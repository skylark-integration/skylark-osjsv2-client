/**
 * skylark-osjsv2-client - A version of osjs-client that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-osjsv2-client/
 * @license MIT
 */
!function(e,t){var n=t.define,require=t.require,i="function"==typeof n&&n.amd,r=!i&&"undefined"!=typeof exports;if(!i&&!n){var o={};n=t.define=function(e,t,n){"function"==typeof n?(o[e]={factory:n,deps:t.map(function(t){return function(e,t){if("."!==e[0])return e;var n=t.split("/"),i=e.split("/");n.pop();for(var r=0;r<i.length;r++)"."!=i[r]&&(".."==i[r]?n.pop():n.push(i[r]));return n.join("/")}(t,e)}),resolved:!1,exports:null},require(e)):o[e]={factory:null,resolved:!0,exports:n}},require=t.require=function(e){if(!o.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var module=o[e];if(!module.resolved){var n=[];module.deps.forEach(function(e){n.push(require(e))}),module.exports=module.factory.apply(t,n)||null,module.resolved=!0}return module.exports}}if(!n)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(e,require){e("skylark-langx-ns/_attach",[],function(){return function(e,t,n){"string"==typeof t&&(t=t.split("."));for(var i=t.length,r=e,o=0,s=t[o++];o<i;)r=r[s]=r[s]||{},s=t[o++];return r[s]=n}}),e("skylark-langx-ns/ns",["./_attach"],function(e){var t={attach:function(n,i){return e(t,n,i)}};return t}),e("skylark-langx-ns/main",["./ns"],function(e){return e}),e("skylark-langx-ns",["skylark-langx-ns/main"],function(e){return e}),e("skylark-langx/skylark",["skylark-langx-ns"],function(e){return e}),e("skylark-osjsv2-client/utils/misc",[],function(){"use strict";return{format:function(e){const t=Array.prototype.slice.call(arguments,1);return e.replace(/\{(\d+)\}/g,function(e,n){return n in t?t[n]:e})},parseurl:function(e,t){t=t||{},e.match(/^(\w+\:)\/\//)||(e="//"+e);const n=e.split(/^(\w+\:)?\/\//),i=(()=>{const e=n[2].replace(/^\/\//,"").split("/");return{proto:(t.protocol||n[1]||window.location.protocol||"").replace(/\:$/,""),host:t.host||e.shift(),path:t.path||"/"+e.join("/")}})();return{protocol:i.proto,host:i.host,path:i.path,url:function(){const e=[i.proto,"://"];if(t.username){const n=String(t.username)+":"+String(t.password);e.push(n),e.push("@")}return e.push(i.host),e.push(i.path),e.join("")}()}},urlparams:function(e,t){return e.slice(e.indexOf(t?"#":"?")+1).split("&").reduce((e,t)=>{let[n,i]=t.split("=");return Object.assign(e,{[n]:decodeURIComponent(i)})},{})},argumentDefaults:function(e,t,n){return e=e||{},Object.keys(t).forEach(n=>{"boolean"==typeof t[n]||"number"==typeof t[n]?void 0!==e[n]&&null!==e[n]||(e[n]=t[n]):e[n]=e[n]||t[n]}),e},mergeObject:function e(t,n,i){i=i||{};for(let r in n)if(n.hasOwnProperty(r))try{if(!1===i.overwrite&&t.hasOwnProperty(r))continue;n[r].constructor===Object?t[r]=e(t[r],n[r]):t[r]=n[r]}catch(e){t[r]=n[r]}return t},cloneObject:function(e,t){if(t)return function e(t){if("object"!=typeof t||null===t)return t;if(t instanceof Array)return t.map(e);const n={};Object.keys(t).forEach(i=>{n[i]=e(t[i])});return n}(e);return JSON.parse(JSON.stringify(e,(e,t)=>t&&"object"==typeof t&&t.tagName?window.undefined:t))}}}),e("skylark-osjsv2-client/core/locales",["../utils/misc"],function(e){"use strict";let t="en_EN",n="en_EN",i=[];function r(){let i={},r={};try{i=OSjs.require("locales/"+n),r=OSjs.require("locales/"+t)}catch(e){console.warn("Locale error",e)}const o=arguments[0];let s=arguments;try{return i&&i[o]?s[0]=i[o]:s[0]=r[o]||o,s.length>1?e.format.apply(null,s):s[0]}catch(e){console.warn(e.stack,e)}return o}function o(){const i=arguments[0],o=arguments[1];let s=Array.prototype.slice.call(arguments,1);return i[n]&&i[n][o]?s[0]=i[n][o]:(s[0]=i[t]&&i[t][o]||o,s[0]&&s[0]===o&&(s[0]=r.apply(null,s))),s.length>1?e.format.apply(null,s):s[0]}return{_:r,__:o,getLocale:function(){return n},setLocale:function(e){let r;try{r=OSjs.require("locales/"+e)}catch(e){return void console.warn("Failed to set locale",e)}r?n=e:(console.warn("Locales::setLocale()","Invalid locale",e,"(Using default)"),n=t);const o=n.split("_")[0],s=document.querySelector("html");s&&(s.setAttribute("lang",e),s.setAttribute("dir",-1!==i.indexOf(o)?"rtl":"ltr"));console.info("Locales::setLocale()",n)},createLocalizer:function(e){return function(){var t=Array.prototype.slice.call(arguments,0);return t.unshift(e),o(...t)}},init:function(e,t,r){t=t||{};const o=r?Object.keys(r):{};o instanceof Array&&-1!==o.indexOf(e)&&(n=e);i=t.RTL||[],o.forEach(e=>{OSjs.Locales[e]=OSjs.require("locales/"+e)})}}}),e("skylark-axios/axios",[],function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var module=t[i]={exports:{},id:i,loaded:!1};return e[i].call(module.exports,module,module.exports,n),module.loaded=!0,module.exports}return n.m=e,n.c=t,n.p="",n(0)}([function(module,exports,e){module.exports=e(1)},function(module,exports,e){"use strict";var t=e(2),n=e(3),i=e(4),r=e(22),o=e(10);function s(e){var r=new i(e),o=n(i.prototype.request,r);return t.extend(o,i.prototype,r),t.extend(o,r),o}var a=s(o);a.Axios=i,a.create=function(e){return s(r(a.defaults,e))},a.Cancel=e(23),a.CancelToken=e(24),a.isCancel=e(9),a.all=function(e){return Promise.all(e)},a.spread=e(25),module.exports=a,module.exports.default=a},function(module,exports,e){"use strict";var t=e(3),n=Object.prototype.toString;function i(e){return"[object Array]"===n.call(e)}function r(e){return void 0===e}function o(e){return null!==e&&"object"==typeof e}function s(e){return"[object Function]"===n.call(e)}function a(e,t){if(null!==e&&void 0!==e)if("object"!=typeof e&&(e=[e]),i(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}module.exports={isArray:i,isArrayBuffer:function(e){return"[object ArrayBuffer]"===n.call(e)},isBuffer:function(e){return null!==e&&!r(e)&&null!==e.constructor&&!r(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){var t;t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer;return t},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:o,isUndefined:r,isDate:function(e){return"[object Date]"===n.call(e)},isFile:function(e){return"[object File]"===n.call(e)},isBlob:function(e){return"[object Blob]"===n.call(e)},isFunction:s,isStream:function(e){return o(e)&&s(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){if("undefined"!=typeof navigator&&("ReactNative"===navigator.product||"NativeScript"===navigator.product||"NS"===navigator.product))return!1;return"undefined"!=typeof window&&"undefined"!=typeof document},forEach:a,merge:function e(){var t={};function n(n,i){"object"==typeof t[i]&&"object"==typeof n?t[i]=e(t[i],n):t[i]=n}for(var i=0,r=arguments.length;i<r;i++)a(arguments[i],n);return t},deepMerge:function e(){var t={};function n(n,i){"object"==typeof t[i]&&"object"==typeof n?t[i]=e(t[i],n):t[i]="object"==typeof n?e({},n):n}for(var i=0,r=arguments.length;i<r;i++)a(arguments[i],n);return t},extend:function(e,n,i){return a(n,function(n,r){e[r]=i&&"function"==typeof n?t(n,i):n}),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(module,exports){"use strict";module.exports=function(e,t){return function(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];return e.apply(t,n)}}},function(module,exports,e){"use strict";var t=e(2),n=e(5),i=e(6),r=e(7),o=e(22);function s(e){this.defaults=e,this.interceptors={request:new i,response:new i}}s.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=o(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=[r,void 0],n=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)n=n.then(t.shift(),t.shift());return n},s.prototype.getUri=function(e){return e=o(this.defaults,e),n(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},t.forEach(["delete","get","head","options"],function(e){s.prototype[e]=function(n,i){return this.request(t.merge(i||{},{method:e,url:n}))}}),t.forEach(["post","put","patch"],function(e){s.prototype[e]=function(n,i,r){return this.request(t.merge(r||{},{method:e,url:n,data:i}))}}),module.exports=s},function(module,exports,e){"use strict";var t=e(2);function n(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}module.exports=function(e,i,r){if(!i)return e;var o;if(r)o=r(i);else if(t.isURLSearchParams(i))o=i.toString();else{var s=[];t.forEach(i,function(e,i){null!==e&&void 0!==e&&(t.isArray(e)?i+="[]":e=[e],t.forEach(e,function(e){t.isDate(e)?e=e.toISOString():t.isObject(e)&&(e=JSON.stringify(e)),s.push(n(i)+"="+n(e))}))}),o=s.join("&")}if(o){var a=e.indexOf("#");-1!==a&&(e=e.slice(0,a)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}},function(module,exports,e){"use strict";var t=e(2);function n(){this.handlers=[]}n.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},n.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},n.prototype.forEach=function(e){t.forEach(this.handlers,function(t){null!==t&&e(t)})},module.exports=n},function(module,exports,e){"use strict";var t=e(2),n=e(8),i=e(9),r=e(10);function o(e){e.cancelToken&&e.cancelToken.throwIfRequested()}module.exports=function(e){o(e),e.headers=e.headers||{},e.data=n(e.data,e.headers,e.transformRequest),e.headers=t.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),t.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]});var s=e.adapter||r.adapter;return s(e).then(function(t){return o(e),t.data=n(t.data,t.headers,e.transformResponse),t},function(t){return i(t)||(o(e),t&&t.response&&(t.response.data=n(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})}},function(module,exports,e){"use strict";var t=e(2);module.exports=function(e,n,i){return t.forEach(i,function(t){e=t(e,n)}),e}},function(module,exports){"use strict";module.exports=function(e){return!(!e||!e.__CANCEL__)}},function(module,exports,e){"use strict";var t=e(2),n=e(11),i={"Content-Type":"application/x-www-form-urlencoded"};function r(e,n){!t.isUndefined(e)&&t.isUndefined(e["Content-Type"])&&(e["Content-Type"]=n)}var o={adapter:function(){var t;"undefined"!=typeof XMLHttpRequest?t=e(12):"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process)&&(t=e(12));return t}(),transformRequest:[function(e,i){return n(i,"Accept"),n(i,"Content-Type"),t.isFormData(e)||t.isArrayBuffer(e)||t.isBuffer(e)||t.isStream(e)||t.isFile(e)||t.isBlob(e)?e:t.isArrayBufferView(e)?e.buffer:t.isURLSearchParams(e)?(r(i,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):t.isObject(e)?(r(i,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};t.forEach(["delete","get","head"],function(e){o.headers[e]={}}),t.forEach(["post","put","patch"],function(e){o.headers[e]=t.merge(i)}),module.exports=o},function(module,exports,e){"use strict";var t=e(2);module.exports=function(e,n){t.forEach(e,function(t,i){i!==n&&i.toUpperCase()===n.toUpperCase()&&(e[n]=t,delete e[i])})}},function(module,exports,e){"use strict";var t=e(2),n=e(13),i=e(5),r=e(16),o=e(19),s=e(20),a=e(14);module.exports=function(l){return new Promise(function(c,u){var d=l.data,h=l.headers;t.isFormData(d)&&delete h["Content-Type"];var p=new XMLHttpRequest;if(l.auth){var g=l.auth.username||"",m=l.auth.password||"";h.Authorization="Basic "+btoa(g+":"+m)}var f=r(l.baseURL,l.url);if(p.open(l.method.toUpperCase(),i(f,l.params,l.paramsSerializer),!0),p.timeout=l.timeout,p.onreadystatechange=function(){if(p&&4===p.readyState&&(0!==p.status||p.responseURL&&0===p.responseURL.indexOf("file:"))){var e="getAllResponseHeaders"in p?o(p.getAllResponseHeaders()):null,t=l.responseType&&"text"!==l.responseType?p.response:p.responseText,i={data:t,status:p.status,statusText:p.statusText,headers:e,config:l,request:p};n(c,u,i),p=null}},p.onabort=function(){p&&(u(a("Request aborted",l,"ECONNABORTED",p)),p=null)},p.onerror=function(){u(a("Network Error",l,null,p)),p=null},p.ontimeout=function(){var e="timeout of "+l.timeout+"ms exceeded";l.timeoutErrorMessage&&(e=l.timeoutErrorMessage),u(a(e,l,"ECONNABORTED",p)),p=null},t.isStandardBrowserEnv()){var _=e(21),w=(l.withCredentials||s(f))&&l.xsrfCookieName?_.read(l.xsrfCookieName):void 0;w&&(h[l.xsrfHeaderName]=w)}if("setRequestHeader"in p&&t.forEach(h,function(e,t){void 0===d&&"content-type"===t.toLowerCase()?delete h[t]:p.setRequestHeader(t,e)}),t.isUndefined(l.withCredentials)||(p.withCredentials=!!l.withCredentials),l.responseType)try{p.responseType=l.responseType}catch(e){if("json"!==l.responseType)throw e}"function"==typeof l.onDownloadProgress&&p.addEventListener("progress",l.onDownloadProgress),"function"==typeof l.onUploadProgress&&p.upload&&p.upload.addEventListener("progress",l.onUploadProgress),l.cancelToken&&l.cancelToken.promise.then(function(e){p&&(p.abort(),u(e),p=null)}),void 0===d&&(d=null),p.send(d)})}},function(module,exports,e){"use strict";var t=e(14);module.exports=function(e,n,i){var r=i.config.validateStatus;!r||r(i.status)?e(i):n(t("Request failed with status code "+i.status,i.config,null,i.request,i))}},function(module,exports,e){"use strict";var t=e(15);module.exports=function(e,n,i,r,o){var s=new Error(e);return t(s,n,i,r,o)}},function(module,exports){"use strict";module.exports=function(e,t,n,i,r){return e.config=t,n&&(e.code=n),e.request=i,e.response=r,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}},function(module,exports,e){"use strict";var t=e(17),n=e(18);module.exports=function(e,i){return e&&!t(i)?n(e,i):i}},function(module,exports){"use strict";module.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(module,exports){"use strict";module.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(module,exports,e){"use strict";var t=e(2),n=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];module.exports=function(e){var i,r,o,s={};return e?(t.forEach(e.split("\n"),function(e){if(o=e.indexOf(":"),i=t.trim(e.substr(0,o)).toLowerCase(),r=t.trim(e.substr(o+1)),i){if(s[i]&&n.indexOf(i)>=0)return;s[i]="set-cookie"===i?(s[i]?s[i]:[]).concat([r]):s[i]?s[i]+", "+r:r}}),s):s}},function(module,exports,e){"use strict";var t=e(2);module.exports=t.isStandardBrowserEnv()?function(){var e,n=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a");function r(e){var t=e;return n&&(i.setAttribute("href",t),t=i.href),i.setAttribute("href",t),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:"/"===i.pathname.charAt(0)?i.pathname:"/"+i.pathname}}return e=r(window.location.href),function(n){var i=t.isString(n)?r(n):n;return i.protocol===e.protocol&&i.host===e.host}}():function(){return!0}},function(module,exports,e){"use strict";var t=e(2);module.exports=t.isStandardBrowserEnv()?{write:function(e,n,i,r,o,s){var a=[];a.push(e+"="+encodeURIComponent(n)),t.isNumber(i)&&a.push("expires="+new Date(i).toGMTString()),t.isString(r)&&a.push("path="+r),t.isString(o)&&a.push("domain="+o),!0===s&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(module,exports,e){"use strict";var t=e(2);module.exports=function(e,n){n=n||{};var i={},r=["url","method","params","data"],o=["headers","auth","proxy"],s=["baseURL","url","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"];t.forEach(r,function(e){void 0!==n[e]&&(i[e]=n[e])}),t.forEach(o,function(r){t.isObject(n[r])?i[r]=t.deepMerge(e[r],n[r]):void 0!==n[r]?i[r]=n[r]:t.isObject(e[r])?i[r]=t.deepMerge(e[r]):void 0!==e[r]&&(i[r]=e[r])}),t.forEach(s,function(t){void 0!==n[t]?i[t]=n[t]:void 0!==e[t]&&(i[t]=e[t])});var a=r.concat(o).concat(s),l=Object.keys(n).filter(function(e){return-1===a.indexOf(e)});return t.forEach(l,function(t){void 0!==n[t]?i[t]=n[t]:void 0!==e[t]&&(i[t]=e[t])}),i}},function(module,exports){"use strict";function e(e){this.message=e}e.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},e.prototype.__CANCEL__=!0,module.exports=e},function(module,exports,e){"use strict";var t=e(23);function n(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var n;this.promise=new Promise(function(e){n=e});var i=this;e(function(e){i.reason||(i.reason=new t(e),n(i.reason))})}n.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},n.source=function(){var e,t=new n(function(t){e=t});return{token:t,cancel:e}},module.exports=n},function(module,exports){"use strict";module.exports=function(e){return function(t){return e.apply(null,t)}}}])}),e("skylark-axios/main",["./axios"],function(e){return e}),e("skylark-axios",["skylark-axios/main"],function(e){return e}),e("skylark-osjsv2-client/helpers/event-handler",[],function(){"use strict";return class{constructor(e,t){this.name=e,this.events={},(t||[]).forEach(function(e){this.events[e]=[]},this),console.debug("EventHandler::constructor()",this.events)}destroy(){this.events={}}on(e,t,n){if(n=n||this,!(t instanceof Function))throw new TypeError("EventHandler::on() expects cb to be a Function");const i=[],r=e=>{this.events[e]instanceof Array||(this.events[e]=[]),i.push(this.events[e].push(e=>t.apply(n,e)))};return e instanceof RegExp?Object.keys(this.events).forEach(function(t){e.test(t)&&r(t)}):e.replace(/\s/g,"").split(",").forEach(function(e){r(e)}),1===i.length?i[0]:i}off(e,t){if(!(this.events[e]instanceof Array))throw new TypeError("Invalid event name");arguments.length>1&&"number"==typeof t?this.events[e].splice(t,1):this.events[e]=[]}emit(e,t,n,i){t=t||[],n=n||this,this.events[e]instanceof Array&&this.events[e].forEach(r=>{try{i?r.apply(n,t):r.call(n,t)}catch(t){console.warn("EventHandler::emit() exception",e,t),console.warn(t.stack)}})}}}),e("skylark-osjsv2-client/helpers/loader",[],function(){"use strict";return new class{constructor(){this.loaders={},this.loaderGraze={},this.$container=document.createElement("osjs-loaders")}create(e,t){if(t=t||{},this.$container.parentNode||document.body.appendChild(this.$container),this.loaders[e])return;const n=document.createElement("osjs-loading");if(n.title=t.title||"",t.icon){const e=document.createElement("img");e.src=t.icon,n.appendChild(e)}this.$container.appendChild(n),this.loaderGraze[e]=setTimeout(()=>{n.style.display="inline-block"},100),this.loaders[e]=n}destroy(e){this.loaders[e]&&(clearTimeout(this.loaderGraze[e]),this.loaders[e].remove(),delete this.loaders[e],delete this.loaderGraze[e])}}}),e("skylark-osjsv2-client/helpers/simplejsonconf",[],function(){"use strict";function e(e){return e&&"object"==typeof e&&!Array.isArray(e)&&null!==e}var exports={from:e=>({getJSON:(t,n)=>exports.getJSON(e,t,n),setJSON:(t,n,i)=>exports.setJSON(e,t,n,i)}),getJSON:(e,t,n)=>{if("string"==typeof t){let i=null,r=e;return t.split(/\./).forEach((e,t,n)=>{t>=n.length-1?i=r[e]:r=r[e]}),void 0===i?n:i}return e}};return exports.setJSON=(()=>{return function(t,n,i,r){const o=!n,s=Object.assign({prune:!1,guess:!1,value:null},r||{});!o&&s.guess&&(i=function(e){try{return JSON.parse(e)}catch(e){}return String(e)}(i));let a=o?i:function(e,t){const n=e.split(/\./);let i={},r=i;return n.forEach((e,i)=>{i>=n.length-1?r[e]=t:(void 0===r[e]&&(r[e]={}),r=r[e])}),i}(n,i),l=function t(n,i){if(e(n)&&e(i))for(var r in i)e(i[r])?(n[r]&&typeof n[r]==typeof i[r]||Object.assign(n,{[r]:{}}),t(n[r],i[r])):Object.assign(n,{[r]:i[r]});return n}(t,a);return s.prune&&function e(t){const n=t instanceof Array;for(let i in t)null===t[i]?n?t.splice(i,1):delete t[i]:"object"==typeof t[i]&&e(t[i])}(l),l}})(),exports}),e("skylark-osjsv2-client/core/config",["../helpers/simplejsonconf"],function(e){"use strict";function t(t,n){const i=OSjs.getConfig();if(!t)return i;const r=e.getJSON(i,t,n);return"object"!=typeof r||r instanceof Array?r:Object.assign({},r)}return{getConfig:t,getDefaultPath:function(e){e&&e.match(/^\//)&&(e=null);return t("VFS.Home")||e||t("VFS.Dist")},getBrowserPath:function(e){let n=t("Connection.RootURI");"string"==typeof e&&(n=n.replace(/\/?$/,e.replace(/^\/?/,"/")));return n},getUserLocale:function(){const e=(window.navigator.userLanguage||window.navigator.language||"en-EN").replace("-","_"),t={nb:"no_NO",es:"es_ES",ru:"ru_RU",en:"en_EN"},n=e.split("_")[0]||"en",i=e.split("_")[1]||n.toUpperCase();if(t[n])return t[n];return n+"_"+i}}}),e("skylark-osjsv2-client/core/connection",["skylark-axios","../helpers/event-handler","../helpers/loader","./config"],function(e,t,n,i){"use strict";function r(e,t){e.lengthComputable?t(e,e.loaded/e.total):t(e,-1)}let o;return class{static get instance(){return o}constructor(){o||(o=this),this.offline=!1,this.index=0,this._evHandler=new t(name,[]),this.onlineFn=(()=>this.onOnline()),this.offlineFn=(()=>this.onOffline())}init(){return void 0!==navigator.onLine&&(window.addEventListener("offline",this.offlineFn),window.addEventListener("online",this.onlineFn)),Promise.resolve()}destroy(){window.removeEventListener("offline",this.offlineFn),window.removeEventListener("online",this.onlineFn),this._evHandler&&(this._evHandler=this._evHandler.destroy()),o=null}getVFSPath(e,t){t=t||{};const n=i.getConfig("Connection.RootURI","/").replace(/\/?$/,"/"),r=i.getConfig("VFS.Dist");if("file:"===window.location.protocol)return e?n+e.path.substr(r.length):n;let o=i.getConfig("Connection.FSURI","/");if(e?(o+="/read",t.path=e.path):o+="/upload",t){const e=Object.keys(t).map(e=>e+"="+encodeURIComponent(t[e]));e.length&&(o+="?"+e.join("&"))}return o}isOnline(){return!this.offline}isOffline(){return this.offline}onVFSRequestCompleted(e,t,n,i,r){return Promise.resolve(!0)}onOnline(){console.warn("Connection::onOnline()","Going online..."),this.offline=!1,this._evHandler&&this._evHandler.emit("online")}onOffline(e){console.warn("Connection::onOffline()","Going offline..."),!this.offline&&this._evHandler&&this._evHandler.emit("offline",[e]),this.offline=!0}createRequest(t,n,i){if(n=n||{},i=i||{},this.offline)return Promise.reject(new Error("You are currently off-line and cannot perform this operation!"));const{raw:o,requestOptions:s}=this.createRequestOptions(t,n);return new Promise((t,n)=>{e(function(e,t){const n=(t=t||{}).onprogress||function(){},i=["onsuccess","onerror","onprogress","oncanceled"];return Object.keys(t).forEach(n=>{-1===i.indexOf(n)&&(e[n]=t[n])}),e.onUploadProgress=(e=>r(e,n)),e.onDownloadProgress=(e=>r(e,n)),e}(s,i)).then(e=>t(o?e.data:{error:!1,result:e.data})).catch(e=>{n(new Error(e.message||e))})})}createRequestOptions(e,t){const n=e.replace(/^FS:/,"");let r=!0,o={responseType:"json",url:i.getConfig("Connection.APIURI")+"/"+n,method:"POST",data:t};return e.match(/^FS:/)&&("get"===n?(o.responseType="arraybuffer",o.url=t.url||this.getVFSPath({path:t.path}),o.method=t.method||"GET",r=!1):o.url="upload"===n?this.getVFSPath():i.getConfig("Connection.FSURI")+"/"+n),{raw:r,requestOptions:o}}subscribe(e,t){return this._evHandler.on(e,t,this)}unsubscribe(e,t){return this._evHandler.off(e,t)}static request(e,t,i){return t=t||{},(i=i||{})&&"object"!=typeof i?Promise.reject(new TypeError("request() expects an object as options")):(n.create("Connection.request"),void 0!==i.indicator&&delete i.indicator,new Promise((r,o)=>{this.instance.createRequest(e,t,i).then(e=>e.error?o(new Error(e.error)):r(e.result)).catch(e=>{o(new Error(e))}).finally(()=>{n.destroy("Connection.request")})}))}}}),e("skylark-osjsv2-client/core/storage",["./connection"],function(e){"use strict";let t;return class{static get instance(){return t}constructor(){t=this,this.saveTimeout=null}init(){return Promise.resolve()}destroy(){t=null}saveSettings(t,n){return clearTimeout(this.saveTimeout),new Promise((i,r)=>{this.saveTimeout=setTimeout(()=>{e.request("settings",{pool:t,settings:Object.assign({},n)}).then(i).catch(r),clearTimeout(this.saveTimeout)},250)})}saveSession(e,t){return new Promise((n,i)=>{const r=e.getProcesses().filter(e=>"function"==typeof e._getSessionData).map(e=>e._getSessionData());t.set("UserSession",null,r,(e,t)=>e?i(e):n(t))})}getLastSession(e){const t=e.get("UserSession"),n=(t||[]).map(e=>{const t=e.args;return t.__resume__=!0,t.__windows__=e.windows||[],{name:e.name,args:t}});return Promise.resolve(n)}}}),e("skylark-osjsv2-client/helpers/settings-fragment",["../utils/misc"],function(e){"use strict";return class t{constructor(e,t,n){if(this._sm=n,this._pool=t,e.constructor!=={}.constructor&&!(e instanceof Array))throw new Error("SettingsFragment will not work unless you give it a object to manage.");this._settings=e}get(e,t){const n=e?this._settings[e]:this._settings;return void 0===n?t:n}set(t,n,i,r){return null===t?e.mergeObject(this._settings,n):["number","string"].indexOf(typeof t)>=0?this._settings[t]=n:console.warn("SettingsFragment::set()","expects key to be a valid iter, not",t),i&&this._sm.save(this._pool,i),void 0!==r&&!0!==r||this._sm.changed(this._pool),this}save(e){return this._sm.save(this._pool,e)}getChained(){let e=this._settings;return arguments.every(function(t){return!!e[t]&&(e=e[t],!0)}),e}mergeDefaults(t){return e.mergeObject(this._settings,t,{overwrite:!1}),this}instance(e){if(void 0===this._settings[e])throw new Error("The object doesn't contain that key. SettingsFragment will not work.");return new t(this._settings[e],this._pool,this._sm)}}}),e("skylark-osjsv2-client/core/settings-manager",["./storage","../helpers/settings-fragment"],function(e,t){"use strict";return new class{constructor(){this.storage={},this.defaultSettings={},this.watches=[]}init(e){return this.storage=e||{},Promise.resolve()}get(e,t){try{return this.storage[e]&&Object.keys(this.storage[e]).length?t?this.storage[e][t]:this.storage[e]:t?this.defaultSettings[e][t]:this.defaultSettings[e]}catch(e){console.warn("SettingsManager::get()","exception",e,e.stack)}return!1}set(e,t,n,i,r){let o=Promise.resolve(!0);try{t?(void 0===this.storage[e]&&(this.storage[e]={}),["number","string"].indexOf(typeof t)>=0?this.storage[e][t]=n:console.warn("SettingsManager::set()","expects key to be a valid iter, not",t)):this.storage[e]=n}catch(e){console.warn("SettingsManager::set()","exception",e,e.stack)}return i&&(o=this.save(e),"function"==typeof i&&(console.warn("Using a callback is deprecated, you should use the returned promise"),o.then(e=>i(!1,e)).catch(e=>i(e,!1)))),void 0!==r&&!0!==r||this.changed(e),o}save(t){console.debug("SettingsManager::save()",t,this.storage);const n={};return Object.keys(this.storage).filter(e=>!e.match(/^__/)).forEach(e=>{n[e]=this.storage[e]}),e.instance.saveSettings(t,n)}defaults(e,t){this.defaultSettings[e]=t}instance(e,n){(!this.storage[e]||this.storage[e]instanceof Array)&&(this.storage[e]={});const i=new t(this.storage[e],e,this);return arguments.length>1&&(this.defaults(e,n),i.mergeDefaults(n)),i}unwatch(e){void 0!==this.watches[e]&&delete this.watches[e]}watch(e,t){if(!this.storage[e])return!1;const n=this.watches.push({pool:e,callback:t});return n-1}changed(e){return this.watches.forEach(t=>{t&&t.pool===e&&t.callback(this.storage[e])}),this}clear(e,t){return t=void 0===t||!0===t,this.set(e,null,{},t),this}}}),e("utils/misc",[],function(){"use strict";return{format:function(e){const t=Array.prototype.slice.call(arguments,1);return e.replace(/\{(\d+)\}/g,function(e,n){return n in t?t[n]:e})},parseurl:function(e,t){t=t||{},e.match(/^(\w+\:)\/\//)||(e="//"+e);const n=e.split(/^(\w+\:)?\/\//),i=(()=>{const e=n[2].replace(/^\/\//,"").split("/");return{proto:(t.protocol||n[1]||window.location.protocol||"").replace(/\:$/,""),host:t.host||e.shift(),path:t.path||"/"+e.join("/")}})();return{protocol:i.proto,host:i.host,path:i.path,url:function(){const e=[i.proto,"://"];if(t.username){const n=String(t.username)+":"+String(t.password);e.push(n),e.push("@")}return e.push(i.host),e.push(i.path),e.join("")}()}},urlparams:function(e,t){return e.slice(e.indexOf(t?"#":"?")+1).split("&").reduce((e,t)=>{let[n,i]=t.split("=");return Object.assign(e,{[n]:decodeURIComponent(i)})},{})},argumentDefaults:function(e,t,n){return e=e||{},Object.keys(t).forEach(n=>{"boolean"==typeof t[n]||"number"==typeof t[n]?void 0!==e[n]&&null!==e[n]||(e[n]=t[n]):e[n]=e[n]||t[n]}),e},mergeObject:function e(t,n,i){i=i||{};for(let r in n)if(n.hasOwnProperty(r))try{if(!1===i.overwrite&&t.hasOwnProperty(r))continue;n[r].constructor===Object?t[r]=e(t[r],n[r]):t[r]=n[r]}catch(e){t[r]=n[r]}return t},cloneObject:function(e,t){if(t)return function e(t){if("object"!=typeof t||null===t)return t;if(t instanceof Array)return t.map(e);const n={};Object.keys(t).forEach(i=>{n[i]=e(t[i])});return n}(e);return JSON.parse(JSON.stringify(e,(e,t)=>t&&"object"==typeof t&&t.tagName?window.undefined:t))}}}),e("skylark-osjsv2-client/utils/fs",["utils/misc"],function(e){"use strict";function t(e){return(e||"").replace(/\/$/,"").split("/").pop()}function n(e,t,n,i){n=n||"application/octet-stream";try{const r=new Blob([t],{type:n}),o=new FileReader;o.onerror=function(e){i(e)},o.onloadend=function(){i(!1,o.result)},o[e](r)}catch(e){console.warn(e,e.stack),i(e)}}return{getPathFromVirtual:function(e){return((e=e||"").split(/([A-z0-9\-_]+)\:\/\/(.*)/)[2]||"").replace(/^\/?/,"/")},getPathProtocol:function(e){const t=document.createElement("a");return t.href=e,t.protocol.replace(/:$/,"")},filename:t,filext:function(e){const n=t(e).split(".").pop();return n?n.toLowerCase():null},dirname:function(e){return e.match(/^((.*)\:\/\/)?\/$/)?e:function(e){const t=e.split(/^(.*)\:\/\/(.*)/).filter(function(e){return""!==e}),n=t.pop(),i=t.pop();let r="";const o=n.split("/").filter(function(e){return""!==e});o.length&&o.pop();(r=o.join("/")).match(/^\//)||(r="/"+r);i&&(r=i+"://"+r);return r}(e.replace(/\/$/,""))},humanFileSize:function(e,t){const n=t?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],i=t?1e3:1024;if(e<i)return e+" B";let r=-1;do{e/=i,++r}while(e>=i);return e.toFixed(1)+" "+n[r]},escapeFilename:function(e){return(e||"").replace(/[\|&;\$%@"<>\(\)\+,\*\/]/g,"").trim()},replaceFileExtension:function(e,t){const n=e.split(".");return n.pop(),n.push(t),n.join(".")},replaceFilename:function(e,t){const n=e.split("/");return n.pop(),n.push(t),n.join("/")},pathJoin:function(){let e=[],t="";function n(e){if(e.match(/^([A-z0-9\-_]+)\:\//)){const n=e.split(/^([A-z0-9\-_]+)\:\//);t||(t=n[1]+"://"),e=n[2]||""}return(e=e.replace(/^\/+/,"").replace(/\/+$/,"")).split("/").filter(function(e){return-1===["",".",".."].indexOf(e)}).join("/")}for(let t=0;t<arguments.length;t++){const i=n(String(arguments[t]));i&&e.push(i)}return t+e.join("/").replace(/^\/?/,"/")},getFilenameRange:function(e){const t={min:0,max:(e=e||"").length};if(e.match(/^\./))e.length>=2&&(t.min=1);else if(e.match(/\.(\w+)$/)){const n=e.split(/\.(\w+)$/);for(let i=n.length-1;i>=0;i--)if(n[i].length){t.max=e.length-n[i].length-1;break}}return t},btoaUrlsafe:function(e){return e&&e.length?btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""):""},atobUrlsafe:function(e){if(e&&e.length)return e=(e+"===").slice(0,e.length+e.length%4),atob(e.replace(/-/g,"+").replace(/_/g,"/"));return""},btoaUtf:function(e){const t=window.unescape||function(e){return e.replace(/%([0-9A-F]{2})/i,function(e,t){return String.fromCharCode(parseInt(t,16))})};return e=t(encodeURIComponent(e)),btoa(e)},atobUtf:function(e){const t=(window.escape||function(e){return e.replace(/[\x00-),:-?[-^`{-\xFF]/g,function(e){return"%"+((e=e.charCodeAt())<16?"0":"")+e.toString(16).toUpperCase()})})(atob(e));return decodeURIComponent(t)},checkAcceptMime:function(e,t){if(e&&t.length){let n;for(let i=0;i<t.length;i++)if(!0===(n=new RegExp(t[i])).test(e))return!0}return!1},filterScandir:function(t,n,i){i=e.cloneObject(i||{});const r=e.cloneObject(n,!0);let o=Object.assign({},i.scandir||{},r);o=Object.assign({},{sortBy:null,sortDir:"asc",typeFilter:null,mimeFilter:[],showHiddenFiles:!0},o);const s=t.filter(function(e){return!(".."===e.filename||!function(e){if(o.typeFilter&&e.type!==o.typeFilter||!o.showHiddenFiles&&e.filename.match(/^\.\w/))return!1;return!0}(e))&&!("file"===e.type&&!function(e){if(o.mimeFilter&&o.mimeFilter.length&&e.mime)return o.mimeFilter.some(function(t){return!!e.mime.match(t)});return!0}(e))}).map(function(e){return"application/vnd.google-apps.folder"===e.mime&&(e.type="dir"),e}),a=o.sortBy,l={mtime:"date",ctime:"date"};-1!==["filename","size","mime","ctime","mtime"].indexOf(a)&&("date"===l[a]?s.sort(function(e,t){return e=new Date(e[a]),t=new Date(t[a]),e>t?1:t>e?-1:0}):"size"!==a&&String.prototype.localeCompare?s.sort(function(e,t){return String(e[a]).localeCompare(String(t[a]))}):s.sort(function(e,t){return e[a]>t[a]?1:t[a]>e[a]?-1:0}),"desc"===o.sortDir&&s.reverse());return s.filter(function(e){return"dir"===e.type}).concat(s.filter(function(e){return"dir"!==e.type}))},addFormFile:function(e,t,n,i){if(i=i||{mime:"application/octet-stream",filename:"filename"},n instanceof window.File)e.append(t,n);else if(n instanceof window.ArrayBuffer){try{n=new Blob([n],{type:i.mime})}catch(e){n=null,console.warn(e,e.stack)}e.append(t,n,i.filename)}else n.data&&n.filename&&e.append(t,n.data,n.filename)},dataSourceToAb:function(e,t,n){const i=atob(e.split(",")[1]),r=new ArrayBuffer(i.length),o=new Uint8Array(r);for(let e=0;e<i.length;e++)o[e]=i.charCodeAt(e);n(!1,r)},textToAb:function(e,t,i){n("readAsArrayBuffer",e,t,i)},abToDataSource:function(e,t,i){n("readAsDataURL",e,t,i)},abToText:function(e,t,i){n("readAsText",e,t,i)},abToBinaryString:function(e,t,i){n("readAsBinaryString",e,t,i)},abToBlob:function(e,t,n){t=t||"application/octet-stream";try{const i=new Blob([e],{type:t});n(!1,i)}catch(e){console.warn(e,e.stack),n(e)}},blobToAb:function(e,t){try{const n=new FileReader;n.onerror=function(e){t(e)},n.onloadend=function(){t(!1,n.result)},n.readAsArrayBuffer(e)}catch(e){console.warn(e,e.stack),t(e)}}}}),e("skylark-osjsv2-client/vfs/file",["../utils/fs","../core/config","../core/locales"],function(e,t,n){"use strict";return class i{constructor(e,t){if(!e)throw new Error(n._("ERR_VFS_FILE_ARGS"));this.path=null,this.filename=null,this.type=null,this.size=null,this.mime=null,this.id=null,this.shortcut=!1,"object"==typeof e?this.setData(e):"string"==typeof e&&(this.path=e,this.setData()),"string"==typeof t&&(t.match(/\//)?this.mime=t:this.type=t),this._guessMime()}setData(t){t&&Object.keys(t).forEach(e=>{"_element"!==e&&(this[e]=t[e])}),this.filename||(this.filename=e.filename(this.path))}getData(){return{path:this.path,filename:this.filename,type:this.type,size:this.size,mime:this.mime,id:this.id}}_guessMime(){if(this.mime||"dir"===this.type||!this.path||this.path.match(/\/$/))return;const n=e.filext(this.path);this.mime=t.getConfig("MIME.mapping")["."+n]||"application/octet-stream"}static fromUpload(e,t){return new i({filename:t.name,path:(e+"/"+t.name).replace(/\/\/\/\/+/,"///"),mime:t.mime||"application/octet-stream",size:t.size})}}}),e("skylark-osjsv2-client/core/package-manager",["./settings-manager","../utils/misc","./locales","./config","../utils/fs","./connection"],function(e,t,n,i,r,o){"use strict";const s=(e,t)=>{const n=i.getConfig("Connection.PackageURI"),o=e=>"string"==typeof e?{src:e}:e;let s=[],a=(e.preload||[]).slice(0).map(o);e.depends instanceof Array&&e.depends.forEach(e=>{if(!OSjs.Applications[e]){const n=t.getPackage(e);n&&(console.info("Using dependency",e),s=s.concat(n.preload.map(o)))}});const l=t.getPackages(!1);return Object.keys(l).forEach(e=>{const t=l[e];"extension"===t.type&&t.uses===name&&t&&(console.info("Using extension",e),s=s.concat(t.preload.map(o)))}),s.concat(a).map(i=>(i.src.match(/^(\/|https?|ftp)/)||("user"===e.scope?t.VFS.url(r.pathJoin(e.path,i.src)).then(e=>(i.src=e,!0)):i.src=r.pathJoin(n,e.path,i.src)),i))};return new class{constructor(){this.packages={},this.blacklist=[]}destroy(){this.packages={},this.blacklist=[]}init(e,t,i,r){return this.Authenticator=e,this.VFS=t,console.debug("PackageManager::load()",i),new Promise((e,t)=>{const o=i?this.setPackages(i):Promise.resolve();o.then(()=>r?e(!0):this._loadMetadata().then(()=>{const i=Object.keys(this.packages).length;return i?e(!0):t(new Error(n._("ERR_PACKAGE_ENUM_FAILED")))}).catch(t)).catch(t)})}_loadMetadata(){const t=e.instance("PackageManager").get("PackagePaths",[]);return new Promise((e,n)=>{o.request("packages",{command:"list",args:{paths:t}}).then(t=>this.setPackages(t).then(e).catch(n)).catch(n)})}generateUserMetadata(){const t=e.instance("PackageManager").get("PackagePaths",[]);return new Promise((e,n)=>{const i=()=>this._loadMetadata().then(e).catch(n);o.request("packages",{command:"cache",args:{action:"generate",scope:"user",paths:t}}).then(i).catch(i)})}_addPackages(e,i){console.debug("PackageManager::_addPackages()",e);const r=Object.keys(e);if(!r.length)return;const o=n.getLocale();r.forEach(n=>{const r=t.cloneObject(e[n]);"object"==typeof r&&(void 0!==r.names&&r.names[o]&&(r.name=r.names[o]),void 0!==r.descriptions&&r.descriptions[o]&&(r.description=r.descriptions[o]),r.description||(r.description=r.name),r.scope=i||"system",r.type=r.type||"application",this.packages[n]=r)})}install(t,n){const i=e.instance("PackageManager").get("PackagePaths",[]);"string"!=typeof n&&(n=i[0]);const s=r.pathJoin(n,t.filename.replace(/\.zip$/i,""));return new Promise((e,n)=>{o.request("packages",{command:"install",args:{zip:t.path,dest:s,paths:i}}).then(()=>this.generateUserMetadata().then(e).catch(n)).catch(n)})}uninstall(e){return new Promise((t,n)=>{o.request("packages",{command:"uninstall",args:{path:e.path}}).then(()=>this.generateUserMetadata().then(t).catch(n)).catch(n)})}setBlacklist(e){this.blacklist=e||[]}getStorePackages(t){const n=e.instance("PackageManager").get("Repositories",[]);let i=[];return new Promise((e,t)=>{Promise.all(n.map(e=>new Promise((t,n)=>{o.request("curl",{url:e,method:"GET"}).then(n=>{let r=[];if("string"==typeof n.body)try{r=JSON.parse(n.body)}catch(e){}return i=i.concat(r.map(t=>(t._repository=e,t))),t()}).catch(n)}))).then(()=>e(i)).catch(t)})}getPackage(e){return void 0!==this.packages[e]&&Object.freeze(t.cloneObject(this.packages)[e])}getPackages(n){const i=this.Authenticator,r=e.instance("PackageManager").get("Hidden",[]),o=t.cloneObject(this.packages),s=e=>!(this.blacklist.indexOf(e.path)>=0)&&!(e&&e.groups instanceof Array&&!i.instance().checkPermission(e.groups));if(void 0===n||!0===n){const e={};return Object.keys(o).forEach(t=>{const n=o[t];s(n)&&n&&r.indexOf(t)<0&&(e[t]=n)}),Object.freeze(e)}return Object.freeze(o)}getPackagesByMime(e){const n=[],i=t.cloneObject(this.packages);return Object.keys(i).forEach(t=>{if(this.blacklist.indexOf(t)<0){const o=i[t];o&&o.mime&&r.checkAcceptMime(e,o.mime)&&n.push(t)}}),n}getPackageResource(e,t,n){if(t.match(/^((https?:)|\.)?\//))return t;t=t.replace(/^\.\//,"");const o="string"==typeof e?e:e.__pname,s=i.getConfig("Connection.FSURI"),a=this.getPackage(o);let l=t;return a&&(l="user"===a.scope?"/user-package/"+r.filename(a.path)+"/"+t.replace(/^\//,""):"packages/"+a.path+"/"+t,n)?"user"===a.scope?l.substr(s.length):i.getConfig("VFS.Dist")+l:l}setPackages(e){const t={},o=n.getLocale(),a=(e,t,n)=>{(t=Object.assign({},t)).type=t.type||"application",n&&(t.scope=n),t.names&&t.names[o]&&(t.name=t.names[o]),t.descriptions&&t.descriptions[o]&&(t.description=t.descriptions[o]);let a=()=>{if(t.icon&&t.path){let e=t.path.replace(/^\//,"");if("user"===t.scope)return this.VFS.url(r.pathJoin(e,t.icon));if(t.icon.match(/^\.\//)){const n=i.getConfig("Connection.PackageURI").replace(/\/?$/,"/");return Promise.resolve(n+e+t.icon.replace(/^\./,""))}}return Promise.resolve(t.icon)};return t.preload=s(t,this),new Promise((e,n)=>{a().then(n=>(n&&(t.icon=n),e(t))).catch(n)})};return new Promise((n,i)=>{const r=Object.keys(e||{});Promise.each(r,n=>new Promise((i,r)=>{const o=e[n];o&&!t[o.className]?a(n,o).then(e=>(t[o.className]=e,i())).catch(r):(console.warn("No such package",n),i())})).catch(i).then(()=>(this.packages=t,n()))})}}}),e("skylark-osjsv2-client/utils/compability",[],function(){"use strict";const e=function(){function e(){return document.createElement("canvas").getContext?document.createElement("canvas"):null}function t(){return document.createElement("video").canPlayType?document.createElement("video"):null}function n(e,t){return function(e,t,n){const i={};return Object.keys(t).forEach(e=>{let r=t[e],o=!1;r instanceof Array?r.forEach(e=>!(o=n(e))):o=n(r),i[e]=o}),i}(0,t,t=>{try{return!!e.canPlayType(t)}catch(e){}return!1})}function i(){return document.createElement("audio").canPlayType?document.createElement("audio"):null}const r=(()=>{const t=[];return()=>{if(!t.length){const n=e();if(n){const e=["2d","webgl","experimental-webgl","webkit-3d","moz-webgl"];e.forEach((e,i)=>{try{n.getContext(e)&&t.push(e)}catch(e){}})}}return t}})();function o(e){let t=!1,n="Webkit Moz ms O".split(" "),i=document.createElement("div"),r=null;if(e=e.toLowerCase(),i.style[e]&&(t=!0),!1===t){r=e.charAt(0).toUpperCase()+e.substr(1);for(let e=0;e<n.length;e++)if(void 0!==i.style[n[e]+r]){t=!0;break}}return t}const s={indexedDB:"indexedDB",localStorage:"localStorage",sessionStorage:"sessionStorage",globalStorage:"globalStorage",openDatabase:"openDatabase",socket:"WebSocket",worker:"Worker",file:"File",blob:"Blob",orientation:"onorientationchange"},a={touch:function(){try{if(navigator.userAgent.match(/Windows NT 6\.(2|3)/))return!1}catch(e){}try{if(navigator.userAgent.match(/iOS|Android|BlackBerry|IEMobile|iPad|iPhone|iPad/i))return!0}catch(e){}return!1}(),upload:function(){try{const e=new XMLHttpRequest;return!!(e&&"upload"in e&&"onprogress"in e.upload)}catch(e){}return!1}(),getUserMedia:function(){let e=!1;window.navigator&&(e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia);return!!e}(),fileSystem:"requestFileSystem"in window||"webkitRequestFileSystem"in window,localStorage:!1,sessionStorage:!1,globalStorage:!1,openDatabase:!1,socket:!1,worker:!1,file:!1,blob:!1,orientation:!1,dnd:!!("draggable"in document.createElement("span")),css:{transition:o("transition"),animation:o("animation")},canvas:!!e(),canvasContext:r(),webgl:function(){let e=!1,t=r();try{(e=t.length>1)||"WebGLRenderingContext"in window&&(e=!0)}catch(e){}return e}(),audioContext:function(){if(window.hasOwnProperty("AudioContext")||window.hasOwnProperty("webkitAudioContext"))return!0;return!1}(),svg:!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,video:!!t(),videoTypes:n(t(),{webm:'video/webm; codecs="vp8.0, vorbis"',ogg:'video/ogg; codecs="theora"',h264:['video/mp4; codecs="avc1.42E01E"','video/mp4; codecs="avc1.42E01E, mp4a.40.2"'],mpeg:'video/mp4; codecs="mp4v.20.8"',mkv:'video/x-matroska; codecs="theora, vorbis"'}),audio:!!i(),audioTypes:n(i(),{ogg:'audio/ogg; codecs="vorbis',mp3:"audio/mpeg",wav:'audio/wav; codecs="1"'}),richtext:function(){try{return!!document.createElement("textarea").contentEditable}catch(e){}return!1}()};return Object.keys(s).forEach(e=>{try{a[e]=s[e]in window&&null!==window[s[e]]}catch(e){console.warn(e)}}),()=>a}();return{getCompability:function(){return e()},isIE:function(){return parseInt(document.documentMode,10)<=11||!!navigator.userAgent.match(/(MSIE|Edge)/)}}}),e("skylark-osjsv2-client/utils/dom",[],function(){"use strict";function e(e,t){let n="";return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(e,"").getPropertyValue(t):e.currentStyle&&(t=t.replace(/\-(\w)/g,(e,t)=>t.toUpperCase()),n=e.currentStyle[t]),n}return{$:function(e){return document.getElementById(e)},$safeName:function(e){return(e||"").replace(/[^a-zA-Z0-9]/g,"_")},$remove:function(e){e&&("function"==typeof e.remove?e.remove():e.parentNode&&e.parentNode.removeChild(e))},$empty:function(e){if(e)for(;e.firstChild;)e.removeChild(e.firstChild)},$getStyle:e,$position:function(e,t){if(e){if(t){const n={left:0,top:0,width:e.offsetWidth,height:e.offsetHeight};for(;n.left+=e.offsetLeft,n.top+=e.offsetTop,e.offsetParent!==t&&null!==e.offsetParent;)e=e.offsetParent;return n}return e.getBoundingClientRect()}return null},$parent:function(e,t){let n=null;if(e&&t){let i=e;for(;i.parentNode;){if(t(i)){n=i;break}i=i.parentNode}}return n},$index:function(e,t){if(e&&(t=t||e.parentNode)){const n=Array.prototype.slice.call(t.children),i=n.indexOf(e,t);return i}return-1},$selectRange:function(e,t,n){if(!e)throw new Error("Cannot select range: missing element");if(void 0===t||void 0===n)throw new Error("Cannot select range: mising start/end");if(e.createTextRange){const i=e.createTextRange();i.collapse(!0),i.moveStart("character",t),i.moveEnd("character",n),i.select(),e.focus()}else e.setSelectionRange?(e.focus(),e.setSelectionRange(t,n)):void 0!==e.selectionStart&&(e.selectionStart=t,e.selectionEnd=n,e.focus())},$addClass:function(e,t){e&&t.split(" ").forEach(t=>{e.classList.add(t)})},$removeClass:function(e,t){e&&t.split(" ").forEach(t=>{e.classList.remove(t)})},$hasClass:function(e,t){if(e&&t)return t.split(" ").every(t=>e.classList.contains(t));return!1},$escape:function(e){const t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML},$create:function(e,t){const n=document.createElement(e);function i(e,t){e=e||{},Object.keys(e).forEach(n=>{t(n.replace(/_/g,"-"),String(e[n]))})}return i(t.style,(e,t)=>{n.style[e]=t}),i(t.aria,(e,t)=>{-1!==["role"].indexOf(e)&&(e="aria-"+e),n.setAttribute(e,t)}),i(t.data,(e,t)=>{n.setAttribute("data-"+e,t)}),i(t,(e,t)=>{-1===["style","aria","data"].indexOf(e)&&(n[e]=t)}),n},$createCSS:function(e,t,n){const i=document.createElement("link");return i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.onload=t||function(){},i.onerror=n||function(){},i.setAttribute("href",e),document.getElementsByTagName("head")[0].appendChild(i),i},$createJS:function(e,t,n,i,r){const o=document.createElement("script");return o.onreadystatechange=t||function(){},o.onerror=i||function(){},o.onload=n||function(){},r=Object.assign({},{type:"text/javascript",charset:"utf-8",src:e},r||{}),Object.keys(r).forEach(e=>{o[e]=String(r[e])}),document.getElementsByTagName("head")[0].appendChild(o),o},$isFormElement:function(e,t){t=t||["TEXTAREA","INPUT","SELECT"],e instanceof window.Event&&(e=e.srcElement||e.target);if(e instanceof window.Element&&t.indexOf(e.tagName.toUpperCase())>=0&&!e.readOnly&&!e.disabled)return!0;return!1},$css:function(t,n,i){function r(e){return e.replace(/\-(\w)/g,(e,t)=>t.toUpperCase())}let o={};if(2===arguments.length){if("string"==typeof n)return t.parentNode?e(t,n):t.style[r(n)];o=n}else 3===arguments.length&&(o[n]=i);return Object.keys(o).forEach(e=>{t.style[r(e)]=String(o[e])}),null},$path:function(e){return function e(t){if(t===document.body)return t.tagName;if(t===window)return"WINDOW";if(t===document)return"DOCUMENT";if(""!==t.id)return'id("'+t.id+'")';let n=0;const i=t.parentNode?t.parentNode.childNodes:[];for(let r=0;r<i.length;r++){const o=i[r];if(o===t)return e(t.parentNode)+"/"+t.tagName+"["+(n+1)+"]";1===o.nodeType&&o.tagName===t.tagName&&n++}return null}(e)},$fromPath:function(e,t){return t=t||document,(new XPathEvaluator).evaluate(e,t.documentElement,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue},$clean:function(e){"string"!=typeof e&&(e=e.innerHTML);return(e||"").replace(/\n/g,"").replace(/[\t ]+</g,"<").replace(/\>[\t ]+</g,"><").replace(/\>[\t ]+$/g,">")}}}),e("skylark-osjsv2-client/core/theme",["./settings-manager","./config","../vfs/file","./package-manager","../utils/fs","../utils/compability","../utils/dom"],function(e,t,n,i,r,o,s){"use strict";return new class{constructor(){const e=o.getCompability();this.settings=null,this.$themeScript=null,this.audioAvailable=!!e.audio,this.oggAvailable=!!e.audioTypes.ogg}init(t){this.VFS=t,this.settings=e.instance("__theme__",{enableSounds:!0,styleTheme:"default",soundTheme:"default",iconTheme:"default",sounds:{}})}update(e,t){this.settings.set(null,e),t&&this.setTheme(e)}destroy(){this.$themeScript=s.$remove(this.$themeScript)}themeAction(e,t){const n=this.getStyleTheme();t=t||[];try{if(OSjs.Themes[n])return OSjs.Themes[n][e].apply(null,t)}catch(e){console.warn(e)}return null}_setBackground(e){const t=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,n={image:"normal","image-center":"center","image-fill":"fill","image-strech":"strech"};let i="color",r="none";if(e.wallpaper&&e.background.match(/^image/)&&(r=e.wallpaper,i=n[e.background]||"default"),"none"!==r)try{this.VFS.url(r).then(e=>(r="url('"+e+"')",document.body.style.backgroundImage=r,!0))}catch(e){console.warn(e)}else document.body.style.backgroundImage=r;e.backgroundColor&&(document.body.style.backgroundColor=e.backgroundColor),e.fontFamily&&(document.body.style.fontFamily=e.fontFamily),document.body.style.backgroundAttachment=t?"fixed":"scroll",document.body.setAttribute("data-background-style",i)}getThemeCSS(e){let n=t.getConfig("Connection.RootURI","/");return null===e?n+"blank.css":(n=t.getConfig("Connection.ThemeURI"))+"/"+e+".css"}setTheme(e){this.themeAction("destroy"),this.setThemeScript(this.getThemeResource("theme.js")),document.body.setAttribute("data-style-theme",e.styleTheme),document.body.setAttribute("data-icon-theme",e.iconTheme),document.body.setAttribute("data-sound-theme",e.soundTheme),document.body.setAttribute("data-animations",String(e.animations)),this._setBackground(e),this.settings.set(null,e)}setThemeScript(e){this.$themeScript&&(this.$themeScript=s.$remove(this.$themeScript)),e&&(this.$themeScript=s.$createJS(e,null,()=>{this.themeAction("init")}))}getStyleTheme(e,t){const n=this.settings.get("styleTheme")||null;if(e){let e=null;if(n&&this.getStyleThemes().forEach(function(t){t&&t.name===n&&(e=t)}),e&&!0===t){const t=document.createElement("div");t.style.visibility="hidden",t.style.position="fixed",t.style.top="-10000px",t.style.left="-10000px",t.style.width="1em",t.style.height="1em",document.body.appendChild(t);const n=t.offsetWidth;if(t.parentNode.removeChild(t),"string"==typeof e.style.window.margin&&e.style.window.margin.match(/em$/)){const t=parseFloat(e.style.window.margin);e.style.window.margin=t*n}if("string"==typeof e.style.window.border&&e.style.window.border.match(/em$/)){const t=parseFloat(e.style.window.border);e.style.window.border=t*n}}return e}return n}getThemeResource(e,n){e=e||null,n=n||null;const i=t.getConfig("Connection.ThemeURI");if(e){const t=this.getStyleTheme();e=function(e,t){e.match(/^\//)||(e="base"===n||null===n?`${i}/${t}/${e}`:`${i}/${t}/${n}/${e}`);return e}(e,t)}return e}getSound(e){if((e=e||null)&&!e.match(/^(https?:)?\//)){const n=this.getSoundTheme(),i=t.getConfig("Connection.SoundURI"),r=this.oggAvailable?"oga":"mp3";e=`${i}/${n}/${e}.${r}`}return e}playSound(e,t){const n=this.getSoundFilename(e);if(!n)return console.debug("playSound()","Cannot play sound, no compability or not enabled!"),null;void 0===t&&(t=1);const i=this.getSound(n);console.debug("playSound()",e,n,i,t);const r=new Audio(i);return r.volume=t,r.play(),r}getIcon(e,n){if(e=e||"",n=n||"16x16",!e.match(/^(https:?)?\//)){const i=t.getConfig("Connection.IconURI"),r=this.getIconTheme();e=`${i}/${r}/${n}/${e}`}return e}getFileIcon(e,t,o){if(o=o||"mimetypes/text-x-preview.png","object"!=typeof e||e instanceof n||(e=new n(e)),!e.filename)throw new Error("Filename is required for getFileIcon()");const s=[{match:"application/pdf",icon:"mimetypes/x-office-document.png"},{match:"application/zip",icon:"mimetypes/package-x-generic.png"},{match:"application/x-python",icon:"mimetypes/text-x-script.png"},{match:"application/x-lua",icon:"mimetypes/text-x-script.png"},{match:"application/javascript",icon:"mimetypes/text-x-script.png"},{match:"text/html",icon:"mimetypes/text-html.png"},{match:"text/xml",icon:"mimetypes/text-html.png"},{match:"text/css",icon:"mimetypes/text-x-script.png"},{match:"osjs/document",icon:"mimetypes/x-office-document.png"},{match:"osjs/draw",icon:"mimetypes/image-x-generic.png"},{match:/^text\//,icon:"mimetypes/text-x-generic.png"},{match:/^audio\//,icon:"mimetypes/audio-x-generic.png"},{match:/^video\//,icon:"mimetypes/video-x-generic.png"},{match:/^image\//,icon:"mimetypes/image-x-generic.png"},{match:/^application\//,icon:"mimetypes/application-x-executable.png"}];if("dir"===e.type)o="places/folder.png";else if("trash"===e.type)o="places/user-trash.png";else if("application"===e.type){const n=r.filename(e.path),o=i.getPackage(n);if(o)return o.icon.match(/^((https?:)|\.)?\//)?i.getPackageResource(n,o.icon):this.getIcon(o.icon,t)}else{const t=e.mime||"application/octet-stream";s.every(e=>{let n=!1;return!(n="string"==typeof e.match?t===e.match:t.match(e.match))||(o=e.icon,!1)})}return this.getIcon(o,t)}getIconTheme(){return this.settings.get("iconTheme","default")}getSoundTheme(){return this.settings.get("soundTheme","default")}getSoundFilename(e){if(!this.audioAvailable||!this.settings.get("enableSounds")||!e)return!1;const t=this.settings.get("sounds",{});return t[e]||null}getStyleThemes(){return t.getConfig("Styles",[])}getSoundThemes(){return t.getConfig("Sounds",[])}getIconThemes(){return t.getConfig("Icons",[])}}}),e("skylark-osjsv2-client/helpers/hooks",["./event-handler"],function(e){"use strict";let t=new e("core-hooks",["initialize","initialized","sessionLoaded","shudown","processStart","processStarted","menuBlur"]);return{triggerHook:function(e,n,i){t&&t.emit(e,n,i,!0)},addHook:function(e,n){if(t)return t.on(e,n);return-1},removeHook:function(e,n){if(t)return t.off(e,n);return!1}}}),e("skylark-osjsv2-client/helpers/promise-limit",[],function(){function e(e){var t=0,n=[];function i(){var i;--t<e&&(i=n.shift(),o.queue=n.length,i&&r(i.fn).then(i.resolve).catch(i.reject))}function r(e){t++;try{return Promise.resolve(e()).then(function(e){return i(),e},function(e){throw i(),e})}catch(e){return i(),Promise.reject(e)}}var o=function(i){return t>=e?function(e){return new Promise(function(t,i){n.push({fn:e,resolve:t,reject:i}),o.queue=n.length})}(i):r(i)};return o}function t(e,t){var n=!1,i=this;return Promise.all(e.map(function(){var e=arguments;return i(function(){if(!n)return t.apply(void 0,e).catch(function(e){throw n=!0,e})})}))}function n(e){return e.queue=0,e.map=t,e}return function(t){return n(t?e(t):function(e){return e()})}}),e("skylark-osjsv2-client/utils/preloader",["../helpers/promise-limit","../core/config","skylark-axios"],function(e,t,n){"use strict";const i=e=>e.match(/\.js$/i)?"javascript":e.match(/\.css$/i)?"stylesheet":"unknown",r=e=>e&&!e.match(/^(\/|file|https?)/)?t.getBrowserPath(e):e,o={javascript:e=>new Promise((t,n)=>{const i=document.createElement("script");i.onreadystatechange=function(){"complete"!==this.readyState&&"loaded"!==this.readyState||t()},i.onerror=(e=>{let t=new Error;t.name="<script> error",t.message="Failed to load script",n(t)}),i.onload=(()=>t()),i.src=e,document.getElementsByTagName("head")[0].appendChild(i)}),stylesheet:e=>new Promise((t,n)=>{let i;const r=e=>{clearTimeout(i);let t=new Error;t.name="<link> error",t.message=e,n(t)},o=document.createElement("link");o.setAttribute("rel","stylesheet"),o.setAttribute("type","text/css"),o.onload=(()=>t()),o.onerror=(e=>r("Failed to load link")),o.setAttribute("href",e),document.getElementsByTagName("head")[0].appendChild(o),i=setTimeout(()=>{r("Loading stylesheet timed out")},3e4),setTimeout(()=>{(e=>{let t=!1;return(document.styleSheet||[]).forEach((n,i)=>-1===n.href.indexOf(e)||(t=!0,!1)),t})(e)&&(clearTimeout(i),t())},10)}),html:e=>new Promise((t,i)=>{n.get(e).then(e=>t(e.data)).catch(e=>i(e.message))})};return new class{constructor(){this.cache={}}clear(){this.cache={}}preload(t,n){n=n||{},t=t.map(e=>"string"==typeof e?{src:r(e),force:!1,type:i(e)}:(e.src=r(e.src),e.type||(e.type=i(e.src)),e)).filter(e=>!!e.src),console.group("Preloader.load()",t);const s=e(n.max||1),a=t.length,l=[],c=[],u=[],d=(e,t,i)=>(void 0!==t&&u.push({item:e,data:t}),!1!==n.cache&&void 0===this.cache[e.src]&&(this.cache[e.src]=t),c.push(e.src),i()),h=(e,t)=>("function"==typeof n.progress&&n.progress(t,a),o[e.type]?new Promise((t,i)=>{n.force||!this.cache[e.src]?o[e.type](e.src).then(n=>d(e,n,t)).catch(n=>(console.warn("Failed loading",e.src,n),l.push(e.src),t())):d(e,this.cache[e.src],t)}):Promise.resolve());return new Promise((e,n)=>{Promise.all(t.map((e,t)=>s(()=>h(e,t)))).then(()=>(console.groupEnd(),e({success:!1,data:u,failed:l,loaded:c}))).catch(n)})}}}),e("skylark-osjsv2-client/core/process",["./connection","../helpers/event-handler","./theme","../utils/fs","./config","../utils/compability","./locales","../helpers/hooks","../helpers/loader","../vfs/file","../utils/preloader","./settings-manager","./package-manager"],function(e,t,n,i,r,o,s,a,l,c,u,d,h){"use strict";let p=[],g=[];function m(e,t){if(e>=0&&g[e])try{const n=g[e].destroy(t);if(console.warn("Killing application",e,n),!1!==n)return g[e]=null,!0}catch(e){console.warn(e)}return!1}return class f{constructor(e,n,i){console.group("Process::constructor()",g.length,arguments),this.__pid=g.push(this)-1,this.__pname=e,this.__args=n||{},this.__metadata=i||{},this.__started=new Date,this.__destroyed=!1,this.__evHandler=new t(e,["message","attention","hashchange","api","destroy","destroyWindow","vfs","vfs:mount","vfs:unmount","vfs:mkdir","vfs:write","vfs:move","vfs:copy","vfs:delete","vfs:upload","vfs:update"]),this.__label=this.__metadata.name,this.__path=this.__metadata.path,this.__scope=this.__metadata.scope||"system",this.__iter=this.__metadata.className,console.groupEnd()}destroy(){return!this.__destroyed&&(this.__destroyed=!0,console.group("Process::destroy()",this.__pid,this.__pname),this._emit("destroy",[]),this.__evHandler&&(this.__evHandler=this.__evHandler.destroy()),this.__pid>=0&&(g[this.__pid]=null),console.groupEnd(),!0)}_onMessage(e,t,n){let i=(n=n||{}).source;i&&"object"==typeof i&&(i instanceof f?i=i.__pid:i._app&&(i=i._app?i._app.__pid:-1)),this.__evHandler&&i!==this.__pid&&(console.debug("Process::_onMessage()",e,t,n,this.__pid,this.__pname),this.__evHandler.emit("message",[e,t,n]),"vfs"===e.substr(0,3)&&this.__evHandler.emit("vfs",[e,t,n]),this.__evHandler.emit(e,[t,n,e]))}_emit(e,t){return this.__evHandler?this.__evHandler.emit(e,t):null}_on(e,t){return this.__evHandler?this.__evHandler.on(e,t,this):null}_off(e,t){this.__evHandler&&this.__evHandler.off(e,t)}_api(t,n,i){return"boolean"==typeof i?i={indicator:i}:"object"!=typeof i&&(i={}),this._emit("api",[t]),new Promise((r,o)=>{e.request("application",{application:this.__iter,path:this.__path,method:t,args:n},i).then(e=>this.__destroyed?(console.warn("Process::_api()","INGORED RESPONSE: Process was closed"),!1):(r(e),!0)).catch(e=>{this.__destroyed||o(e instanceof Error?e:new Error(e))})})}_getArgument(e){return void 0===this.__args[e]?null:this.__args[e]}_getArguments(){return this.__args}_getResource(e,t){return h.getPackageResource(this,e,t)}_setArgument(e,t){this.__args[e]=t}static kill(e){return m(e)}static killAll(e){let t=()=>!0;e&&(t=e instanceof RegExp?t=>t.__pname.match(e):t=>t.__pname===e),this.getProcesses().filter(e=>t(e)).forEach(e=>m(e.__pid,!0)),g=[]}static message(e,t,n){n=n||{},console.debug("Process::message()",e,t,n);let i=n.filter||(()=>!0);if("string"==typeof i){const e=i;i=(t=>t.__pname===e)}this.getProcesses().filter(i).forEach(i=>i._onMessage(e,t,n))}static getProcess(e,t){if("number"==typeof e)return g[e];const n=this.getProcesses().filter(t=>t.__pname===e);return t?n[0]:n}static getProcesses(){return g.filter(e=>!!e)}static reload(e){e instanceof Array||(e=[e]),e.map(e=>this.getProcess(e,!0)).filter(e=>!!e).forEach(e=>{let t,n=null,i=e._getSessionData(),r={};try{t=e.__pname,n=e.destroy()}catch(e){console.warn("Process::reload()",e.stack,e)}null!==i&&((r=i.args).__resume__=!0,r.__windows__=i.windows||[]),r.__preload__={force:!0},n instanceof Promise||(n=Promise.resolve(!0)),t&&n.then(()=>setTimeout(()=>{this.create(t,r)},500))})}static create(e,t,i){t=t||{},i=i||function(){};const c=e+JSON.stringify(t);if(-1!==p.indexOf(c))return Promise.resolve(null);p.push(c);return new Promise((m,_)=>{console.group("Process::create()",e,t);const w=()=>{console.groupEnd();const t=p.indexOf(c);t>=0&&p.splice(t,1),l.destroy("Main.launch."+e)},b=t=>(l.destroy("Main.launch."+e),w(),g=t,OSjs.error(s._("ERR_APP_LAUNCH_FAILED"),s._("ERR_APP_LAUNCH_FAILED_FMT",e),g,g,!0),_(t));try{(()=>{if(!e)throw new Error("Cannot Process::create() witout a application name");const c=o.getCompability(),p=h.getPackage(e),g=f.getProcess(e,!0);if(!p)throw new Error(s._("ERR_APP_LAUNCH_MANIFEST_FAILED_FMT",e));const m=(p.compability||[]).filter(e=>void 0!==c[e]&&!c[e]);if(m.length)throw new Error(s._("ERR_APP_LAUNCH_COMPABILITY_FAILED_FMT",e,m.join(", ")));if(!0===p.singular&&g)return console.warn("Process::create()","detected that this application is a singular and already running..."),g._onMessage("attention",t),Promise.resolve(g);a.triggerHook("processStart",[e,t]),l.create("Main.launch."+e,{title:s._("LBL_STARTING")+" "+p.name,icon:n.getIcon(p.icon,"16x16")});let _={max:!0===p.preloadParallel?r.getConfig("Connection.PreloadParallel"):p.preloadParallel};t.__preload__&&(_=Object.assign(_,t.__preload__),delete t.__preload__);return new Promise((n,r)=>{const o=e=>(console.warn(e),r(new Error(e)));u.preload(p.preload,_).then(r=>{if(r.failed.length)return o(s._("ERR_APP_PRELOAD_FAILED_FMT",e,r.failed.join(",")));if(void 0===OSjs.Applications[e])return o(new Error(s._("ERR_APP_RESOURCES_MISSING_FMT",e)));let l;try{const n=OSjs.Applications[e];l=new n(t,p),i(l,p)}catch(e){return o(e)}try{const n=d.get(l.__pname)||{};l.init(n,p),a.triggerHook("processStarted",[{application:l,name:e,args:t,settings:n,metadata:p}])}catch(e){return o(e)}return n(l)}).catch(o)})})().then(m).catch(b).finally(w)}catch(e){b(e)}});var g}static createFromArray(e,t){return e=e||[],t=t||function(){},console.info("Process::createFromArray()",e),Promise.each(e,e=>new Promise((n,i)=>{if((e=function(e){if("string"==typeof e){const t=e.split("@"),n=t[0];let i={};if(void 0!==t[1])try{i=JSON.parse(t[1])}catch(e){}e={name:n,args:i}}return e}(e)).name)try{this.create(e.name,e.args,(n,i)=>{t(n,i,e.name,e.args)}).then(n).catch(i)}catch(e){i(e)}else n()}))}static createFromFile(e,t){if(e=new c(e),(t=Object.assign({file:e},t||{})).args&&Object.keys(t.args).forEach(e=>{t[e]=t.args[e]}),!e.path)throw new Error("Cannot open file without a path");if(console.info("Process::createFromFile()",e,t),"osjs/application"===e.mime)return this.create(i.filename(e.path));if("dir"===e.type){const t=d.instance("DefaultApplication").get("dir","ApplicationFileManager");return this.create(t,{path:e.path})}return new Promise((n,i)=>{const r=d.get("DefaultApplication",e.mime);let o=h.getPackagesByMime(e.mime);if(!t.forceList&&r&&h.getPackage(r)&&(console.debug("Process::createFromFile()","default application",r),o=[r]),0===o.length)OSjs.error(s._("ERR_FILE_OPEN"),s._("ERR_FILE_OPEN_FMT",e.path),s._("ERR_APP_MIME_NOT_FOUND_FMT",e.mime)),i(new Error(s._("ERR_APP_MIME_NOT_FOUND_FMT",e.mime)));else if(1===o.length)this.create(o[0],t).then(n).catch(i);else{const r=OSjs.require("core/dialog");r.default.create("ApplicationChooser",{file:e,list:o},(r,o,s)=>{"ok"===o&&(this.create(s.name,t),d.set("DefaultApplication",e.mime,s.useDefault?s.name:null,!0).then(n).catch(e=>{i("string"==typeof e?new Error(e):e)}))})}})}}}),e("skylark-osjsv2-client/vfs/mountpoint",["../core/process","../core/locales"],function(e,t){"use strict";return class{constructor(e){if(this.options=Object.assign({name:null,root:null,match:null,enabled:!0,readOnly:!1,transport:null,visible:!0,searchable:!1,dynamic:!0,internal:!1,special:!1,options:{}},e),!this.options.transport)throw new Error("No transport was defined for mountpoint "+this.options.name);if(!this.options.name)throw new Error(t._("ERR_VFSMODULE_INVALID_CONFIG_FMT"));const n=this.options.name.replace(/\s/g,"-").toLowerCase(),i={icon:"devices/drive-harddisk.png",name:n,title:this.options.name,description:this.options.description||this.options.name,root:n+":///",match:function(e,t){if("string"==typeof e)return new RegExp(e);if(!e)return new RegExp("^"+(t+"://").replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"));return e}(this.options.match,n)};Object.keys(i).forEach(e=>{this.options[e]||(this.options[e]=i[e])}),this.name=n,this.isMounted=!1}mount(t){return t=Object.assign({notify:!0},t||{}),this.isMounted||this.option("special")||(t.notify&&e.message("vfs:mount",this.option("name"),{source:null}),this.isMounted=!0),Promise.resolve()}unmount(t){return t=Object.assign({notify:!0},t||{}),this.isMounted&&!this.option("special")&&(t.notify&&e.message("vfs:unmount",this.option("name"),{source:null}),this.isMounted=!1),Promise.resolve()}mounted(){return this.isMounted}enabled(){return this.option("enabled")}option(e){return this.options[e]}isReadOnly(){return this.option("readOnly")}setMounted(e){this.isMounted=!0===e}request(e,n,i){const r=this.option("transport");return r?r.request(e,n,i,this):Promise.reject(new Error(t._("ERR_VFSMODULE_NOT_FOUND_FMT",test)))}}}),e("skylark-osjsv2-client/core/mount-manager",["../vfs/mountpoint","./locales","./config"],function(e,t,n){"use strict";return new class{constructor(){this.inited=!1,this.mountpoints=[]}init(e){if(this.inited)return Promise.resolve();this.transports=e(),this.inited=!0;const t=n.getConfig("VFS.Mountpoints",{}),i=Object.keys(t).filter(e=>!1!==t[e].enabled);return Promise.each(i,e=>new Promise(n=>{const i=Object.assign({name:e,dynamic:!1},t[e]);this.add(i,!0,{notify:!1}).then(n).catch(t=>(console.warn("Failed to init VFS Mountpoint",e,i,String(t)),n(!1)))}))}addList(e){return Promise.each(e,e=>this.add(e))}add(n,i,r){try{if(!(n instanceof e)){if("string"==typeof n.transport){const e=this.transports[n.transport];if(!e)return Promise.reject(new Error("No such transport: "+n.transport));n.transport=new e}n=new e(n)}const i=this.mountpoints.filter(e=>e.option("name")===n.option("name")||e.option("root")===n.option("root"));if(i.length)return Promise.reject(new Error(t._("ERR_VFSMODULE_ALREADY_MOUNTED_FMT",n.option("name"))));this.mountpoints.push(n)}catch(e){return Promise.reject(e)}return console.info("Mounting",n),new Promise((e,t)=>{i?n.mount().then(()=>e(n)).catch(t):e(n)})}remove(e,n){const module=this.getModule(e),i=this.getModule(e,!0);return module?new Promise((e,t)=>{module.unmount(n).then(t=>(-1!==i&&this.mountpoints.splice(i,1),e(t))).catch(t)}):Promise.reject(new Error(t._("ERR_VFSMODULE_NOT_MOUNTED_FMT",e)))}getModules(e){return e=Object.assign({},{visible:!0,special:!1},e),this.mountpoints.filter(t=>{if(t.enabled()&&t.option("visible")){const n=Object.keys(e).filter(n=>t.option(n)===e[n]);return n.length>0}return!1})}getModuleFromPath(e){return this.mountpoints.find(t=>!!("string"==typeof e&&t.enabled()&&t.option("match")&&e.match(t.option("match"))))}getModule(e,t){const n=t?"findIndex":"find";return this.mountpoints[n](t=>t.option("name")===e)}getTransport(e){return this.transports[e]}}}),e("skylark-osjsv2-client/vfs/filedataurl",[],function(){"use strict";return class{constructor(e){this.dataURL=e}toBase64(){return this.data.split(",")[1]}toString(){return this.dataURL}}}),e("skylark-osjsv2-client/vfs/fs",["../utils/fs","./file","./filedataurl","../core/process","../core/mount-manager","../core/package-manager","../core/settings-manager","../core/connection","../core/locales"],function(e,t,n,i,r,o,s,a,l){"use strict";let c=[];function u(e,t){e?console.error("VFS operation without callback caused an error",e):console.warn("VFS operation without callback",t)}function d(e,t){const module=r.getModuleFromPath(e.path);if(module){const n=module.option("match"),i=module.option("options");if(i&&i.alias)return t?module:e.path.replace(n,i.alias)}return!1}function h(e,n,i){if("string"==typeof e?e=new t(e):"object"==typeof e&&e.path&&(e=new t(e)),!(e instanceof t))throw new TypeError(n||l._("ERR_VFS_EXPECT_FILE"));const o=d(e);o&&(e.path=o);const s=r.getModuleFromPath(e.path);if(!s)throw new Error(l._("ERR_VFSMODULE_NOT_FOUND_FMT",e.path));if(i&&s.isReadOnly())throw new Error(l._("ERR_VFSMODULE_READONLY_FMT",s.name));return e}function p(e,t){const n=r.getModuleFromPath(e.path),i=r.getModuleFromPath(t.path);return!n||!i||n===i||(!!(n&&i&&n.option("internal")&&i.option("internal"))||n.option("transport")===i.option("tranport"))}function g(e,t){return(t=t||{}).overwrite?Promise.resolve():new Promise((t,n)=>{b(e).then(e=>e?n(new Error(l._("ERR_VFS_FILE_EXISTS"))):t()).catch(e=>{e&&console.warn("existsWrapper() error",e),n(e)})})}function m(e,t,n,i,r){return console.info("VFS operation",...arguments),e?new Promise((o,s)=>{e.request(t,n,i).then(i=>a.instance.onVFSRequestCompleted(e,t,n,i,r).then(()=>o(i)).catch(s)).catch(s)}):Promise.reject(new Error(l._("ERR_VFSMODULE_INVALID")))}function f(e,t,n,i,o,s){return new Promise((s,a)=>{if(n&&!(n instanceof Object))return void a(new TypeError(l._("ERR_ARGUMENT_FMT","VFS::"+e,"options","Object",typeof n)));const c=r.getModuleFromPath(i);c?m(c,e,t,n,o).then(s).catch(a):a(new Error(l._("ERR_VFSMODULE_NOT_FOUND_FMT",i)))})}function _(e,n,o){function s(t){i.message(e,t,{source:o?o.__pid:null}),function(e,t){c.forEach(function(n){const i=n.path;function r(e){return"dir"===n.type?e.path.substr(0,i.length)===i:e.path===i}let o=!1;t.destination?(o=r(t.destination))||(o=r(t.source)):o=r(t),o&&n.cb(e,t)})}(e,n)}const a=function(){function e(e){if(e instanceof t){const n=new t(e),i=function(e){let t=null;return r.getModules().forEach(function(n){if(!t&&n.option("options").alias){const i=n.option("options").alias;e.path.substr(0,i.length)===i&&(t=n)}}),t}(n);if(i)return n.path=n.path.replace(i.option("options").alias,i.option("root")),n}return!1}return n instanceof t?e(n):n&&n.destination&&n.source?{source:e(n.source),destination:e(n.destination)}:null}();s(n);const l=a.source||a.destination;a&&(a instanceof t||l)&&(l&&(a.source=a.source||n.source,a.destination=a.destination||n.destination),s(a))}function w(e,t,n,i){if(n=n||{},arguments.length<2)return Promise.reject(new Error(l._("ERR_VFS_NUM_ARGS")));try{e=h(e,l._("ERR_VFS_EXPECT_SRC_FILE")),t=h(t,l._("ERR_VFS_EXPECT_DST_FILE"),!0)}catch(e){return Promise.reject(e)}function o(e){n.dialog&&n.dialog.setProgress(e)}const s=new Promise((s,a)=>{g(t,n).then(()=>{const l=r.getModuleFromPath(e.path),c=r.getModuleFromPath(t.path);return p(e,t)?m(l,"move",[e,t],n,i).then(()=>(o(100),s(!0))).catch(a):m(l,"read",[e],n,i).then(r=>(o(50),m(c,"write",[t,r],n,i).then(t=>m(l,"unlink",[e],n,i).then(e=>(o(100),s(e))).catch(a)).catch(a))).catch(a),!0}).catch(a)});return new Promise((e,t)=>{s.then(e).catch(e=>{o(100),t(new Error(l._("ERR_VFSMODULE_MOVE_FMT",e)))})})}function b(e){if(arguments.length<1)return Promise.reject(new Error(l._("ERR_VFS_NUM_ARGS")));try{e=h(e)}catch(e){return Promise.reject(e)}return f("exists",[e],{},e.path,null,"ERR_VFSMODULE_EXISTS_FMT")}return{broadcastMessage:_,find:function(e,t,n){if(n=n||{},arguments.length<2)return Promise.reject(new Error(l._("ERR_VFS_NUM_ARGS")));try{e=h(e)}catch(e){return Promise.reject(e)}return f("find",[e,t],n,e.path,null,"ERR_VFSMODULE_FIND_FMT")},scandir:function(n,i){const r=s.get("VFS");if(i=i||{},arguments.length<1)return Promise.reject(new Error(l._("ERR_VFS_NUM_ARGS")));const o=new t(n),a=d(o,!0);try{n=h(n)}catch(e){return Promise.reject(e)}return new Promise((s,l)=>{f("scandir",[n],i,n.path,null,"ERR_VFSMODULE_SCANDIR_FMT").then(l=>{if(l instanceof Array&&(l=e.filterScandir(l,i,r),a&&(l=l.map(function(n){const i=!0===n.shortcut,r=new t(n);if(!i){const t=n.path.replace(/\/?$/,""),i=a.option("options")||{},o=i.alias.replace(/\/?$/,"");r.path=e.pathJoin(a.option("root"),t.replace(o,""))}return r})),!1!==i.backlink)){const i=function(n,i,r,o){let s="/"===n.path.split("://")[1].replace(/\/+/g,"/").replace(/^\/?/,"/");r&&(s=o.path===r.root);if(!s){const r=i.some(function(e){return".."===e.filename});if(!r)return new t({filename:"..",path:e.dirname(n.path),mime:null,size:0,type:"dir"})}return!1}(n,l,a,o);i&&l.unshift(i)}return s(l)}).catch(l)})},write:function(t,i,o,s){if(o=o||{},arguments.length<2)return Promise.reject(new Error(l._("ERR_VFS_NUM_ARGS")));try{t=h(t,null,!0)}catch(e){return Promise.reject(e)}return new Promise((a,c)=>{const u=r.getModuleFromPath(t.path);(function(t,i){const r=(t,n,r,o)=>{e[t](n,i,function(e,t){e?o(new Error(e)):r(t)})};return new Promise((e,i)=>{try{if("string"==typeof t){if(t.length)return r("textToAb",t,e,i)}else{if(t instanceof n)return r("dataSourceToAb",t.toString(),e,i);if(window.Blob&&t instanceof window.Blob)return r("blobToAb",t,e,i)}}catch(e){return i(e)}return e(t)})})(i,t.mime).then(e=>(m(u,"write",[t,e],o,s).then(a).catch(e=>{c(new Error(l._("ERR_VFSMODULE_WRITE_FMT",e)))}),!0)).catch(e=>{c(new Error(l._("ERR_VFSMODULE_WRITE_FMT",e)))})})},read:function(t,n){if(n=n||{},arguments.length<1)return Promise.reject(new Error(l._("ERR_VFS_NUM_ARGS")));try{t=h(t)}catch(e){return Promise.reject(e)}return new Promise((i,o)=>{const s=r.getModuleFromPath(t.path);m(s,"read",[t],n).then(r=>{if(n.type){const s={datasource:()=>new Promise((n,i)=>{e.abToDataSource(r,t.mime,function(e,t){return e?i(e):n(t)})}),text:()=>new Promise((n,i)=>{e.abToText(r,t.mime,function(e,t){return e?i(e):n(t)})}),blob:()=>new Promise((n,i)=>{e.abToBlob(r,t.mime,function(e,t){return e?i(e):n(t)})}),json:()=>new Promise((n,i)=>{e.abToText(r,t.mime,function(e,t){let r;if("string"==typeof t)try{r=JSON.parse(t)}catch(e){console.warn("VFS::read()","readToJSON",e.stack,e)}return e?i(e):n(r)})})},a=n.type.toLowerCase();if(s[a])return s[a]().then(i).catch(o)}return i(r)}).catch(e=>{o(new Error(l._("ERR_VFSMODULE_READ_FMT",e)))})})},copy:function(e,t,n,i){if(n=n||{},arguments.length<2)return Promise.reject(new Error(l._("ERR_VFS_NUM_ARGS")));try{e=h(e,l._("ERR_VFS_EXPECT_SRC_FILE")),t=h(t,l._("ERR_VFS_EXPECT_DST_FILE"),!0)}catch(e){return Promise.reject(e)}function o(e){n.dialog&&n.dialog.setProgress(e)}(n=Object.assign({},{type:"binary",dialog:null},n)).arrayBuffer=!0;const s=new Promise((s,a)=>{g(t,n).then(()=>{const l=r.getModuleFromPath(e.path),c=r.getModuleFromPath(t.path);return p(e,t)?m(l,"copy",[e,t],n,i).then(()=>(o(100),s(!0))).catch(a):m(l,"read",[e],n,i).then(e=>(o(50),m(c,"write",[t,e],n,i).then(e=>(o(100),s(e))).catch(a))).catch(a),!0}).catch(a)});return new Promise((e,t)=>{s.then(e).catch(e=>{o(100),t(new Error(l._("ERR_VFSMODULE_COPY_FMT",e)))})})},move:w,rename:function(e,t){return w(...arguments)},unlink:function(n,i,r){if(i=i||{},arguments.length<1)return Promise.reject(new Error(l._("ERR_VFS_NUM_ARGS")));try{n=h(n,null,!0)}catch(e){return Promise.reject(e)}return new Promise((a,l)=>{f("unlink",[n],i,n.path,r,"ERR_VFSMODULE_UNLINK_FMT").then(i=>{const r=s.instance("PackageManager").get("PackagePaths",[]),l=r.some(function(i){const r=new t(i),o=e.dirname(n.path);return o===r.path});return l&&o.generateUserMetadata(function(){}),a(i)}).catch(l)})},mkdir:function(e,t,n){if(t=t||{},arguments.length<1)return Promise.reject(new Error(l._("ERR_VFS_NUM_ARGS")));try{e=h(e,null,!0)}catch(e){return Promise.reject(e)}return f("mkdir",[e],t,e.path,n,"ERR_VFSMODULE_MKDIR_FMT")},exists:b,fileinfo:function(e){if(arguments.length<1)return Promise.reject(new Error(l._("ERR_VFS_NUM_ARGS")));try{e=h(e)}catch(e){return Promise.reject(e)}return f("fileinfo",[e],{},e.path,null,"ERR_VFSMODULE_FILEINFO_FMT")},url:function(e,t){if(t=t||{},arguments.length<1)return Promise.reject(new Error(l._("ERR_VFS_NUM_ARGS")));try{e=h(e)}catch(e){return Promise.reject(e)}return f("url",[e],t,e.path,null,"ERR_VFSMODULE_URL_FMT")},upload:function(n,i,o){if(n=n||{},arguments.length<1)return Promise.reject(new Error(l._("ERR_VFS_NUM_ARGS")));if(!n.files)return Promise.reject(new Error(l._("ERR_VFS_UPLOAD_NO_FILES")));if(!n.destination)return Promise.reject(new Error(l._("ERR_VFS_UPLOAD_NO_DEST")));const s=new t(n.destination),a=r.getModuleFromPath(n.destination);return new Promise((r,c)=>{Promise.all(n.files.map(r=>{const l=r instanceof window.File?r.name:r.filename,c=new t(e.pathJoin(n.destination,l));return new Promise((e,t)=>{g(c,i).then(()=>m(a,"upload",[s,r],i,o).then(e).catch(t)).catch(t)})})).then(r).catch(e=>{c(new Error(l._("ERR_VFS_UPLOAD_FAIL_FMT",e)))})})},download:function(e){if(arguments.length<1)return Promise.reject(new Error(l._("ERR_VFS_NUM_ARGS")));try{e=h(e)}catch(e){return Promise.reject(e)}if(!e.path)return Promise.reject(new Error(l._("ERR_VFS_DOWNLOAD_NO_FILE")));const t=new Promise((t,n)=>{const i=r.getModuleFromPath(e);m(i,"download",[e],{}).then(()=>(i.option("internal")?i.download(e).then(t).catch(n):i.read(e).then(t).catch(n),!0))});return new Promise((e,n)=>{t.then(e).catch(e=>{n(new Error(l._("ERR_VFS_DOWNLOAD_FAILED",e)))})})},trash:function(e){if(arguments.length<1)return Promise.reject(new Error(l._("ERR_VFS_NUM_ARGS")));try{e=h(e)}catch(e){return Promise.reject(e)}return f("trash",[e],{},e.path,null,"ERR_VFSMODULE_TRASH_FMT")},untrash:function(e){if(arguments.length<1)return Promise.reject(new Error(l._("ERR_VFS_NUM_ARGS")));try{e=h(e)}catch(e){return Promise.reject(e)}return f("untrash",[e],{},e.path,null,"ERR_VFSMODULE_UNTRASH_FMT")},emptyTrash:function(){return f("emptyTrash",[],{},null,null,"ERR_VFSMODULE_EMPTYTRASH_FMT")},freeSpace:function(e){if(arguments.length<1)return Promise.reject(new Error(l._("ERR_VFS_NUM_ARGS")));try{e=h(e)}catch(e){return Promise.reject(e)}return f("freeSpace",[r.getModuleFromPath(e.path,!1,!0).option("root")],{},e.path,null,"ERR_VFSMODULE_FREESPACE_FMT")},watch:function(e,t){if(t=t||u,arguments.length<2)return t(l._("ERR_VFS_NUM_ARGS")),-1;try{e=h(e)}catch(e){return Promise.reject(e)}return Promise.resolve(c.push({path:e.path,type:e.type,cb:t})-1)},unwatch:function(e){void 0!==c[e]&&delete c[e]},triggerWatch:function(e,t,n){_("vfs:"+e,t,n)}}}),e("skylark-osjsv2-client/core/search-engine",["./package-manager","./settings-manager","../vfs/file","./theme","../vfs/fs"],function(e,t,n,i,r){"use strict";const o=function(){function t(){const t=e.getPackages();return Object.keys(t).map(e=>{const r=t[e];return new function(e){Object.keys(e).forEach(t=>{this[t]=e[t]})}({value:{title:r.name,description:r.description,icon:i.getFileIcon(new n("applications:///"+r.className,"application"),"16x16"),launch:{application:e,args:{}}},fields:[r.className,r.name,r.description]})})}return{search:function(e,n,i){if(i.applications){let i=function(e,t){const n=[];return e.forEach(e=>{let i=!1;e.fields.forEach(r=>{if(i)return;const o=String(t).toLowerCase();-1!==String(r).toLowerCase().indexOf(o)&&(n.push(e.value),i=!0)})}),n}(t(),e);return n.limit&&i.length>n.dlimit&&(i=i.splice(0,n.dlimit)),Promise.resolve(i)}return Promise.resolve([])},reindex:function(e){return Promise.resolve(!0)},destroy:function(){}}}(),s={search:function(e,t,o,s){if(!o.files||!o.paths)return Promise.resolve([]);let a=[];return new Promise((s,l)=>{Promise.each(o.paths,o=>new Promise(s=>{r.find(o,{query:e,limit:t.limit?t.dlimit:0,recursive:t.recursive}).then(e=>s(void((e=e)&&(a=a.concat(e.map(e=>({title:e.filename,description:e.path,icon:i.getFileIcon(new n(e)),launch:{application:"",args:"",file:e}}))))))).catch(e=>{console.warn(e),s()})})).then(()=>s(a)).catch(l)});var l},reindex:function(e){return Promise.resolve()},destroy:function(){}};return new class{constructor(){this.settings={},this.inited=!1,this.modules=[o,s]}init(){return console.debug("SearchEngine::init()"),this.inited||(this.settings=t.get("SearchEngine")||{},this.inited=!0),Promise.resolve()}destroy(){console.debug("SearchEngine::destroy()"),this.modules.forEach(e=>{e.destroy()}),this.modules=[],this.settings={},this.inited=!1}search(e,t){let n=[],i=[];return(t=Object.assign({},{recursive:!1,limit:0,dlimit:0},t)).limit&&(t.dlimit=t.limit),new Promise((r,o)=>{Promise.each(this.modules,module=>new Promise((r,o)=>{console.debug("SearchEngine::search()","=>",module),!t.limit||t.dlimit>0?module.search(e,t,this.settings).then(e=>{t.dlimit-=e.length,n=n.concat(e),r()}).catch(e=>{console.warn(e),i.push(e instanceof Error?e.toString():e),r()}):r()})).then(()=>r(n)).catch(o)})}reindex(e){const t=[];return Promise.each(this.modules,module=>new Promise(n=>{console.debug("SearchEngine::reindex()","=>",module),module.reindex(e).then(n).catch(e=>{e&&t.push(e),n()})}))}configure(e,t){}}}),e("skylark-osjsv2-client/core/authenticator",["./locales","./config","./connection","./settings-manager","./package-manager"],function(e,t,n,i,r){"use strict";let o;return class{static get instance(){return o}constructor(){o=this,this.userData={id:0,username:"root",name:"root user",groups:["admin"]},this.loggedIn=!1,this.isStandalone=!1}init(){return this.createUI()}destroy(){o=null}getUser(){return Object.assign({},this.userData)}isLoggedIn(){return this.isLoggedIn}login(t){return new Promise((i,r)=>{n.request("login",t).then(t=>i(t||e._("ERR_LOGIN_INVALID"))).catch(t=>{r(new Error(e._("ERR_LOGIN_FMT",t)))})})}logout(){return new Promise((e,t)=>{n.request("logout",{}).then(t=>e(!!t)).catch(e=>{t(new Error("An error occured: "+e))})})}checkPermission(e){const t=this.getUser(),n=t.groups||[];return e instanceof Array||(e=[e]),-1!==n.indexOf("admin")||!!e.every(e=>n.indexOf(e)>=0)}requestLogin(e){return new Promise((t,n)=>{this.login(e).then(e=>this.onLogin(e).then(t).catch(n)).catch(n)})}onLogin(n){let o=n.userSettings;return(!o||o instanceof Array)&&(o={}),this.userData=n.userData,document.getElementById("LoadingScreen").style.display="block",e.setLocale(function(){let e=t.getConfig("Locale"),n=t.getUserLocale();t.getConfig("LocaleOptions.AutoDetect",!0)&&n&&(console.info("Auto-detected user locale via browser",n),e=n);let r=i.get("CoreWM");if(!r)try{r=o.CoreWM}catch(e){}return r&&r.language||e}()),i.init(o),n.blacklistedPackages&&r.setBlacklist(n.blacklistedPackages),this.loggedIn=!0,Promise.resolve(!0)}createUI(){return this._renderUI(),this._createUI()}_renderUI(e){e||(e=require("osjs-scheme-loader!login.html"));const t=document.createElement("div");t.innerHTML=e,t.childNodes.forEach(e=>{const t=e.cloneNode(!0);-1===["STYLE","SCRIPT"].indexOf(e.tagName)?document.body.appendChild(t):document.querySelector("head").appendChild(t)})}_createUI(){const e=document.getElementById("Login"),t=document.getElementById("LoginForm"),n=document.getElementById("LoginUsername"),i=document.getElementById("LoginPassword"),r=document.getElementById("LoginSubmit");function o(){r.removeAttribute("disabled"),n.removeAttribute("disabled"),i.removeAttribute("disabled")}return e.style.display="block",o(),new Promise((s,a)=>{t.onsubmit=(t=>{r.setAttribute("disabled","disabled"),n.setAttribute("disabled","disabled"),i.setAttribute("disabled","disabled"),t&&t.preventDefault(),this.requestLogin({username:n.value,password:i.value}).then(()=>(e.parentNode.removeChild(e),s())).catch(e=>{alert(e),o()})})})}}}),e("skylark-osjsv2-client/utils/keycodes",[],function(){"use strict";const e=function(){const e={F1:112,F2:113,F3:114,F4:115,F6:118,F7:119,F8:120,F9:121,F10:122,F11:123,F12:124,TILDE:220,GRAVE:192,CMD:17,LSUPER:91,RSUPER:92,DELETE:46,INSERT:45,HOME:36,END:35,PGDOWN:34,PGUP:33,PAUSE:19,BREAK:19,CAPS_LOCK:20,SCROLL_LOCK:186,BACKSPACE:8,SPACE:32,TAB:9,ENTER:13,ESC:27,LEFT:37,RIGHT:39,UP:38,DOWN:40};for(let t=33;t<=126;t++)e[String.fromCharCode(t)]=t;return Object.freeze(e)}();return e}),e("skylark-osjsv2-client/utils/events",["./keycodes"],function(e){"use strict";function t(e){return e.replace(/\s/g,"").split(",")}function n(e){if(e.detail&&void 0!==e.detail.x&&void 0!==e.detail.y)return{x:e.detail.x,y:e.detail.y};const t=e.touches||e.changedTouches||[];return t.length?{x:t[0].clientX,y:t[0].clientY}:{x:e.clientX,y:e.clientY}}const i=function(){const t={CTRL:e=>e.ctrlKey,SHIFT:e=>e.shiftKey,ALT:e=>e.altKey,META:e=>e.metaKey};return function(n,i){const r=i.toUpperCase().split("+"),o={CTRL:!1,SHIFT:!1,ALT:!1},s=[];r.forEach(e=>{t[e]?o[e]=!0:s.push(e)});const a=Object.keys(o).every(e=>{const i=!!t[e](n);return o[e]===i}),l=s.every(t=>(function(t){let n=!1;return Object.keys(e).forEach(i=>{n||t!==e[i]||(n=i)}),n})(n.keyCode)===t);return a&&l}}(),r=function(){function e(e,t){const i=n(t),r=Object.assign({clientX:i.x,clientY:i.y,x:i.x,y:i.y},t);return new MouseEvent(e,r)}function i(e,t,n,i,r,o,s){const a=[n,r,o];e.addEventListener.apply(e,a),e._boundEvents[t].push({realType:s,args:a,callback:i})}const r={mousewheel:function(e,t,r,o,s){function a(e){const t=n(e),i=e.detail<0||e.wheelDelta>0?1:-1;return t.z=i,o(e,t)}i(e,t,"mousewheel",o,a,s,"mousewheel"),i(e,t,"DOMMouseScroll",o,a,s,"DOMMouseScroll")},click:function(t,n,r,o,s){let a,l,c,u=!1;const d=()=>u=!0;i(t,n,"touchcancel",o,function(){clearTimeout(a),l=null,u=!0,window.removeEventListener("touchmove",d)},s,"dblclick"),i(t,n,"touchstart",o,function(e){c=e,l=e.target,a=setTimeout(()=>{u=!0},300),window.addEventListener("touchmove",d)},s,"click"),i(t,n,"touchend",o,function(n){if(clearTimeout(a),window.removeEventListener("touchmove",d),!u&&n.target===l){const n=e("click",c);Object.defineProperty(n,"target",{value:c.target,enumerable:!1}),t.dispatchEvent(n)}},s,"click")},dblclick:function(t,n,r,o,s){let a,l,c,u=0,d=!1;const h=()=>d=!0;function p(){a=null,d=!0,u=0,window.removeEventListener("toucmove",h)}i(t,n,"touchcancel",o,p,s,"dblclick"),i(t,n,"touchstart",o,function(t){if(window.addEventListener("touchmove",h),clearTimeout(c),0===u)l=t,a=t.target;else if(u>0){if(t.target!==a)return void p();d||(t.preventDefault(),t.stopPropagation(),t.target.dispatchEvent(e("dblclick",l)))}d=!1,u++},s,"dblclick"),i(t,n,"touchend",o,function(){window.removeEventListener("touchmove",h),c=setTimeout(p,680)},s,"dblclick")},contextmenu:function(t,n,r,o,s){let a,l=!1;const c=()=>l=!0;i(t,n,"touchcancel",o,function(){clearTimeout(a),l=!0,window.removeEventListener("toucmove",c)},s,"contextmenu"),i(t,n,"touchstart",o,function(t){a=setTimeout(()=>{l||(t.preventDefault(),t.target.dispatchEvent(e("contextmenu",t)))},300),window.addEventListener("touchmove",c)},s,"contextmenu"),i(t,n,"touchend",o,function(e){l=!0,clearTimeout(a),window.removeEventListener("touchmove",c)},s,"contextmenu")}};return function(e,o,s,a,l){if(a=!0===a,arguments.length<3)throw new Error("$bind expects 3 or more arguments");if("string"!=typeof o)throw new Error("Given event type was not a string");if("function"!=typeof s)throw new Error("Given callback was not a function");function c(t,o){o=function(e){let t=e;if("mousewheel"!==e&&e.match(/^mouse/))if(window.PointerEvent)t=e.replace(/^mouse/,"pointer");else if(window.MSPointerEvent){const n=e.replace(/^mouse/,"");t="MSPointer"+n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()}return t}(o),i(e,t,o,s,function(t){window.OSjs&&(l&&s(t,n(t)),s.call(e,t,n(t)))},a),"click"===o&&"BUTTON"===e.tagName||r[o]&&r[o](e,t,o,function(t){l&&s(t,n(t)),s.call(e,t,n(t))},a)}t(o).forEach(t=>{const n=t.split(":")[0];!function(t){e._boundEvents||(e._boundEvents={});e._boundEvents[t]||(e._boundEvents[t]=[]);return 0===e._boundEvents[t].filter(e=>e.callback===s).length}(t)?console.warn("Utils::$bind()","This event was already bound, skipping"):c(t,n)})}}();return{mousePosition:n,mouseButton:function(e){if(void 0!==e.button)return 0===e.button?"left":1===e.button?"middle":"right";if(2===e.which||4===e.which)return"middle";if(1===e.which)return"left";return"right"},keyCombination:i,$bind:r,$unbind:function(e,n,i,r){function o(t){if(e._boundEvents){const n=e._boundEvents||{};if(n[t])for(let r=0;r<n[t].length;r++){let o=n[t][r];i&&o.callback!==i||(e.removeEventListener.apply(e,o.args),n[t].splice(r,1),r--)}}}e&&(n?t(n).forEach(e=>{o(e)}):e._boundEvents&&(Object.keys(e._boundEvents).forEach(e=>{o(e)}),delete e._boundEvents))}}}),e("skylark-osjsv2-client/helpers/window-behaviour",["../utils/dom","../utils/events","../core/theme"],function(e,t,n){"use strict";class i{constructor(e,t,i,r){this.win=t,this.$element=t._$element,this.$top=t._$top,this.$handle=t._$resize,this.rectWorkspace=e.getWindowSpace(!0),this.rectWindow={x:t._position.x,y:t._position.y,w:t._dimension.w,h:t._dimension.h,r:t._dimension.w+t._position.x,b:t._dimension.h+t._position.y};const o=Object.assign({},n.getStyleTheme(!0,!0));o.style||(o.style={window:{margin:0,border:0}}),this.theme={topMargin:o.style.window.margin||0,borderSize:o.style.window.border||0},this.snapping={cornerSize:e.getSetting("windowCornerSnap")||0,windowSize:e.getSetting("windowSnap")||0},this.action=i,this.moved=!1,this.direction=null,this.startX=r.x,this.startY=r.y,this.minWidth=t._properties.min_width,this.minHeight=t._properties.min_height;const s=[];e.getWindows().forEach(e=>{if(e&&e._wid!==t._wid){const t=e._position,n=e._dimension,i={left:t.x-this.theme.borderSize,top:t.y-this.theme.borderSize,width:n.w+2*this.theme.borderSize,height:n.h+2*this.theme.borderSize+this.theme.topMargin};i.right=i.left+i.width,i.bottom=t.y+n.h+this.theme.topMargin+this.theme.borderSize,s.push(i)}}),this.snapRects=s}getRect(){const e=this.win;return{left:e._position.x,top:e._position.y,width:e._dimension.w,height:e._dimension.h}}calculateDirection(){const t=e.$position(this.$handle),n=this.startX-t.left,i=this.startY-t.top,r={nw:n<=20&&i<=20,n:n>20&&i<=20,w:n<=20&&i>=20,ne:n>=t.width-20&&i<=20,e:n>=t.width-20&&i>20,se:n>=t.width-20&&i>=t.height-20,sw:n<=20&&i>=t.height-20};let o="s";Object.keys(r).forEach(function(e){r[e]&&(o=e)}),this.direction=o}}return{createWindowBehaviour:function(e,n){let r=null,o={};function s(e,t,i,s){if(!n.getMouseLocked()||!t||!r)return;let a;e.preventDefault();const l=s.x-r.startX,c=s.y-r.startY;(a="move"===t?function(e,t,n,i){let o=r.rectWindow.x+n,s=r.rectWindow.y+i;const a=r.theme.borderSize,l=r.theme.topMargin,c=r.snapping.cornerSize,u=r.snapping.windowSize;s<r.rectWorkspace.top&&(s=r.rectWorkspace.top);let d=o+r.rectWindow.w+2*a,h=s+r.rectWindow.h+l+a;c>0&&(o-a<=c&&o-a>=-c?o=a:d>=r.rectWorkspace.width-c&&d<=r.rectWorkspace.width+c&&(o=r.rectWorkspace.width-r.rectWindow.w-a),s<=r.rectWorkspace.top+c&&s>=r.rectWorkspace.top-c?s=r.rectWorkspace.top+a:h>=r.rectWorkspace.height+r.rectWorkspace.top-c&&h<=r.rectWorkspace.height+r.rectWorkspace.top+c&&(s=r.rectWorkspace.height+r.rectWorkspace.top-r.rectWindow.h-l-a));u>0&&r.snapRects.every(function(e){return d>=e.left-u&&d<=e.left+u?(o=e.left-(r.rectWindow.w+2*a),!1):o-a<=e.right+u&&o-a>=e.right-u?(o=e.right+2*a,!1):h>=e.top-u&&h<=e.top+u?(s=e.top-(r.rectWindow.h+2*a+l),!1):!(s<=e.bottom+u&&s>=e.bottom-u)||(s=e.bottom+2*a,!1)});return{left:o,top:s,width:null,height:null}}(0,0,l,c):function(e,t,n,i){if(!r||!r.direction)return!1;let s,a,l,c;return-1!==r.direction.indexOf("s")?(a=r.rectWindow.h+i,o.height=Math.max(r.minHeight,a)):-1!==r.direction.indexOf("n")&&(a=r.rectWindow.h-i,(c=r.rectWindow.y+i)<r.rectWorkspace.top?(c=r.rectWorkspace.top,a=o.height):a<r.minHeight&&(c=r.rectWindow.b-r.minHeight),o.height=Math.max(r.minHeight,a),o.top=c),-1!==r.direction.indexOf("e")?(s=r.rectWindow.w+n,o.width=Math.max(r.minWidth,s)):-1!==r.direction.indexOf("w")&&(s=r.rectWindow.w-n,l=r.rectWindow.x+n,s<r.minWidth&&(l=r.rectWindow.r-r.minWidth),o.width=Math.max(r.minWidth,s),o.left=l),o}(0,0,l,c))&&(null!==a.left&&null!==a.top&&(i._move(a.left,a.top),i._emit("move",[a.left,a.top])),null!==a.width&&null!==a.height&&(i._resize(a.width,a.height,!0),i._emit("resize",[a.width,a.height]))),r.moved=!0}function a(e,a,l,c){e.preventDefault(),l._state.maximized||(r=new i(n,l,a,c),o={},l._focus(),"move"===a?(r.$element.setAttribute("data-hint","moving"),document.body.setAttribute("data-window-hint","moving")):(r.calculateDirection(),r.$element.setAttribute("data-hint","resizing"),document.body.setAttribute("data-window-hint","resizing"),o=r.getRect()),l._emit("preop"),t.$bind(document,"pointermove:movewindow,touchmove:movewindowTouch",function(e,t){e.preventDefault(),n._mouselock&&s(e,a,l,t)},!1),t.$bind(document,"pointerup:movewindowstop,touchend:movewindowstopTouch",function(e,n){(function(e,t,n,i){if(!r)return;r.moved&&("move"===t?(n._onChange("move",!0),n._emit("moved",[n._position.x,n._position.y])):"resize"===t&&(n._onChange("resize",!0),n._emit("resized",[n._dimension.w,n._dimension.h])));r.$element.setAttribute("data-hint",""),document.body.setAttribute("data-window-hint",""),n._emit("postop"),r=null})(0,a,l),t.$unbind(document,"pointermove:movewindow,touchmove:movewindowTouch"),t.$unbind(document,"pointerup:movewindowstop,touchend:movewindowstopTouch")},!1))}e._properties.allow_move&&t.$bind(e._$top,"pointerdown,touchstart",(t,n)=>{t.preventDefault(),e._destroyed||a(t,"move",e,n)},!0);e._properties.allow_resize&&t.$bind(e._$resize,"pointerdown,touchstart",(t,n)=>{t.preventDefault(),e._destroyed||a(t,"resize",e,n)})}}}),e("skylark-osjsv2-client/core/window-manager",["../utils/dom","../utils/events","../utils/misc","../utils/keycodes","./theme","./process","./connection","./settings-manager","./locales","./config","../helpers/window-behaviour"],function(e,t,n,i,r,o,s,a,l,c,u){"use strict";function d(e,t){e&&(t?e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen&&e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):e.webkitCancelFullScreen?e.webkitCancelFullScreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.exitFullscreen&&e.exitFullscreen())}let h;return class extends o{static get instance(){return h}constructor(e,t,n,i){console.group("WindowManager::constructor()"),console.debug("Name",e),console.debug("Arguments",t),super(e,t,n),h=this,this._windows=[],this._settings=a.instance(e,i),this._currentWin=null,this._lastWin=null,this._mouselock=!0,this._stylesheet=null,this._sessionLoaded=!1,this._fullyLoaded=!1,this._isResponsive=!1,this._responsiveRes=800,this._dcTimeout=null,this._resizeTimeout=null,this._$fullscreen=null,this._$lastDomInput=null,this.__name=e||"WindowManager",this.__path=n.path,this.__iter=n.iter,console.groupEnd()}destroy(){return console.debug("WindowManager::destroy()"),this.destroyStylesheet(),t.$unbind(document,"pointerout:windowmanager"),t.$unbind(document,"pointerenter:windowmanager"),t.$unbind(window,"orientationchange:windowmanager"),t.$unbind(window,"hashchange:windowmanager"),t.$unbind(window,"resize:windowmanager"),t.$unbind(window,"scroll:windowmanager"),t.$unbind(window,"fullscreenchange:windowmanager"),t.$unbind(window,"mozfullscreenchange:windowmanager"),t.$unbind(window,"webkitfullscreenchange:windowmanager"),t.$unbind(window,"msfullscreenchange:windowmanager"),t.$unbind(document.body,"contextmenu:windowmanager"),t.$unbind(document.body,"pointerdown:windowmanager,touchstart:windowmanager"),t.$unbind(document.body,"click:windowmanager"),t.$unbind(document,"keyup:windowmanager"),t.$unbind(document,"keydown:windowmanager"),t.$unbind(document,"keypress:windowmanager"),window.onerror=null,window.onbeforeunload=null,this._windows.forEach((e,t)=>{e&&(e.destroy(!0),this._windows[t]=null)}),this._windows=[],this._currentWin=null,this._lastWin=null,this._$fullscreen=null,h=null,this.Notification=OSjs.require("gui/notification"),super.destroy()}init(e,n){var i=this.Notification;s.instance.subscribe("online",()=>{i.create({title:l._("LBL_INFO"),message:l._("CONNECTION_RESTORED")})}),s.instance.subscribe("offline",e=>{i.create({title:l._("LBL_WARNING"),message:l._(e?"CONNECTION_RESTORE_FAILED":"CONNECTION_LOST")})}),console.debug("WindowManager::init()"),document.body.addEventListener("touchend",e=>{e.target===document.body&&e.preventDefault()}),t.$bind(document,"pointerout:windowmanager",e=>this._onMouseLeave(e)),t.$bind(document,"pointerenter:windowmanager",e=>this._onMouseLeave(e)),t.$bind(window,"orientationchange:windowmanager",e=>this._onOrientationChange(e)),t.$bind(window,"hashchange:windowmanager",e=>this._onHashChange(e)),t.$bind(window,"resize:windowmanager",e=>this._onResize(e)),t.$bind(window,"scroll:windowmanager",e=>this._onScroll(e)),t.$bind(window,"fullscreenchange:windowmanager",e=>this._onFullscreen(e)),t.$bind(window,"mozfullscreenchange:windowmanager",e=>this._onFullscreen(e)),t.$bind(window,"webkitfullscreenchange:windowmanager",e=>this._onFullscreen(e)),t.$bind(window,"msfullscreenchange:windowmanager",e=>this._onFullscreen(e)),t.$bind(document.body,"contextmenu:windowmanager",e=>this._onContextMenu(e)),t.$bind(document.body,"pointerdown:windowmanager,touchstart:windowmanager",e=>this._onMouseDown(e)),t.$bind(document.body,"click:windowmanager",e=>this._onClick(e)),t.$bind(document,"keyup:windowmanager",e=>this._onKeyUp(e)),t.$bind(document,"keydown:windowmanager",e=>this._onKeyDown(e)),t.$bind(document,"keypress:windowmanager",e=>this._onKeyPress(e)),window.onerror=this._onError.bind(this),window.onbeforeunload=this._onBeforeUnload(this);const r=this.getDefaultSetting("mediaQueries")||{};let o=0;Object.keys(r).forEach(e=>{o=Math.max(o,r[e])}),this._responsiveRes=o||800,this._onOrientationChange(),this.resize()}setup(e){e()}getWindow(e){return this.getWindows().find(t=>t.__name===e)}addWindow(e,t){console.debug("WindowManager::addWindow()");try{e.init(this,e._app)}catch(e){console.error("WindowManager::addWindow()","=>","Window::init()",e,e.stack)}return u.createWindowBehaviour(e,this),this._windows.push(e),e._inited(),!0===t&&e._focus(),e}removeWindow(e){const t=this._windows.findIndex(t=>t&&t._wid===e._wid);return console.debug("WindowManager::removeWindow()",e._wid,t),-1!==t&&(this._windows[t]=null,!0)}applySettings(e,t,i,r){e=e||{},console.debug("WindowManager::applySettings()","forced?",t);const o=t?e:n.mergeObject(this._settings.get(),e);return this._settings.set(null,o,i,r),!0}createStylesheet(e,t){this.destroyStylesheet();let i=[];Object.keys(e).forEach(t=>{let r=[];Object.keys(e[t]).forEach(i=>{r.push(n.format("    {0}: {1};",i,e[t][i]))}),r=r.join("\n"),i.push(n.format("{0} {\n{1}\n}",t,r))}),i=i.join("\n"),t&&(i+="\n"+t);const r=document.createElement("style");r.type="text/css",r.id="WMGeneratedStyles",r.innerHTML=i,document.getElementsByTagName("head")[0].appendChild(r),this._stylesheet=r}destroyStylesheet(){this._stylesheet&&e.$remove(this._stylesheet),this._stylesheet=null}resize(e,t){this._isResponsive=window.innerWidth<=1024,this.onResize(e)}eventWindow(e,t){return!1}showSettings(){}toggleFullscreen(e,t){if("boolean"==typeof t)d(e,t);else{const t=this._$fullscreen;t&&t!==e&&d(t,!1),d(e,t!==e)}this._$fullscreen=e}onKeyDown(e,t){}onOrientationChange(e,t){console.info("ORIENTATION CHANGED",e,t),document.body.setAttribute("data-orientation",t),this._onDisplayChange()}onResize(e){this._onDisplayChange(),this._emit("resized")}onSessionLoaded(){return!this._sessionLoaded&&(this._sessionLoaded=!0,!0)}_onMouseEnter(e){this._mouselock=!0}_onMouseLeave(e){const t=e.relatedTarget||e.toElement;t&&"HTML"!==t.nodeName?this._mouselock=!0:this._mouselock=!1}_onDisplayChange(){this._dcTimeout=clearTimeout(this._dcTimeout),this._dcTimeout=setTimeout(()=>{this._windows&&this.getWindows().forEach(e=>{e._onResize(),e._emit("resize")})},100),document.body.setAttribute("data-responsive",String(this._isResponsive))}_onOrientationChange(e){let t="landscape";window.screen&&window.screen.orientation&&-1!==window.screen.orientation.type.indexOf("portrait")&&(t="portrait"),this.onOrientationChange(e,t)}_onHashChange(e){const t=window.location.hash.substr(1),n=t.split(/^([\w\.\-_]+)\:(.*)/);if(4===n.length){const e=n[1],i=function(e){const t={};return e.split("&").forEach(function(e){const n=e.split("="),i=decodeURIComponent(n[0]);t[i]=decodeURIComponent(n[1]||"")}),t}(n[2]);e&&o.getProcess(e).forEach(function(e){e._onMessage("hashchange",{hash:t,args:i},{source:null})})}}_onResize(e){clearTimeout(this._resizeTimeout),this._resizeTimeout=setTimeout(()=>{const t=this.getWindowSpace();this.resize(e,t)},100)}_onScroll(e){return e.target===document||e.target===document.body?(e.preventDefault(),e.stopPropagation(),!1):(document.body.scrollTop=0,document.body.scrollLeft=0,!0)}_onFullscreen(e){try{const e=this.Notification.getIcon("_FullscreenNotification");e&&(document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement?(e.opts._isFullscreen=!0,e.setImage(r.getIcon("actions/view-restore.png","16x16"))):(e.opts._isFullscreen=!1,e.setImage(r.getIcon("actions/view-fullscreen.png","16x16"))))}catch(e){console.warn(e.stack,e)}}_onContextMenu(t){return this.onContextMenu(t),e.$isFormElement(t)?(OSjs.require("gui/menu").blur(),!0):(t.preventDefault(),!1)}_onMouseDown(t){if(e.$isFormElement(t))this._$lastDomInput=t.target;else if(this._$lastDomInput){try{this._$lastDomInput.blur()}catch(e){}this._$lastDomInput=null}}_onClick(t){let n,i,o=t.target;for(;o.parentNode&&(o.tagName.match(/^GUI\-MENU/)?i=o:o.tagName.match(/^APPLICATION\-WINDOW/)&&(n=!0),!n&&!i);)o=o.parentNode;if(i&&("GUI-MENU-ENTRY"===i.tagName?"true"!==i.getAttribute("data-disabled")&&(e.$hasClass(i,"gui-menu-expand")||(i=null)):"GUI-MENU-BAR"===i.tagName&&(i=null)),i||OSjs.require("gui/menu").blur(),"BODY"===t.target.tagName){const e=this.getCurrentWindow();e&&e._blur()}r.themeAction("event",[t])}_onKeyUp(e){const t=this.getCurrentWindow();return this.onKeyUp(e,t),!t||t._onKeyEvent(e,"keyup")}_onKeyDown(t){const n=this.getCurrentWindow(),r=(()=>{const e=this.onKeyDown(t,n);return n&&!e&&n._onKeyEvent(t,"keydown"),e})();return(function(t,n){const r=[122,123];let o="BODY"===(t.srcElement||t.target).tagName;t.keyCode!==i.BACKSPACE||e.$isFormElement(t)?t.keyCode===i.TAB&&e.$isFormElement(t)?o=!0:-1!==r.indexOf(t.keyCode)&&(o=!1):o=!0;if(o&&(!n||!n._properties.key_capture))return!0;return!1}(t,n)||r)&&t.preventDefault(),!0}_onKeyPress(e){const t=this.getCurrentWindow();return!t||t._onKeyEvent(e,"keypress")}_onBeforeUnload(e){return c.getConfig("ShowQuitWarning")?l._("MSG_SESSION_WARNING"):null}_onError(e,t,n,i,r){return"string"==typeof r&&(r=null),r=r||{name:"window::onerror()",fileName:t,lineNumber:n+":"+i,message:e},console.warn("window::onerror()",arguments),OSjs.error(l._("ERR_JAVASCRIPT_EXCEPTION"),l._("ERR_JAVACSRIPT_EXCEPTION_DESC"),l._("BUGREPORT_MSG"),r,!0),!1}getDefaultSetting(){return null}getPanel(){return null}getPanels(){return[]}setSetting(e,t){return this._settings.set(e,t)}getWindowSpace(){return{top:0,left:0,width:document.body.offsetWidth,height:document.body.offsetHeight}}getWindowPosition(){const e=this._windows.reduce(function(e,t){return null===t?e:e+1},0);return{x:10*e,y:10*e}}getSetting(e){return this._settings.get(e)}getSettings(){return this._settings.get()}getWindows(){return this._windows.filter(e=>!!e)}getCurrentWindow(){return this._currentWin}setCurrentWindow(e){this._currentWin=e||null}getLastWindow(){return this._lastWin}setLastWindow(e){this._lastWin=e||null}getMouseLocked(){return this._mouselock}}}),e("skylark-osjsv2-client/utils/gui",["./dom","./events","./compability","../core/package-manager","../core/theme"],function(e,t,n,i,r){"use strict";function o(e){const t=e.getAttribute("data-label");return t||""}function s(e,t,n,i){if(i=i||o(e)){const r=document.createElement("label"),o=document.createElement("span");o.appendChild(document.createTextNode(i)),"checkbox"===t||"radio"===t?(r.appendChild(n),r.appendChild(o)):(r.appendChild(o),r.appendChild(n)),e.appendChild(r)}else e.appendChild(n)}return{getWindowId:function(e){for(;e.parentNode;){const t=e.getAttribute("data-window-id");if(null!==t)return parseInt(t,10);e=e.parentNode}return null},getLabel:o,getValueLabel:function(t,n){let i=n?t.getAttribute("data-label"):null;t.childNodes.length&&3===t.childNodes[0].nodeType&&t.childNodes[0].nodeValue&&(i=t.childNodes[0].nodeValue,e.$empty(t));return i||""},getViewNodeValue:function(e){let t=e.getAttribute("data-value");if("string"==typeof t&&t.match(/^\[|\{/))try{t=JSON.parse(t)}catch(e){t=null}return t},getIcon:function(e,t){let n=e.getAttribute("data-icon");if(n)return t?i.getPackageResource(t._app,n):n;if((n=e.getAttribute("data-stock-icon"))&&"undefined"!==n){let e="16x16";try{let t=n.split("/"),i=t.shift(),o=i.match(/^\d+x\d+/);o&&(e=o[0],n=t.join("/")),n=r.getIcon(n,e)}catch(e){}return n}return null},getProperty:function(e,t,n){const i=(n=n||e.tagName.toLowerCase()).match(/^gui\-(tree|icon|list|file)\-view$/);if("value"===t&&!i)return["gui-text","gui-password","gui-textarea","gui-slider","gui-select","gui-select-list"].indexOf(n)>=0?e.querySelector("input, textarea, select").value:["gui-checkbox","gui-radio","gui-switch"].indexOf(n)>=0?!!e.querySelector("input").checked:null;return e.getAttribute("data-"+t)},createInputLabel:s,setProperty:function(t,n,i,r){function o(e,n,r,o){r?e.setAttribute(n,n):e.removeAttribute(n),o&&t.setAttribute("aria-"+n,String(!0===i))}function a(e,t,n){if("object"==typeof n)try{n=JSON.stringify(i)}catch(e){}e.setAttribute(t,String(n))}r=r||t.tagName.toLowerCase();const l=t.children[0];let c=["gui-slider","gui-text","gui-password","gui-textarea","gui-checkbox","gui-radio","gui-select","gui-select-list","gui-button"];(function(){let l;const u={readonly:function(){o(l,"readonly",i,!0)},disabled:function(){o(l,"disabled",i,!0)},value:function(){"gui-radio"!==r&&"gui-checkbox"!==r||(o(l,"checked",i),l.checked=!!i),l.value=i},label:function(){t.appendChild(l),e.$remove(t.querySelector("label")),s(t,r.replace(/^gui\-/,""),l,i)}};c.indexOf(r)>=0&&(l=t.querySelector("textarea, input, select, button"))&&(u[n]?u[n]():a(l,n,i||""))})(),c=["gui-image","gui-audio","gui-video"],["src","controls","autoplay","alt"].indexOf(n)>=0&&c.indexOf(r)>=0&&(l[n]=i);if(["_id","_class","_style"].indexOf(n)>=0)return void l.setAttribute(n.replace(/^_/,""),i);"value"!==n&&a(t,"data-"+n,i)},createElement:function(t,n,i){i=i||[];const r=document.createElement(t),o={textalign:function(t){e.$addClass(r,"gui-align-"+t)},className:function(t){e.$addClass(r,t)}};"object"==typeof n&&Object.keys(n).forEach(function(e){if(i.indexOf(e)>=0)return;const t=n[e];if(void 0!==t&&"function"!=typeof t){if(o[e])return void o[e](t);const n=function(e,t){if("boolean"==typeof t)t=t?"true":"false";else if("object"==typeof t)try{t=JSON.stringify(t)}catch(e){}return t}(0,t);r.setAttribute("data-"+e,n)}});return r},setFlexbox:function(t,n,i,r,o){o=o||t,void 0!==r&&null!==r||(r=o.getAttribute("data-basis")||"auto"),void 0!==n&&null!==n||(n=o.getAttribute("data-grow")||0),void 0!==i&&null!==i||(i=o.getAttribute("data-shrink")||0);const s=[n,i];r.length&&s.push(r);const a=s.join(" ");t.style.webkitBoxFlex=a,t.style.mozBoxFlex=a,t.style.webkitFlex=a,t.style.mozFlex=a,t.style.msFlex=a,t.style.oFlex=a,t.style.flex=a;const l=t.getAttribute("data-align");e.$removeClass(t,"gui-flex-align-start"),e.$removeClass(t,"gui-flex-align-end"),l&&e.$addClass(t,"gui-flex-align-"+l)},createDrag:function(e,n,i,r){let o,s,a,l;n=n||function(){},i=i||function(){},r=r||function(){};let c=!1;function u(e,t,n){if(e.preventDefault(),c){a=t.x,l=t.y;const n=a-o,r=l-s;i(e,{x:n,y:r},{x:a,y:l})}}function d(e,n,i){r(e,{x:a,y:l}),c=!1,t.$unbind(window,"pointerup:guidrag"),t.$unbind(window,"pointermove:guidrag")}t.$bind(e,"pointerdown",function(e,i,r){e.preventDefault(),o=i.x,s=i.y,n(e,{x:o,y:s}),c=!0,t.$bind(window,"pointerup:guidrag",d,!1),t.$bind(window,"pointermove:guidrag",u,!1)},!1)},getNextElement:function(t,n,i){if(i){const r=function(){const t=["menu","menuitem","grid","gridcell","listitem"],n=[];return i.querySelectorAll(".gui-element").forEach(function(i){e.$hasClass(i,"gui-focus-element")||t.indexOf(i.getAttribute("role"))>=0||"true"===i.getAttribute("data-disabled")||i.offsetParent&&n.push(i)}),n}();if(r.length){const i=function(t,n){if(n){let t=n;for(;t.parentNode;){if(e.$hasClass(t,"gui-element"))return t;t=t.parentNode}return null}return t[0]}(r,n),o=function(e,t){let n=-1;t&&e.every(function(e,i){return e===t&&(n=i),-1===n});return n}(r,i);if(o>=0){const e=function(e,n,i){i=t?i<=0?e.length-1:i-1:i>=e.length-1?0:i+1;return i}(r,0,o);return function(e,t){let n=e[t];n.tagName.match(/^GUI\-(BUTTON|TEXT|PASSWORD|SWITCH|CHECKBOX|RADIO|SELECT)/)&&(n=n.querySelectorAll("input, textarea, button, select")[0]);"GUI-FILE-VIEW"===n.tagName&&(n=n.children[0]);return n}(r,e)}}}return null},createDraggable:function(e,i){i=Object.assign({},{type:null,effect:"move",data:null,mime:"application/json",dragImage:null,onStart:function(){return!0},onEnd:function(){return!0}},i),n.isIE()&&(i.mime="text");function r(t){try{if(t.dataTransfer.effectAllowed=i.effect,i.dragImage&&"function"==typeof i.dragImage&&t.dataTransfer.setDragImage){const n=i.dragImage(t,e);if(n){const e=n.element,i=n.offset;document.body.appendChild(e),t.dataTransfer.setDragImage(e,i.x,i.y)}}t.dataTransfer.setData(i.mime,(i.mime,JSON.stringify({type:i.type,effect:i.effect,data:i.data,mime:i.mime})))}catch(e){console.warn("Failed to dragstart: "+e),console.warn(e.stack)}}e.setAttribute("draggable","true"),e.setAttribute("aria-grabbed","false"),t.$bind(e,"dragstart",function(e){return this.setAttribute("aria-grabbed","true"),this.style.opacity="0.4",e.dataTransfer&&r(e),i.onStart(e,this,i)},!1),t.$bind(e,"dragend",function(e){return this.setAttribute("aria-grabbed","false"),this.style.opacity="1.0",i.onEnd(e,this,i)},!1)},createDroppable:function(e,i){i=Object.assign({},{accept:null,effect:"move",mime:"application/json",files:!0,onFilesDropped:function(){return!0},onItemDropped:function(){return!0},onEnter:function(){return!0},onOver:function(){return!0},onLeave:function(){return!0},onDrop:function(){return!0}},i),n.isIE()&&(i.mime="text");function r(e,t){e.stopPropagation(),e.preventDefault();const n=function(e,t){if(!e.dataTransfer)return!0;if(i.files){const n=e.dataTransfer.files;if(n&&n.length)return i.onFilesDropped(e,t,n,i)}try{const n=e.dataTransfer.getData(i.mime),r=JSON.parse(n);if(null===i.accept||i.accept===r.type)return i.onItemDropped(e,t,r,i)}catch(e){console.warn("Failed to drop: "+e)}return!1}(e,t);return i.onDrop(e,t),n}e.setAttribute("aria-dropeffect",i.effect),t.$bind(e,"drop",function(e){return r(e,this)},!1),t.$bind(e,"dragenter",function(e){return i.onEnter.call(this,e,this,i)},!1),t.$bind(e,"dragover",function(t){return t.preventDefault(),!!function(e,t){if(e===t)return!0;let n=10;for(;e&&n>0;){if(e===t)return!0;e=e.parentNode,n--}return!1}(t.target,e)&&(t.stopPropagation(),t.dataTransfer.dropEffect=i.effect,i.onOver.call(this,t,this,i))},!1),t.$bind(e,"dragleave",function(e){return i.onLeave.call(this,e,this,i)},!1)}}}),e("skylark-osjsv2-client/gui/element",["../utils/dom","../utils/gui","../core/locales","../core/package-manager"],function(e,t,n,i){"use strict";let r={};function o(e){const t={"gui-switch":"button","gui-list-view":"textarea","gui-tree-view":"textarea","gui-icon-view":"textarea","gui-input-modal":"button"};return t[e.tagName]?e.$element.querySelector(t[e.tagName]):e.$element.firstChild||e.$element}function s(e,t,n,i){let o;return e=e||t.tagName.toLowerCase(),r[e]&&(o=new r[e].component(t,n),i&&o.build.apply(o,i)),o}return class a{constructor(e,t){this.$element=e||null,this.tagName=e?e.tagName.toLowerCase():null,this.oldDisplay=null,e||console.warn("GUIElement() was constructed without a DOM element",t)}build(){return this}remove(){return this.$element=e.$remove(this.$element),this}empty(){return e.$empty(this.$element),this}blur(){if(this.$element){const e=o(this);e&&e.blur()}return this}focus(){if(this.$element){const e=o(this);e&&e.focus()}return this}show(){return this.$element&&!this.$element.offsetParent&&this.$element&&(this.$element.style.display=this.oldDisplay||""),this}hide(){return this.$element&&this.$element.offsetParent&&(this.oldDisplay||(this.oldDisplay=this.$element.style.display),this.$element.style.display="none"),this}on(e,t,n){return this}son(e,t,n,i){return this.on(e,function(){const e=Array.prototype.slice.call(arguments);e.unshift(this),n.apply(t,e)},i)}set(e,n,i,r){return this.$element&&t.setProperty(this.$element,e,n,i,r),this}get(e){return this.$element?a.getProperty(this.$element,e):null}append(e){e instanceof a?e=e.$element:"string"!=typeof e&&"number"!=typeof e||(e=document.createTextNode(String(e)));let t=document.createElement("div");return t.appendChild(e),this._append(t),t=null,this}appendHTML(e,t,n){const i=document.createElement("div");return i.innerHTML=e,this._append(i,t,n)}_append(e,t,n){for(e instanceof Element&&a.parseNode(t,e,null,n);e.childNodes.length;)this.$element.appendChild(e.childNodes[0]);return e=null,this}querySelector(e,t){const n=this.$element.querySelector(e);return t?a.createFromNode(n,e):n}querySelectorAll(e,t){let n=this.$element.querySelectorAll(e);return t&&(n=n.map(t=>a.createFromNode(t,e))),n}css(t,n){return e.$css(this.$element,t,n),this}position(){return e.$position(this.$element)}_call(e,t,n){arguments.length<3&&console.warn('Element::_call("methodName") is DEPRECATED, use "instance.methodName()" instead');try{return"function"==typeof this._call?this._call(e,t):this[e](t)}catch(e){console.warn(e.stack,e)}return null}fn(e,t,n){return console.warn('Element::fn("methodName") is DEPRECATED, use "instance.methodName()" instead'),t=t||[],n=n||this,this.fn(e,t,n)}static createInto(e,t,n,i,r){n instanceof a&&(n=n.$element);const o=a.create(e,t,i,r);return n.appendChild(o.$element),o}static createFromNode(e,t,n){if(e){const n=s(null,e,t);if(n)return n}return new a(e,t)}static getProperty(e,n,i){const r=(i=i||e.tagName.toLowerCase()).match(/^gui\-(tree|icon|list|file)\-view$/);return"value"!==n&&"selected"!==n||!r?t.getProperty(e,n,i):a.createFromNode(e).values()}static create(e,n,i,r){e=e||"",i=i||{},n=n||{};const o=t.createElement(e,n);return s(null,o,null,[i,r])}static createInstance(e,t,n){return console.warn("Element::createInstance() is DEPRECATED, use Element::createFromNode() instead"),this.createFromNode(e,t,n)}static parseNode(o,a,l,c,u,d){u=u||function(){},c=c||{},l=l||"snipplet",a.querySelectorAll("*").forEach(t=>{const n=t.tagName.toLowerCase();n.match(/^gui\-/)&&!n.match(/(\-container|\-(h|v)box|\-columns?|\-rows?|(status|tool)bar|(button|menu)\-bar|bar\-entry)$/)&&e.$addClass(t,"gui-element")}),function(e,r,o){const s=(o=o||{}).undefined||n._;e.querySelectorAll("*[data-label]").forEach(function(e){const t=s(e.getAttribute("data-label"));e.setAttribute("data-label",t)}),e.querySelectorAll("gui-label, gui-button, gui-list-view-column, gui-select-option, gui-select-list-option").forEach(function(e){if(!e.children.length&&!e.getAttribute("data-no-translate")){const n=t.getValueLabel(e);e.appendChild(document.createTextNode(s(n)))}}),e.querySelectorAll("gui-button").forEach(function(e){const i=t.getValueLabel(e);i&&e.appendChild(document.createTextNode(n._(i)))}),e.querySelectorAll("*[data-icon], *[data-stock-icon]").forEach(function(e){const n=t.getIcon(e,r);e.setAttribute("data-icon",n)}),e.querySelectorAll("*[data-src],*[src]").forEach(function(e){const t=e.hasAttribute("src"),n=t?e.getAttribute("src"):e.getAttribute("data-src")||"";if(r&&r._app&&!n.match(/^(https?:)?\//)){const o=i.getPackageResource(r._app,n);e.setAttribute(t?"src":"data-src",o)}})}(a,o,c),u(a),Object.keys(r).forEach(t=>{a.querySelectorAll(t).forEach(n=>{if(!n._wasParsed&&!e.$hasClass(n,"gui-data-view")){try{s(t,n,null,[])}catch(e){console.warn("parseNode()",d,l,o,"exception"),console.warn(e,e.stack)}n._wasParsed=!0}})})}static register(e,t){const n=e.tagName;if(r[n])throw new Error('GUI Element "'+n+'" already exists');r[n]=(()=>{const n=Object.assign({},{type:"element",allowedChildren:[],allowedParents:[]},e);return n.parent&&delete n.parent,"input"===n.type?n.allowedChildren=!0:"container"!==n.type&&(n.allowedChildren=!1),{metadata:n,component:t}})()}static getRegisteredElement(e){return r[e]}}}),e("skylark-osjsv2-client/gui/scheme",["skylark-axios","../utils/dom","./element","../core/config"],function(e,t,n,i){"use strict";function r(e,t,n){if(e){const i=e.children;let r=0;for(;i.length&&r<1e4;)n?t.parentNode.insertBefore(i[0],t):t.appendChild(i[0]),r++}}function o(e){return t.$clean(function(e){const t=(e||"").split("/>");let n="";for(let e=0;e<t.length-1;e++){const i=t[e].split("<");n+=t[e]+"></"+i[i.length-1].split(" ")[0]+">"}return n+t[t.length-1]}(e))}return class s{constructor(e){console.debug("GUIScheme::construct()",e),this.url=e,this.scheme=null,this.triggers={render:[]}}destroy(){t.$empty(this.scheme),this.scheme=null,this.triggers={}}on(e,t){this.triggers[e].push(t)}_trigger(e,t){t=t||[],this.triggers[e]&&this.triggers[e].forEach(e=>{e.apply(this,t)})}_load(e,t){let r=document.createDocumentFragment(),o=document.createElement("div");o.innerHTML=e,r.appendChild(o),this.scheme=r.cloneNode(!0),i.getConfig("DebugScheme")&&(console.group("Scheme::_load() validation",t),this.scheme.querySelectorAll("*").forEach(e=>{const t=e.tagName.toLowerCase(),i=n.getRegisteredElement(t);if(i){const n=i.metadata.allowedChildren;if(n instanceof Array&&n.length){const i=e.children.map(e=>e.tagName.toLowerCase());i.forEach((i,r)=>{const o=n.indexOf(i);-1===o&&console.warn(i,e.children[r],"is not a valid child of type",t)})}const r=i.metadata.allowedParents;if(r instanceof Array&&r.length){const n=e.parentNode.tagName.toLowerCase();-1===r.indexOf(n)&&console.warn(n,e.parentNode,"is in an invalid parent of type",t)}}}),console.groupEnd()),o=null,r=null}load(t,n){n=n||function(){},console.debug("GUIScheme::load()",this.url);let r=this.url;"/"===r.substr(0,1)||r.match(/^(https?|ftp)/)||(r=i.getBrowserPath(r)),e({url:r,method:"GET"}).then(e=>{const i=o(e.data);n(!1,i),this._load(i,r),t(!1,this.scheme)}).catch(e=>{t("Failed to fetch scheme: "+e.message),n(!0)})}getFragment(e,t){let n=null;return e&&(n=t?this.scheme.querySelector(t+'[data-id="'+e+'"]'):this.scheme.querySelector('application-window[data-id="'+e+'"]')||this.scheme.querySelector('application-dialog[data-id="'+e+'"]')||this.scheme.querySelector('application-fragment[data-id="'+e+'"]')),n}parse(e,i,o,s,a){const l=this.getFragment(e,i);if(console.debug("GUIScheme::parse()",e),!l)return console.error("GUIScheme::parse()","No fragment found",e+"@"+i),null;if(i=i||l.tagName.toLowerCase(),a=a||{},l){const c=l.cloneNode(!0);return!1!==a.resolve&&function(e,n){function i(){const i=n.querySelectorAll("gui-fragment");return!!i.length&&(i.forEach(function(n){const i=n.getAttribute("data-fragment-id");if(i){const t=e.getFragment(i,"application-fragment");t?r(t.cloneNode(!0),n.parentNode):console.warn("Fragment",i,"not found")}t.$remove(n)}),!0)}if(e){let e=!0;for(;e;)e=i()}}(this,c),n.parseNode(o,c,i,a,s,e),c}return null}render(e,i,o,s,a,l){(o=o||e._getRoot())instanceof n&&(o=o.$element),console.debug("GUIScheme::render()",i);const c=this.parse(i,s,e,a,l);r(c,o),o.querySelectorAll("application-fragment").forEach(e=>{t.$remove(e)}),e._restored||function(t){if(t){const n=parseInt(t.getAttribute("data-width"),10)||0,i=parseInt(t.getAttribute("data-height"),10)||0,r=t.getAttribute("data-allow_maximize"),o=t.getAttribute("data-allow_minimize"),s=t.getAttribute("data-allow_close"),a=t.getAttribute("data-allow_resize");(!isNaN(n)&&n>0||!isNaN(i)&&i>0)&&e._resize(n,i),e._setProperty("allow_maximize",r),e._setProperty("allow_minimize",o),e._setProperty("allow_close",s),e._setProperty("allow_resize",a)}}(this.getFragment(i)),this._trigger("render",[o])}getHTML(){return this.scheme.firstChild.innerHTML}static fromString(e){const t=new s(null),n=o(e);return t._load(n,"<html>"),t}}}),e("skylark-osjsv2-client/gui/menu",["../utils/gui","../utils/dom","../utils/events","./element","../core/window-manager","../helpers/hooks"],function(e,t,n,i,r,o){"use strict";let s;function a(e,n,i,r){e.stopPropagation();let o=e.target;o&&"LABEL"===o.tagName&&(o=o.parentNode);let s=!1;if(o&&"GUI-MENU-ENTRY"===o.tagName){let a=o.querySelector("gui-menu");s=!!a;try{s&&!e.isTrusted&&(o.parentNode.querySelectorAll("gui-menu-entry").forEach(e=>{t.$removeClass(e,"active")}),t.$addClass(o,"active"))}catch(e){console.warn(e)}i(e,n,o,r,s)}}function l(e){const n=t.$position(e);n&&window.innerWidth-n.right<e.offsetWidth&&(t.$addClass(e,"gui-overflowing"),function e(t){t.querySelectorAll("gui-menu-entry").forEach(function(t){const n=t.querySelector("gui-menu");n&&(n.style.left=String(-parseInt(n.offsetWidth,10))+"px",e(n))})}(e)),t.$addClass(e,"gui-showing")}function c(e){s&&s(e),s=null,o.triggerHook("menuBlur")}return{clickWrapper:a,clamp:l,blur:c,create:function(o,u,d){o=o||[],c(u);let h=d,p=[];h||(h=e.createElement("gui-menu",{}),function t(n,i){n.forEach(function(n){const r={label:n.title,icon:n.icon,disabled:n.disabled,labelHTML:n.titleHTML,type:n.type,checked:n.checked},o=e.createElement("gui-menu-entry",r);if(n.menu){const i=e.createElement("gui-menu",{});t(n.menu,i),o.appendChild(i)}if(n.onClick){const e=p.push(n.onClick);o.setAttribute("data-callback-id",String(e-1))}i.appendChild(o)})}(o||[],h),i.createFromNode(h,null,"gui-menu").build(!0),n.$bind(h,"mouseover",function(e,n){e.target&&"GUI-MENU-ENTRY"===e.target.tagName&&setTimeout(()=>{!function(e){if(e){const n=t.$position(e),i=r.instance,o=i.getWindowSpace(!0);if(n){const t=o.height-n.bottom;t<0&&(e.style.marginTop=String(t)+"px")}}}(e.target.querySelector("gui-menu"))},1)},!0),n.$bind(h,"click",function(e,t){a(e,t,function(e,t,n,i,r){const o=parseInt(n.getAttribute("data-callback-id"),10);p[o]&&p[o](e,t),r||c(e)})},!0));h.$element&&(h=h.$element);const g=r.instance.getWindowSpace(!0),m=n.mousePosition(u);t.$addClass(h,"gui-root-menu"),h.style.left=m.x+"px",h.style.top=m.y+"px",document.body.appendChild(h),setTimeout(function(){const e=t.$position(h);if(e){if(e.right>g.width){const t=Math.round(g.width-e.width);h.style.left=Math.max(0,t)+"px"}if(e.bottom>g.height){const t=Math.round(g.height-e.height);h.style.top=Math.max(0,t)+"px"}}l(h),s=function(){p=[],h&&(h.querySelectorAll("gui-menu-entry").forEach(function(e){n.$unbind(e)}),n.$unbind(h)),h=t.$remove(h)}},1)},setActive:function(e){c(),s=e}}}),e("skylark-osjsv2-client/core/window",["../vfs/file","./window-manager","../gui/element","../gui/scheme","../helpers/event-handler","./theme","../utils/dom","../utils/gui","../utils/events","../utils/compability","../utils/keycodes","../gui/menu","./locales"],function(e,t,n,i,r,o,s,a,l,c,u,d,h){"use strict";const p=function(){let e=1,t=1e5;return function(n){return void 0!==n&&!0===n?t+=2:e+=2}}();function g(){const e=t.instance;return e?e.getWindowSpace():{top:0,left:0,width:document.body.offsetWidth,height:document.body.offsetHeight}}function m(e,n){const i=t.instance,r=!!i&&i.getSetting("animations");r?e._animationCallback=n:n()}const f=function(){let e;return function(){return e||(e=function(){let e={};const n=t.instance;if(n){const t=n.getDefaultSetting("mediaQueries")||{};Object.keys(t).forEach(function(n){t[n]&&(e[n]=function(e,i,r){return e<=t[n]})})}return e}()),e}}();let _=0,w=[];return class{constructor(e,n,i){if(w.indexOf(e)>=0)throw new Error(h._("ERR_WIN_DUPLICATE_FMT",e));var s,a,l;n=Object.assign({},{icon:o.getIcon("apps/preferences-system-windows.png"),width:200,height:200,title:e,tag:e,auto_size:!1},n),console.group("Window::constructor()",_,arguments),this._$element=null,this._$root=null,this._$top=null,this._$winicon=null,this._$loading=null,this._$disabled=null,this._$resize=null,this._$warning=null,this._opts=n,this._app=i||null,this._destroyed=!1,this._restored=!1,this._loaded=!1,this._initialized=!1,this._disabled=!0,this._loading=!1,this._wid=_,this._icon=n.icon,this._name=e,this._title=n.title,this._tag=n.tag,this._position={x:n.x,y:n.y},this._dimension={w:n.width,h:n.height},this._children=[],this._parent=null,this._origtitle=this._title,this._lastDimension=this._dimension,this._lastPosition=this._position,this._sound=null,this._soundVolume=1,this._scheme=null,this._properties={gravity:null,allow_move:!0,allow_resize:!0,allow_minimize:!0,allow_maximize:!0,allow_close:!0,allow_windowlist:!0,allow_drop:!1,allow_iconmenu:!0,allow_ontop:!0,allow_hotkeys:!0,allow_session:!0,key_capture:!1,start_focused:!0,min_width:150,min_height:150,max_width:null,max_height:null,media_queries:f()},this._state={focused:!1,modal:!1,minimized:!1,maximized:!1,ontop:!1,onbottom:!1},this._animationCallback=null,this._queryTimer=null,this._evHandler=new r(e,["focus","blur","destroy","maximize","minimize","restore","move","moved","resize","resized","keydown","keyup","keypress","drop","drop:upload","drop:file"]),Object.keys(n).forEach(e=>{void 0!==this._properties[e]?this._properties[e]=n[e]:void 0!==this._state[e]&&"focused"!==e?this._state[e]=n[e]:-1!=="sound_volume".indexOf(e)&&(this["_"+(s=e,s.replace(/_([a-z])/g,function(e){return e[1].toUpperCase()}))]=n[e])}),((e,n)=>{if(!e.gravity&&void 0===n.x||void 0===n.y){const e=t.instance,i=e?e.getWindowPosition():{x:0,y:0};n.x=i.x,n.y=i.y}})(this._properties,this._position),a=this._properties,l=this._dimension,a.min_height&&l.h<a.min_height&&(l.h=a.min_height),a.max_width&&l.w<a.max_width&&(l.w=a.max_width),a.max_height&&l.h>a.max_height&&(l.h=a.max_height),a.max_width&&l.w>a.max_width&&(l.w=a.max_width),((e,t)=>{i&&i.__args&&i.__args.__windows__&&i.__args.__windows__.forEach(n=>{!this._restored&&n.name&&n.name===this._name&&(e.x=n.position.x,e.y=n.position.y,this._properties.allow_resize&&(t.w=n.dimension.w,t.h=n.dimension.h),console.info("RESTORED FROM SESSION",n),this._restored=!0)})})(this._position,this._dimension),((e,t,n,i)=>{const r=e.gravity;if(r&&!i)if("center"===r)t.y=window.innerHeight/2-this._dimension.h/2,t.x=window.innerWidth/2-this._dimension.w/2;else{const e=g();r.match(/^south/)?t.y=e.height-n.h:t.y=e.top,r.match(/west$/)?t.x=e.left:t.x=e.width-n.w}})(this._properties,this._position,this._dimension,this._restored),console.debug("State",this._state),console.debug("Properties",this._properties),console.debug("Position",this._position),console.debug("Dimension",this._dimension),console.groupEnd(),_++}init(e,t){if(this._initialized||this._loaded)return this._$root;this._$element=s.$create("application-window",{className:((e,t)=>{const n=["Window",s.$safeName(e)];return t&&e!==t&&n.push(s.$safeName(t)),n})(this._name,this._tag).join(" "),style:{width:this._dimension.w+"px",height:this._dimension.h+"px",top:this._position.y+"px",left:this._position.x+"px",zIndex:p(this._state.ontop)},data:{window_id:this._wid,allow_resize:this._properties.allow_resize,allow_minimize:this._properties.allow_minimize,allow_maximize:this._properties.allow_maximize,allow_close:this._properties.allow_close},aria:{role:"application",live:"polite",hidden:"false"}}),this._$root=document.createElement("application-window-content"),this._$resize=document.createElement("application-window-resize"),["nw","n","ne","e","se","s","sw","w"].forEach(e=>{let t=document.createElement("application-window-resize-handle");t.setAttribute("data-direction",e),this._$resize.appendChild(t),t=null}),this._$loading=document.createElement("application-window-loading"),this._$disabled=document.createElement("application-window-disabled"),this._$top=document.createElement("application-window-top"),this._$winicon=document.createElement("application-window-icon"),this._$winicon.setAttribute("role","button"),this._$winicon.setAttribute("aria-haspopup","true"),this._$winicon.setAttribute("aria-label","Window Menu");const n=document.createElement("application-window-title");let i;n.setAttribute("role","heading");const r=e=>{"function"==typeof this._animationCallback&&(clearTimeout(i),i=setTimeout(()=>{this._animationCallback(e),this._animationCallback=!1,i=clearTimeout(i)},10))};return l.$bind(this._$element,"transitionend",r),l.$bind(this._$element,"animationend",r),l.$bind(this._$element,"click",e=>{this._focus()},!0),l.$bind(this._$top,"mouseup",e=>{const t=e.target;t&&(t.tagName.match(/^APPLICATION\-WINDOW\-BUTTON/)?this._onWindowButtonClick(e,t,t.getAttribute("data-action")):"APPLICATION-WINDOW-ICON"===t.tagName&&this._onWindowIconClick(e))}),l.$bind(this._$top,"dblclick",()=>{this._maximize()}),((e,t,n)=>{if(e.allow_drop&&n.dnd){const e=document.createElement("div");e.className="WindowDropRect",a.createDroppable(t,{onOver:(e,n,i)=>{t.setAttribute("data-dnd-state","true")},onLeave:()=>{t.setAttribute("data-dnd-state","false")},onDrop:()=>{t.setAttribute("data-dnd-state","false")},onItemDropped:(e,n,i,r)=>(t.setAttribute("data-dnd-state","false"),this._onDndEvent(e,"itemDrop",i,r,n)),onFilesDropped:(e,n,i,r)=>(t.setAttribute("data-dnd-state","false"),this._onDndEvent(e,"filesDrop",i,r,n))})}})(this._properties,this._$element,c.getCompability()),n.appendChild(document.createTextNode(this._title)),this._$top.appendChild(this._$winicon),this._$top.appendChild(n),this._$top.appendChild(s.$create("application-window-button-minimize",{className:"application-window-button-entry",data:{action:"minimize"},aria:{role:"button",label:"Minimize Window"}})),this._$top.appendChild(s.$create("application-window-button-maximize",{className:"application-window-button-entry",data:{action:"maximize"},aria:{role:"button",label:"Maximize Window"}})),this._$top.appendChild(s.$create("application-window-button-close",{className:"application-window-button-entry",data:{action:"close"},aria:{role:"button",label:"Close Window"}})),this._$loading.appendChild(document.createElement("application-window-loading-indicator")),this._$element.appendChild(this._$top),this._$element.appendChild(this._$root),this._$element.appendChild(this._$resize),this._$element.appendChild(this._$disabled),this._$element.appendChild(this._$loading),document.body.appendChild(this._$element),this._onChange("create"),this._toggleLoading(!1),this._toggleDisabled(!1),this._setIcon(o.getIcon(this._icon)),this._updateMarkup(),this._sound&&o.playSound(this._sound,this._soundVolume),this._initialized=!0,this._emit("init",[this._$root]),this._$root}_inited(){if(this._loaded)return;if(this._loaded=!0,this._onResize(),!this._restored)if(this._state.maximized)this._maximize(!0);else if(this._state.minimized)this._minimize(!0);else if(this._opts.auto_size){let e=0,t=0;const n=i=>{i.children.forEach(i=>{e=Math.max(e,i.offsetWidth),t=Math.max(t,i.offsetHeight),i.children.length&&n(i)})};n(this._$root),this._resize(e,t,!0)}let e=setTimeout(()=>{this._emit("inited",[]),e=clearTimeout(e)},10);this._app&&this._app._emit("initedWindow",[this]),console.debug("Window::_inited()",this._name)}destroy(e){if(this._destroyed)return!1;this._emit("destroy"),this._destroyed=!0;const n=t.instance;console.group("Window::destroy()");const i=()=>{this._setWarning(null),this._$root=null,this._$top=null,this._$winicon=null,this._$loading=null,this._$disabled=null,this._$resize=null,this._$warning=null,this._$element=s.$remove(this._$element)};return this._onChange("close"),(e=>{if(this._$element){const t=!!n&&n.getSetting("animations");if(t){this._$element.setAttribute("data-closing","true"),this._animationCallback=e;let t=setTimeout(()=>{this._animationCallback&&this._animationCallback(),t=clearTimeout(t)},1e3)}else this._$element.style.display="none",e()}})(()=>{i()}),(()=>{this._$element&&this._$element.querySelectorAll("*").forEach(e=>{e&&l.$unbind(e)});this._parent&&this._parent._removeChild(this);this._parent=null,this._removeChildren()})(),(()=>{n&&n.removeWindow(this);const e=n?n.getCurrentWindow():null;e&&e._wid===this._wid&&n.setCurrentWindow(null);const t=n?n.getLastWindow():null;t&&t._wid===this._wid&&n.setLastWindow(null)})(),this._app&&this._app._onMessage("destroyWindow",this,{}),this._evHandler&&this._evHandler.destroy(),this._app=null,this._evHandler=null,this._args={},this._queryTimer=clearTimeout(this._queryTimer),this._scheme=this._scheme?this._scheme.destroy():null,console.groupEnd(),!0}_find(e,t){const n='[data-id="'+e+'"]';return this._findByQuery(n,t)}_render(e,t,n,r){return t&&(n=n||this._getRoot(),r=r||{},"function"==typeof this._opts.translator&&(r.undefined=this._opts.translator),this._scheme="string"==typeof t?i.fromString(t):t),this._scheme instanceof i?this._scheme.render(this,e,n,null,null,r):console.warn("Got an invalid scheme in window render()",this._scheme),this._scheme}_findDOM(e,t){t=t||this._getRoot();const n='[data-id="'+e+'"]';return t.querySelector(n)}_create(e,t,i,r){return i=i||this._getRoot(),n.createInto(e,t,i,r,this)}_findByQuery(e,t,i){if(!((t=t||this._getRoot())instanceof window.Node))return i?[]:null;if(i)return t.querySelectorAll(e).map(t=>n.createFromNode(t,e));const r=t.querySelector(e);return n.createFromNode(r,e)}_emit(e,t){return!(this._destroyed||!this._evHandler)&&this._evHandler.emit(e,t)}_on(e,t){return!!this._evHandler&&this._evHandler.on(e,t,this)}_off(e,t){return!!this._evHandler&&this._evHandler.off(e,t)}_addChild(e,n,i){console.debug("Window::_addChild()"),e._parent=this;const r=t.instance;return n&&r&&r.addWindow(e,i),this._children.push(e),e}_removeChild(e){let t=!1;return this._children.forEach((n,i)=>{n&&n._wid===e._wid&&(console.debug("Window::_removeChild()"),n.destroy(),this._children[i]=null,t=!0)}),t}_getChild(e,t){t=t||"wid";const n=this._getChildren().filter(n=>n["_"+t]===e);return"tag"===t?n:n[0]}_getChildById(e){return this._getChild(e,"wid")}_getChildByName(e){return this._getChild(e,"name")}_getChildrenByTag(e){return this._getChild(e,"tag")}_getChildren(){return this._children.filter(e=>!!e)}_removeChildren(){this._children.forEach((e,t)=>{e&&e.destroy()}),this._children=[]}_close(){return!this._disabled&&!this._destroyed&&(console.debug("Window::_close()"),this._blur(),this.destroy(),!0)}_minimize(e){if(!this._properties.allow_minimize||this._destroyed)return!1;if(!e&&this._state.minimized)return this._restore(!1,!0),!0;console.debug(this._name,">","Window::_minimize()"),this._blur(),this._state.minimized=!0,this._$element.setAttribute("data-minimized","true"),m(this,()=>{this._$element.style.display="none",this._emit("minimize")}),this._onChange("minimize");const n=t.instance,i=n?n.getCurrentWindow():null;return i&&i._wid===this._wid&&n.setCurrentWindow(null),this._updateMarkup(),!0}_maximize(e){if(!this._properties.allow_maximize||this._destroyed||!this._$element)return!1;if(!e&&this._state.maximized)return this._restore(!0,!1),!0;console.debug(this._name,">","Window::_maximize()"),this._lastPosition={x:this._position.x,y:this._position.y},this._lastDimension={w:this._dimension.w,h:this._dimension.h},this._state.maximized=!0;const t=this._getMaximizedSize();return this._$element.style.zIndex=p(this._state.ontop),this._$element.style.top=t.top+"px",this._$element.style.left=t.left+"px",this._$element.style.width=t.width+"px",this._$element.style.height=t.height+"px",this._$element.setAttribute("data-maximized","true"),this._dimension.w=t.width,this._dimension.h=t.height,this._position.x=t.left,this._position.y=t.top,this._focus(),m(this,()=>{this._emit("maximize")}),this._onChange("maximize"),this._onResize(),this._updateMarkup(),!0}_restore(e,t){if(!this._$element||this._destroyed)return;console.debug(this._name,">","Window::_restore()"),e=void 0===e||!0===e,t=void 0===t||!0===t,(()=>{e&&this._state.maximized&&(this._move(this._lastPosition.x,this._lastPosition.y),this._resize(this._lastDimension.w,this._lastDimension.h),this._state.maximized=!1,this._$element.setAttribute("data-maximized","false"))})(),(()=>{t&&this._state.minimized&&(this._$element.style.display="block",this._$element.setAttribute("data-minimized","false"),this._state.minimized=!1)})(),m(this,()=>{this._emit("restore")}),this._onChange("restore"),this._onResize(),this._focus(),this._updateMarkup()}_focus(e){if(!this._$element||this._destroyed)return!1;this._toggleAttentionBlink(!1),this._$element.style.zIndex=p(this._state.ontop),this._$element.setAttribute("data-focused","true");const n=t.instance,i=n?n.getCurrentWindow():null;return i&&i._wid!==this._wid&&i._blur(),n&&(n.setCurrentWindow(this),n.setLastWindow(this)),this._state.focused&&!e||(this._onChange("focus"),this._emit("focus")),this._state.focused=!0,this._updateMarkup(),!0}_blur(e){if(!this._$element||this._destroyed||!e&&!this._state.focused)return!1;this._$element.setAttribute("data-focused","false"),this._state.focused=!1,this._onChange("blur"),this._emit("blur"),this._blurGUI();const n=t.instance,i=n?n.getCurrentWindow():null;return i&&i._wid===this._wid&&n.setCurrentWindow(null),this._updateMarkup(),!0}_blurGUI(){this._$root.querySelectorAll("input, textarea, select, iframe, button").forEach(e=>{e.blur()})}_resizeTo(e,n,i,r,o,a){if(!this._$element||e<=0||n<=0)return;i=void 0===i||!0===i;let l=0,c=0;if(o){const e=s.$position(o,this._$root);l=parseInt(e.left,10),c=parseInt(e.top,10)}const u=this._getMaximizedSize(),d=this._position.x+l,h=this._position.y+c;let p=e,g=n,m=null,f=null;const _=()=>{d+p>u.width?r?(p=u.width,m=u.left):p=u.width-d+l:p+=l,h+g>u.height?r?(g=u.height,f=u.top):g=u.height-h+this._$top.offsetHeight+c:g+=c};i&&_(),this._resize(p,g,a),(()=>{null!==m&&this._move(m,this._position.y);null!==f&&this._move(this._position.x,f)})(),(()=>{const e=t.instance;e&&e.getSetting("animations")?this._animationCallback=(()=>{this._emit("resized")}):this._emit("resized")})()}_resize(e,t,n){const i=this._properties;if(!this._$element||this._destroyed||!n&&!i.allow_resize)return!1;const r=(e,t,n)=>(!isNaN(e)&&e&&(e=Math.max(e,t),null!==n&&(e=Math.min(e,n))),e);return e=n?e:r(e,i.min_width,i.max_width),!isNaN(e)&&e&&(this._$element.style.width=e+"px",this._dimension.w=e),t=n?t:r(t,i.min_height,i.max_height),!isNaN(t)&&t&&(this._$element.style.height=t+"px",this._dimension.h=t),this._onResize(),!0}_moveTo(e){const n=t.instance;if(!n)return;const i=n.getWindowSpace(),r=this._position.x,o=this._position.y;"left"===e?this._move(i.left,o):"right"===e?this._move(i.width-this._dimension.w,o):"top"===e?this._move(r,i.top):"bottom"===e&&this._move(r,i.height-this._dimension.h)}_move(e,t){return!(!this._$element||this._destroyed||!this._properties.allow_move)&&(void 0!==e&&void 0!==t&&(this._$element.style.top=t+"px",this._$element.style.left=e+"px",this._position.x=e,this._position.y=t,!0))}_toggleDisabled(e){this._$disabled&&(this._$disabled.style.display=e?"block":"none"),this._disabled=!!e,this._updateMarkup()}_toggleLoading(e){this._$loading&&(this._$loading.style.display=e?"block":"none"),this._loading=!!e,this._updateMarkup()}_updateMarkup(e){if(!this._$element)return;const t=this._loading||this._disabled,n=this._disabled,i=this._state.minimized,r=!this._state.focused;if(this._$element.setAttribute("aria-busy",String(t)),this._$element.setAttribute("aria-hidden",String(i)),this._$element.setAttribute("aria-disabled",String(n)),this._$root.setAttribute("aria-hidden",String(r)),!e)return;const o=!0===this._properties.allow_maximize?"inline-block":"none",s=!0===this._properties.allow_minimize?"inline-block":"none",a=!0===this._properties.allow_close?"inline-block":"none";this._$top.querySelector("application-window-button-maximize").style.display=o,this._$top.querySelector("application-window-button-minimize").style.display=s,this._$top.querySelector("application-window-button-close").style.display=a;const l=!0===this._properties.allow_resize;this._$element.setAttribute("data-allow-resize",String(l))}_toggleAttentionBlink(e){if(!this._$element||this._destroyed||this._state.focused)return!1;const t=this._$element;return(e=>{t&&(e?s.$addClass(t,"WindowAttentionBlink"):s.$removeClass(t,"WindowAttentionBlink"));this._onChange(e?"attention_on":"attention_off")})(e),!0}_nextTabIndex(e){const t=a.getNextElement(e.shiftKey,document.activeElement,this._$root);if(t)if(s.$hasClass(t,"gui-data-view"))n.createFromNode(t).focus();else try{t.focus()}catch(e){}}_onDndEvent(t,n,i,r,o){return!this._disabled&&!this._destroyed&&(console.debug("Window::_onDndEvent()",n,i,r),this._emit("drop",[t,n,i,r,o]),i&&("filesDrop"===n?this._emit("drop:upload",[t,i,r,o]):"itemDrop"===n&&"file"===i.type&&i.data&&this._emit("drop:file",[t,new e(i.data||{}),r,o])),!0)}_onKeyEvent(e,t){return!(this._destroyed||!this._state.focused)&&("keydown"===t&&e.keyCode===u.TAB&&this._nextTabIndex(e),this._emit(t,[e,e.keyCode,e.shiftKey,e.ctrlKey,e.altKey]),!0)}_onResize(){clearTimeout(this._queryTimer),this._queryTimer=setTimeout(()=>{!function(e){const n=t.instance;if(!e._$element||!n)return;let i,r="";const o=e._properties.media_queries||{},s=e._$element.offsetWidth,a=e._$element.offsetHeight;for(i in o)if(o.hasOwnProperty(i)&&o[i](s,a,e)){r=i;break}e._$element.setAttribute("data-media",r)}(this),this._queryTimer=clearTimeout(this._queryTimer)},20)}_onWindowIconClick(e){if(!this._properties.allow_iconmenu||this._destroyed)return;console.debug(this._name,">","Window::_onWindowIconClick()");const t=[[this._properties.allow_minimize,()=>({title:h._("WINDOW_MINIMIZE"),icon:o.getIcon("actions/go-up.png"),onClick:(e,t)=>{this._minimize()}})],[this._properties.allow_maximize,()=>({title:h._("WINDOW_MAXIMIZE"),icon:o.getIcon("actions/view-fullscreen.png"),onClick:(e,t)=>{this._maximize(),this._focus()}})],[this._state.maximized,()=>({title:h._("WINDOW_RESTORE"),icon:o.getIcon("actions/view-restore.png"),onClick:(e,t)=>{this._restore(),this._focus()}})],[this._properties.allow_ontop,()=>this._state.ontop?{title:h._("WINDOW_ONTOP_OFF"),icon:o.getIcon("actions/window-new.png"),onClick:(e,t)=>{this._state.ontop=!1,this._$element&&(this._$element.style.zIndex=p(!1)),this._focus()}}:{title:h._("WINDOW_ONTOP_ON"),icon:o.getIcon("actions/window-new.png"),onClick:(e,t)=>{this._state.ontop=!0,this._$element&&(this._$element.style.zIndex=p(!0)),this._focus()}}],[this._properties.allow_close,()=>({title:h._("WINDOW_CLOSE"),icon:o.getIcon("actions/window-close.png"),onClick:(e,t)=>{this._close()}})]],n=[];t.forEach(e=>{e[0]&&n.push(e[1]())}),this._focus(),d.create(n,e)}_onWindowButtonClick(e,t,n){const i={close:this._close,minimize:this._minimize,maximize:this._maximize};if(i[n]){try{this._blurGUI()}catch(e){}i[n].call(this)}}_onChange(e,n){if(e=e||""){const n=t.instance;n&&n.eventWindow(e,this)}}_getMaximizedSize(){const e=g();if(!this._$element||this._destroyed)return e;let t=23,n=0;const i=o.getStyleTheme(!0,!0);return i&&i.style&&i.style.window&&(t=i.style.window.margin,n=i.style.window.border),e.left+=n,e.top+=n,e.width-=2*n,e.height-=t+2*n,Object.freeze(e)}_getViewRect(){return this._$element?Object.freeze(s.$position(this._$element)):null}_getRoot(){return this._$root}_getZindex(){return this._$element?parseInt(this._$element.style.zIndex,10):-1}_getTitle(){return this._title}_setTitle(e,t,n){if(!this._$element||this._destroyed)return;n=n||"-";const i=this._$element.getElementsByTagName("application-window-title")[0];let r=[];r=t?[this._origtitle,n,e]:[e||this._origtitle],this._title=r.join(" ")||this._origtitle,i&&(s.$empty(i),i.appendChild(document.createTextNode(this._title))),this._onChange("title"),this._updateMarkup()}_setIcon(e){this._$winicon&&(this._$winicon.title=this._title,this._$winicon.style.backgroundImage="url("+e+")"),this._icon=e,this._onChange("icon")}_setWarning(e){if(this._$warning=s.$remove(this._$warning),this._destroyed||null===e)return;e=e||"";let t=document.createElement("application-window-warning"),n=document.createElement("div");n.innerHTML="X",l.$bind(n,"click",()=>{this._setWarning(null)});let i=document.createElement("div");i.appendChild(document.createTextNode(e)),t.appendChild(n),t.appendChild(i),this._$warning=t,this._$root.appendChild(this._$warning)}_setProperty(e,t){""!==t&&null!==t&&this._$element&&void 0!==this._properties[e]&&(this._properties[e]="true"===String(t),this._updateMarkup(!0))}}}),e("skylark-osjsv2-client/core/application",["./process","./settings-manager","./window-manager","./window"],function(e,t,n,i){"use strict";return class extends e{constructor(e,n,i,r,o){console.group("Application::constructor()",arguments),o=Object.assign({closeWithMain:!0,closeOnEmpty:!0},o||{}),super(...arguments),this.__inited=!1,this.__mainwindow=null,this.__windows=[],this.__settings=null,this.__destroying=!1,this.__options=o;try{this.__settings=t.instance(e,r||{})}catch(n){console.warn("Application::construct()","An error occured while loading application settings",n),console.warn(n.stack),this.__settings=t.instance(e,{})}console.groupEnd()}init(e,t){const i=n.instance,r=()=>{let e;i&&this.__windows.forEach((t,n)=>{t&&(i.addWindow(t),e=t)}),e&&e._focus()};this.__inited||(console.debug("Application::init()",this.__pname),this.__settings&&this.__settings.set(null,e),this.__inited=!0,this.__evHandler.emit("init",[e,t]),r())}destroy(){if(this.__destroying||this.__destroyed)return!0;this.__destroying=!0,console.group("Application::destroy()",this.__pname),this.__windows.forEach(e=>e&&e.destroy()),this.__scheme&&"function"==typeof this.__scheme.destroy&&this.__scheme.destroy(),this.__mainwindow=null,this.__settings={},this.__windows=[],this.__scheme=null;const e=super.destroy(...arguments);return console.groupEnd(),e}_onMessage(e,t,n){return!this.__destroying&&!this.__destroyed&&("destroyWindow"===e?this.__destroying||(this._removeWindow(t),this.__options.closeOnEmpty&&!this.__windows.length?(console.info("All windows removed, destroying application"),this.destroy()):t._name===this.__mainwindow&&this.__options.closeWithMain&&(console.info("Main window was closed, destroying application"),this.destroy())):"attention"===e&&this.__windows.length&&this.__windows[0]&&this.__windows[0]._focus(),super._onMessage(...arguments))}_addWindow(e,t,r){if(!(e instanceof i))throw new TypeError("Application::_addWindow() expects Core.Window");console.debug("Application::_addWindow()"),this.__windows.push(e),(r||1===this.__windows.length)&&(this.__mainwindow=e._name);const o=n.instance;return this.__inited&&(o&&o.addWindow(e),e._properties.start_focused&&setTimeout(()=>{e._focus()},5)),(t||function(){})(e,o),e}_removeWindow(e){if(!(e instanceof i))throw new TypeError("Application::_removeWindow() expects Core.Window");const t=this.__windows.findIndex(t=>t&&t._wid===e._wid);if(-1!==t){const e=this.__windows[t];console.debug("Application::_removeWindow()",e._wid);try{e.destroy()}catch(e){console.warn(e)}this.__windows.splice(t,1)}return-1!==t}_getWindow(e,t){t=t||"name",null===e&&(e=this.__mainwindow);let n="tag"===t?[]:null;return this.__windows.every((i,r)=>{if(i&&i["_"+t]===e){if("tag"!==t)return n=i,!1;n.push(i)}return!0}),n}_getWindowByName(e){return this._getWindow(e)}_getWindowsByTag(e){return this._getWindow(e,"tag")}_getWindows(){return this.__windows}_getMainWindow(){return this._getWindow(this.__mainwindow,"name")}_getSetting(e){return this.__settings?this.__settings.get(e):null}_getSessionData(){const e=this.__args,t=this.__windows,n={name:this.__pname,args:e,windows:[]};return t.forEach((e,t)=>{e&&e._properties.allow_session&&n.windows.push({name:e._name,dimension:e._dimension,position:e._position,state:e._state})}),n}_setSetting(e,t,n){void 0===n&&(n=!0),4===arguments.length&&"function"==typeof arguments[3]&&(n=arguments[3]),this.__settings&&this.__settings.set(e,t,n)}}}),e("skylark-osjsv2-client/dialogs.html",[],function(){return'\x3c!--\r\n\r\n  Dialog: Error\r\n\r\n--\x3e\r\n<application-dialog data-id="Error">\r\n  <gui-vbox>\r\n    <gui-vbox-container data-shrink="1">\r\n      <gui-label data-id="Message">DIALOG_ERROR_MESSAGE</gui-label>\r\n    </gui-vbox-container>\r\n\r\n    <gui-vbox-container data-shrink="1">\r\n      <gui-label data-id="SummaryLabel">DIALOG_ERROR_SUMMARY</gui-label>\r\n    </gui-vbox-container>\r\n\r\n    <gui-vbox-container data-fill="true" data-basis="90px">\r\n      <gui-textarea data-id="Summary"></gui-textarea>\r\n    </gui-vbox-container>\r\n\r\n    <gui-vbox-container data-shrink="1">\r\n      <gui-label data-id="TraceLabel">DIALOG_ERROR_TRACE</gui-label>\r\n    </gui-vbox-container>\r\n\r\n    <gui-vbox-container data-grow="1" data-fill="true">\r\n      <gui-textarea data-id="Trace"></gui-textarea>\r\n    </gui-vbox-container>\r\n\r\n    <gui-vbox-container data-shrink="1" data-align="end">\r\n      <gui-button-bar>\r\n        <gui-button data-id="ButtonOK">LBL_CLOSE</gui-button>\r\n        <gui-button data-id="ButtonBugReport">LBL_BUGREPORT</gui-button>\r\n      </gui-button-bar>\r\n    </gui-vbox-container>\r\n  </gui-vbox>\r\n\r\n</application-dialog>\r\n\r\n\x3c!--\r\n\r\n  Dialog: Application Chooser\r\n\r\n--\x3e\r\n<application-dialog data-id="ApplicationChooser">\r\n  <gui-vbox>\r\n    <gui-vbox-container data-shrink="1">\r\n      <gui-label data-id="Message">DIALOG_APPCHOOSER_MSG</gui-label>\r\n    </gui-vbox-container>\r\n\r\n    <gui-vbox-container data-shrink="1">\r\n      <gui-label data-id="FileName">filename (mime)</gui-label>\r\n    </gui-vbox-container>\r\n\r\n    <gui-vbox-container data-grow="1" data-fill="true">\r\n      <gui-list-view data-id="ApplicationList" data-multiple="false">\r\n      </gui-list-view>\r\n    </gui-vbox-container>\r\n\r\n    <gui-vbox-container data-shrink="1">\r\n      <gui-checkbox data-id="SetDefault" data-label="DIALOG_APPCHOOSER_SET_DEFAULT"></gui-checkbox>\r\n    </gui-vbox-container>\r\n\r\n    <gui-vbox-container data-shrink="1" data-align="end">\r\n      <gui-button-bar>\r\n        <gui-button data-id="ButtonOK">LBL_OK</gui-button>\r\n        <gui-button data-id="ButtonCancel">LBL_CANCEL</gui-button>\r\n      </gui-button-bar>\r\n    </gui-vbox-container>\r\n  </gui-vbox>\r\n</application-dialog>\r\n\r\n\x3c!--\r\n\r\n  Dialog: File Save/Open\r\n\r\n--\x3e\r\n<application-dialog data-id="File">\r\n  <gui-vbox>\r\n    <gui-vbox-container data-shrink="1">\r\n      <gui-hbox>\r\n        <gui-hbox-container data-shrink="1" data-expand="true">\r\n          <gui-button data-id="HomeButton" data-icon="stock://16x16/places/user-home.png" data-tooltip="LBL_HOME"></gui-button>\r\n        </gui-hbox-container>\r\n        <gui-hbox-container data-shrink="1" data-expand="true">\r\n          <gui-button data-id="ButtonMkdir" data-icon="stock://16x16/actions/folder-new.png" data-tooltip="LBL_MKDIR"></gui-button>\r\n        </gui-hbox-container>\r\n        <gui-hbox-container data-grow="1" data-expand="true">\r\n          <gui-select data-id="ModuleSelect"></gui-select>\r\n        </gui-hbox-container>\r\n      </gui-hbox>\r\n    </gui-vbox-container>\r\n\r\n    <gui-vbox-container data-grow="1" data-fill="true">\r\n      <gui-file-view data-id="FileView">\r\n      </gui-file-view>\r\n    </gui-vbox-container>\r\n\r\n    <gui-vbox-container data-shrink="1" data-id="FileInput">\r\n      <gui-hbox>\r\n        <gui-hbox-container data-grow="1" data-expand="true">\r\n          <gui-text data-id="Filename"></gui-text>\r\n        </gui-hbox-container>\r\n        <gui-hbox-container data-shrink="0" data-basis="150px" data-expand="true">\r\n          <gui-select data-id="Filetype"></gui-select>\r\n        </gui-hbox-container>\r\n      </gui-hbox>\r\n    </gui-vbox-container>\r\n\r\n    <gui-vbox-container data-shrink="1" data-align="end">\r\n      <gui-button-bar>\r\n        <gui-button data-id="ButtonOK">LBL_OK</gui-button>\r\n        <gui-button data-id="ButtonCancel">LBL_CANCEL</gui-button>\r\n      </gui-button-bar>\r\n    </gui-vbox-container>\r\n  </gui-vbox>\r\n</application-dialog>\r\n\r\n\x3c!--\r\n\r\n  Dialog: File Progress\r\n\r\n--\x3e\r\n<application-dialog data-id="FileProgress">\r\n  <gui-vbox>\r\n    <gui-vbox-container data-grow="1">\r\n      <gui-label data-id="Message">LBL_LOADING</gui-label>\r\n    </gui-vbox-container>\r\n\r\n    <gui-vbox-container data-shrink="1" data-expand="true">\r\n      <gui-progress-bar data-id="Progress"></gui-progress-bar>\r\n    </gui-vbox-container>\r\n\r\n    <gui-vbox-container data-shrink="1" data-align="end">\r\n      <gui-button-bar>\r\n        <gui-button data-id="ButtonCancel" data-disabled="true">LBL_CANCEL</gui-button>\r\n      </gui-button-bar>\r\n    </gui-vbox-container>\r\n  </gui-vbox>\r\n</application-dialog>\r\n\r\n\x3c!--\r\n\r\n  Dialog: File Upload\r\n\r\n--\x3e\r\n<application-dialog data-id="FileUpload">\r\n  <gui-vbox>\r\n    <gui-vbox-container data-shrink="1">\r\n      <gui-label data-id="Message">DIALOG_UPLOAD_DESC</gui-label>\r\n    </gui-vbox-container>\r\n\r\n    <gui-vbox-container data-grow="1">\r\n      <gui-file-upload data-id="File"></gui-file-upload>\r\n    </gui-vbox-container>\r\n\r\n    <gui-vbox-container data-shrink="1" data-align="end">\r\n      <gui-button-bar>\r\n        <gui-button data-id="ButtonCancel">LBL_CANCEL</gui-button>\r\n      </gui-button-bar>\r\n    </gui-vbox-container>\r\n  </gui-vbox>\r\n</application-dialog>\r\n\r\n\x3c!--\r\n\r\n  Dialog: File Information\r\n\r\n--\x3e\r\n<application-dialog data-id="FileInfo">\r\n  <gui-vbox>\r\n    <gui-vbox-container data-grow="1" data-fill="true">\r\n      <gui-textarea data-id="Info"></gui-textarea>\r\n    </gui-vbox-container>\r\n\r\n    <gui-vbox-container data-shrink="1" data-align="end">\r\n      <gui-button-bar>\r\n        <gui-button data-id="ButtonOK">LBL_OK</gui-button>\r\n      </gui-button-bar>\r\n    </gui-vbox-container>\r\n  </gui-vbox>\r\n</application-dialog>\r\n\r\n\x3c!--\r\n\r\n  Dialog: Input\r\n\r\n--\x3e\r\n<application-dialog data-id="Input">\r\n  <gui-vbox>\r\n    <gui-vbox-container data-grow="1">\r\n      <gui-label data-id="Message">DIALOG_INPUT_TITLE</gui-label>\r\n    </gui-vbox-container>\r\n\r\n    <gui-vbox-container data-shrink="1" data-expand="true">\r\n      <gui-text data-id="Input"></gui-text>\r\n    </gui-vbox-container>\r\n\r\n    <gui-vbox-container data-shrink="1" data-align="end">\r\n      <gui-button-bar>\r\n        <gui-button data-id="ButtonOK">LBL_OK</gui-button>\r\n        <gui-button data-id="ButtonCancel">LBL_CANCEL</gui-button>\r\n      </gui-button-bar>\r\n    </gui-vbox-container>\r\n  </gui-vbox>\r\n</application-dialog>\r\n\r\n\x3c!--\r\n\r\n  Dialog: Alert\r\n\r\n--\x3e\r\n<application-dialog data-id="Alert">\r\n  <gui-vbox>\r\n    <gui-vbox-container data-grow="1">\r\n      <gui-label data-id="Message">DIALOG_ALERT_TITLE</gui-label>\r\n    </gui-vbox-container>\r\n\r\n    <gui-vbox-container data-shrink="1" data-align="end">\r\n      <gui-button-bar>\r\n        <gui-button data-id="ButtonOK">LBL_OK</gui-button>\r\n      </gui-button-bar>\r\n    </gui-vbox-container>\r\n  </gui-vbox>\r\n</application-dialog>\r\n\r\n\x3c!--\r\n\r\n  Dialog: Confirm\r\n\r\n--\x3e\r\n<application-dialog data-id="Confirm">\r\n  <gui-vbox>\r\n    <gui-vbox-container data-grow="1">\r\n      <gui-label data-id="Message">DIALOG_CONFIRM_TITLE</gui-label>\r\n    </gui-vbox-container>\r\n\r\n    <gui-vbox-container data-shrink="1" data-align="end">\r\n      <gui-button-bar>\r\n        <gui-button data-id="ButtonYes">LBL_YES</gui-button>\r\n        <gui-button data-id="ButtonNo">LBL_NO</gui-button>\r\n        <gui-button data-id="ButtonCancel">LBL_CANCEL</gui-button>\r\n      </gui-button-bar>\r\n    </gui-vbox-container>\r\n  </gui-vbox>\r\n</application-dialog>\r\n\r\n\x3c!--\r\n\r\n  Dialog: Color\r\n\r\n--\x3e\r\n<application-dialog data-id="Color">\r\n  <gui-vbox>\r\n    <gui-vbox-container data-grow="1">\r\n      <gui-hbox>\r\n        <gui-hbox-container data-shrink="1">\r\n          <gui-vbox>\r\n            <gui-vbox-container shrink="1">\r\n              <gui-color-swatch data-id="ColorSelect"></gui-color-swatch>\r\n            </gui-vbox-container>\r\n            <gui-vbox-container shrink="1" data-expand="true">\r\n              <gui-color-box data-id="ColorPreview" data-disabled="true"></gui-color-box>\r\n            </gui-vbox-container>\r\n          </gui-vbox>\r\n        </gui-hbox-container>\r\n\r\n        <gui-hbox-container data-grow="1">\r\n          <gui-vbox>\r\n            <gui-vbox-container shrink="1" data-expand="true">\r\n              <gui-label data-id="LabelRed">Red</gui-label>\r\n            </gui-vbox-container>\r\n            <gui-vbox-container shrink="1" data-expand="true">\r\n              <gui-slider data-min="0" data-max="255" data-id="Red"></gui-slider>\r\n            </gui-vbox-container>\r\n\r\n            <gui-vbox-container shrink="1" data-expand="true">\r\n              <gui-label data-id="LabelGreen">Green</gui-label>\r\n            </gui-vbox-container>\r\n            <gui-vbox-container shrink="1" data-expand="true">\r\n              <gui-slider data-min="0" data-max="255" data-id="Green"></gui-slider>\r\n            </gui-vbox-container>\r\n\r\n            <gui-vbox-container shrink="1" data-expand="true">\r\n              <gui-label data-id="LabelBlue">Blue</gui-label>\r\n            </gui-vbox-container>\r\n            <gui-vbox-container shrink="1" data-expand="true">\r\n              <gui-slider data-min="0" data-max="255" data-id="Blue"></gui-slider>\r\n            </gui-vbox-container>\r\n\r\n            <gui-vbox-container shrink="1" data-expand="true" data-id="AlphaLabelContainer">\r\n              <gui-label data-id="LabelAlpha">Alpha</gui-label>\r\n            </gui-vbox-container>\r\n            <gui-vbox-container shrink="1" data-expand="true" data-id="AlphaContainer">\r\n              <gui-slider data-min="0" data-max="100" data-id="Alpha"></gui-slider>\r\n            </gui-vbox-container>\r\n          </gui-vbox>\r\n        </gui-hbox-container>\r\n      </gui-hbox>\r\n    </gui-vbox-container>\r\n\r\n    <gui-vbox-container data-shrink="1" data-align="end">\r\n      <gui-button-bar>\r\n        <gui-button data-id="ButtonOK">LBL_OK</gui-button>\r\n        <gui-button data-id="ButtonCancel">LBL_CANCEL</gui-button>\r\n      </gui-button-bar>\r\n    </gui-vbox-container>\r\n  </gui-vbox>\r\n</application-dialog>\r\n\r\n\x3c!--\r\n\r\n  Dialog: Font\r\n\r\n--\x3e\r\n<application-dialog data-id="Font">\r\n  <gui-vbox>\r\n    <gui-vbox-container data-grow="1" data-fill="true">\r\n      <gui-hbox>\r\n        <gui-hbox-container data-grow="1" data-shrink="1" data-basis="50%" data-fill="true">\r\n          <gui-select-list data-id="FontName"></gui-select-list>\r\n        </gui-hbox-container>\r\n        <gui-hbox-container data-grow="1" data-shrink="1" data-basis="50%" data-fill="true" data-id="FontSizeContainer">\r\n          <gui-select-list data-id="FontSize"></gui-select-list>\r\n        </gui-hbox-container>\r\n      </gui-hbox>\r\n    </gui-vbox-container>\r\n\r\n    <gui-vbox-container data-shrink="1" data-basis="50px" data-fill="true">\r\n      <gui-textarea data-id="FontPreview"></gui-textarea>\r\n    </gui-vbox-container>\r\n\r\n    <gui-vbox-container data-shrink="1" data-align="end">\r\n      <gui-button-bar>\r\n        <gui-button data-id="ButtonOK">LBL_OK</gui-button>\r\n        <gui-button data-id="ButtonCancel">LBL_CANCEL</gui-button>\r\n      </gui-button-bar>\r\n    </gui-vbox-container>\r\n  </gui-vbox>\r\n</application-dialog>\r\n'}),e("skylark-osjsv2-client/core/dialog",["../utils/dom","../utils/keycodes","./window","./application","./window-manager","../gui/scheme","./locales","../dialogs.html"],function(e,t,n,i,r,o,s,a){"use strict";return class extends n{constructor(e,t,n,i){if(t=t||{},n=n||{},"function"!=typeof(i=i||function(){}))throw new TypeError("DialogWindow expects a callback Function, gave: "+typeof i);console.info("DialogWindow::construct()",e,t,n),super(e,t),this._properties.gravity="center",this._properties.allow_resize=!1,this._properties.allow_minimize=!1,this._properties.allow_maximize=!1,this._properties.allow_windowlist=!1,this._properties.allow_session=!1,this._state.ontop=!0,this._tag="DialogWindow",n.scheme&&n.scheme instanceof o&&(this.scheme=n.scheme,delete n.scheme),this.args=n,this.className=e,this.buttonClicked=!1,this.closeCallback=((e,t,n)=>{this._destroyed||(this.buttonClicked=!0,i.call(this,e,t,n),this._close())})}destroy(){return this.scheme&&(this.scheme=this.scheme.destroy()),super.destroy(...arguments)}init(){const t=super.init(...arguments);t.setAttribute("role","dialog");const n=this.className.replace(/Dialog$/,""),i=["ButtonCancel","ButtonNo"],r={ButtonOK:"ok",ButtonCancel:"cancel",ButtonYes:"yes",ButtonNo:"no"};return this.scheme?this.scheme.render(this,n,t,"application-dialog",t=>{t.querySelectorAll("gui-label").forEach(t=>{if(t.childNodes.length&&3===t.childNodes[0].nodeType&&t.childNodes[0].nodeValue){const n=t.childNodes[0].nodeValue;e.$empty(t),t.appendChild(document.createTextNode(s._(n)))}})}):this._render(n,a),Object.keys(r).filter(e=>this._findDOM(e)).forEach(e=>{const t=this._find(e);t.on("click",t=>{this.onClose(t,r[e])}),i.indexOf(e)>=0&&t.focus()}),e.$addClass(t,"DialogWindow"),t}onClose(e,t){this.closeCallback(e,t,null)}_close(){return this.buttonClicked||this.onClose(null,"cancel",null),super._close(...arguments)}_onKeyEvent(e){super._onKeyEvent(...arguments),e.keyCode===t.ESC&&this.onClose(e,"cancel")}static parseMessage(t){t=e.$escape(t||"").replace(/\*\*(.*)\*\*/g,"<span>$1</span>");let n=document.createElement("div");n.innerHTML=t;const i=document.createDocumentFragment();for(let e=0;e<n.childNodes.length;e++)i.appendChild(n.childNodes[e].cloneNode(!0));return n=null,i}static create(e,t,o,s){o=o||function(){};let a=s=s||{},l=a instanceof n,c=a instanceof i;function u(){if(a){if(l&&a._destroyed)return void console.warn("DialogWindow::create()","INGORED EVENT: Window was destroyed");if(c&&a.__destroyed)return void console.warn("DialogWindow::create()","INGORED EVENT: Process was destroyed")}s.modal&&l&&a._toggleDisabled(!1),o.apply(null,arguments)}!a||l&&c||(a=s.parent,l=a instanceof n,c=a instanceof i);const d="string"==typeof e?new OSjs.Dialogs[e](t,u):e(t,u);if(a)a instanceof n?(d._on("destroy",()=>{a&&a._focus()}),a._addChild(d,!0)):a instanceof i&&a._addWindow(d);else{const e=r.instance;e.addWindow(d,!0)}return s.modal&&l&&a._toggleDisabled(!0),d._focus(),d}}}),e("skylark-osjsv2-client/gui/splash",[],function(){"use strict";return new class{constructor(){this.$el=document.getElementById("LoadingScreen"),this.$progress=this.$el?this.$el.querySelector(".progress"):null}watermark(e){if(e.Watermark.enabled){var t=e.Version||"unknown version",n=e.Watermark.lines||[],i=document.createElement("osjs-watermark");i.setAttribute("aria-hidden","true"),i.innerHTML=n.join("<br />").replace(/%VERSION%/,t),document.body.appendChild(i)}}show(){this.$el&&(this.$el.style.display="block")}hide(){this.$el&&(this.$el.style.display="none")}update(e,t){if(this.$progress){let n=t?0:100;t&&(n=e/t*100),this.$progress.style.width=String(n)+"%"}}}}),e("skylark-osjsv2-client/gui/notification",["../utils/events","../core/window-manager"],function(e,t){"use strict";return new class{constructor(){this.$notifications=null,this.visibles=0}create(n){(n=n||{}).icon=n.icon||null,n.title=n.title||null,n.message=n.message||"",n.onClick=n.onClick||function(){},this.$notifications||(this.$notifications=document.createElement("corewm-notifications"),this.$notifications.setAttribute("role","log"),document.body.appendChild(this.$notifications)),void 0===n.timeout&&(n.timeout=5e3),console.debug("CoreWM::notification()",n);const i=document.createElement("corewm-notification");let r=[""],o=null,s=null;const a=()=>{o&&(clearTimeout(o),o=null),i.onclick=null;const n=()=>{e.$unbind(i),i.parentNode&&i.parentNode.removeChild(i),this.visibles--,this.visibles<=0&&(this.$notifications.style.display="none")},r=t.instance.getSetting("animations");r?(i.setAttribute("data-hint","closing"),s=(()=>n())):(i.style.display="none",n())};if(n.icon){const e=document.createElement("img");e.alt="",e.src=n.icon,r.push("HasIcon"),i.appendChild(e)}if(n.title){const e=document.createElement("div");e.className="Title",e.appendChild(document.createTextNode(n.title)),r.push("HasTitle"),i.appendChild(e)}if(n.message){const e=document.createElement("div");e.className="Message";const t=n.message.split("\n");t.forEach(function(n,i){e.appendChild(document.createTextNode(n)),i<t.length-1&&e.appendChild(document.createElement("br"))}),r.push("HasMessage"),i.appendChild(e)}let l;function c(e){"function"==typeof s&&(clearTimeout(l),l=setTimeout(function(){s(e),s=!1},10))}this.visibles++,this.visibles>0&&(this.$notifications.style.display="block"),i.setAttribute("aria-label",String(n.title)),i.setAttribute("role","alert"),i.className=r.join(" "),i.onclick=function(e){a(),n.onClick(e)},e.$bind(i,"transitionend",c),e.$bind(i,"animationend",c);const u=t.instance.getWindowSpace(!0);this.$notifications.style.marginTop=String(u.top)+"px",this.$notifications.appendChild(i),n.timeout&&(o=setTimeout(function(){a()},n.timeout))}createIcon(e,n){const i=t.instance;if(i&&"function"==typeof i.getNotificationArea){const t=i.getNotificationArea();if(t)return t.createNotification(e,n)}return null}destroyIcon(e){const n=t.instance;if(n&&"function"==typeof n.getNotificationArea){const t=n.getNotificationArea();if(t)return t.removeNotification(e),!0}return!1}getIcon(e){const n=t.instance;if(n&&"function"==typeof n.getNotificationArea){const t=n.getNotificationArea();if(t)return t.getNotification(e)}return null}}}),e("skylark-osjsv2-client/dialogs/alert",["../core/dialog","../core/locales"],function(e,t){"use strict";return class extends e{constructor(e,n){super("AlertDialog",{title:(e=Object.assign({},{},e)).title||t._("DIALOG_ALERT_TITLE"),icon:"status/dialog-warning.png",width:400,height:100},e,n)}init(){const e=super.init(...arguments);return e.setAttribute("role","alertdialog"),this._find("Message").set("value",this.args.message,!0),e}}}),e("skylark-osjsv2-client/dialogs/applicationchooser",["../core/dialog","../core/package-manager","../core/theme","../utils/misc","../core/locales"],function(e,t,n,i,r){"use strict";return class extends e{constructor(e,t){super("ApplicationChooserDialog",{title:(e=Object.assign({},{},e)).title||r._("DIALOG_APPCHOOSER_TITLE"),width:400,height:400},e,t)}init(){const e=super.init(...arguments),o=[{label:r._("LBL_NAME")}],s=[],a=t.getPackages();(this.args.list||[]).forEach(e=>{const t=a[e];if(t&&"application"===t.type){const i=[t.name];t.description&&i.push(t.description),s.push({value:t,columns:[{label:i.join(" - "),icon:n.getIcon(t.icon,null,e),value:JSON.stringify(t)}]})}}),this._find("ApplicationList").set("columns",o).add(s).on("activate",e=>{this.onClose(e,"ok")});let l="<unknown file>",c="<unknown mime>";return this.args.file&&(l=i.format("{0} ({1})",this.args.file.filename,this.args.file.mime),c=r._("DIALOG_APPCHOOSER_SET_DEFAULT",this.args.file.mime)),this._find("FileName").set("value",l),this._find("SetDefault").set("label",c),e}onClose(t,n){let i=null;if("ok"===n){const t=this._find("SetDefault").get("value"),n=this._find("ApplicationList").get("value");if(n&&n.length&&(i=n[0].data.className),!i)return void e.create("Alert",{message:r._("DIALOG_APPCHOOSER_NO_SELECTION")},null,this);i={name:i,useDefault:t}}this.closeCallback(t,n,i)}}}),e("skylark-osjsv2-client/utils/colors",[],function(){"use strict";return{convertToRGB:function(e){const t=parseInt(e.replace("#",""),16),n={};return n.r=(t&255<<16)>>16,n.g=(65280&t)>>8,n.b=255&t,n},convertToHEX:function(e,t,n){"object"==typeof e&&(t=e.g,n=e.b,e=e.r);if(void 0===e||void 0===t||void 0===n)throw new Error("Invalid RGB supplied to convertToHEX()");const i=[parseInt(e,10).toString(16),parseInt(t,10).toString(16),parseInt(n,10).toString(16)];return Object.keys(i).forEach(e=>{1===i[e].length&&(i[e]="0"+i[e])}),"#"+i.join("").toUpperCase()},invertHEX:function(e){let t=parseInt(e.replace("#",""),16);return"#"+(t=("000000"+(t=(t^=16777215).toString(16))).slice(-6))}}}),e("skylark-osjsv2-client/dialogs/color",["../core/dialog","../utils/misc","../utils/colors","../core/locales"],function(e,t,n,i){"use strict";return class extends e{constructor(e,t){e=Object.assign({},{},e);const[r,o]=function(e){let t=e;"string"==typeof e?(t=e,(e=n.convertToRGB(e)).a=null):(void 0===e.a?e.a=null:e.a>1&&(e.a/=100),e=e||{r:0,g:0,b:0,a:100},t=n.convertToHEX(e.r,e.g,e.b));return[e,t]}(e.color);super("ColorDialog",{title:e.title||i._("DIALOG_COLOR_TITLE"),icon:"apps/preferences-desktop-theme.png",width:400,height:null!==r.a?300:220},e,t),this.color={r:r.r,g:r.g,b:r.b,a:r.a,hex:o}}init(){const e=super.init(...arguments),r=e=>{this._find("LabelRed").set("value",i._("DIALOG_COLOR_R",this.color.r)),this._find("LabelGreen").set("value",i._("DIALOG_COLOR_G",this.color.g)),this._find("LabelBlue").set("value",i._("DIALOG_COLOR_B",this.color.b)),this._find("LabelAlpha").set("value",i._("DIALOG_COLOR_A",this.color.a)),e&&(this.color.hex=n.convertToHEX(this.color.r,this.color.g,this.color.b));let r=this.color.hex;null===this.color.a||isNaN(this.color.a)||(r=t.format("rgba({0}, {1}, {2}, {3})",this.color.r,this.color.g,this.color.b,this.color.a)),this._find("ColorPreview").set("value",r)};return this._find("ColorSelect").on("change",e=>{this.color=e.detail,this._find("Red").set("value",this.color.r),this._find("Green").set("value",this.color.g),this._find("Blue").set("value",this.color.b),r(!0)}),this._find("Red").on("change",e=>{this.color.r=parseInt(e.detail,10),r(!0)}).set("value",this.color.r),this._find("Green").on("change",e=>{this.color.g=parseInt(e.detail,10),r(!0)}).set("value",this.color.g),this._find("Blue").on("change",e=>{this.color.b=parseInt(e.detail,10),r(!0)}).set("value",this.color.b),this._find("Alpha").on("change",e=>{this.color.a=parseInt(e.detail,10)/100,r(!0)}).set("value",100*this.color.a),null===this.color.a&&(this._find("AlphaContainer").hide(),this._find("AlphaLabelContainer").hide()),r(!1,this.color.a),e}onClose(e,t){this.closeCallback(e,t,"ok"===t?this.color:null)}}}),e("skylark-osjsv2-client/dialogs/confirm",["../core/dialog","../core/locales"],function(e,t){"use strict";return class extends e{constructor(e,n){super("ConfirmDialog",{title:(e=Object.assign({},{buttons:["yes","no","cancel"]},e)).title||t._("DIALOG_CONFIRM_TITLE"),icon:"status/dialog-question.png",width:400,height:100},e,n)}init(){const t=super.init(...arguments),n=e.parseMessage(this.args.message);this._find("Message").empty().append(n);const i={yes:"ButtonYes",no:"ButtonNo",cancel:"ButtonCancel"},r=[];return["yes","no","cancel"].forEach(e=>{this.args.buttons.indexOf(e)<0&&r.push(e)}),r.forEach(e=>{this._find(i[e]).hide()}),t}}}),e("skylark-osjsv2-client/dialogs/error",["../core/dialog","../core/locales","../core/config"],function(e,t,n){"use strict";return class extends e{constructor(e,n){const i=(e=Object.assign({},{},e)).exception||{};let r="";i.stack?r=i.stack:Object.keys(i).length&&(r=i.name,r+="\nFilename: "+i.fileName||"<unknown>",r+="\nLine: "+i.lineNumber,r+="\nMessage: "+i.message,i.extMessage&&(r+="\n"+i.extMessage)),super("ErrorDialog",{title:e.title||t._("DIALOG_ERROR_TITLE"),icon:"status/dialog-error.png",width:400,height:r?400:200},e,n),this._sound="ERROR",this._soundVolume=1,this.traceMessage=r}init(){const t=super.init(...arguments);t.setAttribute("role","alertdialog");const i=e.parseMessage(this.args.message);return this._find("Message").empty().append(i),this._find("Summary").set("value",this.args.error),this._find("Trace").set("value",this.traceMessage),this.traceMessage||(this._find("Trace").hide(),this._find("TraceLabel").hide()),this.args.bugreport?this._find("ButtonBugReport").on("click",()=>{let e="",t=[];if(n.getConfig("BugReporting.options.issue")){const i={},r=["userAgent","platform","language","appVersion"];r.forEach(e=>{i[e]=navigator[e]}),e=n.getConfig("BugReporting.options.title"),t=["**"+n.getConfig("BugReporting.options.message").replace("%VERSION%",n.getConfig("Version"))+":**","\n","> "+this.args.message,"\n","> "+(this.args.error||"Unknown error"),"\n","## Expected behaviour","\n","## Actual behaviour","\n","## Steps to reproduce the error","\n","## (Optinal) Browser and OS information","\n","```\n"+JSON.stringify(i)+"\n```"],this.traceMessage&&t.push("\n## Stack Trace \n```\n"+this.traceMessage+"\n```\n")}const i=n.getConfig("BugReporting.url").replace("%TITLE%",encodeURIComponent(e)).replace("%BODY%",encodeURIComponent(t.join("\n")));window.open(i)}):this._find("ButtonBugReport").hide(),t}}}),e("skylark-osjsv2-client/dialogs/fileinfo",["../core/dialog","../vfs/fs","../core/locales"],function(e,t,n){"use strict";return class extends e{constructor(e,t){if(super("FileInfoDialog",{title:(e=Object.assign({},{},e)).title||n._("DIALOG_FILEINFO_TITLE"),width:400,height:400},e,t),!this.args.file)throw new Error("You have to select a file for FileInfo")}init(){const e=super.init(...arguments),i=this._find("Info").set("value",n._("LBL_LOADING")),r=this.args.file;return t.fileinfo(r).then(e=>{const t=[];return Object.keys(e).forEach(n=>{"exif"===n?t.push(n+":\n\n"+e[n]):t.push(n+":\n\t"+e[n])}),i.set("value",t.join("\n\n")),!0}).catch(e=>{i.set("value",n._("DIALOG_FILEINFO_ERROR_LOOKUP_FMT",r.path))}),e}}}),e("skylark-osjsv2-client/dialogs/file",["../core/dialog","../gui/element","../vfs/file","../core/settings-manager","../core/mount-manager","../utils/fs","../utils/misc","../vfs/fs","../core/locales","../core/config"],function(e,t,n,i,r,o,s,a,l,c){"use strict";return class extends e{constructor(e,t){if((e=Object.assign({},{file:null,type:"open",path:c.getDefaultPath(),filename:"",filetypes:[],extension:"",mime:"application/octet-stream",filter:[],mfilter:[],select:null,multiple:!1},e)).multiple="save"!==e.type&&!0===e.multiple,e.path&&e.path instanceof n&&(e.path=o.dirname(e.path.path)),e.file&&e.file.path&&(e.path=o.dirname(e.file.path),e.filename=e.file.filename,e.mime=e.file.mime,e.filetypes.length)){const t=e.filetypes[0];e.filename=o.replaceFileExtension(e.filename,t.extension),e.mime=t.mime}const r=e.title||l._("save"===e.type?"DIALOG_FILE_SAVE":"DIALOG_FILE_OPEN"),s="open"===e.type?"actions/document-open.png":"actions/documentsave-as.png";super("FileDialog",{title:r,icon:s,width:600,height:400},e,t),this.selected=null,this.path=e.path,this.settingsWatch=i.watch("VFS",()=>{this.changePath()})}destroy(){try{i.unwatch(this.settingsWatch)}catch(e){}return super.destroy(...arguments)}init(){const i=super.init(...arguments),u=this._find("FileView");u.set("filter",this.args.filter),u.set("filetype",this.args.select||""),u.set("defaultcolumns","true");const d=this._find("Filename"),h=this._find("HomeButton"),p=this._find("ModuleSelect"),g=()=>{let e=!1;"dir"!==this.args.select&&(e=!d.get("value").length),this._find("ButtonOK").set("disabled",e)};if(this._toggleLoading(!0),u.set("multiple",this.args.multiple),d.set("value",this.args.filename||""),this._find("ButtonMkdir").on("click",()=>{e.create("Input",{message:l._("DIALOG_FILE_MKDIR_MSG",this.path),value:"New folder"},(e,t,i)=>{if("ok"===t&&i){const e=o.pathJoin(this.path,i);a.mkdir(new n(e,"dir")).then(()=>this.changePath(e)).catch(e=>{OSjs.error(l._("DIALOG_FILE_ERROR"),l._("ERR_VFSMODULE_MKDIR"),e)})}},this)}),h.on("click",()=>{const e=c.getDefaultPath();this.changePath(e)}),u.on("activate",e=>{if(this.selected=null,"save"!==this.args.type&&d.set("value",""),e&&e.detail&&e.detail.entries){const t=e.detail.entries[0];t&&(this.selected=new n(t.data),"dir"!==this.selected.type&&d.set("value",this.selected.filename),this.checkSelection(e,!0))}}),u.on("select",e=>{if(this.selected=null,e&&e.detail&&e.detail.entries){const t=e.detail.entries[0];t&&(this.selected=new n(t.data),"dir"!==this.selected.type&&d.set("value",this.selected.filename))}g()}),"save"===this.args.type){const e=[];this.args.filetypes.forEach(t=>{e.push({label:s.format("{0} (.{1} {2})",t.label,t.extension,t.mime),value:t.extension})});const n=this._find("Filetype").add(e).on("change",e=>{const t=o.replaceFileExtension(d.get("value"),e.detail);d.set("value",t)});e.length<=1&&new t(n.$element.parentNode).hide(),d.on("enter",e=>{this.selected=null,this.checkSelection(e)}),d.on("change",e=>{g()}),d.on("keyup",e=>{g()})}else"dir"!==this.args.select&&this._find("ButtonMkdir").hide(),this._find("FileInput").hide();const m=r.getModuleFromPath(this.path).option("root"),f=r.getModules().filter(e=>!this.args.mfilter.length||this.args.mfilter.every(t=>t(e))).map(e=>({label:e.option("title")+(e.isReadOnly()?s.format(" ({0})",l._("LBL_READONLY")):""),value:e.option("root")}));return p.clear().add(f).set("value",m),p.on("change",e=>{this.changePath(e.detail,!0)}),this.changePath(),g(),i}changePath(e,t){const n=this._find("FileView"),i=this.path,o=()=>{try{const e=r.getModuleFromPath(i).option("root");this._find("ModuleSelect").set("value",e)}catch(e){console.warn("FileDialog::changePath()","resetLastSelection()",e)}};this._toggleLoading(!0),n.chdir({path:e||this.path,done:n=>{n?t&&o():e&&(this.path=e),this.selected=null,this._toggleLoading(!1)}})}checkFileExtension(){const e=this._find("Filename");let t=this.args.mime,n=e.get("value");if(this.args.filetypes.length&&(!n&&this.args.filename&&(n=this.args.filename),n.length)){const e=n.split(".").pop();let i=!1;this.args.filetypes.forEach(t=>(t.extension===e&&(i=t),!!i)),i=i||this.args.filetypes[0],n=o.replaceFileExtension(n,i.extension),t=i.mime}return{filename:n,mime:t}}checkSelection(t,i){if(this.selected&&"dir"===this.selected.type&&i)return this.changePath(this.selected.path),!1;if("save"===this.args.type){let i=this.checkFileExtension();return this.path&&i.filename?(this.selected=new n(this.path.replace(/^\//,"")+"/"+i.filename,i.mime),this._toggleDisabled(!0),a.exists(this.selected).then(n=>(this._toggleDisabled(!1),!this._destroyed&&(n?(this._toggleDisabled(!0),this.selected&&e.create("Confirm",{buttons:["yes","no"],message:l._("DIALOG_FILE_OVERWRITE",this.selected.filename)},(e,t)=>{this._toggleDisabled(!1),"yes"!==t&&"ok"!==t||this.closeCallback(e,"ok",this.selected)},this)):this.closeCallback(t,"ok",this.selected),!0))).catch(e=>{this._toggleDisabled(!1),this._destroyed||OSjs.error(l._("DIALOG_FILE_ERROR"),l._("DIALOG_FILE_MISSING_FILENAME"))}),!1):(OSjs.error(l._("DIALOG_FILE_ERROR"),l._("DIALOG_FILE_MISSING_FILENAME")),!1)}{if(!this.selected&&"dir"!==this.args.select)return OSjs.error(l._("DIALOG_FILE_ERROR"),l._("DIALOG_FILE_MISSING_SELECTION")),!1;let e=this.selected;e||"dir"!==this.args.select||(e=new n({filename:o.filename(this.path),path:this.path,type:"dir"})),this.closeCallback(t,"ok",e)}return!0}onClose(e,t){("ok"!==t||this.checkSelection(e))&&this.closeCallback(e,t,this.selected)}}}),e("skylark-osjsv2-client/dialogs/fileprogress",["../core/dialog","../core/locales"],function(e,t){"use strict";return class extends e{constructor(e,n){super("FileProgressDialog",{title:(e=Object.assign({},{},e)).title||t._("DIALOG_FILEPROGRESS_TITLE"),icon:"actions/document-send.png",width:400,height:100},e,n),this.busy=!!e.filename}init(){const e=super.init(...arguments);return this.args.message&&this._find("Message").set("value",this.args.message,!0),e}onClose(e,t){this.closeCallback(e,t,null)}setProgress(e,t=!0){const n=this._find("Progress");n&&n.set("progress",e),t&&e>=100&&this._close(!0)}_close(e){return!(!e&&this.busy)&&super._close()}_onKeyEvent(e){this.busy||super._onKeyEvent(...arguments)}}}),e("skylark-osjsv2-client/dialogs/fileupload",["../core/dialog","../vfs/fs","../core/locales","../core/config"],function(e,t,n,i){"use strict";return class extends e{constructor(e,t){(e=Object.assign({},{dest:i.getDefaultPath(),progress:{},file:null},e)).destination&&(e.dest=e.destination),e.dest||(e.dest=i.getDefaultPath()),super("FileUploadDialog",{title:e.title||n._("DIALOG_UPLOAD_TITLE"),icon:"actions/document-new.png",width:400,height:100},e,t)}init(){const e=super.init(...arguments),t=this._find("Message"),r=i.getConfig("VFS.MaxUploadSize");t.set("value",n._("DIALOG_UPLOAD_DESC",this.args.dest,r),!0);const o=this._find("File");return this.args.file?this.setFile(this.args.file,o):o.on("change",e=>{this.setFile(e.detail,o)}),e}setFile(i,r){let o;const s=(e,t)=>{OSjs.error(n._("DIALOG_UPLOAD_FAILED"),n._("DIALOG_UPLOAD_FAILED_MSG"),e||n._("DIALOG_UPLOAD_FAILED_UNKNOWN")),o._close(!0),this.onClose(t,"cancel")};if(i){let a=0;a=i.size>1048576?(Math.round(100*i.size/1048576)/100).toString()+"MB":(Math.round(100*i.size/1024)/100).toString()+"KB",r&&r.set("disabled",!0),this._find("ButtonCancel").set("disabled",!0);const l=n._("DIALOG_UPLOAD_MSG_FMT",i.name,i.type,a,this.args.dest);o=e.create("FileProgress",{message:l,dest:this.args.dest,filename:i.name,mime:i.type,size:a},(e,t)=>{},this),t.upload({files:[i],destination:this.args.dest},{onprogress:e=>{if(e.lengthComputable){const t=Math.round(100*e.loaded/e.total);o.setProgress(t)}}}).then(()=>(o._close(!0),this.onClose(null,"ok",i))).catch(s),setTimeout(()=>{o&&o._focus()},100)}}onClose(e,t,n){n=n||null,this.closeCallback(e,t,n)}}}),e("skylark-osjsv2-client/dialogs/font",["../core/dialog","../core/locales","../core/config"],function(e,t,n){"use strict";return class extends e{constructor(e,i){"null"!==(e=Object.assign({},{fontName:n.getConfig("Fonts.default"),fontSize:12,fontColor:"#000000",backgroundColor:"#ffffff",fonts:n.getConfig("Fonts.list"),minSize:6,maxSize:30,text:"The quick brown fox jumps over the lazy dog",unit:"px"},e)).unit&&"unit"!==e.unit||(e.unit=""),super("FontDialog",{title:e.title||t._("DIALOG_FONT_TITLE"),width:400,height:300},e,i),this.selection={fontName:e.fontName,fontSize:e.fontSize+e.unit}}init(){const e=super.init(...arguments),t=this._find("FontPreview"),n=[],i=[];for(let e=this.args.minSize;e<this.args.maxSize;e++)n.push({value:e,label:e});for(let e=0;e<this.args.fonts.length;e++)i.push({value:this.args.fonts[e],label:this.args.fonts[e]});const r=()=>{t.querySelector("textarea").style.fontFamily=this.selection.fontName,t.querySelector("textarea").style.fontSize=this.selection.fontSize},o=this._find("FontName");o.add(i).set("value",this.args.fontName),o.on("change",e=>{this.selection.fontName=e.detail,r()});const s=this._find("FontSize");return s.add(n).set("value",this.args.fontSize),s.on("change",e=>{this.selection.fontSize=e.detail+this.args.unit,r()}),t.$element.style.color=this.args.fontColor,t.$element.style.backgroundColor=this.args.backgroundColor,t.set("value",this.args.text),this.args.fontSize<0&&this._find("FontSizeContainer").hide(),r(),e}onClose(e,t){const n="ok"===t?this.selection:null;this.closeCallback(e,t,n)}}}),e("skylark-osjsv2-client/dialogs/input",["../core/dialog","../core/locales"],function(e,t){"use strict";return class extends e{constructor(e,n){super("InputDialog",{title:(e=Object.assign({},{},e)).title||t._("DIALOG_INPUT_TITLE"),icon:"status/dialog-information.png",width:400,height:120},e,n)}init(){const t=super.init(...arguments);if(this.args.message){const t=e.parseMessage(this.args.message);this._find("Message").empty().append(t)}const n=this._find("Input");return n.set("placeholder",this.args.placeholder||""),n.set("value",this.args.value||""),n.on("enter",e=>{this.onClose(e,"ok")}),t}_focus(){return!!super._focus(...arguments)&&(this._find("Input").focus(),!0)}onClose(e,t){const n=this._find("Input").get("value");this.closeCallback(e,t,"ok"===t?n:null)}setRange(e){const t=this._find("Input");t.$element&&t.$element.querySelector("input").select(e)}}}),e("skylark-osjsv2-client/vfs/transport",["skylark-axios","../core/locales"],function(e,t){"use strict";return class{request(e,n,i,r){const o=["upload","unlink","write","mkdir","move","trash","untrash","emptyTrash"];if(r.isReadOnly()&&-1!==o.indexOf(e))return Promise.reject(new Error(t._("ERR_VFSMODULE_READONLY")));const s=n.concat([i,r]);return this[e](...s)}scandir(e,n,i){return Promise.reject(new Error(t._("ERR_VFS_UNAVAILABLE")))}read(e,n,i){return Promise.reject(new Error(t._("ERR_VFS_UNAVAILABLE")))}write(e,n,i,r){return Promise.reject(new Error(t._("ERR_VFS_UNAVAILABLE")))}unlink(e,n,i){return Promise.reject(new Error(t._("ERR_VFS_UNAVAILABLE")))}copy(e,n,i,r){return Promise.reject(new Error(t._("ERR_VFS_UNAVAILABLE")))}move(e,n,i,r){return Promise.reject(new Error(t._("ERR_VFS_UNAVAILABLE")))}exists(e,n,i){return Promise.reject(new Error(t._("ERR_VFS_UNAVAILABLE")))}fileinfo(e,n,i){return Promise.reject(new Error(t._("ERR_VFS_UNAVAILABLE")))}mkdir(e,n,i){return Promise.reject(new Error(t._("ERR_VFS_UNAVAILABLE")))}upload(e,n,i,r){return Promise.reject(new Error(t._("ERR_VFS_UNAVAILABLE")))}download(t,n,i){return new Promise((n,i)=>{this.url(t).then(t=>e({responseType:"arraybuffer",url:t,method:"GET"}).then(e=>n(e.data)).catch(e=>{i(e.message)})).catch(i)})}url(e,n,i){return Promise.reject(new Error(t._("ERR_VFS_UNAVAILABLE")))}find(e,n,i){return Promise.reject(new Error(t._("ERR_VFS_UNAVAILABLE")))}trash(e,n,i){return Promise.reject(new Error(t._("ERR_VFS_UNAVAILABLE")))}untrash(e,n,i){return Promise.reject(new Error(t._("ERR_VFS_UNAVAILABLE")))}emptyTrash(e,n){return Promise.reject(new Error(t._("ERR_VFS_UNAVAILABLE")))}freeSpace(e,n,i){return Promise.reject(new Error(t._("ERR_VFS_UNAVAILABLE")))}}}),e("skylark-osjsv2-client/vfs/transports/web",["skylark-axios","../transport","../../core/connection","../../utils/fs"],function(e,t,n,i){"use strict";return class extends t{_request(t,r,o,s){return new Promise((a,l)=>{if(s.cors)e({responseType:r,url:t,method:o}).then(e=>a(null===r?e.statusText:e.data)).catch(e=>l(new Error(e.message||e)));else{const e="text"!==s.type&&"arraybuffer"===r;n.request("curl",{url:t,method:o,binary:e}).then(t=>e?i.dataSourceToAb(t.body,"application/octet-stream",(e,t)=>e?l(e):a(t)):a(t.body)).catch(l)}})}scandir(e,t,n){return new Promise((i,r)=>{const o=n.option("root"),s=e.path.replace(/\/?$/,"/_scandir.json");this._request(s,"json","GET",t).then(e=>i(e.map(e=>(e.path=o+e.path.replace(/^\//,""),e)))).catch(r)})}read(e,t){const n=e.mime||"application/octet-stream";return new Promise((r,o)=>{this._request(e.path,"arraybuffer","GET",t).then(e=>t.cors?("text"===t.type?r(e):i.dataSourceToAb(e,"application/octet-stream",(e,t)=>e?o(e):r(t)),!0):"text"===t.type?(i.abToText(e,n,(e,t)=>{e?o(new Error(e)):r(t)}),!0):r(e)).catch(o)})}exists(e){return new Promise((t,n)=>{this._request(e.path,null,"HEAD").then(e=>t("OK"===e.toUpperCase())).catch(n)})}url(e){return Promise.resolve(e.path)}}}),e("skylark-osjsv2-client/vfs/transports/osjs",["../file","../../utils/fs","../../core/connection","../transport","../../core/config","../../core/locales"],function(e,t,n,i,r,o){"use strict";return class extends i{_request(e,t,i){return n.request("FS:"+e,t,i)}_requestUpload(n,i,s){if(s=s||{},n=n instanceof e?n.path:n,void 0!==i.size){const e=r.getConfig("VFS.MaxUploadSize");if(e>0){const n=i.size;if(n>e){const n=o._("DIALOG_UPLOAD_TOO_BIG_FMT",t.humanFileSize(e));return Promise.reject(new Error(n))}}}const a=new FormData;return a.append("path",n),i&&a.append("filename",i.filename),s&&Object.keys(s).forEach(e=>{"meta"!==e&&"function"!=typeof s[e]&&a.append(e,String(s[e]))}),i instanceof window.ArrayBuffer&&a.append("size",String(i.byteLength)),t.addFormFile(a,"upload",i,s.meta),this._request("upload",a,s)}scandir(t,n){n=n||{};const i={path:t.path,options:{shortcuts:n.shortcuts}};return new Promise((t,r)=>{this._request("scandir",i,n).then(n=>t(n.map(t=>new e(t)))).catch(r)})}read(e,t){return this._request("get",{path:e.path},t)}write(n,i,r){(r=r||{}).meta=n,r.overwrite=!0,r.onprogress=r.onprogress||function(){};const o=new e(t.dirname(n.path),n.mime);return this._requestUpload(o,i,r)}unlink(e){return this._request("unlink",{path:e.path})}copy(e,t,n){return this._request("copy",{src:e.path,dest:t.path},n)}move(e,t,n){return this._request("move",{src:e.path,dest:t.path},n)}exists(e){return this._request("exists",{path:e.path})}fileinfo(e){return this._request("fileinfo",{path:e.path})}mkdir(e){return this._request("mkdir",{path:e.path})}upload(e,t,n){return this._requestUpload(e,t,n)}url(t,i){return"string"==typeof t&&(t=new e(t)),Promise.resolve(n.instance.getVFSPath(t,i))}find(e,t){return this._request("find",{path:e.path,args:t})}trash(e){return Promise.reject(new Error(o._("ERR_VFS_UNAVAILABLE")))}untrash(e){return Promise.reject(new Error(o._("ERR_VFS_UNAVAILABLE")))}emptyTrash(){return Promise.reject(new Error(o._("ERR_VFS_UNAVAILABLE")))}freeSpace(e){return this._request("freeSpace",{root:e})}}}),e("skylark-osjsv2-client/vfs/transports/dist",["./osjs","../../core/mount-manager","../../core/config","../../core/locales"],function(e,t,n,i){"use strict";return class extends e{request(e,t,n){return-1===["url","scandir","read"].indexOf(e)?Promise.reject(new Error(i._("ERR_VFS_UNAVAILABLE"))):super.request(...arguments)}url(e){const i=n.getBrowserPath(),module=t.getModuleFromPath(e.path),r=e.path.replace(module.option("match"),i).replace(/^\/+/,"/");return Promise.resolve(r)}}}),e("skylark-osjsv2-client/vfs/transports/applications",["../../core/package-manager","../transport","../file","../../core/locales"],function(e,t,n,i){"use strict";return class extends t{request(e,t,n){return-1===["scandir"].indexOf(e)?Promise.reject(new Error(i._("ERR_VFS_UNAVAILABLE"))):super.request(...arguments)}scandir(){const t=e.getPackages(),i=[];return Object.keys(t).forEach(e=>{const r=t[e];"extension"!==r.type&&i.push(new n({filename:r.name,type:"application",path:"applications:///"+e,mime:"osjs/application"},"osjs/application"))}),Promise.resolve(i)}url(e){return Promise.resolve(e.path)}}}),e("skylark-osjsv2-client/vfs/transports/webdav",["skylark-axios","../../core/connection","../../utils/fs","../../utils/misc","../transport","../file","../../core/config","../../core/locales"],function(e,t,n,i,r,o,s,a){"use strict";function l(e,t){return e.path.replace(t.option("match"),"")}function c(e,t,n){let r=n.host;n.cors||(r=i.parseurl(n.host,{username:n.username,password:n.password}).url);const o=l(t,e);return r.replace(/\/?$/,o.replace(/^\/?/,"/"))}function u(e,t,r){const s=r.option("root"),a=r.option("options")||{},c=l(t,r);let u=a.ns||"DAV";return":"!==u.substr(-1)&&(u+=":"),(e.children||[]).map(e=>{let t=function(e,t,n){const r=n.option("options")||{},o=i.parseurl(r.host).path;try{let n=e.getElementsByTagNameNS(t,"href")[0].textContent;return n.substr(o.length-1,n.length)}catch(e){console.warn(e)}return"/"}(e,u,r),a="file";return t.match(/\/$/)&&(a="dir",t=t.replace(/\/$/,"")||"/"),t!==c&&new o({id:function(e,t,n){try{return t.getElementsByTagNameNS(n,"getetag")[0].textContent}catch(e){}return null}(0,e,u),path:s+t.replace(/^\//,""),filename:n.filename(t),size:function(e,t,n){if("file"===e)try{return parseInt(t.getElementsByTagNameNS(n,"getcontentlength")[0].textContent,10)||0}catch(e){}return 0}(a,e,u),mime:function(e,t,n){if("file"===e)try{return t.getElementsByTagNameNS(n,"getcontenttype")[0].textContent||"application/octet-stream"}catch(e){return"application/octet-stream"}return null}(a,e,u),type:a})}).filter(e=>!1!==e)}return class extends r{_request(i,r,s,l,u){const d=r.mime||"application/octet-stream",h=new o(r,d),p=l.option("options")||{},g={},m=c(l,h,p);if(r.dest){const e=new o(r.dest,d);g.Destination=c(l,e,p)}return d&&(g["Content-Type"]=d),new Promise((o,s)=>{if(p.cors){const t={url:m,responseType:!0===u?"arraybuffer":"text",method:i,headers:g,data:r.data,auth:{username:p.username,password:p.password}};e(t).then(e=>o(e.data)).catch(e=>s(new Error(e.message||e)))}else{const e={url:m,method:i,binary:!0===u,mime:d,headers:g};t.request("curl",e).then(e=>{const t=e.httpCode;if(!e)return s(new Error(a._("ERR_VFS_REMOTEREAD_EMPTY")));if([200,201,203,204,205,207].indexOf(t)<0){const e=new Error(a._("ERR_VFSMODULE_XHR_ERROR")+": "+t);return e.httpCode=t,s(e)}return!0===u?n.dataSourceToAb(e.body,d,(e,t)=>e?s(new Error(e)):o(t)):o((f=e.body,(new DOMParser).parseFromString(f,"application/xml").firstChild))}).catch(s)}});var f}scandir(e,t,n){return new Promise((i,r)=>{this._request("PROPFIND",{path:e.path},t,n).then(t=>{i(t?u(t,e,n).map(e=>new o(e)):[])}).catch(r)})}read(e,t,n){return this._request("GET",{path:e.path,mime:e.mime},t,n,!0)}write(e,t,n,i){return this._request("PUT",{path:e.path,data:t,mime:e.mime},n,i)}unlink(e,t,n){return this._request("DELETE",{path:e.path},t,n)}copy(e,t,n,i){return this._request("COPY",{path:e.path,dest:t.path},n,i)}move(e,t,n,i){return this._request("MOVE",{path:e.path,dest:t.path},n,i)}exists(e,t,n){return new Promise((i,r)=>{this._request("PROPFIND",{path:e.path},t,n).then(()=>{i(!1)}).catch(e=>{404===e.httpCode?i(!1):(console.warn(e),i(!0))})})}mkdir(e,t,n){return this._request("MKCOL",{path:e.path},t,n)}url(e,t,n){const i=n.option("options")||{};let r=c(n,e,i);return i.cors||(r=s.getConfig("Connection.FSURI")+"/read?path="+encodeURIComponent(r)),Promise.resolve(r)}freeSpace(e){return Promise.resolve(-1)}}}),e("skylark-osjsv2-client/helpers/service-notification-icon",["../gui/notification","../core/theme","../gui/menu","../core/locales"],function(e,t,n,i){"use strict";return new class{constructor(){this.entries={},this.size=0,this.notif=null}init(){const n=e=>(this.displayMenu(e),!1);this.notif=e.createIcon("ServiceNotificationIcon",{image:t.getIcon("status/dialog-password.png"),onContextMenu:n,onClick:n,onInited:(e,t)=>{this._updateIcon()}}),this._updateIcon()}destroy(){e.destroyIcon("ServiceNotificationIcon"),this.size=0,this.entries={},this.notif=null}_updateIcon(){this.notif&&(this.notif.$container&&(this.notif.$container.style.display=this.size?"inline-block":"none"),this.notif.setTitle(i._("SERVICENOTIFICATION_TOOLTIP",this.size.toString())))}displayMenu(e){const t=[],i=this.entries;Object.keys(i).forEach(e=>{t.push({title:e,menu:i[e]})}),n.create(t,e)}add(e,t){this.entries[e]||(this.entries[e]=t,this.size++,this._updateIcon())}remove(e){this.entries[e]&&(delete this.entries[e],this.size--,this._updateIcon())}}}),e("skylark-osjsv2-client/helpers/qs",[],function(){"use strict";function e(e,t,n,i){if("number"!=typeof e)throw new TypeError("statusCode must be a number but was "+typeof e);if(null===t)throw new TypeError("headers cannot be null");if("object"!=typeof t)throw new TypeError("headers must be an object but was "+typeof t);for(var r in this.statusCode=e,this.headers={},t)this.headers[r.toLowerCase()]=t[r];this.body=n,this.url=i}return e.prototype.getBody=function(e){if(this.statusCode>=300){var t=new Error("Server responded with status code "+this.statusCode+":\n"+this.body.toString());throw t.statusCode=this.statusCode,t.headers=this.headers,t.body=this.body,t.url=this.url,t}return e?this.body.toString(e):this.body},e}),e("skylark-osjsv2-client/helpers/handle-qs",["./qs"],function(e){var t=e.parse,n=e.stringify;return function(e,i){var r=(e=e.split("?"))[0],o=(e[1]||"").split("#")[0],s=e[1]&&e[1].split("#").length>1?"#"+e[1].split("#")[1]:"",a=t(o);for(var l in i)a[l]=i[l];return""!==(o=n(a))&&(o="?"+o),r+o+s}}),e("skylark-osjsv2-client/helpers/then-jsonp",["./handle-qs"],function(e){"use strict";var t=0,n={};return function(i,r,o,s){var a=new Promise(function(a,l){if("string"!=typeof i)throw new TypeError("The method must be a string.");if("string"!=typeof r)throw new TypeError("The URL/path must be a string.");if("function"==typeof o&&(s=o,o={}),null!==o&&void 0!==o||(o={}),"object"!=typeof o)throw new TypeError("Options must be an object (or null).");if("function"!=typeof s&&(s=void 0),o.body)throw new TypeError("JSONP does not support requests that have bodies");if(o.headers)throw new TypeError("JSONP does not support requests that specify headers");if(!1===o.followRedirects)throw new TypeError("JSONP does not support requests that do not follow redirects");o.qs=o.qs||{},o.json&&(Object.keys(o.json).forEach(function(e){o.qs[e]=o.json[e]}),delete o.json);var c=o.callbackName||"then_jsonp_"+ ++t;function u(){o.qs&&(r=e(r,o.qs));var t,i=document.createElement("script"),s=document.getElementsByTagName("head")[0]||document.documentElement,u=!1;function d(e){u||(u=!0,i.onload=i.onreadystatechange=i.onerror=null,clearTimeout(t),c in window&&(e?delete window[c]:window[c]=function(){}),i&&i.parentNode&&i.parentNode.removeChild(i),n[c].length?n[c].shift()():delete n[c])}i.onload=i.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(d(),setTimeout(function(){l(new Error("JSONP callback should already have been called"))},100))},i.onerror=function(){d(),l(new Error("JSONP request failed"))},window[c]=function(e){d(!0),a(e)},t=setTimeout(function(){d(),l(new Error("JSONP timed out"))},o.timeout||1e4),i.src=r,i.async=!0,s.appendChild(i)}!1!==o.callbackParameter&&(o.qs[o.callbackParameter||"callback"]=c),"get"!==i.toLowerCase()&&(o.qs[o.methodParameter||"method"]=i),n[c]?n[c].push(u):(n[c]=[],u())});return a.getBody=function(){return a.then(function(e){return e.getBody()})},a.nodeify(s)}}),e("skylark-osjsv2-client/helpers/google-api",["../core/mount-manager","./service-notification-icon","../utils/preloader","../core/locales","../core/config","./then-jsonp"],function(e,t,n,i,r,o){"use strict";const s=window.gapi=window.gapi||{};let a=null;class l{constructor(e){this.clientId=e,this.accessToken=null,this.userId=null,this.preloaded=!1,this.authenticated=!1,this.loaded=[],this.preloads=[{type:"javascript",src:"https://apis.google.com/js/api.js"}]}destroy(){}init(e){e=e||function(){},this.preloaded?e(!1,!0):n.preload(this.preloads).then(t=>{t.failed.length&&(this.preloaded=!0),e(t.failed.join("\n"))}).catch(e)}load(e,t,n,r){const o=e=>{this.authenticate(t,(t,n)=>{if(t)e(t);else{if(!this.authenticated)return void e(i._("GAPI_AUTH_FAILURE"));e(!1,n)}})},l=i=>{const r=[];e.forEach(e=>{-1===this.loaded.indexOf(e)&&r.push(e)});let o=0,a=r.length;console.debug("GoogleAPI::load()",e,"=>",r,t);const l=(e,t)=>{let i=[],r=null;e instanceof Array?e.length>0&&e.length<3&&(i=i.concat(e),r=e[0]):(i.push(e),r=e),i.push((e,n,i,o)=>{this.loaded.push(r),t.call(this,e,n,i,o)}),n?s.client.load.apply(s,i):s.load.apply(s,i)};!function e(){o>=a?i():(l(r[o],()=>{e()}),o++)}()};this.init(e=>{e?r(e):window.gapi&&s.load?o(e=>{e?r(e):l((e,t)=>{r(e,t,a)})}):r(i._("GAPI_LOAD_FAILURE"))})}signOut(n){if(n=n||function(){},console.info("GoogleAPI::signOut()"),this.authenticated){try{s.auth.signOut()}catch(e){console.warn("GoogleAPI::signOut()","failed",e),console.warn(e.stack)}this.authenticated=!1,t.remove("Google API")}e.remove("GoogleDrive"),n(!1,!0)}revoke(e){if(console.info("GoogleAPI::revoke()"),!this.accessToken)return void e(!1);const t="https://accounts.google.com/o/oauth2/revoke?token="+this.accessToken;o("GET",t).then(()=>e(!0)).catch(()=>e(!1))}authenticate(e,n){console.info("GoogleAPI::authenticate()"),n=n||function(){};const r=(t,n)=>{console.info("GoogleAPI::authenticate() => login()",t),n=n||function(){},s.auth.authorize({client_id:this.clientId,scope:e,user_id:this.userId,immediate:t},n)},o=()=>{t.remove("Google API"),t.add("Google API",[{title:i._("GAPI_SIGN_OUT"),onClick:()=>{this.signOut()}},{title:i._("GAPI_REVOKE"),onClick:()=>{this.revoke(()=>{this.signOut()})}}])},a=(e,t)=>{if(console.info("GoogleAPI::authenticate() => handleAuthResult()",e),!e.error||"origin_mismatch"!==e.error_subtype&&("access_denied"!==e.error_subtype||t))e&&!e.error?(l=(l=(t=>{this.userId=t,t?(o(),this.authenticated=!0,this.accessToken=e.access_token||null,n(!1,!0)):n(!1,!1)}))||function(){},s.client.load("oauth2","v2",()=>{s.client.oauth2.userinfo.get().execute(e=>{console.info("GoogleAPI::authenticate() => getUserId()",e),l(e.id)})})):r(!1,e=>{a(e,!1)});else{const t=i._("GAPI_AUTH_FAILURE_FMT",e.error,e.error_subtype);n(t)}};var l;s.load("auth:client",e=>{if(e&&e.error){const t=i._("GAPI_AUTH_FAILURE_FMT",e.error,e.error_subtype);n(t)}else r(!0,e=>{a(e,!0)})})}}return{instance:function(){return a},create:function(e,t){const n=e.load||[],o=e.scope||[],s=!0===e.client;function c(){a.load(n,o,s,t)}if(a)return void c();let u=null;try{u=r.getConfig("GoogleAPI.ClientId")}catch(e){console.warn("getGoogleAPI()",e,e.stack)}if(!u)return void t(i._("GAPI_DISABLED"));a=new l(u),c()}}}),e("skylark-osjsv2-client/vfs/transports/google-drive",["skylark-axios","../transport","../file","../filedataurl","../../core/mount-manager","../../core/locales","../../helpers/google-api","../../utils/fs"],function(e,t,n,i,r,o,s,a){"use strict";const l=7e3;let c,u,d,h,p=window.gapi=window.gapi||{};function g(e,t,i,r,o){const s=[],l=e.replace(o,"/").replace(/\/+/g,"/"),c="/"===l;return t&&t.forEach((t,i)=>{t&&s.push(function(t,i){let r=e;".."===t.title?r=a.dirname(e):(c||(r+="/"),r+=t.title);let o="application/vnd.google-apps.folder"===t.mimeType?"dir":"drive#file"===t.kind?"file":"dir";"application/vnd.google-apps.trash"===t.mimeType&&(o="trash");return new n({filename:t.title,path:r,id:t.id,size:t.quotaBytesUsed||0,mime:"application/vnd.google-apps.folder"===t.mimeType?null:t.mimeType,type:o})}(t))}),s||[]}function m(e,t){function n(){!function(e){u&&(clearTimeout(u),u=null);if(h)return console.info("USING CACHE FROM PREVIOUS FETCH!"),void e(!1,h);console.info("UPDATING CACHE");let t=[];try{const n=p.client.drive.files.list({});!function t(n,i){n.execute(r=>{r.error&&console.warn("GoogleDrive::getAllDirectoryFiles()","error",r),i=i.concat(r.items);const o=r.nextPageToken;o?(n=p.client.drive.files.list({pageToken:o}),t(n,i)):(h=i,e(!1,i))})}(n,t)}catch(n){console.warn("GoogleDrive::getAllDirectoryFiles() exception",n,n.stack),console.warn("THIS ERROR OCCURS WHEN MULTIPLE REQUESTS FIRE AT ONCE ?!"),e(!1,t)}}((n,i)=>{const r=e.path;n?t(n,!1,r):function(t,n,i){const r={},o={};t.forEach(e=>{if(e){r[e.id]=e;const t=[];e.parents&&e.parents.forEach(e=>{e&&t.push(e.id)}),o[e.id]=t}});let s=a.getPathFromVirtual(n).replace(/^\/+/,"").split("/");s=s.filter(e=>""!==e);let l=d,c=!s.length;function u(i){const r=[];return c||r.push({title:"..",path:a.dirname(n),id:e.id,quotaBytesUsed:0,mimeType:"application/vnd.google-apps.folder"}),t.forEach(e=>{e&&o[e.id]&&-1!==o[e.id].indexOf(i)&&r.push(e)}),r}!function e(n){let i=s.shift();let r=s.length<=0;let a;c?a=l:i&&t.forEach(e=>{e&&e.title===i&&o[e.id]&&-1!==o[e.id].indexOf(l)&&(l=e.id,a=e.id)});r?n(a):e(n)}(e=>{e&&r[e]?i(!1,u(e)):c?i(!1,u(l)):i("Could not list directory")})}(i,r,(e,n)=>{console.groupEnd(),u=setTimeout(()=>{console.info("Clearing GoogleDrive filetree cache!"),h=null},l),console.debug("GoogleDrive::*getAllDirectoryFiles()","=>",n),t(e,n,r)})})}if(console.debug("GoogleDrive::*getAllDirectoryFiles()",e),console.group("GoogleDrive::*getAllDirectoryFiles()"),d)n();else{const e=p.client.drive.about.get();e.execute(e=>{e&&e.rootFolderId?(d=e.rootFolderId,n()):t(o._("ERR_VFSMODULE_ROOT_ID"))})}}function f(e,t,i){e instanceof n&&(e=e.path);const r=new n({filename:a.filename(e),type:"dir",path:a.dirname(e)});console.debug("GoogleDrive::*getFileIdFromPath()",e,t,r),m(r,(n,r,o)=>{if(n)return void i(n);let s=null;r.forEach(n=>{if(n.title===a.filename(e))if(t){if(n.mimeType===t)return s=n,!1}else s=n;return!0}),i(!1,s)})}function _(e,t){const n=a.dirname(e.path);console.debug("GoogleDrive::*getParentPathId()",e),f(n,"application/vnd.google-apps.folder",(e,n)=>{e?t(e):t(!1,n?n.id:null)})}function w(e,t,n){var i;console.info("GoogleDrive::setFolder()",e,t),t=t||"root",i=(()=>{p.client.drive.children.insert({folderId:t,resource:{id:e.id}}).execute(e=>{console.info("GoogleDrive::setFolder()","=>",e),n(!1,!0)})}),e.parents.forEach((t,n)=>{const r=p.client.drive.children.delete({folderId:t.id,childId:e.id});r.execute(t=>{n>=e.parents.length-1&&i()})})}return class extends t{_init(){return c?Promise.resolve():new Promise((e,t)=>{s.create({scope:["https://www.googleapis.com/auth/drive.install","https://www.googleapis.com/auth/drive.file","openid"],load:["drive-realtime","drive-share"]},(n,i)=>{p.client.load("drive","v2",n=>(n||(c=!0),n?t(new Error(n)):e(!0)))})})}request(e,t,n,i){const r=arguments;return new Promise((e,t)=>{this._init().then(()=>super.request(...r).then(e).catch(t)).catch(t)})}scandir(e,t,n){return new Promise((i,r)=>{m(e,(o,s,a)=>{if(o)r(new Error(o));else{const r=g(a,s,e,t,n.option("match"));i(r)}})})}read(t,n,i){const r=t=>new Promise((n,i)=>{const r=p.client.drive.files.get({fileId:t.id});r.execute(t=>{if(t&&t.id){let r=p.auth.getToken().access_token;e({url:t.downloadUrl,method:"GET",responseType:"arraybuffer",headers:{Authorization:"Bearer "+r}}).then(e=>n(e.data)).catch(e=>{i(new Error(o._("ERR_VFSMODULE_XHR_ERROR")+" - "+e.message))})}else i(new Error(o._("ERR_VFSMODULE_NOSUCH")))})});return new Promise((e,n)=>{t.downloadUrl?r(t).then(e).catch(n):f(t.path,t.mime,function(t,i){t?n(new Error(t)):i?r(i).then(e).catch(n):n(new Error(o._("ERR_VFSMODULE_NOSUCH")))})})}write(e,t){const n=(n,r)=>new Promise((s,l)=>{let c="/upload/drive/v2/files",u="POST";r&&(c="/upload/drive/v2/files/"+r,u="PUT"),function(e,t,n){const r="-------314159265358979323846",o="\r\n--"+r+"\r\n",s="\r\n--"+r+"--",l=e.mime||"text/plain";function c(t){const n={title:e.filename,mimeType:l},i=t,r=o+"Content-Type: application/json\r\n\r\n"+JSON.stringify(n)+o+"Content-Type: "+l+"\r\nContent-Transfer-Encoding: base64\r\n\r\n"+i+s;return r}const u="multipart/mixed; boundary='"+r+"'";t instanceof i?n(!1,{contentType:u,body:c(t.toBase64())}):a.abToBinaryString(t,l,(e,t)=>{n(e,!e&&{contentType:u,body:c(btoa(t))})})}(e,t,(e,t)=>{if(e)l(new Error(e));else{const e=p.client.request({path:c,method:u,params:{uploadType:"multipart"},headers:{"Content-Type":t.contentType},body:t.body});e.execute(e=>{h=null,e&&e.id?n?w(e,n,(e,t)=>e?l(new Error(e)):s(t)):s(!0):l(o._("ERR_VFSMODULE_NOSUCH"))})}})});return new Promise((t,i)=>{_(e,(r,o)=>{r?i(new Error(r)):e.id?n(o,e.id).then(t).catch(i):this.exists(e).then(e=>n(o,e?e.id:null).then(t).catch(i)).catch(()=>{n(o,null).then(t).catch(i)})})})}copy(e,t){return new Promise((n,i)=>{const r=p.client.drive.files.copy({fileId:e.id,resource:{title:a.filename(t.path)}});r.execute(e=>{if(e.id)_(t,(t,r)=>{t?(console.warn(t),n(!0)):(h=null,w(e,r,(e,t)=>e?i(new Error(e)):n(t)))});else{const t=e&&e.message?e.message:o._("ERR_APP_UNKNOWN_ERROR");i(new Error(t))}})})}move(e,t){return new Promise((n,i)=>{const r=p.client.drive.files.patch({fileId:e.id,resource:{title:a.filename(t.path)}});r.execute(e=>{if(e&&e.id)h=null,n(!0);else{const t=e&&e.message?e.message:o._("ERR_APP_UNKNOWN_ERROR");i(new Error(t))}})})}exists(e){return new Promise((t,i)=>{const r=new n(a.dirname(e.path));this.scandir(r).then(i=>{const r=i.find(t=>t.path===e.path);if(r){const i=new n(e.path,r.mimeType);return i.id=r.id,i.title=r.title,t(i)}return t(!1)}).catch(i)})}fileinfo(e){return new Promise((t,n)=>{const i=p.client.drive.files.get({fileId:e.id});i.execute(e=>{if(e&&e.id){const n=["createdDate","id","lastModifyingUser","lastViewedByMeDate","markedViewedByMeDate","mimeType","modifiedByMeDate","modifiedDate","title","alternateLink"],i={};n.forEach(t=>{i[t]=e[t]}),t(i)}else n(o._("ERR_VFSMODULE_NOSUCH"))})})}url(e){return new Promise((t,n)=>{if(e&&e.id){const i=p.client.drive.files.get({fileId:e.id});i.execute(e=>{if(e&&e.webContentLink)t(e.webContentLink);else{const t=e&&e.message?e.message:o._("ERR_APP_UNKNOWN_ERROR");n(new Error(t))}})}else n(new Error("url() expects a File ref with Id"))})}mkdir(e){const t=t=>new Promise((n,i)=>{const r=p.client.request({path:"/drive/v2/files",method:"POST",body:JSON.stringify({title:e.filename,parents:t,mimeType:"application/vnd.google-apps.folder"})});r.execute(e=>{if(e&&e.id)h=null,n(!0);else{const t=e&&e.message?e.message:o._("ERR_APP_UNKNOWN_ERROR");i(new Error(t))}})});return new Promise((n,i)=>{const module=r.getModuleFromPath(e.path),s=a.getPathFromVirtual(a.dirname(e.path)),l=a.getPathFromVirtual(module.option("root"));s!==l?_(e,(e,r)=>{e||!r?i(new Error(o._("ERR_VFSMODULE_PARENT_FMT",e||o._("ERR_VFSMODULE_PARENT")))):t([{id:r}]).then(n).catch(i)}):t(null).then(n).catch(i)})}upload(e,t){const i=new n({filename:t.name,path:a.pathJoin(e.path,t.name),mime:t.type,size:t.size});return this.write(i,t)}trash(e){return new Promise((t,n)=>{const i=p.client.drive.files.trash({fileId:e.id});i.execute(e=>{if(e.id)t(!0);else{const t=e&&e.message?e.message:o._("ERR_APP_UNKNOWN_ERROR");n(new Error(t))}})})}untrash(e){return new Promise((t,n)=>{const i=p.client.drive.files.untrash({fileId:e.id});i.execute(e=>{if(e.id)t(!0);else{const t=e&&e.message?e.message:o._("ERR_APP_UNKNOWN_ERROR");n(new Error(t))}})})}emptyTrash(){return new Promise((e,t)=>{const n=p.client.drive.files.emptyTrash({});n.execute(n=>{if(n&&n.message){const e=n&&n.message?n.message:o._("ERR_APP_UNKNOWN_ERROR");t(new Error(e))}else e(!0)})})}freeSpace(e){return Promise.resolve(-1)}unlink(e){const t=e=>(h=null,new Promise((t,n)=>{const i=p.client.drive.files.delete({fileId:e.id});i.execute(e=>{if(e&&"object"==typeof e.result)t(!0);else{const t=e&&e.message?e.message:o._("ERR_APP_UNKNOWN_ERROR");n(new Error(t))}})}));return e.id?t(e):new Promise((n,i)=>{f(e.path,e.mime,(e,r)=>{e?i(new Error(e)):r?t(r).then(n).catch(i):i(new Error(o._("ERR_VFSMODULE_NOSUCH")))})})}}}),e("skylark-osjsv2-client/helpers/windows-live-api",["../core/mount-manager","./service-notification-icon","../utils/preloader","../core/locales","../core/config"],function(e,t,n,i,r){"use strict";const o=window.location.href.replace(/\/$/,"")+"/windows-live-oauth.html";let s=null;class a{constructor(e){this.hasSession=!1,this.clientId=e,this.loaded=!1,this.inited=!1,this.accessToken=null,this.lastScope=null,this.preloads=[{type:"javascript",src:"//js.live.net/v5.0/wl.js"}]}destroy(){}init(e){e=e||function(){},this.loaded?e(!1,!0):n.preload(this.preloads).then(t=>{t.failed.length||(this.loaded=!0),e(t.failed.join("\n"))}).catch(()=>e())}load(e,t){console.debug("WindowsLiveAPI::load()",e);let n=window.WL||{};const r=()=>{const n=(this.lastScope||[]).sort(),i=(e||[]).sort();this.hasSession&&n.toString()===i.toString()?t(!1,!0):this.login(e,(e,n)=>{e?t(e):setTimeout(()=>{t(!1,!0)},10)})};this.init(e=>{e?t(e):window.WL?(n=window.WL||{},this.inited?r():(this.inited=!0,n.Event.subscribe("auth.login",(e,t,n,i)=>{this.onLogin(e,t,n,i)}),n.Event.subscribe("auth.logout",(e,t,n,i)=>{this.onLogout(e,t,n,i)}),n.Event.subscribe("wl.log",(e,t,n,i)=>{this.onLog(e,t,n,i)}),n.Event.subscribe("auth.sessionChange",(e,t,n,i)=>{this.onSessionChange(e,t,n,i)}),n.init({client_id:this.clientId,display:"popup",redirect_uri:o}).then(e=>{console.debug("WindowsLiveAPI::load()","=>",e),e.session&&(this.accessToken=e.session.access_token||null),"connected"===e.status?t(!1,!0):"success"===e.status?r():t(i._("WLAPI_INIT_FAILED_FMT",e.status.toString()))},e=>{console.error("WindowsLiveAPI::load()","init() error",e),t(e.error_description)}))):t(i._("WLAPI_LOAD_FAILURE"))})}_removeRing(){t.remove("Windows Live API")}logout(t){t=t||function(){};const n=window.WL||{};this.hasSession&&t(!1,!1),n.Event.unsubscribe("auth.logout"),n.Event.subscribe("auth.logout",()=>{this._removeRing(),n.Event.unsubscribe("auth.logout"),t(!1,!0)}),n.logout(),e.remove("OneDrive")}login(e,t){const n=window.WL||{};this.hasSession?t(!1,!0):n.login({scope:e,redirect_uri:o}).then(e=>{"connected"===e.status?t(!1,!0):t(i._("WLAPI_LOGIN_FAILED"))},e=>{t(i._("WLAPI_LOGIN_FAILED_FMT",e.error_description))})}onSessionChange(){console.warn("WindowsLiveAPI::onSessionChange()",arguments);const e=window.WL||{},t=e.getSession();this.hasSession=!!t}onLogin(){console.warn("WindowsLiveAPI::onLogin()",arguments),this.hasSession=!0,t.add("Windows Live API",[{title:i._("WLAPI_SIGN_OUT"),onClick:()=>{this.logout()}}])}onLogout(){console.warn("WindowsLiveAPI::onLogout()",arguments),this.hasSession=!1,this._removeRing()}onLog(){console.debug("WindowsLiveAPI::onLog()",arguments)}}return{instance:function(){return s},create:function(e,t){function n(){const n=e.scope;s.load(n,e=>{t(e||!1,s)})}if(e=e||{},s)return void n();let o=null;try{o=r.getConfig("WindowsLiveAPI.ClientId")}catch(e){console.warn("getWindowsLiveAPI()",e,e.stack)}if(!o)return void t(i._("WLAPI_DISABLED"));s=new a(o),n()}}}),e("skylark-osjsv2-client/vfs/transports/onedrive",["skylark-axios","../transport","../file","../../core/config","../../core/locales","../../helpers/windows-live-api","../../utils/fs","../fs"],function(e,t,n,i,r,o,s,a){"use strict";let l,c=!1;function u(e,t){console.debug("OneDrive::*onedriveCall()",e);const n=window.WL||{};n.api(e).then(e=>{t(!1,e)},n=>{console.error("OneDrive::*onedriveCall()","error",n,e),t(n.error.message)})}function d(e){let t="file";return"folder"!==e.type&&"album"!==e.type||(t="dir"),t}function h(e,t,r){const o=e.replace(/^\/+/,"").replace(/\/+$/,""),a=r+(o?o+"/":o)+t.name,c=new n({id:t.id,filename:t.name,size:t.size||0,path:a,mime:function(e){l||(l=i.getConfig("MIME.mapping",{}));let t=null;if("dir"!==d(e)){t="application/octet-stream";let n=s.filext(e.name);n.length&&l[n="."+n]&&(t=l[n])}return t}(t),type:d(t)});return c}function p(e,t){u({path:e+"/files",method:"GET"},(e,n)=>{e?t(e):(console.debug("OneDrive::*getFilesInFolder()","=>",n),t(!1,n.data||[]))})}function g(e,t,n){if(!n&&e.id)return void t(!1,e.id);let i=s.getPathFromVirtual(e.path).replace(/\/+/,"/");if(n&&(i=s.dirname(i)),"/"===i)return void t(!1,"me/skydrive");const o=i.replace(/^\/+/,"").split("/"),a=!o.length;let l="me/skydrive";!function e(t){const n=o.shift();const i=o.length<=0;let r;if(a)r=l;else if(n)return void p(l,(r,o)=>{let s;o=o||[],r?console.warn("OneDrive","resolvePath()","getFilesInFolder() error",r):(o.forEach(e=>{e&&e.name===n&&(s=e.id)}),s&&(l=s)),i?t(s):e(t)});i?t(r):e(t)}(e=>{e?t(!1,e):t(r._("ONEDRIVE_ERR_RESOLVE"))})}return class extends t{_init(){return new e((e,t)=>{const n={scope:["wl.signin","wl.skydrive","wl.skydrive_update"]};c?e(!0):o.create(n,n=>{n?t(new Error(n)):(c=!0,e(!0))})})}request(t,n,i,r){const o=arguments;return new e((e,t)=>{this._init().then(()=>super.request(...o).then(e).catch(t)).catch(t)})}scandir(t,i,r){return new e((e,i)=>{const o=s.getPathFromVirtual(t.path);g(t,(a,l)=>{a?i(new Error(a)):u({path:l,method:"GET"},(a,l)=>{a?i(new Error(a)):p(l.id,(a,l)=>{if(a)i(new Error(a));else{const i=function(e,t,i,r,o){const a=[];"/"!==e&&a.push(new n({id:i.id,filename:"..",path:s.dirname(i.path),size:0,type:"dir"}));return t.forEach(t=>{a.push(h(e,t,o))}),a}(o,l,t,0,r.option("root"));e(i)}})})})})}read(t,i,r){return new e((e,r)=>{this.url(t).then(o=>{const s=new n(o,t.mime);a.read(s,i).then(e).catch(r)}).catch(r)})}write(t,n){return new e((e,i)=>{const a=o.instance(),l="https://apis.live.net/v5.0/me/skydrive/files?access_token="+a.accessToken,c=new FormData;s.addFormFile(c,"file",n,t),axios({url:l,method:"POST",responseType:"json",data:c}).then(t=>{const n=t.data;return n&&n.id?e(n.id):i(new Error(r._("ERR_APP_UNKNOWN_ERROR")))}).catch(i)})}copy(t,i){return new e((e,r)=>{i=new n(s.dirname(i.path)),g(t,(t,n)=>{t?r(new Error(t)):g(i,(t,i)=>{t?r(new Error(t)):u({path:n,method:"COPY",body:{destination:i}},(t,n)=>t?r(new Error(t)):e(!0))})})})}move(t,i){return new e((e,r)=>{i=new n(s.dirname(i.path)),g(t,(t,n)=>{t?r(new Error(t)):g(i,(t,i)=>{t?r(new Error(t)):u({path:n,method:"MOVE",body:{destination:i}},(t,n)=>t?r(new Error(t)):e(!0))})})})}exists(t){return new e((e,n)=>{this.fileinfo(t).then(()=>e(!0)).catch(()=>e(!1))})}fileinfo(t){return new e((e,n)=>{g(t,(t,i)=>{t?n(new Error(t)):u({path:i,method:"GET"},(t,i)=>{if(t)n(new Error(t));else{const t=["created_time","id","link","name","type","updated_time","upload_location","description","client_updated_time"],n={};t.forEach(e=>{n[e]=i[e]}),e(n)}})})})}url(t){return new e((e,n)=>{g(t,function(t,i){t?n(new Error(t)):u({path:i+"/content",method:"GET"},(t,i)=>{t?n(new Error(t)):e(i.location)})})})}mkdir(t){return new e((e,n)=>{g(t,(i,r)=>{i?n(i):u({path:r,method:"POST",body:{name:t.filename}},(t,i)=>t?n(new Error(t)):e(!0))},!0)})}upload(e,t){const i=new n({filename:t.name,path:s.pathJoin(e.path,t.name),mime:t.type,size:t.size});return this.write(i,t)}freeSpace(t){return e.resolve(-1)}unlink(t){return new e((e,n)=>{g(t,(t,i)=>{t?n(new Error(t)):u({path:i,method:"DELETE"},(t,i)=>t?n(new Error(t)):e(!0))})})}}}),e("skylark-osjsv2-client/vfs/transports/dropbox",["../transport","../../utils/preloader","../../core/config","../file","../../utils/misc","../../core/locales","../../utils/fs"],function(e,t,n,i,r,o,s){"use strict";return class extends e{constructor(){super(...arguments),this.loaded=!1,this.authed=!1,this.dbx=null}_loadDependencies(){return this.loaded?Promise.resolve(!0):new Promise((e,n)=>{t.preload(["https://unpkg.com/dropbox/dist/Dropbox-sdk.min.js"]).then(()=>window.Dropbox?(this.loaded=!0,e(!0)):n(new Error(o._("ERR_DROPBOX_API")))).catch(e=>(this.loaded=!0,n(e)))})}_createClient(e){return this.authed?Promise.resolve(!0):new Promise((t,n)=>{let i,s;this.dbx=new window.Dropbox({clientId:e});const a=window.location.href.replace(/\/?$/,"/")+"dropbox-oauth.html";window.__osjs__dropbox_callback__=(e=>{if(clearTimeout(s),i)return;const a=r.urlparams(e,!0);a.access_token?(this.authed=!0,this.dbx=new window.Dropbox({accessToken:a.access_token}),t(!0)):n(new Error(o._("ERR_DROPBOX_AUTH")))});const l=this.dbx.getAuthenticationUrl(a);s=setTimeout(()=>{i=!0,n(new Error(o._("ERR_DROPBOX_AUTH")))},3e4),window.open(l)})}_init(){const e=n.getConfig("DropboxAPI.ClientKey");return e?new Promise((t,n)=>{this._loadDependencies().then(()=>this._createClient(e).then(t).catch(n)).catch(n)}):Promise.reject(new Error(o._("ERR_DROPBOX_KEY")))}request(e,t,n,i){const r=arguments;return new Promise((e,t)=>{this._init().then(()=>super.request(...r).then(e).catch(e=>"string"!=typeof e&&!(e instanceof Error)&&e.status&&e.response&&e.error?t(new Error(e.error.error_summary)):t(e))).catch(t)})}_createMetadata(e,t){return{id:t.id,filename:t.name,path:s.pathJoin(e,t.path_display),type:"folder"===t[".tag"]?"dir":"file",size:t.size||0}}find(e,t,n,i){const r=s.getPathFromVirtual(e.path);return new Promise((e,n)=>{this.dbx.filesSearch({path:"/"===r?"":r,query:t.query,max_results:100,mode:{".tag":"filename"}}).then(t=>e(t.matches.map(e=>this._createMetadata(i.option("root"),e.metadata)))).catch(n)})}scandir(e,t,n){const i=s.getPathFromVirtual(e.path);let r=[];const o=e=>new Promise((t,s)=>{const a=e?"filesListFolderContinue":"filesListFolder",l=e?{cursor:e}:{path:"/"===i?"":i};this.dbx[a](l).then(e=>{const i=(e.entries||[]).map(e=>this._createMetadata(n.option("root"),e));return r=r.concat(i),e.has_more&&e.cursor?o(e.cursor).then(t).catch(s):t(r)}).catch(s)});return o(null)}read(e,t,n){return new Promise((t,n)=>{this.url(e,{dl:0}).then(e=>{this.dbx.sharingGetSharedLinkFile({url:e}).then(e=>t(e.fileBlob)).catch(n)}).catch(n)})}write(e,t){return new Promise((n,i)=>{this.dbx.filesUpload({path:s.getPathFromVirtual(e.path),mode:{".tag":"overwrite"},contents:t}).then(()=>n(!0)).catch(i)})}copy(e,t){return new Promise((n,i)=>{this.dbx.filesCopy({from_path:s.getPathFromVirtual(e.path),to_path:s.getPathFromVirtual(t.path)}).then(()=>n(!0)).catch(i)})}move(e,t){return new Promise((n,i)=>{this.dbx.filesMove({from_path:s.getPathFromVirtual(e.path),to_path:s.getPathFromVirtual(t.path)}).then(()=>n(!0)).catch(i)})}exists(e){return new Promise((t,n)=>{this.fileinfo(e).then(()=>t(!0)).catch(()=>t(!1))})}fileinfo(e){return this.dbx.filesGetMetadata({path:s.getPathFromVirtual(e.path)})}url(e,t){const n=()=>new Promise((n,i)=>{this.dbx.sharingGetSharedLinks({path:s.getPathFromVirtual(e.path)}).then(e=>{if(e.links.length){const i=e.links.find(e=>"public"===e.visibility[".tag"]),r=void 0===t.dl?1:t.dl;if(i)return n(i.url.replace("dl=0","dl="+String(r)))}return n(!1)}).catch(i)}),i=()=>new Promise((t,n)=>{this.dbx.sharingCreateSharedLinkWithSettings({path:s.getPathFromVirtual(e.path),settings:{requested_visibility:"public"}}).then(e=>t(e.url)).catch(n)});return new Promise((e,t)=>{n().then(n=>n?(console.warn("ALREADY HAS URL",n),e(n)):(console.warn("CREATING NEW URL"),i().then(e).catch(t))).catch(t)})}mkdir(e){return new Promise((t,n)=>{this.dbx.filesCreateFolder({path:s.getPathFromVirtual(e.path)}).then(()=>t(!0)).catch(n)})}upload(e,t){const n=new i({filename:t.name,path:s.pathJoin(e.path,t.name),mime:t.type,size:t.size});return this.write(n,t)}freeSpace(e){return new Promise((e,t)=>{this.dbx.usersGetSpaceUsage().then(t=>{try{if(t.allocation&&void 0!==t.allocation.individual)return e(t.allocation.individual.allocated)}catch(e){console.warn(e)}return e(-1)}).catch(t)})}unlink(e){return new Promise((t,n)=>{this.dbx.filesDelete({path:s.getPathFromVirtual(e.path)}).then(()=>t(!0)).catch(n)})}}}),e("skylark-osjsv2-client/core/init",["./locales","./mount-manager","./settings-manager","./package-manager","./search-engine","./authenticator","./window-manager","./dialog","./storage","./process","./theme","./connection","../helpers/hooks","./config","../gui/splash","../utils/misc","../gui/menu","../gui/notification","../utils/preloader","../dialogs/alert","../dialogs/applicationchooser","../dialogs/color","../dialogs/confirm","../dialogs/error","../dialogs/fileinfo","../dialogs/file","../dialogs/fileprogress","../dialogs/fileupload","../dialogs/font","../dialogs/input","../vfs/fs","../vfs/transports/web","../vfs/transports/osjs","../vfs/transports/dist","../vfs/transports/applications","../vfs/transports/webdav","../vfs/transports/google-drive","../vfs/transports/onedrive","../vfs/transports/dropbox"],function(e,t,n,i,r,o,s,a,l,c,u,d,h,p,g,m,f,_,w,b,E,y,v,S,L,A,O,R,I,T,C,x,N,P,F,k,D,M,$){"use strict";const U=!1;function j(){const e={web:k.default,osjs:M.default,dist:P.default,applications:F.default,webdav:k.default,"google-drive":D.default,onedrive:M.default,dropbox:$.default};return e}Promise.each=function(e,t){return Array.isArray(e)?0===e.length?Promise.resolve():e.reduce(function(e,n,i){return e.then(()=>t(n,i))},Promise.resolve()):Promise.reject(new Error("Non array passed to each"))};let B=!1,G=!1;function V(e,t,n,i,r){if(r=(()=>!!p.getConfig("BugReporting.enabled")&&(void 0!==r&&!!r))(),f.blur(),i instanceof Error&&i.message.match(/^Script Error/i)&&String(i.lineNumber).match(/^0/))return void console.error("VENDOR ERROR",{title:e,message:t,error:n,exception:i});console.error(e,t,n,i);const o=U&&window.location.hash.match(/mocha=true/);o||function(){const o=s.instance;if(o&&o._fullyLoaded)try{return a.create("Error",{title:e,message:t,error:n,exception:i,bugreport:r}),!0}catch(e){console.warn("An error occured while creating Error Dialog",e),console.warn("stack",e.stack)}return!1}()||window.alert(e+"\n\n"+t+"\n\n"+n)}const W=e=>new Promise((t,n)=>{const i=e=>e.reduce((e,t)=>e.concat(Array.isArray(t)?i(t):t),[]);w.preload(i(e.Preloads)).then(e=>t()).catch(n)}),q=e=>new Promise((t,n)=>{const i=e.Connection;let r,o,s;console.log({authenticator:i.Authenticator,connection:i.Connection,storage:i.Storage});let a=-1!==i.Connection.split("+").indexOf("ws")?"ws":"http";try{r=OSjs.require("core/auth/"+i.Authenticator),o=OSjs.require("core/connections/"+a),s=OSjs.require("core/storage/"+i.Storage)}catch(e){return void n(e)}const l=new o,c=new r,u=new s;Promise.each([l,u,c],e=>e.init()).then(t).catch(n)}),z=e=>new Promise((e,i)=>{const r=n.instance("VFS").get("mounts",[]);t.init(j).then(n=>t.addList(r).then(t=>e(t)).catch(t=>{console.warn("A module failed to load!",t),e()})).catch(i)}),H=e=>new Promise((t,i)=>{const r=e.SettingsManager||{};Object.keys(r).forEach(function(e){console.debug("initSettingsManager()","initializes pool",e,r[e]),n.instance(e,r[e]||{})}),t()}),Y=e=>new Promise((t,n)=>{const r=e.PreloadOnBoot||[];let s={};try{s=OSjs.getManifest()}catch(e){}const a=o.instance;i.init(o,C,s,a.isStandalone).then(()=>Promise.each(r,e=>new Promise(t=>{var n=i.getPackage(e);n&&n.preload?w.preload(n.preload).then(t).catch(()=>t()):t()})).then(t).catch(n)).catch(n)}),K=e=>new Promise((e,t)=>{const n=i.getPackages();(()=>new Promise((e,t)=>{let i=[];Object.keys(n).forEach(e=>{const t=n[e];"extension"===t.type&&t.preload&&(i=i.concat(t.preload))}),i.length?w.preload(i).then(e).catch(()=>e()):e()}))().then(()=>(()=>new Promise((e,t)=>{const i=Object.keys(OSjs.Extensions);Promise.each(i,e=>new Promise((t,i)=>{try{const i=n[e];let r=OSjs.Extensions[e].init(i);r instanceof Promise||(r=Promise.resolve(!0)),r.then(t).catch(e=>(console.error(e),t(!1)))}catch(e){console.warn("Extension init failed",e.stack,e),t(!1)}})).then(e).catch(e=>{console.warn(e),t(new Error(e))})}))().then(e).catch(t)).catch(()=>e())}),X=e=>new Promise((e,t)=>{r.init().then(e).catch(t)}),J=e=>new Promise((e,t)=>{["containers","visual","tabs","richtext","misc","inputs","treeview","listview","iconview","fileview","menus"].forEach(e=>{const t=OSjs.require("gui/elements/"+e);Object.keys(t).forEach(e=>{t[e].register()})}),OSjs.error=V,OSjs.Dialogs.Alert=b,OSjs.Dialogs.ApplicationChooser=E,OSjs.Dialogs.Color=y,OSjs.Dialogs.Confirm=v,OSjs.Dialogs.Error=S,OSjs.Dialogs.File=A,OSjs.Dialogs.FileInfo=L,OSjs.Dialogs.FileProgress=O,OSjs.Dialogs.FileUpload=R,OSjs.Dialogs.Font=I,OSjs.Dialogs.Input=T,u.init(C),e()}),Z=t=>new Promise((n,i)=>{const r=t.WindowManager;r&&r.exec?c.create(r.exec,r.args||{}).then(e=>e.setup().then(n).catch(i)).catch(t=>{i(new Error(e._("ERR_CORE_INIT_WM_FAILED_FMT",t)))}):i(new Error(e._("ERR_CORE_INIT_NO_WM")))}),Q=e=>new Promise((e,t)=>{const n=document.createElement("div");n.id="mocha",document.body.appendChild(n),document.body.style.overflow="auto",document.body.style.backgroundColor="#ffffff",w.preload(["/test.css","/test.js"]).then(()=>{OSjs.runTests()}),e(!0)});function ee(e){if(e&&e.data&&void 0!==e.data.message&&"number"==typeof e.data.pid){console.debug("window::message()",e.data);var t=c.getProcess(e.data.pid);if(t&&("function"==typeof t.onPostMessage&&t.onPostMessage(e.data.message,e),"function"==typeof t._getWindow)){var n=t._getWindow(e.data.wid,"wid");n&&n.onPostMessage(e.data.message,e)}}}function te(){if(B||G)return;B=!0,console.info("Starting OS.js");const t=OSjs.getConfig(),n=U&&window.location.hash.match(/mocha=true/);e.init(t.Locale,t.LocaleOptions,t.Languages),g.watermark(t),g.show(),h.triggerHook("initialize"),Promise.each([W,q,z,H,Y,K,X,J,n?Q:Z],(e,n)=>new Promise((i,r)=>(console.group("Initializing",n+1,"of",9),g.update(n,9),e(t).then(e=>(console.groupEnd(),i(e))).catch(e=>(console.warn(e),console.groupEnd(),r(new Error(e))))))).then(()=>{if(console.info("Done!"),window.addEventListener("message",ee,!1),h.triggerHook("initialized"),g.hide(),!n){u.playSound("LOGIN");var e=s.instance;e&&(e._fullyLoaded=!0),function(e){console.debug("initSession()");var t=[];try{t=e.AutoStart}catch(e){console.warn("initSession()->autostart()","exception",e,e.stack)}var n={},i=[];return t.forEach(function(e,r){"string"==typeof e&&(e=t[r]={name:e}),-1===i.indexOf(e.name)&&(n[e.name]||(n[e.name]=r,i.push(e.name)))}),new Promise(e=>{l.instance.getLastSession(getLastSession).then(i=>(i.forEach(function(e){if(void 0===n[e.name])t.push(e);else if(e.args){var i=n[e.name],r=t[i];r.args||(r.args={}),r.args=m.mergeObject(r.args,e.args)}}),console.info("initSession()->autostart()",t),c.createFromArray(t).then(e).catch(e))).catch(t=>{console.warn(t),e()})})}(t).then(()=>h.triggerHook("sessionLoaded"))}return!0}).catch(t=>{const n=e._("ERR_CORE_INIT_FAILED"),i=e._("ERR_CORE_INIT_FAILED_DESC");alert(n+"\n\n"+i),console.error(n,i,t)})}function ne(e=!1){if(G||!B)return;G=!0,B=!1,window.removeEventListener("message",ee,!1);const t=s.instance;t&&t.toggleFullscreen(),w.clear(),f.blur(),c.killAll(),r.destroy(),i.destroy(),o.instance.destroy(),l.instance.destroy(),d.instance.destroy(),h.triggerHook("shutdown"),console.warn("OS.js was shut down!"),e||!0!==p.getConfig("ReloadOnShutdown")||window.location.reload()}return{start:te,stop:ne,restart:function(e=!1){const t=e=>o.instance.logout().then(e).catch(e);(e&&l.instance?function(e){l.instance.saveSession().then(()=>t(e)).catch(()=>t(e))}:t)(function(){console.clear(),ne(!0),te()})},logout:function(){const t=l.instance;function i(e){u.playSound("LOGOUT");const i=e=>o.instance.logout().then(e).catch(e);e?t.saveSession(c,n).then(()=>i(ne)).catch(()=>i(ne)):i(ne)}if(s.instance){const t=o.instance.getUser()||{name:e._("LBL_UNKNOWN")};a.create("Confirm",{title:e._("DIALOG_LOGOUT_TITLE"),message:e._("DIALOG_LOGOUT_MSG_FMT",t.name)},function(e,t){-1!==["no","yes"].indexOf(t)&&i("yes"===t)})}else i(!0)},running:function(){return!G}}}),e("skylark-osjsv2-client/utils/pepjs",[],function(){"use strict";var e=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pageX","pageY"],t=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0];function n(n,i){i=i||Object.create(null);var r=document.createEvent("Event");r.initEvent(n,i.bubbles||!1,i.cancelable||!1);for(var o,s=2;s<e.length;s++)o=e[s],r[o]=i[o]||t[s];r.buttons=i.buttons||0;var a=0;return a=i.pressure&&r.buttons?i.pressure:r.buttons?.5:0,r.x=r.clientX,r.y=r.clientY,r.pointerId=i.pointerId||0,r.width=i.width||0,r.height=i.height||0,r.pressure=a,r.tiltX=i.tiltX||0,r.tiltY=i.tiltY||0,r.twist=i.twist||0,r.tangentialPressure=i.tangentialPressure||0,r.pointerType=i.pointerType||"",r.hwTimestamp=i.hwTimestamp||0,r.isPrimary=i.isPrimary||!1,r}var i=window.Map&&window.Map.prototype.forEach,r=i?Map:o;function o(){this.array=[],this.size=0}o.prototype={set:function(e,t){if(void 0===t)return this.delete(e);this.has(e)||this.size++,this.array[e]=t},has:function(e){return void 0!==this.array[e]},delete:function(e){this.has(e)&&(delete this.array[e],this.size--)},get:function(e){return this.array[e]},clear:function(){this.array.length=0,this.size=0},forEach:function(e,t){return this.array.forEach(function(n,i){e.call(t,n,i,this)},this)}};var s=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","buttons","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","type","target","currentTarget","which","pageX","pageY","timeStamp"],a=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],l={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},c="undefined"!=typeof SVGElementInstance,u={pointermap:new r,eventMap:Object.create(null),captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(e,t){var n=t,i=n.events;i&&(i.forEach(function(e){n[e]&&(this.eventMap[e]=n[e].bind(n))},this),this.eventSources[e]=n,this.eventSourceList.push(n))},register:function(e){for(var t,n=this.eventSourceList.length,i=0;i<n&&(t=this.eventSourceList[i]);i++)t.register.call(t,e)},unregister:function(e){for(var t,n=this.eventSourceList.length,i=0;i<n&&(t=this.eventSourceList[i]);i++)t.unregister.call(t,e)},contains:function(e,t){try{return e.contains(t)}catch(e){return!1}},down:function(e){e.bubbles=!0,this.fireEvent("pointerdown",e)},move:function(e){e.bubbles=!0,this.fireEvent("pointermove",e)},up:function(e){e.bubbles=!0,this.fireEvent("pointerup",e)},enter:function(e){e.bubbles=!1,this.fireEvent("pointerenter",e)},leave:function(e){e.bubbles=!1,this.fireEvent("pointerleave",e)},over:function(e){e.bubbles=!0,this.fireEvent("pointerover",e)},out:function(e){e.bubbles=!0,this.fireEvent("pointerout",e)},cancel:function(e){e.bubbles=!0,this.fireEvent("pointercancel",e)},leaveOut:function(e){this.out(e),this.propagate(e,this.leave,!1)},enterOver:function(e){this.over(e),this.propagate(e,this.enter,!0)},eventHandler:function(e){if(!e._handledByPE){var t=e.type,n=this.eventMap&&this.eventMap[t];n&&n(e),e._handledByPE=!0}},listen:function(e,t){t.forEach(function(t){this.addEvent(e,t)},this)},unlisten:function(e,t){t.forEach(function(t){this.removeEvent(e,t)},this)},addEvent:function(e,t){e.addEventListener(t,this.boundHandler)},removeEvent:function(e,t){e.removeEventListener(t,this.boundHandler)},makeEvent:function(e,t){this.captureInfo[t.pointerId]&&(t.relatedTarget=null);var i=new n(e,t);return t.preventDefault&&(i.preventDefault=t.preventDefault),i._target=i._target||t.target,i},fireEvent:function(e,t){var n=this.makeEvent(e,t);return this.dispatchEvent(n)},cloneEvent:function(e){for(var t,n=Object.create(null),i=0;i<s.length;i++)n[t=s[i]]=e[t]||a[i],!c||"target"!==t&&"relatedTarget"!==t||n[t]instanceof SVGElementInstance&&(n[t]=n[t].correspondingUseElement);return e.preventDefault&&(n.preventDefault=function(){e.preventDefault()}),n},getTarget:function(e){var t=this.captureInfo[e.pointerId];return t?e._target!==t&&e.type in l?void 0:t:e._target},propagate:function(e,t,n){for(var i=e.target,r=[];i!==document&&!i.contains(e.relatedTarget);)if(r.push(i),!(i=i.parentNode))return;n&&r.reverse(),r.forEach(function(n){e.target=n,t.call(this,e)},this)},setCapture:function(e,t,i){this.captureInfo[e]&&this.releaseCapture(e,i),this.captureInfo[e]=t,this.implicitRelease=this.releaseCapture.bind(this,e,i),document.addEventListener("pointerup",this.implicitRelease),document.addEventListener("pointercancel",this.implicitRelease);var r=new n("gotpointercapture");r.pointerId=e,r._target=t,i||this.asyncDispatchEvent(r)},releaseCapture:function(e,t){var i=this.captureInfo[e];if(i){this.captureInfo[e]=void 0,document.removeEventListener("pointerup",this.implicitRelease),document.removeEventListener("pointercancel",this.implicitRelease);var r=new n("lostpointercapture");r.pointerId=e,r._target=i,t||this.asyncDispatchEvent(r)}},dispatchEvent:function(e){var t=this.getTarget(e);if(t)return t.dispatchEvent(e)},asyncDispatchEvent:function(e){requestAnimationFrame(this.dispatchEvent.bind(this,e))}};u.boundHandler=u.eventHandler.bind(u);var d={shadow:function(e){if(e)return e.shadowRoot||e.webkitShadowRoot},canTarget:function(e){return e&&Boolean(e.elementFromPoint)},targetingShadow:function(e){var t=this.shadow(e);if(this.canTarget(t))return t},olderShadow:function(e){var t=e.olderShadowRoot;if(!t){var n=e.querySelector("shadow");n&&(t=n.olderShadowRoot)}return t},allShadows:function(e){for(var t=[],n=this.shadow(e);n;)t.push(n),n=this.olderShadow(n);return t},searchRoot:function(e,t,n){if(e){var i,r,o=e.elementFromPoint(t,n);for(r=this.targetingShadow(o);r;){if(i=r.elementFromPoint(t,n)){var s=this.targetingShadow(i);return this.searchRoot(s,t,n)||i}r=this.olderShadow(r)}return o}},owner:function(e){for(var t=e;t.parentNode;)t=t.parentNode;return t.nodeType!==Node.DOCUMENT_NODE&&t.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(t=document),t},findTarget:function(e){var t=e.clientX,n=e.clientY,i=this.owner(e.target);return i.elementFromPoint(t,n)||(i=document),this.searchRoot(i,t,n)}},h=Array.prototype.forEach.call.bind(Array.prototype.forEach),p=Array.prototype.map.call.bind(Array.prototype.map),g=Array.prototype.slice.call.bind(Array.prototype.slice),m=Array.prototype.filter.call.bind(Array.prototype.filter),f=window.MutationObserver||window.WebKitMutationObserver,_={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};function w(e,t,n,i){this.addCallback=e.bind(i),this.removeCallback=t.bind(i),this.changedCallback=n.bind(i),f&&(this.observer=new f(this.mutationWatcher.bind(this)))}function b(e){return"body /shadow-deep/ "+E(e)}function E(e){return'[touch-action="'+e+'"]'}function y(e){return"{ -ms-touch-action: "+e+"; touch-action: "+e+"; }"}w.prototype={watchSubtree:function(e){this.observer&&d.canTarget(e)&&this.observer.observe(e,_)},enableOnSubtree:function(e){this.watchSubtree(e),e===document&&"complete"!==document.readyState?this.installOnLoad():this.installNewSubtree(e)},installNewSubtree:function(e){h(this.findElements(e),this.addElement,this)},findElements:function(e){return e.querySelectorAll?e.querySelectorAll("[touch-action]"):[]},removeElement:function(e){this.removeCallback(e)},addElement:function(e){this.addCallback(e)},elementChanged:function(e,t){this.changedCallback(e,t)},concatLists:function(e,t){return e.concat(g(t))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===document.readyState&&this.installNewSubtree(document)}.bind(this))},isElement:function(e){return e.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(e){var t=p(e,this.findElements,this);return t.push(m(e,this.isElement)),t.reduce(this.concatLists,[])},mutationWatcher:function(e){e.forEach(this.mutationHandler,this)},mutationHandler:function(e){if("childList"===e.type){var t=this.flattenMutationTree(e.addedNodes);t.forEach(this.addElement,this);var n=this.flattenMutationTree(e.removedNodes);n.forEach(this.removeElement,this)}else"attributes"===e.type&&this.elementChanged(e.target,e.oldValue)}};var v=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],S="",L=window.PointerEvent||window.MSPointerEvent,A=!window.ShadowDOMPolyfill&&document.head.createShadowRoot;var O=u.pointermap,R=[1,4,2,8,16],I=!1;try{I=1===new MouseEvent("test",{buttons:1}).buttons}catch(e){}var T,C={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(e){u.listen(e,this.events)},unregister:function(e){u.unlisten(e,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(e){for(var t,n=this.lastTouches,i=e.clientX,r=e.clientY,o=0,s=n.length;o<s&&(t=n[o]);o++){var a=Math.abs(i-t.x),l=Math.abs(r-t.y);if(a<=25&&l<=25)return!0}},prepareEvent:function(e){var t=u.cloneEvent(e),n=t.preventDefault;return t.preventDefault=function(){e.preventDefault(),n()},t.pointerId=this.POINTER_ID,t.isPrimary=!0,t.pointerType=this.POINTER_TYPE,t},prepareButtonsForMove:function(e,t){var n=O.get(this.POINTER_ID);0!==t.which&&n?e.buttons=n.buttons:e.buttons=0,t.buttons=e.buttons},mousedown:function(e){if(!this.isEventSimulatedFromTouch(e)){var t=O.get(this.POINTER_ID),n=this.prepareEvent(e);I||(n.buttons=R[n.button],t&&(n.buttons|=t.buttons),e.buttons=n.buttons),O.set(this.POINTER_ID,e),t&&0!==t.buttons?u.move(n):u.down(n)}},mousemove:function(e){if(!this.isEventSimulatedFromTouch(e)){var t=this.prepareEvent(e);I||this.prepareButtonsForMove(t,e),t.button=-1,O.set(this.POINTER_ID,e),u.move(t)}},mouseup:function(e){if(!this.isEventSimulatedFromTouch(e)){var t=O.get(this.POINTER_ID),n=this.prepareEvent(e);if(!I){var i=R[n.button];n.buttons=t?t.buttons&~i:0,e.buttons=n.buttons}O.set(this.POINTER_ID,e),n.buttons&=~R[n.button],0===n.buttons?u.up(n):u.move(n)}},mouseover:function(e){if(!this.isEventSimulatedFromTouch(e)){var t=this.prepareEvent(e);I||this.prepareButtonsForMove(t,e),t.button=-1,O.set(this.POINTER_ID,e),u.enterOver(t)}},mouseout:function(e){if(!this.isEventSimulatedFromTouch(e)){var t=this.prepareEvent(e);I||this.prepareButtonsForMove(t,e),t.button=-1,u.leaveOut(t)}},cancel:function(e){var t=this.prepareEvent(e);u.cancel(t),this.deactivateMouse()},deactivateMouse:function(){O.delete(this.POINTER_ID)}},x=u.captureInfo,N=d.findTarget.bind(d),P=d.allShadows.bind(d),F=u.pointermap,k={events:["touchstart","touchmove","touchend","touchcancel"],register:function(e){T.enableOnSubtree(e)},unregister:function(){},elementAdded:function(e){var t=e.getAttribute("touch-action"),n=this.touchActionToScrollType(t);n&&(e._scrollType=n,u.listen(e,this.events),P(e).forEach(function(e){e._scrollType=n,u.listen(e,this.events)},this))},elementRemoved:function(e){e._scrollType=void 0,u.unlisten(e,this.events),P(e).forEach(function(e){e._scrollType=void 0,u.unlisten(e,this.events)},this)},elementChanged:function(e,t){var n=e.getAttribute("touch-action"),i=this.touchActionToScrollType(n),r=this.touchActionToScrollType(t);i&&r?(e._scrollType=i,P(e).forEach(function(e){e._scrollType=i},this)):r?this.elementRemoved(e):i&&this.elementAdded(e)},scrollTypes:{EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(e){var t=e,n=this.scrollTypes;return"none"===t?"none":t===n.XSCROLLER?"X":t===n.YSCROLLER?"Y":n.SCROLLER.exec(t)?"XY":void 0},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(e){return this.firstTouch===e.identifier},setPrimaryTouch:function(e){(0===F.size||1===F.size&&F.has(1))&&(this.firstTouch=e.identifier,this.firstXY={X:e.clientX,Y:e.clientY},this.scrolling=!1,this.cancelResetClickCount())},removePrimaryPointer:function(e){e.isPrimary&&(this.firstTouch=null,this.firstXY=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var e=function(){this.clickCount=0,this.resetId=null}.bind(this);this.resetId=setTimeout(e,200)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(e){var t=0;return"touchstart"!==e&&"touchmove"!==e||(t=1),t},touchToPointer:function(e){var t=this.currentTouchEvent,n=u.cloneEvent(e),i=n.pointerId=e.identifier+2;n.target=x[i]||N(n),n.bubbles=!0,n.cancelable=!0,n.detail=this.clickCount,n.button=0,n.buttons=this.typeToButtons(t.type),n.width=2*(e.radiusX||e.webkitRadiusX||0),n.height=2*(e.radiusY||e.webkitRadiusY||0),n.pressure=e.force||e.webkitForce||.5,n.isPrimary=this.isPrimaryTouch(e),n.pointerType=this.POINTER_TYPE,n.altKey=t.altKey,n.ctrlKey=t.ctrlKey,n.metaKey=t.metaKey,n.shiftKey=t.shiftKey;var r=this;return n.preventDefault=function(){r.scrolling=!1,r.firstXY=null,t.preventDefault()},n},processTouches:function(e,t){var n=e.changedTouches;this.currentTouchEvent=e;for(var i,r=0;r<n.length;r++)i=n[r],t.call(this,this.touchToPointer(i))},shouldScroll:function(e){if(this.firstXY){var t,n=e.currentTarget._scrollType;if("none"===n)t=!1;else if("XY"===n)t=!0;else{var i=e.changedTouches[0],r=n,o="Y"===n?"X":"Y",s=Math.abs(i["client"+r]-this.firstXY[r]),a=Math.abs(i["client"+o]-this.firstXY[o]);t=s>=a}return this.firstXY=null,t}},findTouch:function(e,t){for(var n,i=0,r=e.length;i<r&&(n=e[i]);i++)if(n.identifier===t)return!0},vacuumTouches:function(e){var t=e.touches;if(F.size>=t.length){var n=[];F.forEach(function(e,i){if(1!==i&&!this.findTouch(t,i-2)){var r=e.out;n.push(r)}},this),n.forEach(this.cancelOut,this)}},touchstart:function(e){this.vacuumTouches(e),this.setPrimaryTouch(e.changedTouches[0]),this.dedupSynthMouse(e),this.scrolling||(this.clickCount++,this.processTouches(e,this.overDown))},overDown:function(e){F.set(e.pointerId,{target:e.target,out:e,outTarget:e.target}),u.enterOver(e),u.down(e)},touchmove:function(e){this.scrolling||(this.shouldScroll(e)?(this.scrolling=!0,this.touchcancel(e)):(e.preventDefault(),this.processTouches(e,this.moveOverOut)))},moveOverOut:function(e){var t=e,n=F.get(t.pointerId);if(n){var i=n.out,r=n.outTarget;u.move(t),i&&r!==t.target&&(i.relatedTarget=t.target,t.relatedTarget=r,i.target=r,t.target?(u.leaveOut(i),u.enterOver(t)):(t.target=r,t.relatedTarget=null,this.cancelOut(t))),n.out=t,n.outTarget=t.target}},touchend:function(e){this.dedupSynthMouse(e),this.processTouches(e,this.upOut)},upOut:function(e){this.scrolling||(u.up(e),u.leaveOut(e)),this.cleanUpPointer(e)},touchcancel:function(e){this.processTouches(e,this.cancelOut)},cancelOut:function(e){u.cancel(e),u.leaveOut(e),this.cleanUpPointer(e)},cleanUpPointer:function(e){F.delete(e.pointerId),this.removePrimaryPointer(e)},dedupSynthMouse:function(e){var t=C.lastTouches,n=e.changedTouches[0];if(this.isPrimaryTouch(n)){var i={x:n.clientX,y:n.clientY};t.push(i);var r=function(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)}.bind(null,t,i);setTimeout(r,2500)}}};T=new w(k.elementAdded,k.elementRemoved,k.elementChanged,k);var D=u.pointermap,M=window.MSPointerEvent&&"number"==typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,$={events:["MSPointerDown","MSPointerMove","MSPointerUp","MSPointerOut","MSPointerOver","MSPointerCancel","MSGotPointerCapture","MSLostPointerCapture"],register:function(e){u.listen(e,this.events)},unregister:function(e){u.unlisten(e,this.events)},POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(e){var t=e;return M&&((t=u.cloneEvent(e)).pointerType=this.POINTER_TYPES[e.pointerType]),t},cleanup:function(e){D.delete(e)},MSPointerDown:function(e){D.set(e.pointerId,e);var t=this.prepareEvent(e);u.down(t)},MSPointerMove:function(e){var t=this.prepareEvent(e);u.move(t)},MSPointerUp:function(e){var t=this.prepareEvent(e);u.up(t),this.cleanup(e.pointerId)},MSPointerOut:function(e){var t=this.prepareEvent(e);u.leaveOut(t)},MSPointerOver:function(e){var t=this.prepareEvent(e);u.enterOver(t)},MSPointerCancel:function(e){var t=this.prepareEvent(e);u.cancel(t),this.cleanup(e.pointerId)},MSLostPointerCapture:function(e){var t=u.makeEvent("lostpointercapture",e);u.dispatchEvent(t)},MSGotPointerCapture:function(e){var t=u.makeEvent("gotpointercapture",e);u.dispatchEvent(t)}};var U,j,B,G=window.navigator;function V(e){if(!u.pointermap.has(e)){var t=new Error("InvalidPointerId");throw t.name="InvalidPointerId",t}}function W(e){for(var t=e.parentNode;t&&t!==e.ownerDocument;)t=t.parentNode;if(!t){var n=new Error("InvalidStateError");throw n.name="InvalidStateError",n}}function q(e){var t=u.pointermap.get(e);return 0!==t.buttons}G.msPointerEnabled?(U=function(e){V(e),W(this),q(e)&&(u.setCapture(e,this,!0),this.msSetPointerCapture(e))},j=function(e){V(e),u.releaseCapture(e,!0),this.msReleasePointerCapture(e)}):(U=function(e){V(e),W(this),q(e)&&u.setCapture(e,this)},j=function(e){V(e),u.releaseCapture(e)}),B=function(e){return!!u.captureInfo[e]},function(){if(L){v.forEach(function(e){String(e)===e?(S+=E(e)+y(e)+"\n",A&&(S+=b(e)+y(e)+"\n")):(S+=e.selectors.map(E)+y(e.rule)+"\n",A&&(S+=e.selectors.map(b)+y(e.rule)+"\n"))});var e=document.createElement("style");e.textContent=S,document.head.appendChild(e)}}(),function(){if(!window.PointerEvent){if(window.PointerEvent=n,window.navigator.msPointerEnabled){var e=window.navigator.msMaxTouchPoints;Object.defineProperty(window.navigator,"maxTouchPoints",{value:e,enumerable:!0}),u.registerSource("ms",$)}else Object.defineProperty(window.navigator,"maxTouchPoints",{value:0,enumerable:!0}),u.registerSource("mouse",C),void 0!==window.ontouchstart&&u.registerSource("touch",k);u.register(document)}}(),window.Element&&!Element.prototype.setPointerCapture&&Object.defineProperties(Element.prototype,{setPointerCapture:{value:U},releasePointerCapture:{value:j},hasPointerCapture:{value:B}});var z={dispatcher:u,Installer:w,PointerEvent:n,PointerMap:r,targetFinding:d};return z}),e("skylark-osjsv2-client/boot",["./core/init","./utils/pepjs"],function(e){"use strict";window.OSjs=Object.assign({error:(e,t,n,i,r)=>{console.error(e,t,n,i)},runTests:()=>{},getConfig:()=>({}),getManifest:()=>({}),Themes:{},Dialogs:{},Locales:{},Extensions:{},Applications:{}},window.OSjs||{}),window.OSjs.require=(e=>{const t=require("skylark-osjsv2-client/"+e);return t}),"loading"!==document.readyState?e.start():document.addEventListener("DOMContentLoaded",()=>e.start())}),e("skylark-osjsv2-client/locales/en_EN",[],function(){return{ERR_FILE_OPEN:"Error opening file",ERR_WM_NOT_RUNNING:"Window manager is not running",ERR_FILE_OPEN_FMT:"The file '**{0}**' could not be opened",ERR_APP_MIME_NOT_FOUND_FMT:"Could not find any Applications with support for '{0}' files",ERR_APP_LAUNCH_FAILED:"Failed to launch Application",ERR_APP_LAUNCH_FAILED_FMT:"An error occured while trying to launch: {0}",ERR_APP_CONSTRUCT_FAILED_FMT:"Application '{0}' construct failed: {1}",ERR_APP_INIT_FAILED_FMT:"Application '{0}' init() failed: {1}",ERR_APP_RESOURCES_MISSING_FMT:"Application resources missing for '{0}' or it failed to load!",ERR_APP_PRELOAD_FAILED_FMT:"Application '{0}' preloading failed: \n{1}",ERR_APP_LAUNCH_ALREADY_RUNNING_FMT:"The application '{0}' is already launched and allows only one instance!",ERR_APP_LAUNCH_MANIFEST_FAILED_FMT:"Failed to launch '{0}'. Application manifest data not found!",ERR_APP_LAUNCH_COMPABILITY_FAILED_FMT:"Failed to launch '{0}'. Your browser does not support: {1}",ERR_NO_WM_RUNNING:"No window manager is running",ERR_CORE_INIT_FAILED:"Failed to initialize OS.js",ERR_CORE_INIT_FAILED_DESC:"An error occured while initializing OS.js",ERR_CORE_INIT_NO_WM:"Cannot launch OS.js: No window manager defined!",ERR_CORE_INIT_WM_FAILED_FMT:"Cannot launch OS.js: Failed to launch Window Manager: {0}",ERR_CORE_INIT_PRELOAD_FAILED:"Cannot launch OS.js: Failed to preload resources...",ERR_JAVASCRIPT_EXCEPTION:"JavaScript Error Report",ERR_JAVACSRIPT_EXCEPTION_DESC:"An unexpected error occured, maybe a bug.",ERR_APP_API_ERROR:"Application API error",ERR_APP_API_ERROR_DESC_FMT:"Application {0} failed to perform operation '{1}'",ERR_APP_MISSING_ARGUMENT_FMT:"Missing argument: {0}",ERR_APP_UNKNOWN_ERROR:"Unknown error",ERR_OPERATION_TIMEOUT:"Operation Timeout",ERR_OPERATION_TIMEOUT_FMT:"Operation Timeout ({0})",ERR_ARGUMENT_FMT:"'{0}' expects '{1}' to be a '{2}', '{3}' given",ERR_INVALID_LOCATION:"Invalid location",ERR_WIN_DUPLICATE_FMT:"You already have a Window named '{0}'",WINDOW_MINIMIZE:"Minimize",WINDOW_MAXIMIZE:"Maximize",WINDOW_RESTORE:"Restore",WINDOW_CLOSE:"Close",WINDOW_ONTOP_ON:"Ontop (Enable)",WINDOW_ONTOP_OFF:"Ontop (Disable)",TITLE_SIGN_OUT:"Sign out",TITLE_SIGNED_IN_AS_FMT:"Signed in as: {0}",ERR_LOGIN_FMT:"Login error: {0}",ERR_LOGIN_INVALID:"Invalid login",ERR_NO_SESSION:"No session was created by the server. Do you want to retry login?",MSG_SESSION_WARNING:"Are you sure you want to quit OS.js? All unsaved settings and application data will be lost!",BUGREPORT_MSG:"Please report this if you think this is a bug.\nInclude a brief description on how the error occured, and if you can; how to replicate it",SERVICENOTIFICATION_TOOLTIP:"Logged into external services: {0}",CONNECTION_LOST:"Connection to the server was lost. Reconnecting...",CONNECTION_RESTORED:"Connection to the server was restored",CONNECTION_RESTORE_FAILED:"Failed to re-establish connection. Trying again.",CONNECTION_ERROR:"Connection error",ERR_UTILS_XHR_FATAL:"Fatal Error",ERR_UTILS_XHR_FMT:"AJAX/XHR Error: {0}",DIALOG_LOGOUT_TITLE:"Log out (Exit)",DIALOG_LOGOUT_MSG_FMT:"Logging out user '{0}'.\nDo you want to save current session?",DIALOG_CLOSE:"Close",DIALOG_CANCEL:"Cancel",DIALOG_APPLY:"Apply",DIALOG_OK:"OK",DIALOG_ALERT_TITLE:"Alert Dialog",DIALOG_COLOR_TITLE:"Color Dialog",DIALOG_COLOR_R:"Red: {0}",DIALOG_COLOR_G:"Green: {0}",DIALOG_COLOR_B:"Blue: {0}",DIALOG_COLOR_A:"Alpha: {0}",DIALOG_CONFIRM_TITLE:"Confirm Dialog",DIALOG_ERROR_TITLE:"Error",DIALOG_ERROR_MESSAGE:"Message",DIALOG_ERROR_SUMMARY:"Summary",DIALOG_ERROR_TRACE:"Trace",DIALOG_ERROR_BUGREPORT:"Report Bug",DIALOG_FILE_SAVE:"Save",DIALOG_FILE_OPEN:"Open",DIALOG_FILE_MKDIR:"New Folder",DIALOG_FILE_MKDIR_MSG:"Create a new directory in **{0}**",DIALOG_FILE_OVERWRITE:"Are you sure you want to overwrite the file '{0}'?",DIALOG_FILE_MNU_VIEWTYPE:"View type",DIALOG_FILE_MNU_LISTVIEW:"List View",DIALOG_FILE_MNU_TREEVIEW:"Tree View",DIALOG_FILE_MNU_ICONVIEW:"Icon View",DIALOG_FILE_ERROR:"FileDialog Error",DIALOG_FILE_ERROR_SCANDIR:"Failed listing directory '{0}' because an error occured",DIALOG_FILE_ERROR_FIND:"Failed searching directory '{0}' because an error occured",DIALOG_FILE_MISSING_FILENAME:"You need to select a file or enter new filename!",DIALOG_FILE_MISSING_SELECTION:"You need to select a file!",DIALOG_FILEINFO_TITLE:"File Information",DIALOG_FILEINFO_LOADING:"Loading file information for: {0}",DIALOG_FILEINFO_ERROR:"FileInformationDialog Error",DIALOG_FILEINFO_ERROR_LOOKUP:"Failed to get file information for **{0}**",DIALOG_FILEINFO_ERROR_LOOKUP_FMT:"Failed to get file information for: {0}",DIALOG_INPUT_TITLE:"Input Dialog",DIALOG_FILEPROGRESS_TITLE:"File Operation Progress",DIALOG_FILEPROGRESS_LOADING:"Loading...",DIALOG_UPLOAD_TITLE:"Upload Dialog",DIALOG_UPLOAD_DESC:"Upload file to **{0}**.<br />Maximum size: {1} bytes",DIALOG_UPLOAD_MSG_FMT:"Uploading '{0}' ({1} {2}) to {3}",DIALOG_UPLOAD_MSG:"Uploading file...",DIALOG_UPLOAD_FAILED:"Upload failed",DIALOG_UPLOAD_FAILED_MSG:"The upload has failed",DIALOG_UPLOAD_FAILED_UNKNOWN:"Reason unknown...",DIALOG_UPLOAD_FAILED_CANCELLED:"Cancelled by user...",DIALOG_UPLOAD_TOO_BIG:"File is too big",DIALOG_UPLOAD_TOO_BIG_FMT:"File is too big, exceeds {0}",DIALOG_FONT_TITLE:"Font Dialog",DIALOG_APPCHOOSER_TITLE:"Choose Application",DIALOG_APPCHOOSER_MSG:"Choose an application to open",DIALOG_APPCHOOSER_NO_SELECTION:"You need to select an application",DIALOG_APPCHOOSER_SET_DEFAULT:"Use as default application for {0}",GAPI_DISABLED:"GoogleAPI Module not configured or disabled",GAPI_SIGN_OUT:"Sign out from Google API Services",GAPI_REVOKE:"Revoke permissions and Sign Out",GAPI_AUTH_FAILURE:"Google API Authentication failed or did not take place",GAPI_AUTH_FAILURE_FMT:"Failed to authenticate: {0}:{1}",GAPI_LOAD_FAILURE:"Failed to load Google API",WLAPI_DISABLED:"Windows Live API module not configured or disabled",WLAPI_SIGN_OUT:"Sign out from Window Live API",WLAPI_LOAD_FAILURE:"Failed to load Windows Live API",WLAPI_LOGIN_FAILED:"Failed to log into Windows Live API",WLAPI_LOGIN_FAILED_FMT:"Failed to log into Windows Live API: {0}",WLAPI_INIT_FAILED_FMT:"Windows Live API returned {0} status",IDB_MISSING_DBNAME:"Cannot create IndexedDB without Database Name",IDB_NO_SUCH_ITEM:"No such item",ERR_VFS_FATAL:"Fatal Error",ERR_VFS_UNAVAILABLE:"Not available",ERR_VFS_FILE_ARGS:"File expects at least one argument",ERR_VFS_NUM_ARGS:"Not enough arguments",ERR_VFS_EXPECT_FILE:"Expects a file-object",ERR_VFS_EXPECT_SRC_FILE:"Expects a source file-object",ERR_VFS_EXPECT_DST_FILE:"Expects a destination file-object",ERR_VFS_FILE_EXISTS:"Destination already exists",ERR_VFS_TARGET_NOT_EXISTS:"Target does not exist",ERR_VFS_TRANSFER_FMT:"An error occured while transfering between storage: {0}",ERR_VFS_UPLOAD_NO_DEST:"Cannot upload a file without a destination",ERR_VFS_UPLOAD_NO_FILES:"Cannot upload without any files defined",ERR_VFS_UPLOAD_FAIL_FMT:"File upload failed: {0}",ERR_VFS_UPLOAD_CANCELLED:"File upload was cancelled",ERR_VFS_DOWNLOAD_NO_FILE:"Cannot download a path without a path",ERR_VFS_DOWNLOAD_FAILED:"An error occured while downloading: {0}",ERR_VFS_REMOTEREAD_EMPTY:"Response was empty",ERR_VFS_NO_MIME_DETECT:"No mime type detected",ERR_VFSMODULE_INVALID:"Invalid VFS Module",ERR_VFSMODULE_INVALID_FMT:"Invalid VFS Module: {0}",ERR_VFSMODULE_INVALID_METHOD:"Invalid VFS Method",ERR_VFSMODULE_INVALID_METHOD_FMT:"Invalid VFS Method: {0}",ERR_VFSMODULE_INVALID_TYPE:"Invalid VFS Module type",ERR_VFSMODULE_INVALID_TYPE_FMT:"Invalid VFS Module type: {0}",ERR_VFSMODULE_INVALID_CONFIG:"Invalid VFS Module configuration",ERR_VFSMODULE_INVALID_CONFIG_FMT:"Invalid VFS Module configuration: {0}",ERR_VFSMODULE_ALREADY_MOUNTED:"VFS Module already mounted",ERR_VFSMODULE_ALREADY_MOUNTED_FMT:"VFS Module '{0}' already mounted",ERR_VFSMODULE_NOT_MOUNTED:"VFS Module not mounted",ERR_VFSMODULE_NOT_MOUNTED_FMT:"VFS Module '{0}' not mounted",ERR_VFSMODULE_EXCEPTION:"VFS Module Exception",ERR_VFSMODULE_EXCEPTION_FMT:"VFS Module Exception: {0}",ERR_VFSMODULE_NOT_FOUND_FMT:"No VFS Module matches {0}. Wrong path or format ?",ERR_VFSMODULE_READONLY:"This VFS Module is read-only",ERR_VFSMODULE_READONLY_FMT:"This VFS Module is read-only: {0}",TOOLTIP_VFS_DOWNLOAD_NOTIFICATION:"Downloading file",ERR_VFSMODULE_XHR_ERROR:"XHR Error",ERR_VFSMODULE_ROOT_ID:"Failed to find root folder id",ERR_VFSMODULE_NOSUCH:"File does not exist",ERR_VFSMODULE_PARENT:"No such parent",ERR_VFSMODULE_PARENT_FMT:"Failed to look up parent: {0}",ERR_VFSMODULE_SCANDIR:"Failed to scan directory",ERR_VFSMODULE_SCANDIR_FMT:"Failed to scan directory: {0}",ERR_VFSMODULE_READ:"Failed to read file",ERR_VFSMODULE_READ_FMT:"Failed to read file: {0}",ERR_VFSMODULE_WRITE:"Failed to write file",ERR_VFSMODULE_WRITE_FMT:"Failed to write file: {0}",ERR_VFSMODULE_COPY:"Failed to copy",ERR_VFSMODULE_COPY_FMT:"Failed to copy: {0}",ERR_VFSMODULE_UNLINK:"Failed to unlink file",ERR_VFSMODULE_UNLINK_FMT:"Failed to unlink file: {0}",ERR_VFSMODULE_MOVE:"Failed to move file",ERR_VFSMODULE_MOVE_FMT:"Failed to move file: {0}",ERR_VFSMODULE_EXIST:"Failed to check file existence",ERR_VFSMODULE_EXIST_FMT:"Failed to check file existence: {0}",ERR_VFSMODULE_FILEINFO:"Failed to get file information",ERR_VFSMODULE_FILEINFO_FMT:"Failed to get file information: {0}",ERR_VFSMODULE_MKDIR:"Failed to create directory",ERR_VFSMODULE_MKDIR_FMT:"Failed to create directory: {0}",ERR_VFSMODULE_MKFILE:"Failed to create file",ERR_VFSMODULE_MKFILE_FMT:"Failed to create file: {0}",ERR_VFSMODULE_URL:"Failed to get URL for file",ERR_VFSMODULE_URL_FMT:"Failed to get URL for file: {0}",ERR_VFSMODULE_TRASH:"Failed to move file to trash",ERR_VFSMODULE_TRASH_FMT:"Failed to move file to trash: {0}",ERR_VFSMODULE_UNTRASH:"Failed to move file out of trash",ERR_VFSMODULE_UNTRASH_FMT:"Failed to move file out of trash: {0}",ERR_VFSMODULE_EMPTYTRASH:"Failed to empty trash",ERR_VFSMODULE_EMPTYTRASH_FMT:"Failed to empty trash: {0}",ERR_VFSMODULE_FIND:"Failed to search",ERR_VFSMODULE_FIND_FMT:"Failed to search: {0}",ERR_VFSMODULE_FREESPACE:"Failed to get free space",ERR_VFSMODULE_FREESPACE_FMT:"Failed to get free space: {0}",ERR_VFSMODULE_EXISTS:"Failed to check if exists",ERR_VFSMODULE_EXISTS_FMT:"Failed to check if exists: {0}",ERR_DROPBOX_API:"Failed to load Dropbox API",ERR_DROPBOX_AUTH:"Failed to authenticate via Dropbox",ERR_DROPBOX_KEY:"No Dropbox client key configured",DROPBOX_NOTIFICATION_TITLE:"You are signed in to Dropbox API",DROPBOX_SIGN_OUT:"Sign out from Google API Services",ONEDRIVE_ERR_RESOLVE:"Failed to resolve path: item not found",ZIP_PRELOAD_FAIL:"Failed to load zip.js",ZIP_VENDOR_FAIL:"zip.js library was not found. Did it load properly?",ZIP_NO_RESOURCE:"No zip resource was given",ZIP_NO_PATH:"No path given",SEARCH_LOADING:"Searching...",SEARCH_NO_RESULTS:"No results found",ERR_PACKAGE_EXISTS:"Package installation directory already exists. Cannot continue!",ERR_PACKAGE_MANIFEST:"Failed to load package manifest",ERR_PACKAGE_ENUM_FAILED:'Failed to get package list. Make sure you\'re not using "Private Mode" as this might case problems.',ERR_FILE_APP_OPEN:"Cannot open file",ERR_FILE_APP_OPEN_FMT:"The file {0} could not be opened because the mime {1} is not supported",ERR_FILE_APP_OPEN_ALT_FMT:"The file {0} could not be opened: {1}",ERR_FILE_APP_SAVE_ALT_FMT:"The file {0} could not be saved: {1}",ERR_GENERIC_APP_FMT:"{0} Application Error",ERR_GENERIC_APP_ACTION_FMT:"Failed to perform action '{0}'",ERR_GENERIC_APP_UNKNOWN:"Unknown Error",ERR_GENERIC_APP_REQUEST:"An error occured while handling your request",ERR_GENERIC_APP_FATAL_FMT:"Fatal Error: {0}",MSG_GENERIC_APP_DISCARD:"Discard changes?",MSG_FILE_CHANGED:"The file has changed. Reload?",MSG_APPLICATION_WARNING:"Application Warning",MSG_MIME_OVERRIDE:'The filetype "{0}" is not supported, using "{1}" instead.',ERR_OPEN_LOCATION:"Failed to open location",ERR_OPEN_LOCATION_FMT:"Failed to open location: {0}",LBL_UNKNOWN:"Unknown",LBL_APPEARANCE:"Appearance",LBL_USER:"User",LBL_NAME:"Name",LBL_APPLY:"Apply",LBL_FILENAME:"Filename",LBL_PATH:"Path",LBL_SIZE:"Size",LBL_TYPE:"Type",LBL_MIME:"MIME",LBL_LOADING:"Loading",LBL_SETTINGS:"Settings",LBL_ADD_FILE:"Add file",LBL_COMMENT:"Comment",LBL_ACCOUNT:"Account",LBL_CONNECT:"Connect",LBL_ONLINE:"Online",LBL_OFFLINE:"Offline",LBL_AWAY:"Away",LBL_BUSY:"Busy",LBL_CHAT:"Chat",LBL_HELP:"Help",LBL_ABOUT:"About",LBL_PANELS:"Panels",LBL_LOCALES:"Locales",LBL_THEME:"Theme",LBL_COLOR:"Color",LBL_PID:"PID",LBL_KILL:"Kill",LBL_ALIVE:"Alive",LBL_INDEX:"Index",LBL_ADD:"Add",LBL_FONT:"Font",LBL_YES:"Yes",LBL_NO:"No",LBL_CANCEL:"Cancel",LBL_TOP:"Top",LBL_LEFT:"Left",LBL_RIGHT:"Right",LBL_BOTTOM:"Bottom",LBL_CENTER:"Center",LBL_FILE:"File",LBL_NEW:"New",LBL_OPEN:"Open",LBL_SAVE:"Save",LBL_SAVEAS:"Save as...",LBL_CLOSE:"Close",LBL_MKDIR:"Create directory",LBL_UPLOAD:"Upload",LBL_VIEW:"View",LBL_EDIT:"Edit",LBL_RENAME:"Rename",LBL_DELETE:"Delete",LBL_OPENWITH:"Open With ...",LBL_ICONVIEW:"Icon View",LBL_TREEVIEW:"Tree View",LBL_LISTVIEW:"List View",LBL_REFRESH:"Refresh",LBL_VIEWTYPE:"View type",LBL_BOLD:"Bold",LBL_ITALIC:"Italic",LBL_UNDERLINE:"Underline",LBL_REGULAR:"Regular",LBL_STRIKE:"Strike",LBL_INDENT:"Indent",LBL_OUTDENT:"Outdate",LBL_UNDO:"Undo",LBL_REDO:"Redo",LBL_CUT:"Cut",LBL_UNLINK:"Unlink",LBL_COPY:"Copy",LBL_PASTE:"Paste",LBL_INSERT:"Insert",LBL_IMAGE:"Image",LBL_LINK:"Link",LBL_DISCONNECT:"Disconnect",LBL_APPLICATIONS:"Applications",LBL_ADD_FOLDER:"Add folder",LBL_INFORMATION:"Information",LBL_TEXT_COLOR:"Text Color",LBL_BACK_COLOR:"Back Color",LBL_RESET_DEFAULT:"Reset to defaults",LBL_DOWNLOAD_COMP:"Download to computer",LBL_ORDERED_LIST:"Ordered List",LBL_BACKGROUND_IMAGE:"Background Image",LBL_BACKGROUND_COLOR:"Background Color",LBL_UNORDERED_LIST:"Unordered List",LBL_STATUS:"Status",LBL_READONLY:"Read-Only",LBL_CREATED:"Created",LBL_MODIFIED:"Modified",LBL_SHOW_COLUMNS:"Show Columns",LBL_MOVE:"Move",LBL_OPTIONS:"Options",LBL_OK:"OK",LBL_DIRECTORY:"Directory",LBL_CREATE:"Create",LBL_BUGREPORT:"Bugreport",LBL_INSTALL:"Install",LBL_UPDATE:"Update",LBL_REMOVE:"Remove",LBL_SHOW_SIDEBAR:"Show sidebar",LBL_SHOW_NAVIGATION:"Show navigation",LBL_SHOW_HIDDENFILES:"Show hidden files",LBL_SHOW_FILEEXTENSIONS:"Show file extensions",LBL_MOUNT:"Mount",LBL_DESCRIPTION:"Description",LBL_USERNAME:"Username",LBL_PASSWORD:"Password",LBL_HOST:"Host",LBL_NAMESPACE:"Namespace",LBL_SEARCH:"Search",LBL_BACK:"Back",LBL_ICONS:"Icons",LBL_ICON:"Icon",LBL_UNINSTALL:"Uninstall",LBL_REGENERATE:"Regenerate",LBL_DESKTOP:"Desktop",LBL_WINDOWMANAGER:"Window Manager",LBL_HOTKEY:"Hotkey",LBL_HOTKEYS:"Hotkeys",LBL_MOUNTS:"Mounts",LBL_ID:"ID",LBL_APPLICATION:"Application",LBL_SCOPE:"Scope",LBL_HIDE:"Hide",LBL_REPOSITORY:"Repository",LBL_VERSION:"Version",LBL_AUTHOR:"Author",LBL_GROUPS:"Groups",LBL_AUTOHIDE:"Autohide",LBL_PERSONAL:"Personal",LBL_SYSTEM:"System",LBL_STARTING:"Starting",LBL_SOUNDS:"Sounds",LBL_STORE:"Store",LBL_LOCALE:"Locale",LBL_PACKAGE:"Package",LBL_PACKAGES:"Packages",LBL_INPUT:"Input",LBL_MISC:"Misc",LBL_OTHER:"Other",LBL_USERS:"Users",LBL_FONTS:"Fonts",LBL_OPEN_LOCATION:"Open Location",LBL_HOME:"Home",LBL_WIDGET:"Widget",LBL_WIDGETS:"Widgets",LBL_LOCK:"Lock",LBL_UNLOCK:"Unlock",LBL_WARNING:"Warning",LBL_INFO:"Info",LBL_POSITION:"Position",LBL_OPACITY:"Opactiy",LBL_ITEMS:"Items",LBL_ONTOP:"On top",LBL_BACKGROUND:"Background",LBL_QUIT:"Quit",LBL_EXIT:"Exit",LBL_WINDOWS:"Windows"}}),e("skylark-osjsv2-client/core/auth/database",["../authenticator"],function(e){"use strict";return class extends e{}}),e("skylark-osjsv2-client/core/auth/demo",["../authenticator"],function(e){"use strict";return class extends e{_getSettings(){let e,t={};for(let n=0;n<localStorage.length;n++)if((e=localStorage.key(n)).match(/^OSjs\//))try{t[e.replace(/^OSjs\//,"")]=JSON.parse(localStorage.getItem(e))}catch(e){console.warn("DemoAuthenticator::login()",e,e.stack)}return t}login(e){return new Promise((t,n)=>{super.login(e).then(e=>(e.userSettings=this._getSettings(),t(e))).catch(n)})}createUI(){return this.requestLogin({username:"demo",password:"demo"})}}}),e("skylark-osjsv2-client/core/auth/pam",["../authenticator"],function(e){"use strict";return class extends e{}}),e("skylark-osjsv2-client/core/auth/standalone",["./demo"],function(e){"use strict";return class extends e{constructor(){super(),this.isStandalone=!0}login(e){return Promise.resolve({userData:{id:1,username:"root",name:"Administrator User",groups:["admin"]},userSettings:this._getSettings(),blacklistedPackages:[]})}}}),e("skylark-osjsv2-client/core/connections/http",["../../vfs/fs","../../vfs/file","../connection"],function(e,t,n){"use strict";return class extends n{onVFSRequestCompleted(module,n,i,r,o){if(-1!==["upload","write","mkdir","copy","move","unlink"].indexOf(n)){const r="move"===n?{source:i[0]instanceof t?i[0]:null,destination:i[1]instanceof t?i[1]:null}:i["copy"===n?1:0];e.triggerWatch(n,r,o)}return super.onVFSRequestCompleted(...arguments)}}}),e("skylark-osjsv2-client/core/connections/standalone",["./http"],function(e){"use strict";return class extends e{createRequest(e,t,n){return"packages"===e?Promise.resolve({result:OSjs.getManifest()}):Promise.reject(new Error("You are currently running locally and cannot perform this operation!"))}}}),e("skylark-osjsv2-client/core/connections/ws",["../config","../locales","../../vfs/fs","../../vfs/file","../connection"],function(e,t,n,i,r){"use strict";return class extends r{constructor(){super(...arguments);const t=e.getConfig("Connection.WSPort"),n=e.getConfig("Connection.WSPath")||"";let i=window.location.protocol.replace("http","ws")+"//"+window.location.host;"upgrade"!==t&&(i.match(/:\d+$/)&&(i=i.replace(/:\d+$/,"")),i+=":"+t),i+=n,this.ws=null,this.wsurl=i,this.wsqueue={},this.destroying=!1}destroy(){return this.destroying||(this.ws&&this.ws.close(),this.ws=null,this.wsqueue={}),this.destroying=!0,super.destroy.apply(this,arguments)}init(){return this.destroying=!1,new Promise((e,t)=>{this._connect(!1,(n,i)=>{n?t(n instanceof Error?n:new Error(n)):e(i)})})}_connect(e,n){if(this.destroying||this.ws&&!e)return;console.info("Trying WebSocket Connection",this.wsurl);let i=!1;this.ws=new WebSocket(this.wsurl),this.ws.onopen=function(e){i=!0,setTimeout(()=>n(!1),0)},this.ws.onmessage=(e=>{console.debug("websocket open",e);const t=JSON.parse(e.data),n=t._index;this._onmessage(n,t)}),this.ws.onerror=(e=>{console.error("websocket error",e)}),this.ws.onclose=(e=>{console.debug("websocket close",e),i||3001===e.code?this._onclose():n(t._("CONNECTION_ERROR"))})}_onmessage(e,t){void 0===e?this.message(t):this.wsqueue[e]&&(delete t._index,this.wsqueue[e](!1,t),delete this.wsqueue[e])}_onclose(e){this.destroying||(this.onOffline(e),this.ws=null,setTimeout(()=>{this._connect(!0,t=>{t?this._onclose((e||0)+1):this.onOnline()})},e?1e4:1e3))}message(e){"vfs:watch"===e.action&&n.triggerWatch(e.args.event,new i(e.args.file)),this._evHandler&&this._evHandler.emit(e.action,e.args)}createRequest(e,t,n){if(!this.ws)return Promise.reject(new Error("No websocket connection"));if(-1!==["FS:upload","FS:get","logout"].indexOf(e))return super.createRequest(...arguments);const i=this.index++,r=e.match(/^FS:/)?"/FS/":"/API/";try{this.ws.send(JSON.stringify({_index:i,path:r+e.replace(/^FS:/,""),args:t}))}catch(e){return Promise.reject(e)}return new Promise((e,t)=>{this.wsqueue[i]=function(n,i){return n?t(n):e(i)}})}}}),e("skylark-osjsv2-client/core/storage/database",["../storage"],function(e){"use strict";return class extends e{}}),e("skylark-osjsv2-client/core/storage/demo",["../config","../storage"],function(e,t){"use strict";return class extends t{init(){const t=e.getConfig("Version"),n=localStorage.getItem("__version__");return t!==n&&localStorage.clear(),localStorage.setItem("__version__",String(t)),Promise.resolve()}saveSettings(e,t){return Object.keys(t).forEach(n=>{if(!e||n===e)try{localStorage.setItem("OSjs/"+n,JSON.stringify(t[n]))}catch(e){console.warn("DemoStorage::settings()",e,e.stack)}}),Promise.resolve()}}}),e("skylark-osjsv2-client/core/storage/standalone",["./demo"],function(e){"use strict";return class extends e{}}),e("skylark-osjsv2-client/core/storage/system",["../storage"],function(e){"use strict";return class extends e{}}),e("skylark-osjsv2-client/gui/elements/containers",["../../utils/gui","../../utils/events","../element"],function(e,t,n){"use strict";function i(e,t){return void 0===t&&(t=!(t="false"!==e.getAttribute("data-expanded"))),e.setAttribute("aria-expanded",String(t)),e.setAttribute("data-expanded",String(t)),t}return{GUIPanedView:class extends n{static register(){return super.register({tagName:"gui-paned-view",type:"container",allowedChildren:["gui-paned-view-container"]},this)}on(e,n,i){const r=this.$element;return"resize"===e&&(e="_"+e),t.$bind(r,e,n.bind(this),i),this}build(){const t=this.$element,n=t.getAttribute("data-orientation")||"horizontal";return t.querySelectorAll("gui-paned-view-container").forEach((i,r)=>{if(r%2){const o=document.createElement("gui-paned-view-handle");o.setAttribute("role","separator"),i.parentNode.insertBefore(o,i),function(i,r,o){const s=i.previousElementSibling;if(!s)return;let a=s.offsetWidth,l=s.offsetHeight,c=16,u=Number.MAX_VALUE;e.createDrag(i,e=>{a=s.offsetWidth,l=s.offsetHeight,c=parseInt(o.getAttribute("data-min-size"),10)||c;const t=parseInt(o.getAttribute("data-max-size"),10);if(!t){const e=i.parentNode["horizontal"===n?"offsetWidth":"offsetHeight"],t=i.parentNode.querySelectorAll("gui-paned-view-container").length,r=i.parentNode.querySelectorAll("gui-paned-view-handle").length;u=e-16*t-8*r}},(e,t)=>{const i=a+t.x,r=l+t.y;let o;"horizontal"===n?!isNaN(i)&&i>0&&i>=c&&i<=u&&(o=i.toString()+"px"):!isNaN(r)&&r>0&&r>=c&&r<=u&&(o=r.toString()+"px"),o&&(s.style.webkitFlexBasis=o,s.style.mozFflexBasis=o,s.style.msFflexBasis=o,s.style.oFlexBasis=o,s.style.flexBasis=o)},e=>{t.dispatchEvent(new CustomEvent("_resize",{detail:{index:r}}))})}(o,r,i)}}),this}},GUIPanedViewContainer:class extends n{static register(){return super.register({tagName:"gui-paned-view-container",type:"container",allowedParents:["gui-paned-view"]},this)}build(){return e.setFlexbox(this.$element),this}},GUIButtonBar:class extends n{static register(){return super.register({tagName:"gui-button-bar",type:"container"},this)}build(){return this.$element.setAttribute("role","toolbar"),this}},GUIToolBar:class extends n{static register(){return super.register({tagName:"gui-toolbar",type:"container"},this)}build(){return this.$element.setAttribute("role","toolbar"),this}},GUIGrid:class extends n{static register(){return super.register({tagName:"gui-grid",type:"container",allowedChildren:["gui-grid-row"]},this)}build(){const e=this.$element.querySelectorAll("gui-grid-row"),t=100/e.length;return e.forEach(e=>{e.style.height=String(t)+"%"}),this}},GUIGridRow:class extends n{static register(){return super.register({tagName:"gui-grid-row",type:"container",allowedChildren:["gui-grid-entry"],allowedParents:["gui-grid-row"]},this)}},GUIGridEntry:class extends n{static register(){return super.register({tagName:"gui-grid-entry",type:"container",allowedParents:["gui-grid-row"]},this)}},GUIVBox:class extends n{static register(){return super.register({tagName:"gui-vbox",type:"container",allowedChildren:["gui-vbox-container"]},this)}},GUIVBoxContainer:class extends n{static register(){return super.register({tagName:"gui-vbox-container",type:"container",allowedParents:["gui-vbox"]},this)}build(){return e.setFlexbox(this.$element),this}},GUIHBox:class extends n{static register(){return super.register({tagName:"gui-hbox",type:"container",allowedChildren:["gui-hbox-container"]},this)}},GUIHBoxContainer:class extends n{static register(){return super.register({tagName:"gui-hbox-container",type:"container",allowedParents:["gui-hbox"]},this)}build(){return e.setFlexbox(this.$element),this}},GUIExpander:class extends n{static register(){return super.register({tagName:"gui-expander",type:"container"},this)}set(e,t){return"expanded"===e?i(this.$element,!0===t):super.set(...arguments)}on(e,n,i){return-1!==["change"].indexOf(e)&&(e="_"+e),t.$bind(this.$element,e,n.bind(this),i),this}build(){const e=this.$element,n=e.getAttribute("data-label")||"",r=document.createElement("gui-expander-label");return t.$bind(r,"pointerdown",t=>{e.dispatchEvent(new CustomEvent("_change",{detail:{expanded:i(e)}}))},!1),r.appendChild(document.createTextNode(n)),e.setAttribute("role","toolbar"),e.setAttribute("aria-expanded","true"),e.setAttribute("data-expanded","true"),e.children.length?e.insertBefore(r,e.children[0]):e.appendChild(r),this}}}}),e("skylark-osjsv2-client/utils/clipboard",[],function(){"use strict";let e;return{setClipboard:function(t){console.debug("setClipboard()",t),e=t},getClipboard:function(){return e}}}),e("skylark-osjsv2-client/gui/dataview",["../utils/gui","../utils/dom","../utils/events","../utils/clipboard","../utils/keycodes","../vfs/file","./element"],function(e,t,n,i,r,o,s){"use strict";const a={"gui-list-view":"gui-list-view-row"};function l(e){"string"!=typeof e&&(e=e.tagName.toLowerCase());let t=a[e];return t||(t=e+"-entry"),t}function c(e,t){const n=e.target,i=n.tagName.toLowerCase();return i.match(/(view|textarea|body)$/)?null:"gui-list-view-column"!==i||t?n:n.parentNode}function u(e,t){return(t=t||c(e))&&"GUI-LIST-VIEW-HEAD"===t.parentNode.tagName}function d(e,n,i,r,o,s,a){if(s=s||n.parentNode,u(null,n))return a?[]:null;if(-1===i)s.querySelectorAll(l(s)).forEach(function(e){t.$removeClass(e,"gui-active")}),o=[];else{a&&e.shiftKey||(s.querySelectorAll(r).forEach(function(e){t.$removeClass(e,"gui-active")}),o=[]);const l=o.indexOf(i);l>=0?(o.splice(l,1),t.$removeClass(n,"gui-active")):(o.push(i),t.$addClass(n,"gui-active"))}return o.sort(function(e,t){return e-t}),o}function h(e){const t=e.getAttribute("data-value");try{return JSON.parse(t)}catch(e){}return t}function p(e,t,n,i){const r=e.getAttribute("data-value");if(!(n||t!==i&&t!==r))return e;try{const i=JSON.parse(r);if("object"==typeof i[n]?i[n]===t:String(i[n])===String(t))return e}catch(e){}return!1}return class a extends s{clear(e){const i=this.$element;return arguments.length||(e=i),i.querySelectorAll(l(i)).forEach(e=>{n.$unbind(e)}),t.$empty(e),e.scrollTop=0,i._selected=[],this}add(e,t){return t=t||function(){},e instanceof Array||(e=[e]),e.forEach(e=>{t(this,e)}),this}patch(e,n,i,r,o){let s=!1;e instanceof Array||(e=[e],s=!0);let l={};return i.querySelectorAll(n).forEach(e=>{const t=e.getAttribute("data-id");null!==t&&(l[t]=e)}),e.forEach(e=>{let s;if(void 0!==e.id&&null!==e.id){l[e.id]&&(s=l[e.id],delete l[e.id]);const c=r(this,e);c&&(s?(t.$hasClass(s,"gui-active")&&t.$addClass(c,"gui-active"),i.insertBefore(c,s),a.prototype.remove.call(this,null,n,s,i)):i.appendChild(c),o(this,c))}}),s||Object.keys(l).forEach(e=>{a.prototype.remove.call(this,null,n,l[e])}),l={},this.updateActiveSelection(n),this}remove(e,n,i,r){if(e=e||[],r=r||this.$element,i)t.$remove(i);else if(void 0===e[1]&&"number"==typeof e[0])t.$remove(r.querySelectorAll(n)[e[0]]);else{const i=e[0],o=e[1]||"id",s="data-"+o+'="'+i+'"';r.querySelectorAll(n+"["+s+"]").forEach(t.$remove)}return this.updateActiveSelection(n),this}updateActiveSelection(e){const n=[];this.$element.querySelectorAll(e+".gui-active").forEach(e=>{n.push(t.$index(e))}),this.$element._active=n}scrollIntoView(e){const n=this.$element,i=t.$position(e,n);let r=0;if("gui-list-view"===n.tagName.toLowerCase()){const e=n.querySelector("gui-list-view-head");e&&(r=e.offsetHeight)}const o=n.scrollTop+n.offsetHeight-r,s=n.scrollTop+r,a=i.top-r;return null!==i&&(a>o||a<s)&&(n.scrollTop=a,!0)}bindEntryEvents(t,n){const i=this.$element;i.dispatchEvent(new CustomEvent("_render",{detail:{element:t,data:e.getViewNodeValue(t)}})),"true"===i.getAttribute("data-draggable")&&function(){let n=t.getAttribute("data-value");if(null!==n)try{n=JSON.parse(n)}catch(e){}let r=t.getAttribute("data-draggable-source");null===r&&null!==(r=e.getWindowId(i))&&(r={wid:r});e.createDraggable(t,{type:i.getAttribute("data-draggable-type")||t.getAttribute("data-draggable-type"),source:r,data:n});let o=t.getAttribute("data-tooltip");o&&!t.getAttribute("title")&&t.setAttribute("title",o)}()}getSelected(n){const i=[];return n.forEach((n,r)=>{t.$hasClass(n,"gui-active")&&i.push({index:r,data:e.getViewNodeValue(n)})}),i}getEntry(e,t,n,i){if(t){let r=null;return e.forEach((e,i)=>{!r&&p(e,t,n,i)&&(r=e)}),i&&r?h(r):r}if(i&&e)try{return e.map(e=>h(e))}catch(e){console.warn(e)}return e}setSelected(e,n,i,r,o){const s=[],a=this.$element;let l=!1;"object"==typeof o&&(l=!0===o.scroll);const c=(e,n)=>{s.push(n),t.$addClass(e,"gui-active"),l&&this.scrollIntoView(e)};n.forEach((e,n)=>{t.$removeClass(e,"gui-active"),p(e,i,r,n)&&c(e,n)}),a._selected=s}build(e){const s=this.$element;s._selected=[],s.scrollTop=0,t.$addClass(s,"gui-data-view");const a="true"===s.getAttribute("data-single-click");let h,p=!1,g=s.getAttribute("data-multiple");g=null===g||"true"===g;const m=e=>{if(h||p)return!1;const n=c(e);if(!n)return!1;const i=n.tagName.toLowerCase();if(u(null,n)){const t=c(e,!0);if(t){let e=t.getAttribute("data-sortby");if(e){let n=t.getAttribute("data-sortdir"),i="desc"===n;n="asc"===n?"desc":i?null:"asc",e=i?null:e,t.setAttribute("data-sortdir",n),s.setAttribute("data-sortby",e||""),s.setAttribute("data-sortdir",n||""),s.dispatchEvent(new CustomEvent("_sort",{detail:{sortDir:n,sortBy:e}}))}}return!1}if("gui-tree-view-expander"===i)return this.expand({ev:e,entry:n.parentNode}),!0;const r=t.$index(n);return s._selected=d(e,n,r,i,s._selected,s,g),s.dispatchEvent(new CustomEvent("_select",{detail:{entries:this.values()}})),!0},f=e=>{if(!h&&!u(e)){if(a){if(!1===m(e))return}else if(!c(e))return;s.dispatchEvent(new CustomEvent("_activate",{detail:{entries:this.values()}}))}},_=e=>{u(e)||(m(e),s.dispatchEvent(new CustomEvent("_contextmenu",{detail:{entries:this.values(),x:e.clientX,y:e.clientY}})))};if(!s.querySelector("textarea.gui-focus-element")&&!s.getAttribute("no-selection")){const e=document.createElement("textarea");e.setAttribute("aria-label",""),e.setAttribute("aria-hidden","true"),e.setAttribute("readonly","true"),e.className="gui-focus-element",n.$bind(e,"focus",e=>{e.preventDefault(),t.$addClass(s,"gui-element-focused")}),n.$bind(e,"blur",e=>{e.preventDefault(),t.$removeClass(s,"gui-element-focused")}),n.$bind(e,"keydown",e=>{e.preventDefault(),function(e,t,n){const s={},a=n.keyCode,c=t.tagName.toLowerCase(),u=l(c),h=t.querySelector(c+"-body"),p=h.querySelectorAll(u),g=p.length;if(!g)return;if(a===r.ENTER)return void t.dispatchEvent(new CustomEvent("_activate",{detail:{entries:e.values()}}));s[r.C]=function(t){if(t.ctrlKey){const t=e.values();if(t&&t.length){const e=[];t.forEach(function(t){t&&t.data&&e.push(new o(t.data.path,t.data.mime))}),i.setClipboard(e)}}};const m=t._selected.concat()||[],f=m.length?m[0]:0,_=m.length>1?m[m.length-1]:f;let w=0;function b(){const i=p[w];i&&(t._selected=d(n,i,w,u,m,h,n.shiftKey),e.scrollIntoView(i))}function E(){let e=0,t=-1;return p.forEach(function(n){return-1===t&&(t=n.offsetTop),t===n.offsetTop&&(t=n.offsetTop,e++,!0)}),e}!function(){function e(){w=Math.min(_+1,g),b()}function t(){w=Math.max(0,f-1),b()}"gui-tree-view"===c||"gui-list-view"===c?(s[r.UP]=t,s[r.DOWN]=e):(s[r.UP]=function(){w=Math.max(0,f-E()),b()},s[r.DOWN]=function(){w=Math.max(_,_+E()),b()},s[r.LEFT]=t,s[r.RIGHT]=e);s[a]&&s[a](n)}()}(this,s,e)}),n.$bind(e,"keypress",e=>{e.preventDefault()}),n.$bind(s,"pointerdown,touchstart",e=>{h=!1;const t=e.target;p=t&&"GUI-LIST-VIEW-COLUMN-RESIZER"===t.tagName},!0),n.$bind(s,"touchmove",e=>{h=!0},!0),a?n.$bind(s,"click",f,!0):(n.$bind(s,"click",m,!0),n.$bind(s,"dblclick",f,!0)),n.$bind(s,"contextmenu",e=>(e.preventDefault(),_(e),!1),!0),this.on("select",n=>{if(t.$hasClass(s,"gui-element-focused"))return;const i=s.scrollTop;e.focus(),s.scrollTop=i,setTimeout(()=>{s.scrollTop=i},2)},!0),s.appendChild(e)}}focus(){try{const e=this.$element.querySelector(".gui-focus-element");e.focus()}catch(e){console.warn(e,e.stack)}}blur(){try{const e=this.$element.querySelector(".gui-focus-element");e.blur()}catch(e){console.warn(e,e.stack)}}values(){return[]}on(e,t,i){return-1!==["activate","select","expand","contextmenu","render","drop","sort"].indexOf(e)&&(e="_"+e),n.$bind(this.$element,e,t.bind(this),i),this}}}),e("skylark-osjsv2-client/helpers/date",[],function(){"use strict";class e{constructor(t){t&&(t instanceof Date?this.date=t:t instanceof e?this.date=t.date:"string"==typeof t&&(this.date=new Date(t))),this.date||(this.date=new Date)}static get config(){return{defaultFormat:"isoDateTime"}}static get dayNames(){return["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}static get monthNames(){return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]}get(){return this.date}format(t){return e.format(this,t)}getFirstDayInMonth(t){return e.getFirstDayInMonth(t,null,null,this)}getLastDayInMonth(t){return e.getLastDayInMonth(t,null,null,this)}getDaysInMonth(){return e.getDaysInMonth(null,null,this)}getWeekNumber(){return e.getWeekNumber(this)}isWithinMonth(t,n){return e.isWithinMonth(this,t,n)}getDayOfTheYear(){return e.getDayOfTheYear()}static format(e,t){return n(t,e)}static getPreviousMonth(t){let n;return t=t?t instanceof e?t.date:t:new Date,n=0===t.getMonth()?new Date(t.getFullYear()-1,11,t.getDate()):new Date(t.getFullYear(),t.getMonth()-1,t.getDate()),new e(n)}static getNextMonth(t){let n;return t=t?t instanceof e?t.date:t:new Date,n=11===t.getMonth()?new Date(t.getFullYear()+1,0,t.getDate()):new Date(t.getFullYear(),t.getMonth()+1,t.getDate()),new e(n)}static getFirstDayInMonth(t,s,a,l){l=i(l),s=r(s,l),a=o(a,l);const c=new Date;return c.setFullYear(s,a,1),!0===t?c.getDate():t?n(t,c):new e(c)}static getLastDayInMonth(t,s,a,l){l=i(l),s=r(s,l),a=o(a,l);const c=new Date;return c.setFullYear(s,a,0),!0===t?c.getDate():t?n(t,c):new e(c)}static getDaysInMonth(e,t,n){n=i(n),e=r(e,n),t=o(t,n);const s=new Date;return s.setFullYear(e,t,0),parseInt(s.getDate(),10)}static getWeekNumber(t){t=t?t instanceof e?t.date:t:new Date;const n=new Date(+t);return n.setHours(0,0,0),n.setDate(n.getDate()+4-(n.getDay()||7)),Math.ceil(((n-new Date(n.getFullYear(),0,1))/864e5+1)/7)}static getDayName(n,i){if(n<0||null===n||void 0===n)return t(e.dayNames,n,i,7);const r=n+((i=i?0:1)+7);return e.dayNames[r]}static getMonthName(n,i){if(n<0||null===n||void 0===n)return t(e.monthNames,n,i,12);const r=n+((i=i?0:1)+12);return e.monthNames[r]}static isWithinMonth(e,t,n){return e.getFullYear()>=t.getFullYear()&&e.getMonth()>=t.getMonth()&&e.getFullYear()<=n.getFullYear()&&e.getMonth()<=n.getMonth()}static getDayOfTheYear(){const e=new Date,t=new Date(e.getFullYear(),0,0),n=e-t;return Math.floor(n/864e5)}}function t(e,t,n,i){const r=[];for(let t=n?0:i;t<e.length;t++)r.push(e[t]);return r}function n(t,n){let i;return void 0!==t&&t?"string"!=typeof t?(i=t.utc,t=t.format):i=e.config.utc:t=e.config.defaultFormat,function(t,n,i){function r(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e}i=!0===i;n={default:"Y-m-d H:i:s",shortDate:"m/d/y",mediumDate:"M d, Y",longDate:"F d, Y",fullDate:"l, F d, Y",shortTime:"h:i A",mediumTime:"h:i:s A",longTime:"h:i:s A T",isoDate:"Y-m-d",isoTime:"H:i:s",isoDateTime:"Y-m-d H:i:s"}[n]||n,t instanceof e||(t=new e(t));const o={d:function(e){return r(o.j(e))},D:function(n){return e.dayNames[i?t.getUTCDay():t.getDay()]},j:function(e){return i?t.getUTCDate():t.getDate()},l:function(n){return e.dayNames[(i?t.getUTCDay():t.getDay())+7]},w:function(e){return i?t.getUTCDay():t.getDay()},z:function(e){return t.getDayOfTheYear()},S:function(e){const n=i?t.getUTCDate():t.getDate();return["th","st","nd","rd"][n%10>3?0:(n%100-n%10!=10)*n%10]},W:function(e){return t.getWeekNumber()},F:function(n){return e.monthNames[(i?t.getUTCMonth():t.getMonth())+12]},m:function(e){return r(o.n(e))},M:function(n){return e.monthNames[i?t.getUTCMonth():t.getMonth()]},n:function(e){return(i?t.getUTCMonth():t.getMonth())+1},t:function(e){return t.getDaysInMonth()},Y:function(e){return i?t.getUTCFullYear():t.getFullYear()},y:function(e){return String(o.Y(e)).slice(2)},a:function(e){return o.G(e)<12?"am":"pm"},A:function(e){return o.a(e).toUpperCase()},g:function(e){return o.G(e)%12||12},G:function(e){return i?t.getUTCHours():t.getHours()},h:function(e){return r(o.g(e))},H:function(e){return r(o.G(e))},i:function(e){return r(i?t.getUTCMinutes():t.getMinutes())},s:function(e){return r(i?t.getUTCSeconds():t.getSeconds())},O:function(e){const n=-t.getTimezoneOffset(),i=n>=0?"+":"-";function r(e){const t=Math.abs(Math.floor(e));return(t<10?"0":"")+t}const o=i+r(n/60)+":"+r(n%60);return o},T:function(e){if(i)return"UTC";const n=String(t.date).match(/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g)||[""];return n.pop().replace(/(\+|\-)[0-9]+$/,"")},U:function(e){return t.getTime()}},s=[];return n.split("").forEach(function(e){s.push(o[e]?o[e]():e)}),s.join("")}(n,t,i)}function i(t){return t?t instanceof e?t.date:t:new Date}function r(e,t){return void 0===e||null===e||e<0?t.getFullYear():e}function o(e,t){return void 0===e||null===e||e<0?t.getMonth():e}return["UTC","toString","now","parse","getDate","getDay","getFullYear","getHours","getMilliseconds","getMinutes","getMonth","getSeconds","getTime","getTimezoneOffset","getUTCDate","getUTCDay","getUTCFullYear","getUTCHours","getUTCMilliseconds","getUTCMinutes","getUTCMonth","getUTCSeconds","getYear","setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear","toDateString","toGMTString","toISOString","toJSON","toLocaleDateString","toLocaleFormat","toLocaleString","toLocaleTimeString","toSource","toString","toTimeString","toUTCString","valueOf"].forEach(function(t){e.prototype[t]=function(){return this.date[t].apply(this.date,arguments)}}),e}),e("skylark-osjsv2-client/gui/elements/fileview",["../../utils/fs","../../vfs/fs","../../utils/dom","../../utils/gui","../../utils/misc","../../utils/events","../menu","../element","../dataview","../../core/package-manager","../../core/settings-manager","../../vfs/file","../../helpers/date","../../core/theme","../../core/locales","../../core/config"],function(e,t,n,i,r,o,s,a,l,c,u,d,h,p,g,m){"use strict";let f={"gui-icon-view":"32x32"};function _(e,t){if(e.icon&&"object"==typeof e.icon)return e.icon.application?c.getPackageResource(e.icon.filename,e.icon.application):p.getIcon(e.icon.filename,t,e.icon.application);return p.getFileIcon(e,t,"status/dialog-question.png")}function w(t){let n="";return"dir"!==t.type&&t.size>=0&&(n=e.humanFileSize(t.size)),n}const b=(()=>{let t;return(n,i)=>{if(t||(t=m.getConfig("MIME.mapping")),!1===i.extensions){let i=e.filext(n);i&&t[i="."+i]&&(n=n.substr(0,n.length-i.length))}return n}})();function E(e){if("string"==typeof e){let t=null;try{t=new Date(e)}catch(e){}if(t)return h.format(t)}return e}function y(e,t,n){const i={filename:{label:"LBL_FILENAME",icon:()=>_(t),value:()=>b(t.filename,n)},mime:{label:"LBL_MIME",size:"100px",icon:()=>null,value:()=>t.mime},mtime:{label:"LBL_MODIFIED",size:"160px",icon:()=>null,value:()=>E(t.mtime)},ctime:{label:"LBL_CREATED",size:"160px",icon:()=>null,value:()=>E(t.ctime)},size:{label:"LBL_SIZE",size:"120px",icon:()=>null,value:()=>w(t)}};let o=["filename","mime","size"],s=o;if(!(n=n||{}).defaultcolumns){const e=r.cloneObject(u.get("VFS")||{}),t=e.scandir||{};s=t.columns||o}const a=[],l=e.$element.getAttribute("data-sortby"),c=e.$element.getAttribute("data-sortdir");return s.forEach((e,n)=>{const r=i[e];t?a.push({sortBy:e,label:r.value(),icon:r.icon(),textalign:0===n?"left":"right"}):a.push({sortBy:e,sortDir:e===l?c:null,label:g._(r.label),size:r.size||"",resizable:n>0,textalign:0===n?"left":"right"})}),a}function v(e,n,i,o){const s=e.getChildView();if(!s)return;o=o||{};const a=r.cloneObject(u.get("VFS")||{}),l=a.scandir||{},c=e.$element,h=s.$element,p=h.tagName.toLowerCase();c.setAttribute("data-path",n);const g={filter:null,backlink:o.backlink};function m(e,t,n,i){c.hasAttribute(e)?g[t]=n(c.getAttribute(e)):g[t]=(i||function(){})()}m("data-sortby","sortby",e=>e),m("data-sortdir","sortdir",e=>e),m("data-dotfiles","dotfiles",e=>"true"===e,()=>!0===l.showHiddenFiles),m("data-extensions","extensions",e=>"true"===e,()=>!0===l.showFileExtensions),m("data-filetype","filetype",e=>e),m("data-defaultcolumns","defaultcolumns",e=>"true"===e);try{g.filter=JSON.parse(c.getAttribute("data-filter"))}catch(e){}!function(e,n,i,r){const o=new d(e);o.type="dir";const s={backlink:n.backlink,showDotFiles:!0===n.dotfiles,showFileExtensions:!0===n.extensions,mimeFilter:n.filter||[],typeFilter:n.filetype||null,sortBy:n.sortby,sortDir:n.sortdir};t.scandir(o,s).then(e=>{const t=[],n={size:0,directories:0,files:0,hidden:0};(e||[]).forEach(e=>{t.push(r(e)),n.size+=e.size||0,n.directories+="dir"===e.type?1:0,n.files+="dir"!==e.type?1:0,n.hidden+="."===(e.filename||"").substr(0)?1:0}),i(!1,t,n)}).catch(i)}(n,g,(t,n,r)=>{"gui-list-view"===p&&(e.getChildView().set("zebra",!0),!1!==o.headers&&e.getChildView().set("columns",y(e,null,g))),i(t,n,r)},t=>{const n=r.format("{0}\n{1}\n{2} {3}",t.type.toUpperCase(),t.filename,w(t),t.mime||"");return"gui-list-view"!==p?function(){const e={value:t,id:t.id||b(t.filename,g),label:t.filename,tooltip:n,icon:_(t,f[p]||"16x16")};"gui-tree-view"===p&&"dir"===t.type&&".."!==t.filename&&(e.entries=[{label:"Loading..."}]);return e}():{value:t,id:t.id||t.filename,tooltip:n,columns:y(e,t,g)}})}return{GUIFileView:class extends a{static register(){return super.register({tagName:"gui-file-view"},this)}on(e,t,n){-1!==["activate","select","contextmenu","sort"].indexOf(e)&&(e="_"+e);const i=this.$element;return"_contextmenu"===e&&i.setAttribute("data-has-contextmenu","true"),o.$bind(i,e,t.bind(this),n),this}set(e,t,n,r){const o=this.$element;if("type"===e){const e=o.children[0];return!(!e||e.tagName.toLowerCase()!==t)||(o.setAttribute("data-type",t),this.buildChildView(),void 0!==n&&!0!==n||this.chdir({path:o.getAttribute("data-path")}),this)}if(["filter","dotfiles","filetype","extensions","defaultcolumns","sortby","sortdir"].indexOf(e)>=0)return i.setProperty(o,e,t),this;const s=this.getChildView();return s?s.set.apply(s,arguments):l.prototype.set.apply(this,arguments)}build(){if(this.childView)return this;this.buildChildView();const e=this.$element;return o.$bind(e,"_expand",e=>{const t=e.detail.element;if(!t.getAttribute("data-was-rendered")&&e.detail.expanded){const i=e.detail.entries[0].data;t.setAttribute("data-was-rendered",String(!0)),v(this,i.path,(e,i,r)=>{if(!e){t.querySelectorAll("gui-tree-view-entry").forEach(e=>{n.$remove(e)});const e=this.getChildView();e&&e.add({entries:i,parentNode:t})}},{backlink:!1})}}),this}values(){const e=this.getChildView();return e?e.values():null}contextmenu(e){const t=u.instance("VFS"),n=t.get("scandir")||{};function i(e,n){const i={scandir:{}};i.scandir[e]=n,t.set(null,i,!0)}s.create([{title:g._("LBL_SHOW_HIDDENFILES"),type:"checkbox",checked:!0===n.showHiddenFiles,onClick:()=>{i("showHiddenFiles",!n.showHiddenFiles)}},{title:g._("LBL_SHOW_FILEEXTENSIONS"),type:"checkbox",checked:!0===n.showFileExtensions,onClick:()=>{i("showFileExtensions",!n.showFileExtensions)}}],e)}chdir(e){let t=this.getChildView();t||(t=this.buildChildView());const n=e.done||function(){},i=e.path||m.getDefaultPath(),r=t,o=this.$element;clearTimeout(o._readdirTimeout),o._readdirTimeout=setTimeout(()=>{v(this,i,(e,t,o)=>{e?OSjs.error(g._("ERR_VFSMODULE_XHR_ERROR"),g._("ERR_VFSMODULE_SCANDIR_FMT",i),e):(r.clear(),r.add(t)),n(e,o)},e.opts)},50)}getChildViewType(){let e=this.$element.getAttribute("data-type")||"list-view";return e.match(/^gui\-/)||(e="gui-"+e),e}getChildView(){return a.createFromNode(this.$element.children[0])}buildChildView(){const e=this.$element,t=this.getChildViewType(),i=this.getChildView();if(i&&i.$element&&i.$element.tagName.toLowerCase()===t)return null;n.$empty(e);const r=a.create(t,{draggable:!0,"draggable-type":"file"});return r.build(),r.on("select",t=>{e.dispatchEvent(new CustomEvent("_select",{detail:t.detail}))}),r.on("activate",t=>{e.dispatchEvent(new CustomEvent("_activate",{detail:t.detail}))}),r.on("sort",t=>{e.setAttribute("data-sortby",String(t.detail.sortBy)),e.setAttribute("data-sortdir",String(t.detail.sortDir)),this.chdir({sopts:{headers:!1},path:e.getAttribute("data-path")}),e.dispatchEvent(new CustomEvent("_sort",{detail:t.detail}))}),r.on("contextmenu",t=>{e.hasAttribute("data-has-contextmenu")&&"false"!==e.hasAttribute("data-has-contextmenu")||this.contextmenu(t),e.dispatchEvent(new CustomEvent("_contextmenu",{detail:t.detail}))}),"gui-tree-view"===t&&r.on("expand",t=>{e.dispatchEvent(new CustomEvent("_expand",{detail:t.detail}))}),e.setAttribute("role","region"),e.appendChild(r.$element),r}}}}),e("skylark-osjsv2-client/gui/elements/iconview",["../../utils/gui","../dataview"],function(e,t){"use strict";function n(t,n){const i=e.createElement("gui-icon-view-entry",n);return i}function i(t,n){const i=n.getAttribute("data-icon"),r=e.getLabel(n),o=document.createElement("div"),s=document.createElement("img");s.src=i,o.appendChild(s);const a=document.createElement("div"),l=document.createElement("span");l.appendChild(document.createTextNode(r)),a.appendChild(l),t.bindEntryEvents(n,"gui-icon-view-entry"),n.setAttribute("role","listitem"),n.appendChild(o),n.appendChild(a)}return{GUIIconView:class extends t{static register(){return super.register({parent:t,tagName:"gui-icon-view"},this)}values(){return this.getSelected(this.$element.querySelectorAll("gui-icon-view-entry"))}build(){const e=this.$element;let t=e.querySelector("gui-icon-view-body");const n=!!t;return n||(t=document.createElement("gui-icon-view-body"),e.appendChild(t)),e.querySelectorAll("gui-icon-view-entry").forEach((e,r)=>{n||t.appendChild(e),i(this,e)}),e.setAttribute("role","list"),super.build(...arguments)}get(e,t,n,i){if("entry"===e){const e=this.$element.querySelector("gui-icon-view-body"),r=e.querySelectorAll("gui-icon-view-entry");return this.getEntry(r,t,n,i)}return super.get(...arguments)}set(e,t,n){const i=this.$element.querySelector("gui-icon-view-body");return"selected"===e||"value"===e?(i&&this.setSelected(i,i.querySelectorAll("gui-icon-view-entry"),t,n),this):super.set(...arguments)}add(e){const t=this.$element.querySelector("gui-icon-view-body");return super.add(e,(e,r)=>{const o=n(this,r);t.appendChild(o),i(this,o)})}clear(){const e=this.$element.querySelector("gui-icon-view-body");return super.clear(e)}remove(e){return super.remove(e,"gui-icon-view-entry")}patch(e){const t=this.$element.querySelector("gui-icon-view-body");return super.patch(e,"gui-icon-view-entry",t,n,i)}}}}),e("skylark-osjsv2-client/gui/elements/inputs",["../../utils/dom","../../utils/gui","../../utils/clipboard","../../utils/events","../../utils/keycodes","../element","../../core/locales"],function(e,t,n,i,r,o,s){"use strict";let a=0;function l(o,s){const a=o.getAttribute("data-group"),l=o.getAttribute("data-placeholder"),c="true"===String(o.getAttribute("data-disabled")),u=o.childNodes.length?o.childNodes[0].nodeValue:null;e.$empty(o);const d=document.createElement("textarea"===s?"textarea":"input"),h={value:null,type:s,tabindex:-1,placeholder:l,disabled:c?"disabled":null,name:a?a+"[]":null};["autocomplete","autocorrect","autocapitalize","spellcheck"].forEach(e=>{h[e]=o.getAttribute("data-"+e)||"false"}),function(){(function(){["range","slider"].indexOf(s)>=0?(h.min=o.getAttribute("data-min"),h.max=o.getAttribute("data-max"),h.step=o.getAttribute("data-step")):["radio","checkbox"].indexOf(s)>=0?"true"===o.getAttribute("data-value")&&(h.checked="checked"):["text","password","textarea"].indexOf(s)>=0&&(h.value=u||"");Object.keys(h).forEach(e=>{null!==h[e]&&("value"===e?d.value=h[e]:d.setAttribute(e,h[e]))})})(),"text"!==s&&"password"!==s&&"textarea"!==s||i.$bind(d,"keydown",e=>{e.keyCode===r.ENTER?d.dispatchEvent(new CustomEvent("_enter",{detail:d.value})):e.keyCode===r.C&&e.ctrlKey&&n.setClipboard(d.value),"textarea"===s&&e.keyCode===r.TAB&&(e.preventDefault(),d.value+="\t")},!1),t.createInputLabel(o,s,d);const e={TEXTAREA:()=>"textbox",INPUT:e=>{return{range:"slider",text:"textbox",password:"textbox"}[e.type]||e.type}};e[o.tagName]&&d.setAttribute("role",e[o.tagName](d));d.setAttribute("aria-label",o.getAttribute("title")||""),o.setAttribute("role","region"),o.setAttribute("aria-disabled",String(c)),i.$bind(d,"change",e=>{let t=d.value;"radio"!==s&&"checkbox"!==s||(t=d.checked),d.dispatchEvent(new CustomEvent("_change",{detail:t}))},!1)}()}function c(t,n,i){!0!==t?(n.removeAttribute("checked"),e.$removeClass(i,"gui-active"),i.innerHTML="0"):(n.setAttribute("checked","checked"),e.$addClass(i,"gui-active"),i.innerHTML="1")}class u extends o{on(e,t,n){"enter"===e?e="_enter":"change"===e&&(e="_change");const r=this.$element.querySelector("textarea, input, select");return i.$bind(r,e,t.bind(this),n),this}}class d extends u{add(e){return function(e,t){const n=e.querySelector("select");t instanceof Array||(t=[t]);t.forEach(e=>{const t=document.createElement("option");t.setAttribute("role","option"),t.setAttribute("value",e.value),t.appendChild(document.createTextNode(e.label)),n.appendChild(t)})}(this.$element,e),this}remove(t){var n,i;return n=this.$element,i=t,n.querySelector("select").querySelectorAll("option").forEach(t=>String(t.value)!==String(i)||(e.$remove(t),!1)),this}clear(){const t=this.$element.querySelector("select");return e.$empty(t),this}build(){const e=this.$element,t="gui-select-list"===e.tagName.toLowerCase();return function(e,t){const n=null!==e.getAttribute("data-disabled"),r=e.getAttribute("data-selected"),o=document.createElement("select");t&&(o.setAttribute("size",e.getAttribute("data-size")||2),t="true"===e.getAttribute("data-multiple"));t&&o.setAttribute("multiple","multiple");n&&o.setAttribute("disabled","disabled");null!==r&&(o.selectedIndex=r);e.querySelectorAll("gui-select-option").forEach(e=>{const t=e.getAttribute("data-value")||"",n=e.childNodes.length?e.childNodes[0].nodeValue:"",i=document.createElement("option");i.setAttribute("role","option"),i.setAttribute("value",t),i.appendChild(document.createTextNode(n)),e.getAttribute("selected")&&i.setAttribute("selected","selected"),o.appendChild(i),e.parentNode.removeChild(e)}),i.$bind(o,"change",e=>{o.dispatchEvent(new CustomEvent("_change",{detail:o.value}))},!1),o.setAttribute("role","listbox"),o.setAttribute("aria-label",e.getAttribute("title")||""),e.setAttribute("aria-disabled",String(n)),e.setAttribute("role","region"),e.appendChild(o)}(e,t),this}}return{GUILabel:class extends o{static register(){return super.register({tagName:"gui-label"},this)}set(t,n,i){const r=this.$element;if("value"===t||"label"===t){r.setAttribute("data-label",String(n));const t=r.querySelector("label");return e.$empty(t),i?t.innerHTML=n:t.appendChild(document.createTextNode(n)),this}return super.set(...arguments)}build(){const e=this.$element,n=t.getValueLabel(e,!0),i=document.createElement("label");return i.appendChild(document.createTextNode(n)),e.setAttribute("role","heading"),e.setAttribute("data-label",String(n)),e.appendChild(i),this}},GUITextarea:class extends u{static register(){return super.register({tagName:"gui-textarea",type:"input"},this)}build(){return l(this.$element,"textarea"),this}set(e,t){const n=this.$element;return n&&"scrollTop"===e?("number"!=typeof t&&(t=n.firstChild.scrollHeight),n.firstChild.scrollTop=t,this):super.set(...arguments)}},GUIText:class extends u{static register(){return super.register({tagName:"gui-text",type:"input"},this)}build(){return l(this.$element,"text"),this}},GUIPassword:class extends u{static register(){return super.register({tagName:"gui-password",type:"input"},this)}build(){return l(this.$element,"password"),this}},GUIFileUpload:class extends u{static register(){return super.register({tagName:"gui-file-upload",type:"input"},this)}build(){const e=document.createElement("input");return e.setAttribute("role","button"),e.setAttribute("type","file"),e.onchange=(t=>{e.dispatchEvent(new CustomEvent("_change",{detail:e.files[0]}))}),this.$element.appendChild(e),this}},GUIRadio:class extends u{static register(){return super.register({tagName:"gui-radio",type:"input"},this)}build(){return l(this.$element,"radio"),this}},GUICheckbox:class extends u{static register(){return super.register({tagName:"gui-checkbox",type:"input"},this)}build(){return l(this.$element,"checkbox"),this}},GUISwitch:class extends u{static register(){return super.register({tagName:"gui-switch",type:"input"},this)}set(e,t){if("value"===e){const e=this.$element.querySelector("input"),n=this.$element.querySelector("button");return c(t,e,n),this}return super.set(...arguments)}build(){const e=this.$element,n=document.createElement("input");n.type="checkbox",e.appendChild(n);const r=document.createElement("div"),o=document.createElement("button");function s(e){let t=!1;c(t=void 0===e?!(t=!!n.checked):e,n,o)}return r.appendChild(o),t.createInputLabel(e,"switch",r),i.$bind(r,"pointerup",t=>{t.preventDefault();const n=null!==e.getAttribute("data-disabled");n||s()},!1),s(!1),this}},GUIButton:class extends o{static register(){return super.register({tagName:"gui-button",type:"input"},this)}set(t,n,i){if("value"===t||"label"===t){const t=this.$element.querySelector("button");return e.$empty(t),i?t.innerHTML=n:t.appendChild(document.createTextNode(n)),t.setAttribute("aria-label",n),this}return super.set(...arguments)}create(e){const n=e.label;e.label&&delete e.label;const i=t.createElement("gui-button",e);return n&&i.appendChild(document.createTextNode(n)),i}on(e,t,n){const r=this.$element.querySelector("button");return i.$bind(r,e,t.bind(this),n),this}build(){const n=this.$element,r=n.getAttribute("data-icon"),o=null!==n.getAttribute("data-disabled"),l=n.getAttribute("data-group"),c=t.getValueLabel(n),u=document.createElement("button");var d;return o&&u.setAttribute("disabled","disabled"),function(){c&&e.$addClass(n,"gui-has-label");u.appendChild(document.createTextNode(c)),u.setAttribute("aria-label",c)}(),function(){if(r&&"null"!==r){const t=s._(n.getAttribute("data-tooltip")||""),i=document.createElement("img");i.src=r,i.alt=t,i.title=t,u.firstChild?u.insertBefore(i,u.firstChild):u.appendChild(i),e.$addClass(n,"gui-has-image")}}(),(d=l)&&(u.setAttribute("name",d+"["+a+"]"),i.$bind(u,"pointerup",()=>{let t=n;for(;t.parentNode&&"application-window-content"!==t.tagName.toLowerCase();)t=t.parentNode;e.$addClass(u,"gui-active"),t.querySelectorAll('gui-button[data-group="'+d+'"] > button').forEach(t=>{t.name!==u.name&&e.$removeClass(t,"gui-active")})})),a++,n.setAttribute("role","navigation"),n.appendChild(u),this}},GUISelect:class extends d{static register(){return super.register({tagName:"gui-select",type:"input"},this)}},GUISelectList:class extends d{static register(){return super.register({tagName:"gui-select-list",type:"input"},this)}},GUISlider:class extends u{static register(){return super.register({tagName:"gui-slider",type:"input"},this)}get(e){const t=o.getProperty(this.$element,e);return"value"===e?parseInt(t,10):t}build(){return l(this.$element,"range"),this}},GUIInputModal:class extends o{static register(){return super.register({tagName:"gui-input-modal",type:"input"},this)}on(e,t,n){return"open"===e&&(e="_open"),i.$bind(this.$element,e,t.bind(this),n),this}get(e){if("value"===e){const e=this.$element.querySelector("input");return e.value}return super.get(...arguments)}set(e,t){if("value"===e){const e=this.$element.querySelector("input");return e.removeAttribute("disabled"),e.value=t,e.setAttribute("disabled","disabled"),e.setAttribute("aria-disabled","true"),this}return super.set(...arguments)}build(){const e=this.$element,t=document.createElement("div"),n=document.createElement("input");n.type="text",n.setAttribute("disabled","disabled");const r=document.createElement("button");return r.innerHTML="...",i.$bind(r,"pointerup",t=>{e.dispatchEvent(new CustomEvent("_open",{detail:n.value}))},!1),t.appendChild(n),t.appendChild(r),e.appendChild(t),this}}}}),e("skylark-osjsv2-client/gui/elements/listview",["../../utils/dom","../../utils/gui","../../utils/events","../dataview"],function(e,t,n,i){"use strict";function r(n){const i=n.querySelector("gui-list-view-fake-head gui-list-view-head");e.$empty(i);const r=n.querySelector("gui-list-view-head gui-list-view-row");r&&(i.appendChild(r.cloneNode(!0)),function(){const i=n.querySelector("gui-list-view-fake-head"),r=n.querySelector("gui-list-view-head"),o=i.querySelectorAll("gui-list-view-column"),s=r.querySelectorAll("gui-list-view-column");i.querySelectorAll("gui-list-view-column-resizer").forEach(t=>{e.$remove(t)}),s.forEach((i,r)=>{const s=i.getAttribute("data-resizable");if("true"===s){const s=o[r],a=document.createElement("gui-list-view-column-resizer");s.appendChild(a);let l=0,c=0,u=16,d=u,h=null;t.createDrag(a,e=>{l=i.offsetWidth,d=u,c=n.offsetWidth-n.children.length*u},(t,n)=>{const r=l-n.x;!isNaN(r)&&r>d&&r<c&&(i.style.width=String(r)+"px",s.style.width=String(r)+"px"),h=e.$remove(h)})}})}())}function o(t,n){const i=t.$element;n.querySelectorAll("gui-list-view-column").forEach((t,n)=>{const r=t.getAttribute("data-icon");r&&"null"!==r&&(e.$addClass(t,"gui-has-image"),t.style.backgroundImage="url("+r+")");const o=t.firstChild;if(o&&3===o.nodeType){const e=document.createElement("span");e.appendChild(document.createTextNode(o.nodeValue)),t.insertBefore(e,o),t.removeChild(o)}i._columns[n]&&!i._columns[n].visible&&(t.style.display="none"),t.setAttribute("role","listitem")}),t.bindEntryEvents(n,"gui-list-view-row")}function s(e,n,i){const r=n.label||"";n.label&&delete n.label;let o=null;n.size&&(o=n.size,delete n.size);const s=t.createElement("gui-list-view-column",n);if(o&&(s.style.width=o),"function"==typeof r)s.appendChild(r.call(s,s,n));else{const e=document.createElement("span");e.appendChild(document.createTextNode(r)),s.appendChild(e)}return s}function a(e,n){if((n=n||{}).columns){const i=t.createElement("gui-list-view-row",n,["columns"]);return n.columns.forEach(t=>{i.appendChild(s(e,t))}),i}return null}return{GUIListView:class extends i{static register(){return super.register({parent:i,tagName:"gui-list-view"},this)}values(){const e=this.$element.querySelector("gui-list-view-body"),t=this.getSelected(e.querySelectorAll("gui-list-view-row"));return t}get(e,t,n,i){if("entry"===e){const e=this.$element.querySelector("gui-list-view-body"),r=e.querySelectorAll("gui-list-view-row");return this.getEntry(r,t,n,i)}return super.get(...arguments)}set(t,n,i,o){const a=this.$element;if("columns"===t){const t=a.querySelector("gui-list-view-head"),i=document.createElement("gui-list-view-row");return e.$empty(t),a._columns=[],n.forEach(e=>{e.visible=void 0===e.visible||!0===e.visible;const t=s(this,e,!0);a._columns.push(e),e.visible||(t.style.display="none"),i.appendChild(t)}),t.appendChild(i),r(a),this}if("selected"===t||"value"===t){const e=a.querySelector("gui-list-view-body");return this.setSelected(e,e.querySelectorAll("gui-list-view-row"),n,i,o),this}return super.set(...arguments)}add(e){const t=this.$element.querySelector("gui-list-view-body");return super.add(e,(e,n)=>{const i=n.onCreated||function(){},r=a(this,n);r&&(t.appendChild(r),o(this,r)),i(r)})}clear(){const e=this.$element.querySelector("gui-list-view-body");return super.clear(e)}remove(e){const t=this.$element.querySelector("gui-list-view-body");return super.remove(e,"gui-list-view-row",null,t)}patch(e){const t=this.$element.querySelector("gui-list-view-body");return super.patch(e,"gui-list-view-row",t,a,o)}build(){const e=this.$element;e._columns=[];let t=e.querySelector("gui-list-view-inner"),i=e.querySelector("gui-list-view-head"),s=e.querySelector("gui-list-view-body");function a(e){"GUI-LIST-VIEW-INNER"!==e.parentNode.tagName&&t.appendChild(e)}let l=e.querySelector("gui-list-view-fake-head");if(!l){l=document.createElement("gui-list-view-fake-head");const e=document.createElement("gui-list-view-inner");e.appendChild(document.createElement("gui-list-view-head")),l.appendChild(e)}t||(t=document.createElement("gui-list-view-inner"),e.appendChild(t)),s?a(s):(s=document.createElement("gui-list-view-body"),t.appendChild(s)),s.setAttribute("role","group"),i?a(i):(i=document.createElement("gui-list-view-head"),t.insertBefore(i,s)),i.setAttribute("role","group"),e.setAttribute("role","list"),e.appendChild(l),n.$bind(e,"scroll",t=>{l.style.top=e.scrollTop+"px"},!1);const c=e.querySelectorAll("gui-list-view-head gui-list-view-column");return c.forEach((t,n)=>{const i=t.getAttribute("data-visible"),r={visible:null===i||"true"===i,size:t.getAttribute("data-size")};r.size&&(t.style.width=r.size),e._columns.push(r),r.visible||(t.style.display="none")}),r(e),e.querySelectorAll("gui-list-view-body gui-list-view-row").forEach(e=>{o(this,e)}),super.build(...arguments)}}}}),e("skylark-osjsv2-client/gui/elements/menus",["../../utils/dom","../../utils/gui","../../utils/events","../menu","../element"],function(e,t,n,i,r){"use strict";let o;function s(t,n){const i=t.getAttribute("data-id");let r=e.$index(t);n||(r=parseInt(t.getAttribute("data-index"),10));const o={index:r,id:i};return Array.prototype.slice.call(t.attributes).forEach(e=>{if(e.name.match(/^data\-/)){const t=e.name.replace(/^data\-/,"");void 0===o[t]&&(o[t]=e.value)}}),o}function a(e){return-1!==["select","click"].indexOf(e)?"_select":e}function l(e,t,n,i){t=t||0,i=i||function(){},e.children&&e.children.forEach((e,o)=>{e&&"gui-menu-entry"===e.tagName.toLowerCase()&&(r.createFromNode(e).build(null,n),i(e,t))})}function c(e,t,n,i){const r=!!n.querySelector("gui-menu");if(!r){const e=(i||n).querySelector("label");e.dispatchEvent(new CustomEvent("_select",{detail:s(n,!0)}))}}return{GUIMenuEntry:class extends r{static register(){return super.register({tagName:"gui-menu-entry"},this)}on(e,t,i){e=a(e);const r=this.$element.querySelector("gui-menu-entry > label");return n.$bind(r,e,t.bind(this),i),this}build(n,i){const r=this.$element;if(arguments.length<2)return this;r.setAttribute("role","menuitem"+(r.getAttribute("data-type")||""));const o=t.getLabel(r),s=t.getIcon(r,i);r.setAttribute("aria-label",o);const a=document.createElement("label");return s&&(r.style.backgroundImage="url("+s+")",e.$addClass(a,"gui-has-image")),r.appendChild(a),function(e,t){const n=e.getAttribute("data-type"),i="true"===e.getAttribute("data-checked");let r=null;if(n){const o=e.getAttribute("data-group");(r=document.createElement("input")).type=n,r.name=o?o+"[]":"",i&&r.setAttribute("checked","checked"),t.setAttribute("role","menuitem"+n),t.appendChild(r)}}(r,a),"true"===r.getAttribute("data-labelhtml")?a.innerHTML=o:a.appendChild(document.createTextNode(o)),r.querySelector("gui-menu")?(e.$addClass(r,"gui-menu-expand"),r.setAttribute("aria-haspopup","true")):r.setAttribute("aria-haspopup","false"),this}},GUIMenuBar:class extends r{static register(){return super.register({tagName:"gui-menu-bar"},this)}on(e,t,i){return e=a(e),this.$element.querySelectorAll("gui-menu-bar-entry").forEach(r=>{n.$bind(r,e,t.bind(this),i)}),this}build(){const r=this.$element;return r.setAttribute("role","menubar"),r.querySelectorAll("gui-menu-bar-entry").forEach((e,n)=>{const r=t.getLabel(e),o=document.createElement("span");o.appendChild(document.createTextNode(r)),e.setAttribute("role","menuitem"),e.insertBefore(o,e.firstChild);const s=e.querySelector("gui-menu");i.clamp(s),e.setAttribute("aria-haspopup",String(!!s)),e.setAttribute("data-index",String(n)),function e(t,n){if(t&&t.children){const i=t.children;let r;for(let t=0;t<i.length;t++)"GUI-MENU-ENTRY"===(r=i[t]).tagName&&(r.setAttribute("aria-haspopup",String(!!r.firstChild)),e(r.firstChild,n+1))}}(s,2)}),n.$bind(r,"click",t=>{"GUI-MENU-BAR-ENTRY"===t.target.tagName&&function(t){t.preventDefault();const n=t.target,r=n.querySelector("gui-menu");if("true"===n.getAttribute("data-disabled"))return;n.querySelectorAll("gui-menu-entry").forEach(t=>{e.$removeClass(t,"gui-hover")}),r&&i.setActive(t=>{t instanceof window.Event&&t.stopPropagation(),e.$removeClass(n,"gui-active")});e.$hasClass(n,"gui-active")?r&&e.$removeClass(n,"gui-active"):(r&&e.$addClass(n,"gui-active"),n.dispatchEvent(new CustomEvent("_select",{detail:s(n)})))}(t)},!0),this}},GUIMenu:class extends r{static register(){return super.register({tagName:"gui-menu"},this)}on(e,t,i){return e=a(e),n.$bind(this.$element,e,function(e){"LABEL"===e.target.tagName&&t.apply(new r(e.target.parentNode),arguments)},!0),this}show(e){e.stopPropagation(),e.preventDefault();const t=this.$element.cloneNode(!0);i.create(null,e,t)}set(e,t,n){if("checked"===e){const e=this.$element.querySelector('gui-menu-entry[data-id="'+t+'"]');if(e){const t=e.querySelector("input");t&&(n?t.setAttribute("checked","checked"):t.removeAttribute("checked"))}return this}return super.set(...arguments)}build(e,t){const r=this.$element;r.setAttribute("role","menu");try{l(r,0,t,(n,i)=>{if(e&&n){const e=n.getElementsByTagName("gui-menu");e.forEach(e=>{e&&l(e,i+1,t)})}})}catch(e){console.warn(e)}return e||n.$bind(r,"click",(e,t)=>{clearTimeout(o),o=setTimeout(()=>{o=clearTimeout(o),i.clickWrapper(e,t,c)},1)},!0),this}}}}),e("skylark-osjsv2-client/gui/elements/misc",["../../utils/dom","../../utils/events","../../utils/colors","../element"],function(e,t,n,i){"use strict";class r extends i{static register(){return super.register({tagName:"gui-iframe"},this)}static get _tagName(){let e=!1;try{e=window.navigator.standalone||window.matchMedia("(display-mode: standalone)").matches}catch(e){}return e?"webview":"iframe"}set(e,t){return"src"===e?(this.$element.querySelector(r._tagName).src=t,this):super.set(...arguments)}build(){const e=this.$element,t=e.getAttribute("data-src")||"about:blank",n=document.createElement(r._tagName);return n.src=t,n.setAttribute("border",0),e.appendChild(n),this}}return{GUIColorBox:class extends i{static register(){return super.register({tagName:"gui-color-box"},this)}on(e,n,i){const r=this.$element,o=r.querySelector("div");return t.$bind(o,e,n.bind(this),i),this}set(e,t){return"value"===e?(this.$element.firstChild.style.backgroundColor=t,this):super.set(...arguments)}build(){const e=document.createElement("div");return this.$element.appendChild(e),this}},GUIColorSwatch:class extends i{static register(){return super.register({tagName:"gui-color-swatch"},this)}on(e,n,i){const r=this.$element,o=r.querySelector("canvas");return"select"!==e&&"change"!==e||(e="_change"),t.$bind(o,e,n.bind(this),i),this}build(){const i=this.$element,r=document.createElement("canvas");r.width=100,r.height=100;const o=r.getContext("2d");let s=o.createLinearGradient(0,0,o.canvas.width,0);return s.addColorStop(0,"rgb(255,   0,   0)"),s.addColorStop(.15,"rgb(255,   0, 255)"),s.addColorStop(.33,"rgb(0,     0, 255)"),s.addColorStop(.49,"rgb(0,   255, 255)"),s.addColorStop(.67,"rgb(0,   255,   0)"),s.addColorStop(.84,"rgb(255, 255,   0)"),s.addColorStop(1,"rgb(255,   0,   0)"),o.fillStyle=s,o.fillRect(0,0,o.canvas.width,o.canvas.height),(s=o.createLinearGradient(0,0,0,o.canvas.height)).addColorStop(0,"rgba(255, 255, 255, 1)"),s.addColorStop(.5,"rgba(255, 255, 255, 0)"),s.addColorStop(.5,"rgba(0,     0,   0, 0)"),s.addColorStop(1,"rgba(0,     0,   0, 1)"),o.fillStyle=s,o.fillRect(0,0,o.canvas.width,o.canvas.height),t.$bind(r,"pointerdown",t=>{const i=function(t){const i=e.$position(r),s=void 0===t.offsetX?t.clientX-i.left:t.offsetX,a=void 0===t.offsetY?t.clientY-i.top:t.offsetY;if(isNaN(s)||isNaN(a))return null;const l=o.getImageData(s,a,1,1).data;return{r:l[0],g:l[1],b:l[2],hex:n.convertToHEX(l[0],l[1],l[2])}}(t);i&&r.dispatchEvent(new CustomEvent("_change",{detail:i}))},!1),i.appendChild(r),this}},GUIIframe:r,GUIProgressBar:class extends i{static register(){return super.register({tagName:"gui-progress-bar"},this)}set(e,t){const n=this.$element;return n.setAttribute("data-"+e,t),"progress"===e||"value"===e?(t=parseInt(t,10),t=Math.max(0,Math.min(100,t)),n.setAttribute("aria-label",String(t)),n.setAttribute("aria-valuenow",String(t)),n.querySelector("div").style.width=t.toString()+"%",n.querySelector("span").innerHTML=t+"%",this):super.set(...arguments)}build(){const e=this.$element;let t=e.getAttribute("data-progress")||0;const n=(t=Math.max(0,Math.min(100,t))).toString()+"%",i=document.createElement("div");i.style.width=n;const r=document.createElement("span");return r.appendChild(document.createTextNode(n)),e.setAttribute("role","progressbar"),e.setAttribute("aria-valuemin",0),e.setAttribute("aria-valuemax",100),e.setAttribute("aria-label",0),e.setAttribute("aria-valuenow",0),e.appendChild(i),e.appendChild(r),this}},GUIStatusBar:class extends i{static register(){return super.register({tagName:"gui-statusbar"},this)}set(t,n){if("label"===t||"value"===t){const t=this.$element.getElementsByTagName("gui-statusbar-label")[0];return t&&(e.$empty(t),t.innerHTML=n),this}return super.set(...arguments)}build(e,t){const n=this.$element,i=document.createElement("gui-statusbar-label");let r=n.getAttribute("data-label")||n.getAttribute("data-value");return r||(r=(()=>{let e,t,i=[];for(let r=0;r<n.childNodes.length;r++)(e=n.childNodes[r]).nodeType===Node.TEXT_NODE&&((t=e.nodeValue.replace(/\s+/g,"").replace(/^\s+/g,"")).length>0&&i.push(t),n.removeChild(e),r++);return i.join(" ")})()),i.innerHTML=r,n.setAttribute("role","log"),n.appendChild(i),this}}}}),e("skylark-osjsv2-client/gui/elements/richtext",["../../utils/dom","../../utils/events","../../core/theme","../element"],function(e,t,n,i){"use strict";function r(e,t){return(t=t||e.querySelector("iframe")).contentDocument||t.contentWindow.document}function o(e){e._fixTry=0,e._fixInterval=clearInterval(e._fixInterval)}function s(e,t){o(e),t=t||"";const i=n.getStyleTheme();let s=e.getAttribute("data-editable");s=null===s||"true"===s;const a=function(e){9===e.keyCode&&(!function(e){let t,n;window.getSelection?(t=window.getSelection()).getRangeAt&&t.rangeCount&&((n=t.getRangeAt(0)).deleteContents(),n.insertNode(document.createTextNode(e))):document.selection&&document.selection.createRange&&(document.selection.createRange().text=e)}(" "),e.preventDefault())}.toString()+';window.addEventListener("keydown", onMouseDown)';let l='<!DOCTYPE html><html><head><link rel="stylesheet" type="text/css" href="/themes.css" /><script>'+a+'<\/script></head><body contentEditable="true" data-style-theme="'+i+'"></body></html>';s||(l=l.replace(' contentEditable="true"',""));const c=r(e);c.open(),c.write(l),c.close(),function(e,t,n){if(e._fixTry>10)return void(e._fixTry=0);e._fixInterval=setInterval(()=>{try{n&&(t.body.innerHTML=n),o(e)}catch(e){console.warn("gui-richtext","setDocumentData()",e.stack,e,"... trying again")}e._fixTry++},100)}(e,c,t)}return{GUIRichText:class extends i{static register(){return super.register({tagName:"gui-richtext"},this)}on(e,n,i){return-1!==["selection"].indexOf(e)&&(e="_"+e),t.$bind(this.$element,e,n.bind(this),i),this}build(){const t=this.$element,n=t.childNodes.length?t.childNodes[0].nodeValue:"";e.$empty(t);const i=document.createElement("iframe");return i.setAttribute("border",0),i.onload=(()=>{i.contentWindow.addEventListener("selectstart",()=>{t.dispatchEvent(new CustomEvent("_selection",{detail:{}}))}),i.contentWindow.addEventListener("pointerup",()=>{t.dispatchEvent(new CustomEvent("_selection",{detail:{}}))})}),t.appendChild(i),setTimeout(()=>{try{s(t,n)}catch(e){console.warn("gui-richtext","build()",e)}},1),this}command(){try{const e=r(this.$element);if(e&&e.execCommand)return e.execCommand.apply(e,arguments)}catch(e){console.warn("gui-richtext call() warning",e.stack,e)}return this}query(){try{const e=r(this.$element);if(e&&e.queryCommandValue)return e.queryCommandValue.apply(e,arguments)}catch(e){console.warn("gui-richtext call() warning",e.stack,e)}return null}get(e,t){return"value"===e?function(e){try{const t=r(e);return t.body.innerHTML}catch(e){console.error("gui-richtext","getDocumentData()",e.stack,e)}return""}(this.$element):super.get(...arguments)}set(e,t){return"value"===e?(s(this.$element,t),this):super.set(...arguments)}}}}),e("skylark-osjsv2-client/gui/elements/tabs",["../../utils/dom","../../utils/gui","../../utils/events","../element"],function(e,t,n,i){"use strict";function r(t,n,i){e.$removeClass(t,"gui-active"),n===i&&e.$addClass(t,"gui-active")}function o(t,n,i,o,s){n.querySelectorAll("li").forEach((e,t)=>{r(e,t,o)}),t.querySelectorAll("gui-tab-container").forEach((e,t)=>{r(e,t,o)}),e.$addClass(s,"gui-active"),t.dispatchEvent(new CustomEvent("_change",{detail:{index:o}}))}function s(e,t,n){let i=null;return"number"==typeof n?i=n:t.querySelectorAll("li").forEach((e,t)=>{null===i&&e.firstChild.textContent===n&&(i=t)}),i}function a(e,t,i,r){const s=document.createElement("li"),a=t.children.length;if(n.$bind(s,"pointerdown",n=>{o(e,t,n,a,s)},!1),s.setAttribute("role","tab"),s.setAttribute("aria-label",i),s.appendChild(document.createTextNode(i)),t.appendChild(s),r){const t=document.createElement("gui-tab-container");t.setAttribute("data-label",i),t.setAttribute("role","tabpanel"),e.appendChild(t)}}return{GUITabs:class extends i{static register(){return super.register({tagName:"gui-tabs"},this)}on(e,t,i){return-1!==["select","activate"].indexOf(e)&&(e="change"),"change"===e&&(e="_"+e),n.$bind(this.$element,e,t.bind(this),i),this}set(e,t){if(-1!==["current","selected","active"].indexOf(e)){const e=this.$element,n=e.querySelector("ul"),i=s(e,n,t);return null!==i&&o(e,n,null,i,n[i]),this}return super.set(...arguments)}get(t,n){if(-1!==["current","selected","active"].indexOf(t)){const t=this.$element.querySelector('ul > li[class="gui-active"]');return e.$index(t)}return super.get(...arguments)}add(e){const t=this.$element,n=t.querySelector("ul");return e instanceof Array||(e=[e]),e.forEach(e=>{a(t,n,e,!0)}),this}remove(e){const t=this.$element,n=t.querySelector("ul");return e instanceof Array||(e=[e]),e.forEach(e=>{!function(e,t,n){const i=s(e,t,n);null!==i&&(t.children[i].remove(),e.querySelectorAll("gui-tab-container")[i].remove())}(t,n,e)}),this}build(){const e=this.$element,n=document.createElement("ul");e.querySelectorAll("gui-tab-container").forEach((i,r)=>{a(e,n,t.getLabel(i)),i.setAttribute("role","tabpanel")}),n.setAttribute("role","tablist"),e.setAttribute("role","navigation"),e.children.length?e.insertBefore(n,e.children[0]):e.appendChild(n);const i=parseInt(e.getAttribute("data-selected-index"),10)||0;return o(e,n,null,i),this}}}}),e("skylark-osjsv2-client/gui/elements/treeview",["../../utils/dom","../../utils/gui","../dataview"],function(e,t,n){"use strict";function i(e,n){const i=t.createElement("gui-tree-view-entry",n,["entries"]);return i}function r(n,i,r,o){void 0===o&&(o=!e.$hasClass(r,"gui-expanded")),e.$removeClass(r,"gui-expanded"),o&&e.$addClass(r,"gui-expanded");const s=r.children;for(let e=0;e<s.length;e++)"gui-tree-view-entry"===s[e].tagName.toLowerCase()&&(s[e].style.display=o?"block":"none");const a={index:e.$index(r),data:t.getViewNodeValue(r)};r.setAttribute("data-expanded",String(o)),r.setAttribute("aria-expanded",String(o)),i.dispatchEvent(new CustomEvent("_expand",{detail:{entries:[a],expanded:o,element:r}}))}function o(n,i){const o=n.$element;if(i._rendered)return;i._rendered=!0;const s=i.getAttribute("data-icon"),a=t.getLabel(i),l="true"===o.getAttribute("data-expanded"),c=i.querySelector("gui-tree-view-entry"),u=document.createElement("div"),d=document.createElement("span");function h(t){t.stopPropagation(),e.$addClass(i,"dnd-over")}function p(t){e.$removeClass(i,"dnd-over")}if(s&&(d.style.backgroundImage="url("+s+")",e.$addClass(d,"gui-has-image")),d.appendChild(document.createTextNode(a)),u.appendChild(d),c){e.$addClass(i,"gui-expandable");const t=document.createElement("gui-tree-view-expander");i.insertBefore(u,c),i.insertBefore(t,u)}else i.appendChild(u);if("true"===String(i.getAttribute("data-draggable"))&&t.createDraggable(u,(()=>{let e={};try{e=JSON.parse(i.getAttribute("data-value"))}catch(e){}return{data:e}})()),"true"===String(i.getAttribute("data-droppable"))){let n;t.createDroppable(u,{onEnter:h,onOver:h,onLeave:p,onDrop:p,onItemDropped:(t,r,s)=>{t.stopPropagation(),t.preventDefault(),n=clearTimeout(n),n=setTimeout(()=>{e.$removeClass(i,"dnd-over")},10);let a={};try{a=JSON.parse(r.parentNode.getAttribute("data-value"))}catch(e){}o.dispatchEvent(new CustomEvent("_drop",{detail:{src:s.data,dest:a}}))}})}r(null,o,i,l),n.bindEntryEvents(i,"gui-tree-view-entry")}return{GUITreeView:class extends n{static register(){return super.register({parent:n,tagName:"gui-tree-view"},this)}values(){const e=this.$element;return this.getSelected(e.querySelectorAll("gui-tree-view-entry"))}build(e){const t=this.$element;let n=t.querySelector("gui-tree-view-body"),i=!!n;return n||(n=document.createElement("gui-tree-view-body"),t.appendChild(n)),n.setAttribute("role","group"),t.setAttribute("role","tree"),t.setAttribute("aria-multiselectable",n.getAttribute("data-multiselect")||"false"),t.querySelectorAll("gui-tree-view-entry").forEach((e,t)=>{e.setAttribute("aria-expanded","false"),i||n.appendChild(e),e.setAttribute("role","treeitem"),o(this,e)}),super.build(...arguments)}get(e,t,n){if("entry"===e){const e=this.$element.querySelector("gui-tree-view-body");return this.getEntry(e.querySelectorAll("gui-tree-view-entry"),t,n)}return super.get(...arguments)}set(e,t,n,i){const r=this.$element,o=r.querySelector("gui-tree-view-body");return"selected"===e||"value"===e?(this.setSelected(o,o.querySelectorAll("gui-tree-view-entry"),t,n,i),this):super.set(...arguments)}clear(){const e=this.$element.querySelector("gui-tree-view-body");return super.clear(e)}add(e){const t=this.$element.querySelector("gui-tree-view-body");let n=t;const r=(e,t,n)=>{super.add(e,(e,s)=>{if(s){s.parentNode&&delete s.parentNode;const e=i(this,s);t.appendChild(e),s.entries&&r(s.entries,e,n+1),o(this,e)}})};return"object"!=typeof e||e instanceof Array||!Object.keys(e).length||(n=e.parentNode||t,e=e.entries||[]),r(e,n,0),this}remove(e){return super.remove(e,"gui-tree-view-entry")}patch(e){const t=this.$element.querySelector("gui-tree-view-body");return super.patch(e,"gui-list-view-entry",t,i,o)}expand(e){return r(e.ev,this.$element,e.entry),this}}}}),e("skylark-osjsv2-client/gui/elements/visual",["../../utils/events","../element"],function(e,t){"use strict";function n(t,n,i){"object"!=typeof(i=i||{})&&(console.error("Derp","applyArgs was not an object ?!"),i={});const r=document.createElement(n),o=t.getAttribute("data-src"),s=t.getAttribute("data-controls");s&&r.setAttribute("controls","controls");const a=t.getAttribute("data-autoplay");a&&r.setAttribute("autoplay","autoplay"),Object.keys(i).forEach(function(t){let o=i[t];"function"==typeof o?(t=t.replace(/^on/,""),"video"!==n&&"audio"!==n||"load"!==t||(t="loadedmetadata"),e.$bind(r,t,o.bind(r),!1)):("boolean"==typeof i[t]&&(o=o?"true":"false"),r.setAttribute(t,o))}),r.src=o||"about:blank",t.appendChild(r)}return{GUIAudio:class extends t{static register(){return super.register({tagName:"gui-audio"},this)}on(t,n,i){const r=this.$element.querySelector("audio");return e.$bind(r,t,n.bind(this),i),this}build(e){return n(this.$element,"audio",e),this}},GUIVideo:class extends t{static register(){return super.register({tagName:"gui-video"},this)}on(t,n,i){const r=this.$element.querySelector("video");return e.$bind(r,t,n.bind(this),i),this}build(e){return n(this.$element,"video",e),this}},GUIImage:class extends t{static register(){return super.register({tagName:"gui-image"},this)}on(t,n,i){const r=this.$element.querySelector("img");return e.$bind(r,t,n.bind(this),i),this}build(e){return n(this.$element,"img",e),this}},GUICanvas:class extends t{static register(){return super.register({tagName:"gui-canvas"},this)}on(t,n,i){const r=this.$element.querySelector("canvas");return e.$bind(r,t,n.bind(this),i),this}build(){const e=document.createElement("canvas");return this.$element.appendChild(e),this}}}}),e("skylark-osjsv2-client/helpers/default-application-window",["../vfs/file","../core/window","../core/dialog","../core/locales"],function(e,t,n,i){"use strict";return class extends t{constructor(t,n,i,r){super(...arguments),this.hasClosingDialog=!1,this.currentFile=r?new e(r):null,this.hasChanged=!1}destroy(){super.destroy(...arguments),this.currentFile=null}init(e,t){const n=super.init(...arguments);return n}_inited(){const e=t.prototype._inited.apply(this,arguments),n=this._app,i={MenuNew:()=>{n.newDialog(this.currentFile,this)},MenuSave:()=>{n.saveDialog(this.currentFile,this)},MenuSaveAs:()=>{n.saveDialog(this.currentFile,this,!0)},MenuOpen:()=>{n.openDialog(this.currentFile,this)},MenuClose:()=>{this._close()}};return this._find("SubmenuFile").on("select",e=>{i[e.detail.id]&&i[e.detail.id]()}),this._find("MenuSave").set("disabled",!0),this.currentFile&&(this._app.openFile(this.currentFile,this)||(this.currentFile=null)),e}_onDndEvent(n,i,r,o){if(t.prototype._onDndEvent.apply(this,arguments)&&"itemDrop"===i&&r){const t=r.data;t&&"file"===t.type&&t.mime&&this._app.openFile(new e(t),this)}}_close(){if(!this.hasClosingDialog)return this.hasChanged?(this.hasClosingDialog=!0,void this.checkHasChanged(e=>{this.hasClosingDialog=!1,e&&(this.hasChanged=!1,this._close())})):void t.prototype._close.apply(this,arguments)}checkHasChanged(e){this.hasChanged?n.create("Confirm",{buttons:["yes","no"],message:i._("MSG_GENERIC_APP_DISCARD")},function(t,n){e("ok"===n||"yes"===n)},{parent:this,modal:!0}):e(!0)}showFile(e,t){this.updateFile(e)}updateFile(e){this.currentFile=e||null,this.hasChanged=!1,this._scheme&&this._find("MenuSave").set("disabled",!e),e?this._setTitle(e.filename,!0):this._setTitle()}getFileData(){return null}_onKeyEvent(e,n,i){return"SAVE"===i?(this._app.saveDialog(this.currentFile,this,!this.currentFile),!1):"SAVEAS"===i?(this._app.saveDialog(this.currentFile,this,!0),!1):"OPEN"===i?(this._app.openDialog(this.currentFile,this),!1):t.prototype._onKeyEvent.apply(this,arguments)}}}),e("skylark-osjsv2-client/helpers/default-application",["../core/application","../core/dialog","../vfs/file","../vfs/fs","../utils/fs","../core/locales"],function(e,t,n,i,r,o){"use strict";return class extends e{constructor(e,t,n,i){super(...arguments),this.defaultOptions=Object.assign({},{readData:!0,rawData:!1,extension:"",mime:"application/octet-stream",filetypes:[],filename:"New file"},i)}destroy(){super.destroy(...arguments)}_onMessage(e,i,r){super._onMessage(...arguments);const s=this._getArgument("file"),a=this._getWindow(this.__mainwindow);"vfs"===e&&null!==r.source&&r.source!==this.__pid&&r.file&&a&&s&&s.path===r.file.path&&t.create("Confirm",{buttons:["yes","no"],message:o._("MSG_FILE_CHANGED")},(e,t)=>{"ok"!==t&&"yes"!==t||this.openFile(new n(r.file),a)},{parent:a,modal:!0})}openFile(e,t){if(!e)return!1;const n=t=>!!t&&(OSjs.error(this.__label,o._("ERR_FILE_APP_OPEN"),o._("ERR_FILE_APP_OPEN_ALT_FMT",e.path,t)),!0),s=n=>{this._setArgument("file",e),t.showFile(e,n)},a=this.__metadata.mime||[];if(!r.checkAcceptMime(e.mime,a))return OSjs.error(this.__label,o._("ERR_FILE_APP_OPEN"),o._("ERR_FILE_APP_OPEN_FMT",e.path,e.mime)),!1;function l(e,i){t._toggleLoading(!1),n(e)||s(i)}return t._toggleLoading(!0),this.defaultOptions.readData?i.read(e,{type:this.defaultOptions.rawData?"binary":"text"},this).then(e=>l(!1,e)).catch(e=>l(e)):i.url(e).then(e=>l(!1,e)).catch(e=>l(e)),!0}saveFile(e,t,n){e&&(n._toggleLoading(!0),i.write(e,t||"",null,this).then(()=>(this._setArgument("file",e),n.updateFile(e),!0)).catch(t=>{OSjs.error(this.__label,o._("ERR_FILE_APP_SAVE"),o._("ERR_FILE_APP_SAVE_ALT_FMT",e.path,t))}).finally(()=>{n._toggleLoading(!1)}))}saveDialog(e,n,i,r){const o=n.getFileData();i?t.create("File",{file:e,filename:e?e.filename:this.defaultOptions.filename,filetypes:this.defaultOptions.filetypes,filter:this.__metadata.mime,extension:this.defaultOptions.extension,mime:this.defaultOptions.mime,type:"save"},(e,t,i)=>{"ok"===t&&this.saveFile(i,o,n),"function"==typeof r&&r(e,t,i)},{parent:n,modal:!0}):this.saveFile(e,o,n)}openDialog(e,i){const r=()=>{t.create("File",{file:e,filter:this.__metadata.mime},(e,t,r)=>{"ok"===t&&r&&this.openFile(new n(r),i)},{parent:i,modal:!0})};i.checkHasChanged(e=>{e&&r()})}newDialog(e,t){t.checkHasChanged(e=>{e&&(this._setArgument("file",null),t.showFile(null,null))})}}}),e("skylark-osjsv2-client/helpers/iframe-application-window",["../core/window"],function(e){"use strict";let t=0;return class extends e{constructor(e,t,n){super("IFrameApplicationWindow",t=Object.assign({},{src:"about:blank",focus:function(){},blur:function(){},icon:null,title:"IframeApplicationWindow",width:320,height:240,allow_resize:!1,allow_restore:!1,allow_maximize:!1},t),n),this._iwin=null,this._frame=null}destroy(){return this.postMessage("Window::destroy"),super.destroy(...arguments)}init(e,n){const i=super.init(...arguments);i.style.overflow="visible";const r="IframeApplicationWindow"+t.toString(),o=document.createElement("iframe");o.setAttribute("border",0),o.id=r,o.className="IframeApplicationFrame",o.addEventListener("load",()=>{this._iwin=o.contentWindow,this.postMessage("Window::init")}),this.setLocation(this._opts.src,o),i.appendChild(o),this._frame=o;try{this._iwin=o.contentWindow}catch(e){}return this._iwin&&this._iwin.focus(),this._frame.focus(),this._opts.focus(this._frame,this._iwin),t++,i}_blur(){return!!super._blur(...arguments)&&(this._iwin&&this._iwin.blur(),this._frame&&this._frame.blur(),this._opts.blur(this._frame,this._iwin),!0)}_focus(){return!!super._focus(...arguments)&&(this._iwin&&this._iwin.focus(),this._frame&&this._frame.focus(),this._opts.focus(this._frame,this._iwin),!0)}postMessage(e){this._iwin&&this._app&&(console.debug("IFrameApplicationWindow::postMessage()",e),this._iwin.postMessage({message:e,pid:this._app.__pid,wid:this._wid},window.location.href))}onPostMessage(e,t){console.debug("IFrameApplicationWindow::onPostMessage()",e)}setLocation(e,t){t=t||this._frame;const n=window.onbeforeunload;window.onbeforeunload=null,t.src=e,window.onbeforeunload=n}}}),e("skylark-osjsv2-client/helpers/iframe-application",["./iframe-application-window","../core/application"],function(e,t){"use strict";return class extends t{constructor(e,t,n,i){super(...arguments),this.options=Object.assign({},{icon:"",title:"IframeApplicationWindow"},i),this.options.src=this._getResource(this.options.src)}init(t,n){super.init(...arguments);const i=this.__pname+"Window";this._addWindow(new e(i,this.options,this))}onPostMessage(e,t){console.debug("IFrameApplication::onPostMessage()",e);const n=(t,n)=>{this.postMessage({id:e.id,method:e.method,error:t,result:Object.assign({},n)})};"number"==typeof e.id&&e.method&&(this[e.method]?this[e.method](e.args||{},n):n("No such method"))}postMessage(e){const t=this._getMainWindow();t&&t.postMessage(e)}}}),e("skylark-osjsv2-client/main",["skylark-langx/skylark","./boot","./locales/en_EN","./core/auth/database","./core/auth/demo","./core/auth/pam","./core/auth/standalone","./core/connections/http","./core/connections/standalone","./core/connections/ws","./core/storage/database","./core/storage/demo","./core/storage/standalone","./core/storage/system","./gui/elements/containers","./gui/elements/fileview","./gui/elements/iconview","./gui/elements/inputs","./gui/elements/listview","./gui/elements/menus","./gui/elements/misc","./gui/elements/richtext","./gui/elements/tabs","./gui/elements/treeview","./gui/elements/visual","./helpers/default-application-window","./helpers/default-application","./helpers/event-handler","./helpers/handle-qs","./helpers/hooks","./helpers/iframe-application-window","./helpers/iframe-application","./helpers/settings-fragment","./helpers/window-behaviour"],function(){return{}}),e("skylark-osjsv2-client",["skylark-osjsv2-client/main"],function(e){return e})}(n,require),!i){var s=require("skylark-langx/skylark");r?module.exports=s:t.skylarkjs=s}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-osjsv2-client-all.js.map
