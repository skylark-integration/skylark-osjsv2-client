/**
 * skylark-osjsv2-client - A version of osjs-client that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-osjsv2-client/
 * @license MIT
 */
define(["./locales","./config","./connection","./settings-manager","./package-manager"],function(e,t,n,r,o){"use strict";let s;return class{static get instance(){return s}constructor(){s=this,this.userData={id:0,username:"root",name:"root user",groups:["admin"]},this.loggedIn=!1,this.isStandalone=!1}init(){return this.createUI()}destroy(){s=null}getUser(){return Object.assign({},this.userData)}isLoggedIn(){return this.isLoggedIn}login(t){return new Promise((r,o)=>{n.request("login",t).then(t=>r(t||e._("ERR_LOGIN_INVALID"))).catch(t=>{o(new Error(e._("ERR_LOGIN_FMT",t)))})})}logout(){return new Promise((e,t)=>{n.request("logout",{}).then(t=>e(!!t)).catch(e=>{t(new Error("An error occured: "+e))})})}checkPermission(e){const t=this.getUser().groups||[];return e instanceof Array||(e=[e]),-1!==t.indexOf("admin")||!!e.every(e=>t.indexOf(e)>=0)}requestLogin(e){return new Promise((t,n)=>{this.login(e).then(e=>this.onLogin(e).then(t).catch(n)).catch(n)})}onLogin(n){let s=n.userSettings;return(!s||s instanceof Array)&&(s={}),this.userData=n.userData,document.getElementById("LoadingScreen").style.display="block",e.setLocale(function(){let e=t.getConfig("Locale"),n=t.getUserLocale();t.getConfig("LocaleOptions.AutoDetect",!0)&&n&&(console.info("Auto-detected user locale via browser",n),e=n);let o=r.get("CoreWM");if(!o)try{o=s.CoreWM}catch(e){}return o&&o.language||e}()),r.init(s),n.blacklistedPackages&&o.setBlacklist(n.blacklistedPackages),this.loggedIn=!0,Promise.resolve(!0)}createUI(){return this._renderUI(),this._createUI()}_renderUI(e){e||(e=require("osjs-scheme-loader!login.html"));const t=document.createElement("div");t.innerHTML=e,t.childNodes.forEach(e=>{const t=e.cloneNode(!0);-1===["STYLE","SCRIPT"].indexOf(e.tagName)?document.body.appendChild(t):document.querySelector("head").appendChild(t)})}_createUI(){const e=document.getElementById("Login"),t=document.getElementById("LoginForm"),n=document.getElementById("LoginUsername"),r=document.getElementById("LoginPassword"),o=document.getElementById("LoginSubmit");function s(){o.removeAttribute("disabled"),n.removeAttribute("disabled"),r.removeAttribute("disabled")}return e.style.display="block",s(),new Promise((i,a)=>{t.onsubmit=(t=>{o.setAttribute("disabled","disabled"),n.setAttribute("disabled","disabled"),r.setAttribute("disabled","disabled"),t&&t.preventDefault(),this.requestLogin({username:n.value,password:r.value}).then(()=>(e.parentNode.removeChild(e),i())).catch(e=>{alert(e),s()})})})}}});
//# sourceMappingURL=../sourcemaps/core/authenticator.js.map
