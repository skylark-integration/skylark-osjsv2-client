/**
 * skylark-osjsv2-client - A version of osjs-client that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-osjsv2-client/
 * @license MIT
 */
define(["./handle-qs"],function(e){"use strict";var t=0,o={};return function(n,r,a,s){var i=new Promise(function(i,d){if("string"!=typeof n)throw new TypeError("The method must be a string.");if("string"!=typeof r)throw new TypeError("The URL/path must be a string.");if("function"==typeof a&&(s=a,a={}),null!==a&&void 0!==a||(a={}),"object"!=typeof a)throw new TypeError("Options must be an object (or null).");if("function"!=typeof s&&(s=void 0),a.body)throw new TypeError("JSONP does not support requests that have bodies");if(a.headers)throw new TypeError("JSONP does not support requests that specify headers");if(!1===a.followRedirects)throw new TypeError("JSONP does not support requests that do not follow redirects");a.qs=a.qs||{},a.json&&(Object.keys(a.json).forEach(function(e){a.qs[e]=a.json[e]}),delete a.json);var c=a.callbackName||"then_jsonp_"+ ++t;function u(){a.qs&&(r=e(r,a.qs));var t,n=document.createElement("script"),s=document.getElementsByTagName("head")[0]||document.documentElement,u=!1;function l(e){u||(u=!0,n.onload=n.onreadystatechange=n.onerror=null,clearTimeout(t),c in window&&(e?delete window[c]:window[c]=function(){}),n&&n.parentNode&&n.parentNode.removeChild(n),o[c].length?o[c].shift()():delete o[c])}n.onload=n.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(l(),setTimeout(function(){d(new Error("JSONP callback should already have been called"))},100))},n.onerror=function(){l(),d(new Error("JSONP request failed"))},window[c]=function(e){l(!0),i(e)},t=setTimeout(function(){l(),d(new Error("JSONP timed out"))},a.timeout||1e4),n.src=r,n.async=!0,s.appendChild(n)}!1!==a.callbackParameter&&(a.qs[a.callbackParameter||"callback"]=c),"get"!==n.toLowerCase()&&(a.qs[a.methodParameter||"method"]=n),o[c]?o[c].push(u):(o[c]=[],u())});return i.getBody=function(){return i.then(function(e){return e.getBody()})},i.nodeify(s)}});
//# sourceMappingURL=../sourcemaps/helpers/then-jsonp.js.map
