/**
 * skylark-osjsv2-client - A version of osjs-client that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-osjsv2-client/
 * @license MIT
 */
define(["../core/application","../core/dialog","../vfs/file","../vfs/fs","../utils/fs","../core/locales"],function(e,t,i,s,a,l){"use strict";return class extends e{constructor(e,t,i,s){super(...arguments),this.defaultOptions=Object.assign({},{readData:!0,rawData:!1,extension:"",mime:"application/octet-stream",filetypes:[],filename:"New file"},s)}destroy(){super.destroy(...arguments)}_onMessage(e,s,a){super._onMessage(...arguments);const n=this._getArgument("file"),o=this._getWindow(this.__mainwindow);"vfs"===e&&null!==a.source&&a.source!==this.__pid&&a.file&&o&&n&&n.path===a.file.path&&t.create("Confirm",{buttons:["yes","no"],message:l._("MSG_FILE_CHANGED")},(e,t)=>{"ok"!==t&&"yes"!==t||this.openFile(new i(a.file),o)},{parent:o,modal:!0})}openFile(e,t){if(!e)return!1;const i=t=>!!t&&(OSjs.error(this.__label,l._("ERR_FILE_APP_OPEN"),l._("ERR_FILE_APP_OPEN_ALT_FMT",e.path,t)),!0),n=i=>{this._setArgument("file",e),t.showFile(e,i)},o=this.__metadata.mime||[];if(!a.checkAcceptMime(e.mime,o))return OSjs.error(this.__label,l._("ERR_FILE_APP_OPEN"),l._("ERR_FILE_APP_OPEN_FMT",e.path,e.mime)),!1;function _(e,s){t._toggleLoading(!1),i(e)||n(s)}return t._toggleLoading(!0),this.defaultOptions.readData?s.read(e,{type:this.defaultOptions.rawData?"binary":"text"},this).then(e=>_(!1,e)).catch(e=>_(e)):s.url(e).then(e=>_(!1,e)).catch(e=>_(e)),!0}saveFile(e,t,i){e&&(i._toggleLoading(!0),s.write(e,t||"",null,this).then(()=>(this._setArgument("file",e),i.updateFile(e),!0)).catch(t=>{OSjs.error(this.__label,l._("ERR_FILE_APP_SAVE"),l._("ERR_FILE_APP_SAVE_ALT_FMT",e.path,t))}).finally(()=>{i._toggleLoading(!1)}))}saveDialog(e,i,s,a){const l=i.getFileData();s?t.create("File",{file:e,filename:e?e.filename:this.defaultOptions.filename,filetypes:this.defaultOptions.filetypes,filter:this.__metadata.mime,extension:this.defaultOptions.extension,mime:this.defaultOptions.mime,type:"save"},(e,t,s)=>{"ok"===t&&this.saveFile(s,l,i),"function"==typeof a&&a(e,t,s)},{parent:i,modal:!0}):this.saveFile(e,l,i)}openDialog(e,s){const a=()=>{t.create("File",{file:e,filter:this.__metadata.mime},(e,t,a)=>{"ok"===t&&a&&this.openFile(new i(a),s)},{parent:s,modal:!0})};s.checkHasChanged(e=>{e&&a()})}newDialog(e,t){t.checkHasChanged(e=>{e&&(this._setArgument("file",null),t.showFile(null,null))})}}});
//# sourceMappingURL=../sourcemaps/helpers/default-application.js.map
