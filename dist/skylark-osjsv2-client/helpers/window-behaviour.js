/**
 * skylark-osjsv2-client - A version of osjs-client that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-osjsv2-client/
 * @license MIT
 */
define(["../utils/dom","../utils/events","../core/theme"],function(t,e,i){"use strict";class o{constructor(t,e,o,n){this.win=e,this.$element=e._$element,this.$top=e._$top,this.$handle=e._$resize,this.rectWorkspace=t.getWindowSpace(!0),this.rectWindow={x:e._position.x,y:e._position.y,w:e._dimension.w,h:e._dimension.h,r:e._dimension.w+e._position.x,b:e._dimension.h+e._position.y};const r=Object.assign({},i.getStyleTheme(!0,!0));r.style||(r.style={window:{margin:0,border:0}}),this.theme={topMargin:r.style.window.margin||0,borderSize:r.style.window.border||0},this.snapping={cornerSize:t.getSetting("windowCornerSnap")||0,windowSize:t.getSetting("windowSnap")||0},this.action=o,this.moved=!1,this.direction=null,this.startX=n.x,this.startY=n.y,this.minWidth=e._properties.min_width,this.minHeight=e._properties.min_height;const h=[];t.getWindows().forEach(t=>{if(t&&t._wid!==e._wid){const e=t._position,i=t._dimension,o={left:e.x-this.theme.borderSize,top:e.y-this.theme.borderSize,width:i.w+2*this.theme.borderSize,height:i.h+2*this.theme.borderSize+this.theme.topMargin};o.right=o.left+o.width,o.bottom=e.y+i.h+this.theme.topMargin+this.theme.borderSize,h.push(o)}}),this.snapRects=h}getRect(){const t=this.win;return{left:t._position.x,top:t._position.y,width:t._dimension.w,height:t._dimension.h}}calculateDirection(){const e=t.$position(this.$handle),i=this.startX-e.left,o=this.startY-e.top,n={nw:i<=20&&o<=20,n:i>20&&o<=20,w:i<=20&&o>=20,ne:i>=e.width-20&&o<=20,e:i>=e.width-20&&o>20,se:i>=e.width-20&&o>=e.height-20,sw:i<=20&&o>=e.height-20};let r="s";Object.keys(n).forEach(function(t){n[t]&&(r=t)}),this.direction=r}}return{createWindowBehaviour:function(t,i){let n=null,r={};function h(t,e,o,h){if(!i.getMouseLocked()||!e||!n)return;let s;t.preventDefault();const d=h.x-n.startX,c=h.y-n.startY;(s="move"===e?function(t,e,i,o){let r=n.rectWindow.x+i,h=n.rectWindow.y+o;const s=n.theme.borderSize,d=n.theme.topMargin,c=n.snapping.cornerSize,p=n.snapping.windowSize;h<n.rectWorkspace.top&&(h=n.rectWorkspace.top);let w=r+n.rectWindow.w+2*s,m=h+n.rectWindow.h+d+s;return c>0&&(r-s<=c&&r-s>=-c?r=s:w>=n.rectWorkspace.width-c&&w<=n.rectWorkspace.width+c&&(r=n.rectWorkspace.width-n.rectWindow.w-s),h<=n.rectWorkspace.top+c&&h>=n.rectWorkspace.top-c?h=n.rectWorkspace.top+s:m>=n.rectWorkspace.height+n.rectWorkspace.top-c&&m<=n.rectWorkspace.height+n.rectWorkspace.top+c&&(h=n.rectWorkspace.height+n.rectWorkspace.top-n.rectWindow.h-d-s)),p>0&&n.snapRects.every(function(t){return w>=t.left-p&&w<=t.left+p?(r=t.left-(n.rectWindow.w+2*s),!1):r-s<=t.right+p&&r-s>=t.right-p?(r=t.right+2*s,!1):m>=t.top-p&&m<=t.top+p?(h=t.top-(n.rectWindow.h+2*s+d),!1):!(h<=t.bottom+p&&h>=t.bottom-p&&(h=t.bottom+2*s,1))}),{left:r,top:h,width:null,height:null}}(0,0,d,c):function(t,e,i,o){if(!n||!n.direction)return!1;let h,s,d,c;return-1!==n.direction.indexOf("s")?(s=n.rectWindow.h+o,r.height=Math.max(n.minHeight,s)):-1!==n.direction.indexOf("n")&&(s=n.rectWindow.h-o,(c=n.rectWindow.y+o)<n.rectWorkspace.top?(c=n.rectWorkspace.top,s=r.height):s<n.minHeight&&(c=n.rectWindow.b-n.minHeight),r.height=Math.max(n.minHeight,s),r.top=c),-1!==n.direction.indexOf("e")?(h=n.rectWindow.w+i,r.width=Math.max(n.minWidth,h)):-1!==n.direction.indexOf("w")&&(h=n.rectWindow.w-i,d=n.rectWindow.x+i,h<n.minWidth&&(d=n.rectWindow.r-n.minWidth),r.width=Math.max(n.minWidth,h),r.left=d),r}(0,0,d,c))&&(null!==s.left&&null!==s.top&&(o._move(s.left,s.top),o._emit("move",[s.left,s.top])),null!==s.width&&null!==s.height&&(o._resize(s.width,s.height,!0),o._emit("resize",[s.width,s.height]))),n.moved=!0}function s(t,s,d,c){t.preventDefault(),d._state.maximized||(n=new o(i,d,s,c),r={},d._focus(),"move"===s?(n.$element.setAttribute("data-hint","moving"),document.body.setAttribute("data-window-hint","moving")):(n.calculateDirection(),n.$element.setAttribute("data-hint","resizing"),document.body.setAttribute("data-window-hint","resizing"),r=n.getRect()),d._emit("preop"),e.$bind(document,"pointermove:movewindow,touchmove:movewindowTouch",function(t,e){t.preventDefault(),i._mouselock&&h(t,s,d,e)},!1),e.$bind(document,"pointerup:movewindowstop,touchend:movewindowstopTouch",function(t,i){!function(t,e,i,o){n&&(n.moved&&("move"===e?(i._onChange("move",!0),i._emit("moved",[i._position.x,i._position.y])):"resize"===e&&(i._onChange("resize",!0),i._emit("resized",[i._dimension.w,i._dimension.h]))),n.$element.setAttribute("data-hint",""),document.body.setAttribute("data-window-hint",""),i._emit("postop"),n=null)}(0,s,d),e.$unbind(document,"pointermove:movewindow,touchmove:movewindowTouch"),e.$unbind(document,"pointerup:movewindowstop,touchend:movewindowstopTouch")},!1))}t._properties.allow_move&&e.$bind(t._$top,"pointerdown,touchstart",(e,i)=>{e.preventDefault(),t._destroyed||s(e,"move",t,i)},!0),t._properties.allow_resize&&e.$bind(t._$resize,"pointerdown,touchstart",(e,i)=>{e.preventDefault(),t._destroyed||s(e,"resize",t,i)})}}});
//# sourceMappingURL=../sourcemaps/helpers/window-behaviour.js.map
