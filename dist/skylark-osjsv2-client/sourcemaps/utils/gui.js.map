{"version":3,"sources":["utils/gui.js"],"names":["define","DOM","Events","Compability","PackageManager","Theme","getLabel","el","getAttribute","createInputLabel","type","input","label","lbl","document","createElement","span","appendChild","createTextNode","getWindowId","parentNode","attr","parseInt","getValueLabel","childNodes","length","nodeType","nodeValue","$empty","getViewNodeValue","value","match","JSON","parse","e","getIcon","win","image","getPackageResource","_app","size","spl","split","siz","shift","join","getProperty","param","tagName","isDataView","toLowerCase","indexOf","querySelector","checked","setProperty","_setKnownAttribute","i","k","v","a","setAttribute","removeAttribute","String","_setValueAttribute","stringify","inner","children","accept","firstChild","params","readonly","disabled","$remove","replace","ignoreParams","classMap","textalign","$addClass","className","Object","keys","forEach","fvalue","getValue","setFlexbox","grow","shrink","basis","checkel","flex","push","style","webkitBoxFlex","mozBoxFlex","webkitFlex","mozFlex","msFlex","oFlex","align","$removeClass","createDrag","onDown","onMove","onUp","startX","startY","currentX","currentY","dragging","_onMouseMove","ev","pos","touchDevice","preventDefault","x","y","_onMouseUp","$unbind","window","$bind","getNextElement","prev","current","root","elements","ignore_roles","list","querySelectorAll","$hasClass","offsetParent","getElements","currentParent","els","m","cur","getCurrentParent","currentIndex","found","every","idx","getCurrentIndex","next","getNext","createDraggable","args","_dragStart","dataTransfer","effectAllowed","effect","dragImage","setDragImage","dragEl","element","dragPos","offset","body","setData","mime","data","console","warn","stack","assign","onStart","onEnd","isIE","this","opacity","createDroppable","_onDrop","stopPropagation","result","files","onFilesDropped","getData","item","onItemDropped","_doDrop","onDrop","onEnter","onOver","onLeave","call","start","matcher","getParent","target","dropEffect"],"mappings":"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","file":"../../utils/gui.js","sourcesContent":["define([\n    './dom',\n    './events',\n    './compability',\n    '../core/package-manager',\n    '../core/theme'\n], function (DOM, Events, Compability, PackageManager, Theme) {\n    'use strict';\n    function getWindowId(el) {\n        while (el.parentNode) {\n            const attr = el.getAttribute('data-window-id');\n            if (attr !== null) {\n                return parseInt(attr, 10);\n            }\n            el = el.parentNode;\n        }\n        return null;\n    }\n    function getLabel(el) {\n        const label = el.getAttribute('data-label');\n        return label || '';\n    }\n    function getValueLabel(el, attr) {\n        let label = attr ? el.getAttribute('data-label') : null;\n        if (el.childNodes.length && el.childNodes[0].nodeType === 3 && el.childNodes[0].nodeValue) {\n            label = el.childNodes[0].nodeValue;\n            DOM.$empty(el);\n        }\n        return label || '';\n    }\n    function getViewNodeValue(el) {\n        let value = el.getAttribute('data-value');\n        if (typeof value === 'string' && value.match(/^\\[|\\{/)) {\n            try {\n                value = JSON.parse(value);\n            } catch (e) {\n                value = null;\n            }\n        }\n        return value;\n    }\n    function getIcon(el, win) {\n        let image = el.getAttribute('data-icon');\n        if (image) {\n            return win ? PackageManager.getPackageResource(win._app, image) : image;\n        }\n        image = el.getAttribute('data-stock-icon');\n        if (image && image !== 'undefined') {\n            let size = '16x16';\n            try {\n                let spl = image.split('/');\n                let tmp = spl.shift();\n                let siz = tmp.match(/^\\d+x\\d+/);\n                if (siz) {\n                    size = siz[0];\n                    image = spl.join('/');\n                }\n                image = Theme.getIcon(image, size);\n            } catch (e) {\n            }\n            return image;\n        }\n        return null;\n    }\n    function getProperty(el, param, tagName) {\n        tagName = tagName || el.tagName.toLowerCase();\n        const isDataView = tagName.match(/^gui\\-(tree|icon|list|file)\\-view$/);\n        if (param === 'value' && !isDataView) {\n            if ([\n                    'gui-text',\n                    'gui-password',\n                    'gui-textarea',\n                    'gui-slider',\n                    'gui-select',\n                    'gui-select-list'\n                ].indexOf(tagName) >= 0) {\n                return el.querySelector('input, textarea, select').value;\n            }\n            if ([\n                    'gui-checkbox',\n                    'gui-radio',\n                    'gui-switch'\n                ].indexOf(tagName) >= 0) {\n                return !!el.querySelector('input').checked;\n            }\n            return null;\n        }\n        //if ((param === 'value' || param === 'selected') && isDataView) {\n        //    return GUIElement.createFromNode(el).values();\n        //}\n        return el.getAttribute('data-' + param);\n    }\n    function createInputLabel(el, type, input, label) {\n        label = label || getLabel(el);\n        if (label) {\n            const lbl = document.createElement('label');\n            const span = document.createElement('span');\n            span.appendChild(document.createTextNode(label));\n            if (type === 'checkbox' || type === 'radio') {\n                lbl.appendChild(input);\n                lbl.appendChild(span);\n            } else {\n                lbl.appendChild(span);\n                lbl.appendChild(input);\n            }\n            el.appendChild(lbl);\n        } else {\n            el.appendChild(input);\n        }\n    }\n    function setProperty(el, param, value, tagName) {\n        tagName = tagName || el.tagName.toLowerCase();\n        function _setKnownAttribute(i, k, v, a) {\n            if (v) {\n                i.setAttribute(k, k);\n            } else {\n                i.removeAttribute(k);\n            }\n            if (a) {\n                el.setAttribute('aria-' + k, String(value === true));\n            }\n        }\n        function _setValueAttribute(i, k, v) {\n            if (typeof v === 'object') {\n                try {\n                    v = JSON.stringify(value);\n                } catch (e) {\n                }\n            }\n            i.setAttribute(k, String(v));\n        }\n        const inner = el.children[0];\n        let accept = [\n            'gui-slider',\n            'gui-text',\n            'gui-password',\n            'gui-textarea',\n            'gui-checkbox',\n            'gui-radio',\n            'gui-select',\n            'gui-select-list',\n            'gui-button'\n        ];\n        (function () {\n            let firstChild;\n            const params = {\n                readonly: function () {\n                    _setKnownAttribute(firstChild, 'readonly', value, true);\n                },\n                disabled: function () {\n                    _setKnownAttribute(firstChild, 'disabled', value, true);\n                },\n                value: function () {\n                    if (tagName === 'gui-radio' || tagName === 'gui-checkbox') {\n                        _setKnownAttribute(firstChild, 'checked', value);\n                        firstChild.checked = !!value;\n                    }\n                    firstChild.value = value;\n                },\n                label: function () {\n                    el.appendChild(firstChild);\n                    DOM.$remove(el.querySelector('label'));\n                    createInputLabel(el, tagName.replace(/^gui\\-/, ''), firstChild, value);\n                }\n            };\n            if (accept.indexOf(tagName) >= 0) {\n                firstChild = el.querySelector('textarea, input, select, button');\n                if (firstChild) {\n                    if (params[param]) {\n                        params[param]();\n                    } else {\n                        _setValueAttribute(firstChild, param, value || '');\n                    }\n                }\n            }\n        }());\n        accept = [\n            'gui-image',\n            'gui-audio',\n            'gui-video'\n        ];\n        if ([\n                'src',\n                'controls',\n                'autoplay',\n                'alt'\n            ].indexOf(param) >= 0 && accept.indexOf(tagName) >= 0) {\n            inner[param] = value;\n        }\n        if ([\n                '_id',\n                '_class',\n                '_style'\n            ].indexOf(param) >= 0) {\n            inner.setAttribute(param.replace(/^_/, ''), value);\n            return;\n        }\n        if (param !== 'value') {\n            _setValueAttribute(el, 'data-' + param, value);\n        }\n    }\n    function createElement(tagName, params, ignoreParams) {\n        ignoreParams = ignoreParams || [];\n        const el = document.createElement(tagName);\n        const classMap = {\n            textalign: function (v) {\n                DOM.$addClass(el, 'gui-align-' + v);\n            },\n            className: function (v) {\n                DOM.$addClass(el, v);\n            }\n        };\n        function getValue(k, value) {\n            if (typeof value === 'boolean') {\n                value = value ? 'true' : 'false';\n            } else if (typeof value === 'object') {\n                try {\n                    value = JSON.stringify(value);\n                } catch (e) {\n                }\n            }\n            return value;\n        }\n        if (typeof params === 'object') {\n            Object.keys(params).forEach(function (k) {\n                if (ignoreParams.indexOf(k) >= 0) {\n                    return;\n                }\n                const value = params[k];\n                if (typeof value !== 'undefined' && typeof value !== 'function') {\n                    if (classMap[k]) {\n                        classMap[k](value);\n                        return;\n                    }\n                    const fvalue = getValue(k, value);\n                    el.setAttribute('data-' + k, fvalue);\n                }\n            });\n        }\n        return el;\n    }\n    function setFlexbox(el, grow, shrink, basis, checkel) {\n        checkel = checkel || el;\n        (function () {\n            if (typeof basis === 'undefined' || basis === null) {\n                basis = checkel.getAttribute('data-basis') || 'auto';\n            }\n        }());\n        (function () {\n            if (typeof grow === 'undefined' || grow === null) {\n                grow = checkel.getAttribute('data-grow') || 0;\n            }\n        }());\n        (function () {\n            if (typeof shrink === 'undefined' || shrink === null) {\n                shrink = checkel.getAttribute('data-shrink') || 0;\n            }\n        }());\n        const flex = [\n            grow,\n            shrink\n        ];\n        if (basis.length) {\n            flex.push(basis);\n        }\n        const style = flex.join(' ');\n        el.style.webkitBoxFlex = style;\n        el.style.mozBoxFlex = style;\n        el.style.webkitFlex = style;\n        el.style.mozFlex = style;\n        el.style.msFlex = style;\n        el.style.oFlex = style;\n        el.style.flex = style;\n        const align = el.getAttribute('data-align');\n        DOM.$removeClass(el, 'gui-flex-align-start');\n        DOM.$removeClass(el, 'gui-flex-align-end');\n        if (align) {\n            DOM.$addClass(el, 'gui-flex-align-' + align);\n        }\n    }\n    function createDrag(el, onDown, onMove, onUp) {\n        onDown = onDown || function () {\n        };\n        onMove = onMove || function () {\n        };\n        onUp = onUp || function () {\n        };\n        let startX, startY, currentX, currentY;\n        let dragging = false;\n        function _onMouseMove(ev, pos, touchDevice) {\n            ev.preventDefault();\n            if (dragging) {\n                currentX = pos.x;\n                currentY = pos.y;\n                const diffX = currentX - startX;\n                const diffY = currentY - startY;\n                onMove(ev, {\n                    x: diffX,\n                    y: diffY\n                }, {\n                    x: currentX,\n                    y: currentY\n                });\n            }\n        }\n        function _onMouseUp(ev, pos, touchDevice) {\n            onUp(ev, {\n                x: currentX,\n                y: currentY\n            });\n            dragging = false;\n            Events.$unbind(window, 'pointerup:guidrag');\n            Events.$unbind(window, 'pointermove:guidrag');\n        }\n        function _onMouseDown(ev, pos, touchDevice) {\n            ev.preventDefault();\n            startX = pos.x;\n            startY = pos.y;\n            onDown(ev, {\n                x: startX,\n                y: startY\n            });\n            dragging = true;\n            Events.$bind(window, 'pointerup:guidrag', _onMouseUp, false);\n            Events.$bind(window, 'pointermove:guidrag', _onMouseMove, false);\n        }\n        Events.$bind(el, 'pointerdown', _onMouseDown, false);\n    }\n    function getNextElement(prev, current, root) {\n        function getElements() {\n            const ignore_roles = [\n                'menu',\n                'menuitem',\n                'grid',\n                'gridcell',\n                'listitem'\n            ];\n            const list = [];\n            root.querySelectorAll('.gui-element').forEach(function (e) {\n                if (DOM.$hasClass(e, 'gui-focus-element') || ignore_roles.indexOf(e.getAttribute('role')) >= 0 || e.getAttribute('data-disabled') === 'true') {\n                    return;\n                }\n                if (e.offsetParent) {\n                    list.push(e);\n                }\n            });\n            return list;\n        }\n        function getCurrentIndex(els, m) {\n            let found = -1;\n            if (m) {\n                els.every(function (e, idx) {\n                    if (e === m) {\n                        found = idx;\n                    }\n                    return found === -1;\n                });\n            }\n            return found;\n        }\n        function getCurrentParent(els, m) {\n            if (m) {\n                let cur = m;\n                while (cur.parentNode) {\n                    if (DOM.$hasClass(cur, 'gui-element')) {\n                        return cur;\n                    }\n                    cur = cur.parentNode;\n                }\n                return null;\n            }\n            return els[0];\n        }\n        function getNextIndex(els, p, i) {\n            if (prev) {\n                i = i <= 0 ? els.length - 1 : i - 1;\n            } else {\n                i = i >= els.length - 1 ? 0 : i + 1;\n            }\n            return i;\n        }\n        function getNext(els, i) {\n            let next = els[i];\n            if (next.tagName.match(/^GUI\\-(BUTTON|TEXT|PASSWORD|SWITCH|CHECKBOX|RADIO|SELECT)/)) {\n                next = next.querySelectorAll('input, textarea, button, select')[0];\n            }\n            if (next.tagName === 'GUI-FILE-VIEW') {\n                next = next.children[0];\n            }\n            return next;\n        }\n        if (root) {\n            const elements = getElements();\n            if (elements.length) {\n                const currentParent = getCurrentParent(elements, current);\n                const currentIndex = getCurrentIndex(elements, currentParent);\n                if (currentIndex >= 0) {\n                    const nextIndex = getNextIndex(elements, currentParent, currentIndex);\n                    return getNext(elements, nextIndex);\n                }\n            }\n        }\n        return null;\n    }\n    function createDraggable(el, args) {\n        args = Object.assign({}, {\n            type: null,\n            effect: 'move',\n            data: null,\n            mime: 'application/json',\n            dragImage: null,\n            onStart: function () {\n                return true;\n            },\n            onEnd: function () {\n                return true;\n            }\n        }, args);\n        if (Compability.isIE()) {\n            args.mime = 'text';\n        }\n        function _toString(mime) {\n            return JSON.stringify({\n                type: args.type,\n                effect: args.effect,\n                data: args.data,\n                mime: args.mime\n            });\n        }\n        function _dragStart(ev) {\n            try {\n                ev.dataTransfer.effectAllowed = args.effect;\n                if (args.dragImage && typeof args.dragImage === 'function') {\n                    if (ev.dataTransfer.setDragImage) {\n                        const dragImage = args.dragImage(ev, el);\n                        if (dragImage) {\n                            const dragEl = dragImage.element;\n                            const dragPos = dragImage.offset;\n                            document.body.appendChild(dragEl);\n                            ev.dataTransfer.setDragImage(dragEl, dragPos.x, dragPos.y);\n                        }\n                    }\n                }\n                ev.dataTransfer.setData(args.mime, _toString(args.mime));\n            } catch (e) {\n                console.warn('Failed to dragstart: ' + e);\n                console.warn(e.stack);\n            }\n        }\n        el.setAttribute('draggable', 'true');\n        el.setAttribute('aria-grabbed', 'false');\n        Events.$bind(el, 'dragstart', function (ev) {\n            this.setAttribute('aria-grabbed', 'true');\n            this.style.opacity = '0.4';\n            if (ev.dataTransfer) {\n                _dragStart(ev);\n            }\n            return args.onStart(ev, this, args);\n        }, false);\n        Events.$bind(el, 'dragend', function (ev) {\n            this.setAttribute('aria-grabbed', 'false');\n            this.style.opacity = '1.0';\n            return args.onEnd(ev, this, args);\n        }, false);\n    }\n    function createDroppable(el, args) {\n        args = Object.assign({}, {\n            accept: null,\n            effect: 'move',\n            mime: 'application/json',\n            files: true,\n            onFilesDropped: function () {\n                return true;\n            },\n            onItemDropped: function () {\n                return true;\n            },\n            onEnter: function () {\n                return true;\n            },\n            onOver: function () {\n                return true;\n            },\n            onLeave: function () {\n                return true;\n            },\n            onDrop: function () {\n                return true;\n            }\n        }, args);\n        if (Compability.isIE()) {\n            args.mime = 'text';\n        }\n        function getParent(start, matcher) {\n            if (start === matcher) {\n                return true;\n            }\n            let i = 10;\n            while (start && i > 0) {\n                if (start === matcher) {\n                    return true;\n                }\n                start = start.parentNode;\n                i--;\n            }\n            return false;\n        }\n        function _doDrop(ev, el) {\n            if (!ev.dataTransfer) {\n                return true;\n            }\n            if (args.files) {\n                const files = ev.dataTransfer.files;\n                if (files && files.length) {\n                    return args.onFilesDropped(ev, el, files, args);\n                }\n            }\n            try {\n                const data = ev.dataTransfer.getData(args.mime);\n                const item = JSON.parse(data);\n                if (args.accept === null || args.accept === item.type) {\n                    return args.onItemDropped(ev, el, item, args);\n                }\n            } catch (e) {\n                console.warn('Failed to drop: ' + e);\n            }\n            return false;\n        }\n        function _onDrop(ev, el) {\n            ev.stopPropagation();\n            ev.preventDefault();\n            const result = _doDrop(ev, el);\n            args.onDrop(ev, el);\n            return result;\n        }\n        el.setAttribute('aria-dropeffect', args.effect);\n        Events.$bind(el, 'drop', function (ev) {\n            return _onDrop(ev, this);\n        }, false);\n        Events.$bind(el, 'dragenter', function (ev) {\n            return args.onEnter.call(this, ev, this, args);\n        }, false);\n        Events.$bind(el, 'dragover', function (ev) {\n            ev.preventDefault();\n            if (!getParent(ev.target, el)) {\n                return false;\n            }\n            ev.stopPropagation();\n            ev.dataTransfer.dropEffect = args.effect;\n            return args.onOver.call(this, ev, this, args);\n        }, false);\n        Events.$bind(el, 'dragleave', function (ev) {\n            return args.onLeave.call(this, ev, this, args);\n        }, false);\n    }\n    return {\n        getWindowId: getWindowId,\n        getLabel: getLabel,\n        getValueLabel: getValueLabel,\n        getViewNodeValue: getViewNodeValue,\n        getIcon: getIcon,\n        getProperty: getProperty,\n        createInputLabel: createInputLabel,\n        setProperty: setProperty,\n        createElement: createElement,\n        setFlexbox: setFlexbox,\n        createDrag: createDrag,\n        getNextElement: getNextElement,\n        createDraggable: createDraggable,\n        createDroppable: createDroppable\n    };\n});"]}