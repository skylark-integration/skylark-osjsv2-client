/**
 * skylark-osjsv2-client - A version of osjs-client that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-osjsv2-client/
 * @license MIT
 */
define(["../../utils/dom","../../utils/events","../../core/theme","../element"],function(e,t,n,r){"use strict";function i(e,t){return(t=t||e.querySelector("iframe")).contentDocument||t.contentWindow.document}function c(e){e._fixTry=0,e._fixInterval=clearInterval(e._fixInterval)}function o(e,t){c(e),t=t||"";const r=n.getStyleTheme();let o=e.getAttribute("data-editable");o=null===o||"true"===o;let s='<!DOCTYPE html><html><head><link rel="stylesheet" type="text/css" href="/themes.css" /><script>'+(function(e){9===e.keyCode&&(function(e){let t,n;window.getSelection?(t=window.getSelection()).getRangeAt&&t.rangeCount&&((n=t.getRangeAt(0)).deleteContents(),n.insertNode(document.createTextNode(e))):document.selection&&document.selection.createRange&&(document.selection.createRange().text=e)}("Â "),e.preventDefault())}.toString()+';window.addEventListener("keydown", onMouseDown)')+'<\/script></head><body contentEditable="true" data-style-theme="'+r+'"></body></html>';o||(s=s.replace(' contentEditable="true"',""));const a=i(e);a.open(),a.write(s),a.close(),function(e,t,n){e._fixTry>10?e._fixTry=0:e._fixInterval=setInterval(()=>{try{n&&(t.body.innerHTML=n),c(e)}catch(e){console.warn("gui-richtext","setDocumentData()",e.stack,e,"... trying again")}e._fixTry++},100)}(e,a,t)}return{GUIRichText:class extends r{static register(){return super.register({tagName:"gui-richtext"},this)}on(e,n,r){return-1!==["selection"].indexOf(e)&&(e="_"+e),t.$bind(this.$element,e,n.bind(this),r),this}build(){const t=this.$element,n=t.childNodes.length?t.childNodes[0].nodeValue:"";e.$empty(t);const r=document.createElement("iframe");return r.setAttribute("border",0),r.onload=(()=>{r.contentWindow.addEventListener("selectstart",()=>{t.dispatchEvent(new CustomEvent("_selection",{detail:{}}))}),r.contentWindow.addEventListener("pointerup",()=>{t.dispatchEvent(new CustomEvent("_selection",{detail:{}}))})}),t.appendChild(r),setTimeout(()=>{try{o(t,n)}catch(e){console.warn("gui-richtext","build()",e)}},1),this}command(){try{const e=i(this.$element);if(e&&e.execCommand)return e.execCommand.apply(e,arguments)}catch(e){console.warn("gui-richtext call() warning",e.stack,e)}return this}query(){try{const e=i(this.$element);if(e&&e.queryCommandValue)return e.queryCommandValue.apply(e,arguments)}catch(e){console.warn("gui-richtext call() warning",e.stack,e)}return null}get(e,t){return"value"===e?function(e){try{return i(e).body.innerHTML}catch(e){console.error("gui-richtext","getDocumentData()",e.stack,e)}return""}(this.$element):super.get(...arguments)}set(e,t){return"value"===e?(o(this.$element,t),this):super.set(...arguments)}}}});
//# sourceMappingURL=../../sourcemaps/gui/elements/richtext.js.map
