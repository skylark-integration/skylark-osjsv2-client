/**
 * skylark-osjsv2-client - A version of osjs-client that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-osjsv2-client/
 * @license MIT
 */
define(["../utils/gui","../utils/dom","../utils/events","./element","../core/window-manager","../helpers/hooks"],function(t,e,n,i,o,c){"use strict";let u;function l(t,n,i,o){t.stopPropagation();let c=t.target;c&&"LABEL"===c.tagName&&(c=c.parentNode);let u=!1;if(c&&"GUI-MENU-ENTRY"===c.tagName){u=!!c.querySelector("gui-menu");try{u&&!t.isTrusted&&(c.parentNode.querySelectorAll("gui-menu-entry").forEach(t=>{e.$removeClass(t,"active")}),e.$addClass(c,"active"))}catch(t){console.warn(t)}i(t,n,c,o,u)}}function a(t){const n=e.$position(t);n&&window.innerWidth-n.right<t.offsetWidth&&(e.$addClass(t,"gui-overflowing"),function t(e){e.querySelectorAll("gui-menu-entry").forEach(function(e){const n=e.querySelector("gui-menu");n&&(n.style.left=String(-parseInt(n.offsetWidth,10))+"px",t(n))})}(t)),e.$addClass(t,"gui-showing")}function r(t){u&&u(t),u=null,c.triggerHook("menuBlur")}return{clickWrapper:l,clamp:a,blur:r,create:function(c,s,d){c=c||[],r(s);let g=d,m=[];g||(g=t.createElement("gui-menu",{}),function e(n,i){n.forEach(function(n){const o={label:n.title,icon:n.icon,disabled:n.disabled,labelHTML:n.titleHTML,type:n.type,checked:n.checked},c=t.createElement("gui-menu-entry",o);if(n.menu){const i=t.createElement("gui-menu",{});e(n.menu,i),c.appendChild(i)}if(n.onClick){const t=m.push(n.onClick);c.setAttribute("data-callback-id",String(t-1))}i.appendChild(c)})}(c||[],g),i.createFromNode(g,null,"gui-menu").build(!0),n.$bind(g,"mouseover",function(t,n){t.target&&"GUI-MENU-ENTRY"===t.target.tagName&&setTimeout(()=>{!function(t){if(t){const n=e.$position(t),i=o.instance.getWindowSpace(!0);if(n){const e=i.height-n.bottom;e<0&&(t.style.marginTop=String(e)+"px")}}}(t.target.querySelector("gui-menu"))},1)},!0),n.$bind(g,"click",function(t,e){l(t,e,function(t,e,n,i,o){const c=parseInt(n.getAttribute("data-callback-id"),10);m[c]&&m[c](t,e),o||r(t)})},!0)),g.$element&&(g=g.$element);const f=o.instance.getWindowSpace(!0),h=n.mousePosition(s);e.$addClass(g,"gui-root-menu"),g.style.left=h.x+"px",g.style.top=h.y+"px",document.body.appendChild(g),setTimeout(function(){const t=e.$position(g);if(t){if(t.right>f.width){const e=Math.round(f.width-t.width);g.style.left=Math.max(0,e)+"px"}if(t.bottom>f.height){const e=Math.round(f.height-t.height);g.style.top=Math.max(0,e)+"px"}}a(g),u=function(){m=[],g&&(g.querySelectorAll("gui-menu-entry").forEach(function(t){n.$unbind(t)}),n.$unbind(g)),g=e.$remove(g)}},1)},setActive:function(t){r(),u=t}}});
//# sourceMappingURL=../sourcemaps/gui/menu.js.map
