/**
 * skylark-osjsv2-client - A version of osjs-client that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-osjsv2-client/
 * @license MIT
 */
define(["../utils/dom","../utils/gui","../core/locales","../core/package-manager"],function(e,t,n,r){"use strict";let l={};function s(e){const t={"gui-switch":"button","gui-list-view":"textarea","gui-tree-view":"textarea","gui-icon-view":"textarea","gui-input-modal":"button"};return t[e.tagName]?e.$element.querySelector(t[e.tagName]):e.$element.firstChild||e.$element}function a(e,t,n,r){let s;return e=e||t.tagName.toLowerCase(),l[e]&&(s=new l[e].component(t,n),r&&s.build.apply(s,r)),s}return class i{constructor(e,t){this.$element=e||null,this.tagName=e?e.tagName.toLowerCase():null,this.oldDisplay=null,e||console.warn("GUIElement() was constructed without a DOM element",t)}build(){return this}remove(){return this.$element=e.$remove(this.$element),this}empty(){return e.$empty(this.$element),this}blur(){if(this.$element){const e=s(this);e&&e.blur()}return this}focus(){if(this.$element){const e=s(this);e&&e.focus()}return this}show(){return this.$element&&!this.$element.offsetParent&&this.$element&&(this.$element.style.display=this.oldDisplay||""),this}hide(){return this.$element&&this.$element.offsetParent&&(this.oldDisplay||(this.oldDisplay=this.$element.style.display),this.$element.style.display="none"),this}on(e,t,n){return this}son(e,t,n,r){return this.on(e,function(){const e=Array.prototype.slice.call(arguments);e.unshift(this),n.apply(t,e)},r)}set(e,n,r,l){return this.$element&&t.setProperty(this.$element,e,n,r,l),this}get(e){return this.$element?i.getProperty(this.$element,e):null}append(e){e instanceof i?e=e.$element:"string"!=typeof e&&"number"!=typeof e||(e=document.createTextNode(String(e)));let t=document.createElement("div");return t.appendChild(e),this._append(t),t=null,this}appendHTML(e,t,n){const r=document.createElement("div");return r.innerHTML=e,this._append(r,t,n)}_append(e,t,n){for(e instanceof Element&&i.parseNode(t,e,null,n);e.childNodes.length;)this.$element.appendChild(e.childNodes[0]);return e=null,this}querySelector(e,t){const n=this.$element.querySelector(e);return t?i.createFromNode(n,e):n}querySelectorAll(e,t){let n=this.$element.querySelectorAll(e);return t&&(n=n.map(t=>i.createFromNode(t,e))),n}css(t,n){return e.$css(this.$element,t,n),this}position(){return e.$position(this.$element)}_call(e,t,n){arguments.length<3&&console.warn('Element::_call("methodName") is DEPRECATED, use "instance.methodName()" instead');try{return"function"==typeof this._call?this._call(e,t):this[e](t)}catch(e){console.warn(e.stack,e)}return null}fn(e,t,n){return console.warn('Element::fn("methodName") is DEPRECATED, use "instance.methodName()" instead'),t=t||[],n=n||this,this.fn(e,t,n)}static createInto(e,t,n,r,l){n instanceof i&&(n=n.$element);const s=i.create(e,t,r,l);return n.appendChild(s.$element),s}static createFromNode(e,t,n){if(e){const n=a(null,e,t);if(n)return n}return new i(e,t)}static getProperty(e,n,r){const l=(r=r||e.tagName.toLowerCase()).match(/^gui\-(tree|icon|list|file)\-view$/);return"value"!==n&&"selected"!==n||!l?t.getProperty(e,n,r):i.createFromNode(e).values()}static create(e,n,r,l){return e=e||"",r=r||{},n=n||{},a(null,t.createElement(e,n),null,[r,l])}static createInstance(e,t,n){return console.warn("Element::createInstance() is DEPRECATED, use Element::createFromNode() instead"),this.createFromNode(e,t,n)}static parseNode(s,i,o,c,u,h){u=u||function(){},c=c||{},o=o||"snipplet",i.querySelectorAll("*").forEach(t=>{const n=t.tagName.toLowerCase();n.match(/^gui\-/)&&!n.match(/(\-container|\-(h|v)box|\-columns?|\-rows?|(status|tool)bar|(button|menu)\-bar|bar\-entry)$/)&&e.$addClass(t,"gui-element")}),function(e,l,s){const a=(s=s||{}).undefined||n._;e.querySelectorAll("*[data-label]").forEach(function(e){const t=a(e.getAttribute("data-label"));e.setAttribute("data-label",t)}),e.querySelectorAll("gui-label, gui-button, gui-list-view-column, gui-select-option, gui-select-list-option").forEach(function(e){if(!e.children.length&&!e.getAttribute("data-no-translate")){const n=t.getValueLabel(e);e.appendChild(document.createTextNode(a(n)))}}),e.querySelectorAll("gui-button").forEach(function(e){const r=t.getValueLabel(e);r&&e.appendChild(document.createTextNode(n._(r)))}),e.querySelectorAll("*[data-icon], *[data-stock-icon]").forEach(function(e){const n=t.getIcon(e,l);e.setAttribute("data-icon",n)}),e.querySelectorAll("*[data-src],*[src]").forEach(function(e){const t=e.hasAttribute("src"),n=t?e.getAttribute("src"):e.getAttribute("data-src")||"";if(l&&l._app&&!n.match(/^(https?:)?\//)){const s=r.getPackageResource(l._app,n);e.setAttribute(t?"src":"data-src",s)}})}(i,s,c),u(i),Object.keys(l).forEach(t=>{i.querySelectorAll(t).forEach(n=>{if(!n._wasParsed&&!e.$hasClass(n,"gui-data-view")){try{a(t,n,null,[])}catch(e){console.warn("parseNode()",h,o,s,"exception"),console.warn(e,e.stack)}n._wasParsed=!0}})})}static register(e,t){const n=e.tagName;if(l[n])throw new Error('GUI Element "'+n+'" already exists');l[n]=(()=>{const n=Object.assign({},{type:"element",allowedChildren:[],allowedParents:[]},e);return n.parent&&delete n.parent,"input"===n.type?n.allowedChildren=!0:"container"!==n.type&&(n.allowedChildren=!1),{metadata:n,component:t}})()}static getRegisteredElement(e){return l[e]}}});
//# sourceMappingURL=../sourcemaps/gui/element.js.map
