/**
 * skylark-osjsv2-client - A version of osjs-client that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-osjsv2-client/
 * @license MIT
 */
define(["utils/misc"],function(e){"use strict";function t(e){return(e||"").replace(/\/$/,"").split("/").pop()}function n(e,t,n,r){n=n||"application/octet-stream";try{const i=new Blob([t],{type:n}),o=new FileReader;o.onerror=function(e){r(e)},o.onloadend=function(){r(!1,o.result)},o[e](i)}catch(e){console.warn(e,e.stack),r(e)}}return{getPathFromVirtual:function(e){return((e=e||"").split(/([A-z0-9\-_]+)\:\/\/(.*)/)[2]||"").replace(/^\/?/,"/")},getPathProtocol:function(e){const t=document.createElement("a");return t.href=e,t.protocol.replace(/:$/,"")},filename:t,filext:function(e){const n=t(e).split(".").pop();return n?n.toLowerCase():null},dirname:function(e){return e.match(/^((.*)\:\/\/)?\/$/)?e:function(e){const t=e.split(/^(.*)\:\/\/(.*)/).filter(function(e){return""!==e}),n=t.pop(),r=t.pop();let i="";const o=n.split("/").filter(function(e){return""!==e});return o.length&&o.pop(),(i=o.join("/")).match(/^\//)||(i="/"+i),r&&(i=r+"://"+i),i}(e.replace(/\/$/,""))},humanFileSize:function(e,t){const n=t?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],r=t?1e3:1024;if(e<r)return e+" B";let i=-1;do{e/=r,++i}while(e>=r);return e.toFixed(1)+" "+n[i]},escapeFilename:function(e){return(e||"").replace(/[\|&;\$%@"<>\(\)\+,\*\/]/g,"").trim()},replaceFileExtension:function(e,t){const n=e.split(".");return n.pop(),n.push(t),n.join(".")},replaceFilename:function(e,t){const n=e.split("/");return n.pop(),n.push(t),n.join("/")},pathJoin:function(){let e=[],t="";function n(e){if(e.match(/^([A-z0-9\-_]+)\:\//)){const n=e.split(/^([A-z0-9\-_]+)\:\//);t||(t=n[1]+"://"),e=n[2]||""}return(e=e.replace(/^\/+/,"").replace(/\/+$/,"")).split("/").filter(function(e){return-1===["",".",".."].indexOf(e)}).join("/")}for(let t=0;t<arguments.length;t++){const r=n(String(arguments[t]));r&&e.push(r)}return t+e.join("/").replace(/^\/?/,"/")},getFilenameRange:function(e){const t={min:0,max:(e=e||"").length};if(e.match(/^\./))e.length>=2&&(t.min=1);else if(e.match(/\.(\w+)$/)){const n=e.split(/\.(\w+)$/);for(let r=n.length-1;r>=0;r--)if(n[r].length){t.max=e.length-n[r].length-1;break}}return t},btoaUrlsafe:function(e){return e&&e.length?btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""):""},atobUrlsafe:function(e){return e&&e.length?(e=(e+"===").slice(0,e.length+e.length%4),atob(e.replace(/-/g,"+").replace(/_/g,"/"))):""},btoaUtf:function(e){return e=(window.unescape||function(e){return e.replace(/%([0-9A-F]{2})/i,function(e,t){return String.fromCharCode(parseInt(t,16))})})(encodeURIComponent(e)),btoa(e)},atobUtf:function(e){const t=(window.escape||function(e){return e.replace(/[\x00-),:-?[-^`{-\xFF]/g,function(e){return"%"+((e=e.charCodeAt())<16?"0":"")+e.toString(16).toUpperCase()})})(atob(e));return decodeURIComponent(t)},checkAcceptMime:function(e,t){if(e&&t.length){let n;for(let r=0;r<t.length;r++)if(!0===(n=new RegExp(t[r])).test(e))return!0}return!1},filterScandir:function(t,n,r){r=e.cloneObject(r||{});const i=e.cloneObject(n,!0);let o=Object.assign({},r.scandir||{},i);o=Object.assign({},{sortBy:null,sortDir:"asc",typeFilter:null,mimeFilter:[],showHiddenFiles:!0},o);const c=t.filter(function(e){return!(".."===e.filename||!function(e){return!(o.typeFilter&&e.type!==o.typeFilter||!o.showHiddenFiles&&e.filename.match(/^\.\w/))}(e)||"file"===e.type&&!function(e){return!(o.mimeFilter&&o.mimeFilter.length&&e.mime)||o.mimeFilter.some(function(t){return!!e.mime.match(t)})}(e))}).map(function(e){return"application/vnd.google-apps.folder"===e.mime&&(e.type="dir"),e}),a=o.sortBy,l={mtime:"date",ctime:"date"};return-1!==["filename","size","mime","ctime","mtime"].indexOf(a)&&("date"===l[a]?c.sort(function(e,t){return(e=new Date(e[a]))>(t=new Date(t[a]))?1:t>e?-1:0}):"size"!==a&&String.prototype.localeCompare?c.sort(function(e,t){return String(e[a]).localeCompare(String(t[a]))}):c.sort(function(e,t){return e[a]>t[a]?1:t[a]>e[a]?-1:0}),"desc"===o.sortDir&&c.reverse()),c.filter(function(e){return"dir"===e.type}).concat(c.filter(function(e){return"dir"!==e.type}))},addFormFile:function(e,t,n,r){if(r=r||{mime:"application/octet-stream",filename:"filename"},n instanceof window.File)e.append(t,n);else if(n instanceof window.ArrayBuffer){try{n=new Blob([n],{type:r.mime})}catch(e){n=null,console.warn(e,e.stack)}e.append(t,n,r.filename)}else n.data&&n.filename&&e.append(t,n.data,n.filename)},dataSourceToAb:function(e,t,n){const r=atob(e.split(",")[1]),i=new ArrayBuffer(r.length),o=new Uint8Array(i);for(let e=0;e<r.length;e++)o[e]=r.charCodeAt(e);n(!1,i)},textToAb:function(e,t,r){n("readAsArrayBuffer",e,t,r)},abToDataSource:function(e,t,r){n("readAsDataURL",e,t,r)},abToText:function(e,t,r){n("readAsText",e,t,r)},abToBinaryString:function(e,t,r){n("readAsBinaryString",e,t,r)},abToBlob:function(e,t,n){t=t||"application/octet-stream";try{n(!1,new Blob([e],{type:t}))}catch(e){console.warn(e,e.stack),n(e)}},blobToAb:function(e,t){try{const n=new FileReader;n.onerror=function(e){t(e)},n.onloadend=function(){t(!1,n.result)},n.readAsArrayBuffer(e)}catch(e){console.warn(e,e.stack),t(e)}}}});
//# sourceMappingURL=../sourcemaps/utils/fs.js.map
