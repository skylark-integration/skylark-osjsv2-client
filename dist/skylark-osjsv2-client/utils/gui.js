/**
 * skylark-osjsv2-client - A version of osjs-client that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-osjsv2-client/
 * @license MIT
 */
define(["./dom","./events","./compability","../core/package-manager","../core/theme"],function(e,t,n,i,r){"use strict";function a(e){return e.getAttribute("data-label")||""}function o(e,t,n,i){if(i=i||a(e)){const r=document.createElement("label"),a=document.createElement("span");a.appendChild(document.createTextNode(i)),"checkbox"===t||"radio"===t?(r.appendChild(n),r.appendChild(a)):(r.appendChild(a),r.appendChild(n)),e.appendChild(r)}else e.appendChild(n)}return{getWindowId:function(e){for(;e.parentNode;){const t=e.getAttribute("data-window-id");if(null!==t)return parseInt(t,10);e=e.parentNode}return null},getLabel:a,getValueLabel:function(t,n){let i=n?t.getAttribute("data-label"):null;return t.childNodes.length&&3===t.childNodes[0].nodeType&&t.childNodes[0].nodeValue&&(i=t.childNodes[0].nodeValue,e.$empty(t)),i||""},getViewNodeValue:function(e){let t=e.getAttribute("data-value");if("string"==typeof t&&t.match(/^\[|\{/))try{t=JSON.parse(t)}catch(e){t=null}return t},getIcon:function(e,t){let n=e.getAttribute("data-icon");if(n)return t?i.getPackageResource(t._app,n):n;if((n=e.getAttribute("data-stock-icon"))&&"undefined"!==n){let e="16x16";try{let t=n.split("/"),i=t.shift().match(/^\d+x\d+/);i&&(e=i[0],n=t.join("/")),n=r.getIcon(n,e)}catch(e){}return n}return null},getProperty:function(e,t,n){const i=(n=n||e.tagName.toLowerCase()).match(/^gui\-(tree|icon|list|file)\-view$/);return"value"!==t||i?e.getAttribute("data-"+t):["gui-text","gui-password","gui-textarea","gui-slider","gui-select","gui-select-list"].indexOf(n)>=0?e.querySelector("input, textarea, select").value:["gui-checkbox","gui-radio","gui-switch"].indexOf(n)>=0?!!e.querySelector("input").checked:null},createInputLabel:o,setProperty:function(t,n,i,r){function a(e,n,r,a){r?e.setAttribute(n,n):e.removeAttribute(n),a&&t.setAttribute("aria-"+n,String(!0===i))}function u(e,t,n){if("object"==typeof n)try{n=JSON.stringify(i)}catch(e){}e.setAttribute(t,String(n))}r=r||t.tagName.toLowerCase();const l=t.children[0];let c=["gui-slider","gui-text","gui-password","gui-textarea","gui-checkbox","gui-radio","gui-select","gui-select-list","gui-button"];!function(){let l;const d={readonly:function(){a(l,"readonly",i,!0)},disabled:function(){a(l,"disabled",i,!0)},value:function(){"gui-radio"!==r&&"gui-checkbox"!==r||(a(l,"checked",i),l.checked=!!i),l.value=i},label:function(){t.appendChild(l),e.$remove(t.querySelector("label")),o(t,r.replace(/^gui\-/,""),l,i)}};c.indexOf(r)>=0&&(l=t.querySelector("textarea, input, select, button"))&&(d[n]?d[n]():u(l,n,i||""))}(),c=["gui-image","gui-audio","gui-video"],["src","controls","autoplay","alt"].indexOf(n)>=0&&c.indexOf(r)>=0&&(l[n]=i),["_id","_class","_style"].indexOf(n)>=0?l.setAttribute(n.replace(/^_/,""),i):"value"!==n&&u(t,"data-"+n,i)},createElement:function(t,n,i){i=i||[];const r=document.createElement(t),a={textalign:function(t){e.$addClass(r,"gui-align-"+t)},className:function(t){e.$addClass(r,t)}};return"object"==typeof n&&Object.keys(n).forEach(function(e){if(i.indexOf(e)>=0)return;const t=n[e];if(void 0!==t&&"function"!=typeof t){if(a[e])return void a[e](t);const n=function(e,t){if("boolean"==typeof t)t=t?"true":"false";else if("object"==typeof t)try{t=JSON.stringify(t)}catch(e){}return t}(0,t);r.setAttribute("data-"+e,n)}}),r},setFlexbox:function(t,n,i,r,a){a=a||t,void 0!==r&&null!==r||(r=a.getAttribute("data-basis")||"auto"),void 0!==n&&null!==n||(n=a.getAttribute("data-grow")||0),void 0!==i&&null!==i||(i=a.getAttribute("data-shrink")||0);const o=[n,i];r.length&&o.push(r);const u=o.join(" ");t.style.webkitBoxFlex=u,t.style.mozBoxFlex=u,t.style.webkitFlex=u,t.style.mozFlex=u,t.style.msFlex=u,t.style.oFlex=u,t.style.flex=u;const l=t.getAttribute("data-align");e.$removeClass(t,"gui-flex-align-start"),e.$removeClass(t,"gui-flex-align-end"),l&&e.$addClass(t,"gui-flex-align-"+l)},createDrag:function(e,n,i,r){let a,o,u,l;n=n||function(){},i=i||function(){},r=r||function(){};let c=!1;function d(e,t,n){e.preventDefault(),c&&(u=t.x,l=t.y,i(e,{x:u-a,y:l-o},{x:u,y:l}))}function s(e,n,i){r(e,{x:u,y:l}),c=!1,t.$unbind(window,"pointerup:guidrag"),t.$unbind(window,"pointermove:guidrag")}t.$bind(e,"pointerdown",function(e,i,r){e.preventDefault(),a=i.x,o=i.y,n(e,{x:a,y:o}),c=!0,t.$bind(window,"pointerup:guidrag",s,!1),t.$bind(window,"pointermove:guidrag",d,!1)},!1)},getNextElement:function(t,n,i){if(i){const o=function(){const t=["menu","menuitem","grid","gridcell","listitem"],n=[];return i.querySelectorAll(".gui-element").forEach(function(i){e.$hasClass(i,"gui-focus-element")||t.indexOf(i.getAttribute("role"))>=0||"true"===i.getAttribute("data-disabled")||i.offsetParent&&n.push(i)}),n}();if(o.length){const i=function(t,n){if(n){let t=n;for(;t.parentNode;){if(e.$hasClass(t,"gui-element"))return t;t=t.parentNode}return null}return t[0]}(o,n),u=function(e,t){let n=-1;return t&&e.every(function(e,i){return e===t&&(n=i),-1===n}),n}(o,i);if(u>=0)return function(e,t){let n=e[t];return n.tagName.match(/^GUI\-(BUTTON|TEXT|PASSWORD|SWITCH|CHECKBOX|RADIO|SELECT)/)&&(n=n.querySelectorAll("input, textarea, button, select")[0]),"GUI-FILE-VIEW"===n.tagName&&(n=n.children[0]),n}(o,(r=o,a=u,a=t?a<=0?r.length-1:a-1:a>=r.length-1?0:a+1))}}var r,a;return null},createDraggable:function(e,i){function r(t){try{if(t.dataTransfer.effectAllowed=i.effect,i.dragImage&&"function"==typeof i.dragImage&&t.dataTransfer.setDragImage){const n=i.dragImage(t,e);if(n){const e=n.element,i=n.offset;document.body.appendChild(e),t.dataTransfer.setDragImage(e,i.x,i.y)}}t.dataTransfer.setData(i.mime,(i.mime,JSON.stringify({type:i.type,effect:i.effect,data:i.data,mime:i.mime})))}catch(e){console.warn("Failed to dragstart: "+e),console.warn(e.stack)}}i=Object.assign({},{type:null,effect:"move",data:null,mime:"application/json",dragImage:null,onStart:function(){return!0},onEnd:function(){return!0}},i),n.isIE()&&(i.mime="text"),e.setAttribute("draggable","true"),e.setAttribute("aria-grabbed","false"),t.$bind(e,"dragstart",function(e){return this.setAttribute("aria-grabbed","true"),this.style.opacity="0.4",e.dataTransfer&&r(e),i.onStart(e,this,i)},!1),t.$bind(e,"dragend",function(e){return this.setAttribute("aria-grabbed","false"),this.style.opacity="1.0",i.onEnd(e,this,i)},!1)},createDroppable:function(e,i){function r(e,t){e.stopPropagation(),e.preventDefault();const n=function(e,t){if(!e.dataTransfer)return!0;if(i.files){const n=e.dataTransfer.files;if(n&&n.length)return i.onFilesDropped(e,t,n,i)}try{const n=e.dataTransfer.getData(i.mime),r=JSON.parse(n);if(null===i.accept||i.accept===r.type)return i.onItemDropped(e,t,r,i)}catch(e){console.warn("Failed to drop: "+e)}return!1}(e,t);return i.onDrop(e,t),n}i=Object.assign({},{accept:null,effect:"move",mime:"application/json",files:!0,onFilesDropped:function(){return!0},onItemDropped:function(){return!0},onEnter:function(){return!0},onOver:function(){return!0},onLeave:function(){return!0},onDrop:function(){return!0}},i),n.isIE()&&(i.mime="text"),e.setAttribute("aria-dropeffect",i.effect),t.$bind(e,"drop",function(e){return r(e,this)},!1),t.$bind(e,"dragenter",function(e){return i.onEnter.call(this,e,this,i)},!1),t.$bind(e,"dragover",function(t){return t.preventDefault(),!!function(e,t){if(e===t)return!0;let n=10;for(;e&&n>0;){if(e===t)return!0;e=e.parentNode,n--}return!1}(t.target,e)&&(t.stopPropagation(),t.dataTransfer.dropEffect=i.effect,i.onOver.call(this,t,this,i))},!1),t.$bind(e,"dragleave",function(e){return i.onLeave.call(this,e,this,i)},!1)}}});
//# sourceMappingURL=../sourcemaps/utils/gui.js.map
