/**
 * skylark-osjsv2-client - A version of osjs-client that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-osjsv2-client/
 * @license MIT
 */
define(["./keycodes"],function(e){"use strict";function t(e){return e.replace(/\s/g,"").split(",")}function n(e){if(e.detail&&void 0!==e.detail.x&&void 0!==e.detail.y)return{x:e.detail.x,y:e.detail.y};const t=e.touches||e.changedTouches||[];return t.length?{x:t[0].clientX,y:t[0].clientY}:{x:e.clientX,y:e.clientY}}return{mousePosition:n,mouseButton:function(e){return void 0!==e.button?0===e.button?"left":1===e.button?"middle":"right":2===e.which||4===e.which?"middle":1===e.which?"left":"right"},keyCombination:function(){const t={CTRL:e=>e.ctrlKey,SHIFT:e=>e.shiftKey,ALT:e=>e.altKey,META:e=>e.metaKey};return function(n,o){const c={CTRL:!1,SHIFT:!1,ALT:!1},i=[];o.toUpperCase().split("+").forEach(e=>{t[e]?c[e]=!0:i.push(e)});const u=Object.keys(c).every(e=>{const o=!!t[e](n);return c[e]===o}),r=i.every(t=>(function(t){let n=!1;return Object.keys(e).forEach(o=>{n||t!==e[o]||(n=o)}),n})(n.keyCode)===t);return u&&r}}(),$bind:function(){function e(e,t){const o=n(t),c=Object.assign({clientX:o.x,clientY:o.y,x:o.x,y:o.y},t);return new MouseEvent(e,c)}function o(e,t,n,o,c,i,u){const r=[n,c,i];e.addEventListener.apply(e,r),e._boundEvents[t].push({realType:u,args:r,callback:o})}const c={mousewheel:function(e,t,c,i,u){function r(e){const t=n(e),o=e.detail<0||e.wheelDelta>0?1:-1;return t.z=o,i(e,t)}o(e,t,"mousewheel",i,r,u,"mousewheel"),o(e,t,"DOMMouseScroll",i,r,u,"DOMMouseScroll")},click:function(t,n,c,i,u){let r,l,s,a=!1;const d=()=>a=!0;o(t,n,"touchcancel",i,function(){clearTimeout(r),l=null,a=!0,window.removeEventListener("touchmove",d)},u,"dblclick"),o(t,n,"touchstart",i,function(e){s=e,l=e.target,r=setTimeout(()=>{a=!0},300),window.addEventListener("touchmove",d)},u,"click"),o(t,n,"touchend",i,function(n){if(clearTimeout(r),window.removeEventListener("touchmove",d),!a&&n.target===l){const n=e("click",s);Object.defineProperty(n,"target",{value:s.target,enumerable:!1}),t.dispatchEvent(n)}},u,"click")},dblclick:function(t,n,c,i,u){let r,l,s,a=0,d=!1;const f=()=>d=!0;function v(){r=null,d=!0,a=0,window.removeEventListener("toucmove",f)}o(t,n,"touchcancel",i,v,u,"dblclick"),o(t,n,"touchstart",i,function(t){if(window.addEventListener("touchmove",f),clearTimeout(s),0===a)l=t,r=t.target;else if(a>0){if(t.target!==r)return void v();d||(t.preventDefault(),t.stopPropagation(),t.target.dispatchEvent(e("dblclick",l)))}d=!1,a++},u,"dblclick"),o(t,n,"touchend",i,function(){window.removeEventListener("touchmove",f),s=setTimeout(v,680)},u,"dblclick")},contextmenu:function(t,n,c,i,u){let r,l=!1;const s=()=>l=!0;o(t,n,"touchcancel",i,function(){clearTimeout(r),l=!0,window.removeEventListener("toucmove",s)},u,"contextmenu"),o(t,n,"touchstart",i,function(t){r=setTimeout(()=>{l||(t.preventDefault(),t.target.dispatchEvent(e("contextmenu",t)))},300),window.addEventListener("touchmove",s)},u,"contextmenu"),o(t,n,"touchend",i,function(e){l=!0,clearTimeout(r),window.removeEventListener("touchmove",s)},u,"contextmenu")}};return function(e,i,u,r,l){if(r=!0===r,arguments.length<3)throw new Error("$bind expects 3 or more arguments");if("string"!=typeof i)throw new Error("Given event type was not a string");if("function"!=typeof u)throw new Error("Given callback was not a function");function s(t,i){i=function(e){let t=e;if("mousewheel"!==e&&e.match(/^mouse/))if(window.PointerEvent)t=e.replace(/^mouse/,"pointer");else if(window.MSPointerEvent){const n=e.replace(/^mouse/,"");t="MSPointer"+n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()}return t}(i),o(e,t,i,u,function(t){window.OSjs&&(l&&u(t,n(t)),u.call(e,t,n(t)))},r),"click"===i&&"BUTTON"===e.tagName||c[i]&&c[i](e,t,i,function(t){l&&u(t,n(t)),u.call(e,t,n(t))},r)}var a;t(i).forEach(t=>{const n=t.split(":")[0];t=t,e._boundEvents||(e._boundEvents={}),e._boundEvents[t]||(e._boundEvents[t]=[]),0===e._boundEvents[t].filter(e=>e.callback===u).length?s(t,n):console.warn("Utils::$bind()","This event was already bound, skipping")})}}(),$unbind:function(e,n,o,c){function i(t){if(e._boundEvents){const n=e._boundEvents||{};if(n[t])for(let c=0;c<n[t].length;c++){let i=n[t][c];o&&i.callback!==o||(e.removeEventListener.apply(e,i.args),n[t].splice(c,1),c--)}}}e&&(n?t(n).forEach(e=>{i(e)}):e._boundEvents&&(Object.keys(e._boundEvents).forEach(e=>{i(e)}),delete e._boundEvents))}}});
//# sourceMappingURL=../sourcemaps/utils/events.js.map
