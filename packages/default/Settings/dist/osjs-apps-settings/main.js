/**
 * osjs-apps-settings - 
 * @author 
 * @version v1.0.0
 * @link 
 * @license 
 */
define(["./locales","./module-desktop","./module-input","./module-locale","./module-panel","./module-pm","./module-search","./module-sound","./module-store","./module-theme","./module-user","./module-users","./module-vfs","./scheme.html"],function(e,t,n,i,s,o,c,a,l,r,u,d,h,m){"use strict";const p=OSjs.require("core/locales"),g=OSjs.require("core/dialog"),f=OSjs.require("core/window"),S=OSjs.require("utils/events"),y=OSjs.require("core/theme"),b=OSjs.require("utils/misc"),_=OSjs.require("gui/menu"),w=OSjs.require("core/settings-manager"),O=OSjs.require("core/window-manager"),k=OSjs.require("core/application"),E=p.createLocalizer(e),j="misc",C={personal:{label:"LBL_PERSONAL"},system:{label:"LBL_SYSTEM"},user:{label:"LBL_USER"},misc:{label:"LBL_OTHER"}},A={theme:"Theme",desktop:"Desktop",panel:"Panel",user:"User",fileview:"VFS",search:"Search"};class q extends g{constructor(e,t,n,i){super("ApplicationSettingsGenericsWindow",{icon:t.icon,title:t.name,width:400,height:300,translator:E}),this.schemeRef=n,this.callback=i,this.closed=!1}init(e,t){const n=super.init(...arguments);return this.schemeRef.render(this,"SettingsItemWindow"),this._find("ButtonItemOK").on("click",()=>{this.closed=!0;const e=this._find("List").get("selected");this.callback("ok",e.length?e[0]:null),this._close()}),this._find("ButtonItemCancel").on("click",()=>this._close()),n}_close(){return this.closed||this.callback("cancel"),super._close(...arguments)}}class M extends f{constructor(e,t,n){super("ApplicationSettingsWindow",{icon:t.icon,title:t.name,width:500,height:450,allow_resize:!0,translator:E},e),this.initialCategory=n}init(e,t){const n=super.init(...arguments),i=O.instance;this.scheme=this._render("SettingsWindow",m),this._find("ButtonOK").son("click",this,this.onButtonOK),this._find("ButtonCancel").son("click",this,this.onButtonCancel);const s=document.createElement("div");s.className="ListView gui-generic-zebra-container gui-element";let o={},c=document.createDocumentFragment();return Object.keys(C).forEach(function(e){const t=document.createElement("ul"),n=document.createElement("span"),i=document.createElement("div");i.className="gui-generic-double-padded",n.appendChild(document.createTextNode(E(C[e].label))),o[e]=t,i.appendChild(n),i.appendChild(t),s.appendChild(i)}),t.modules.forEach(e=>{if(("function"!=typeof e.compatible||e.compatible())&&o[e.group]){const t=document.createElement("img");t.setAttribute("src",y.getIcon(e.icon,"32x32")),t.setAttribute("title",e.name);const s=document.createElement("span");s.appendChild(document.createTextNode(E(e.label||e.name)));const a=document.createElement("li");a.className="gui-generic-hoverable",a.setAttribute("data-module",String(e.name)),a.appendChild(t),a.appendChild(s),o[e.group].appendChild(a);const l=n.querySelector('[data-module="'+e.name+'"]');l?l.className="gui-generic-padded":console.warn("Not found",e.name);const r=b.cloneObject(i.getSettings());try{e.render(this,this.scheme,c,r,i)}catch(e){console.warn(e,e.stack)}try{e.update(this,this.scheme,r,i)}catch(e){console.warn(e,e.stack)}e._inited=!0}}),Object.keys(o).forEach(e=>{o[e].children.length||(o[e].parentNode.style.display="none")}),S.$bind(s,"click",e=>{const t=e.isTrusted?e.target:e.relatedTarget||e.target;if(_.blur(),t&&"LI"===t.tagName&&t.hasAttribute("data-module")){e.preventDefault();const n=t.getAttribute("data-module");this.onModuleSelect(n)}},!0),n.querySelector('[data-id="ContainerSelection"]').appendChild(s),o={},c=null,this.initialCategory&&this.onExternalAttention(this.initialCategory),n}destroy(){return!!super.destroy(...arguments)&&(this.currentModule=null,!0)}onModuleSelect(e){const t=O.instance,n=this._$element;function i(e){n.querySelector('[data-id="ContainerSelection"]').style.display=e?"block":"none",n.querySelector('[data-id="ContainerContent"]').style.display=e?"none":"block",n.querySelector('[data-id="ContainerButtons"]').style.display=e?"none":"block"}let s,o;if(n.querySelectorAll("div[data-module]").forEach(function(e){e.style.display="none"}),i(!0),this._setTitle(null),e&&this._app.modules.forEach(function(t){s||t.name!==e||(s=t)}),s){const e=n.querySelector('div[data-module="'+s.name+'"]');if(e){e.style.display="block",o=b.cloneObject(t.getSettings());try{s.update(this,this.scheme,o,t,!0)}catch(e){console.warn(e,e.stack)}i(!1),this._setTitle(E(s.name),!0),!1===s.button?this._find("ButtonOK").hide():this._find("ButtonOK").show()}}else e||(o=b.cloneObject(t.getSettings()),this._app.modules.forEach(e=>{try{e._inited&&e.update(this,this.scheme,o,t)}catch(e){console.warn(e,e.stack)}}));this._app.setModule(s)}onButtonOK(){const e={},t=O.instance;this._app.modules.forEach(n=>{if(n._inited){const i=n.save(this,this.scheme,e,t);"function"==typeof i&&i()}}),this._toggleLoading(!0),this._app.saveSettings(e,()=>{this._toggleLoading(!1)})}onButtonCancel(){this.onModuleSelect(null)}onExternalAttention(e){this.onModuleSelect(A[e]||e),this._focus()}}OSjs.Applications.ApplicationSettings=Object.seal(class extends k{constructor(e,t){super("ApplicationSettings",e,t);const n=OSjs.Applications.ApplicationSettings.Modules;this.watches={},this.currentModule=null,this.modules=Object.keys(n).map(function(e){const t=b.argumentDefaults(n[e],{_inited:!1,name:e,group:j,icon:"status/error.png",init:function(){},update:function(){},render:function(){},save:function(){}});return-1===Object.keys(C).indexOf(t.group)&&(t.group=j),Object.keys(t).forEach(function(e){"function"==typeof t[e]&&(t[e]=t[e].bind(t))}),t}),this.modules.forEach(e=>{e.init(this),e.watch&&e.watch instanceof Array&&e.watch.forEach(t=>{this.watches[e.name]=w.watch(t,()=>{const t=this._getMainWindow();e&&t&&this.currentModule&&this.currentModule.name===e.name&&t.onModuleSelect(e.name)})})})}destroy(){return!!super.destroy(...arguments)&&(Object.keys(this.watches).forEach(e=>{w.unwatch(this.watches[e])}),this.watches={},!0)}init(e,t){super.init(...arguments);const n=this._getArgument("category")||e.category,i=this._addWindow(new M(this,t,n));this._on("attention",function(e){i&&e.category&&i.onExternalAttention(e.category)})}saveSettings(e,t){O.instance.applySettings(e,!1,1),w.save().then(e=>t(!1,e)).catch(t)}setModule(e){this.currentModule=e}static get SettingsItemDialog(){return q}static get Modules(){return{Desktop:t,Input:n,Locale:i,Panel:s,PM:o,Search:c,Sounds:a,Store:l,Theme:r,User:u,Users:d,VFS:h}}})});
//# sourceMappingURL=sourcemaps/main.js.map
