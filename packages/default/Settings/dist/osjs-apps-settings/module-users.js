/**
 * osjs-apps-settings - 
 * @author 
 * @version v1.0.0
 * @link 
 * @license 
 */
define(["./locales"],function(e){"use strict";const n=OSjs.require("core/locales"),s=OSjs.require("core/dialog"),t=OSjs.require("core/config"),r=OSjs.require("core/connection"),i=OSjs.require("core/window"),o=n.createLocalizer(e);function a(e,n){r.request("users",{command:"list"}).then(n=>{n instanceof Array&&e._find("UsersList").clear().add(n.map(function(e,n){return{value:e,columns:[{label:e.id},{label:e.username},{label:e.name}]}}))})}function c(e,n,t,c){if(e._toggleDisabled(!0),c)return void s.create("Input",{message:o("Set user password"),type:"password"},function(n,s,t){t?r.request("users",{command:"passwd",user:{password:t,id:c}}).then(()=>{e._toggleDisabled(!1),a(e)}).catch(n=>{e._toggleDisabled(!1),OSjs.error("Settings",o("Error while managing users"),n)}):e._toggleDisabled(!1)});const u=null===t?"add":"edit";t=t||{};const l=new i("SettingsUserWindow",{icon:e._app.__metadata.icon,title:e._app.__metadata.name,width:400,height:250},e._app);l._on("destroy",function(n){e._toggleDisabled(!1)}),l._on("init",function(s){n.render(l,l._name),Object.keys(t).length&&(l._find("UserUsername").set("value",t.username),l._find("UserName").set("value",t.name),l._find("UserGroups").set("value",(t.groups||[]).join(","))),l._find("ButtonClose").on("click",function(){l._close()}),l._find("ButtonOK").on("click",function(){t.username=l._find("UserUsername").get("value"),t.name=l._find("UserName").get("value")||t.username,t.groups=l._find("UserGroups").get("value").replace(/\s/g,"").split(","),t.username&&t.groups?r.request("users",{command:u,user:t}).then(()=>{a(e),l._close()}).catch(e=>{OSjs.error("Settings",o("Error while managing users"),e)}):l._close()})}),e._addChild(l,!0,!0)}return{group:"system",name:"Users",label:"LBL_USERS",icon:"apps/system-users.png",button:!1,compatible:function(){const e=t.getConfig("Connection.Authenticator");return-1===["demo","pam","shadow"].indexOf(e)},init:function(){},update:function(e,n,s,t){a(e)},render:function(e,n,s,t,i){function u(n,s){const t=e._find("UsersList").get("selected");if(t&&t.length){const e=t[0].data;e._username=e.username,n(e)}else s&&n(null)}e._find("UsersAdd").on("click",function(){c(e,n,null)}),e._find("UsersRemove").on("click",function(){u(function(n){!function(e,n,s){r.request("users",{command:"remove",user:s}).then(n=>{a(e)}).catch(e=>{OSjs.error("Settings",o("Error while managing users"),e)})}(e,0,n)})}),e._find("UsersEdit").on("click",function(){u(function(s){c(e,n,s)})}),e._find("UsersPasswd").on("click",function(){u(function(s){c(e,n,null,s.id)})})},save:function(e,n,s,t){}}});
//# sourceMappingURL=sourcemaps/module-users.js.map
