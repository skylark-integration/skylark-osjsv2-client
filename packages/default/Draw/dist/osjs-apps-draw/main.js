/**
 * osjs-apps-draw - 
 * @author 
 * @version v1.0.0
 * @link 
 * @license 
 */
define(["./locales","./scheme.html"],function(t,e){"use strict";const o=OSjs.require("core/locales"),n=OSjs.require("core/dialog"),i=OSjs.require("utils/gui"),r=OSjs.require("utils/dom"),a=OSjs.require("utils/colors"),s=OSjs.require("vfs/filedataurl"),l=OSjs.require("helpers/default-application"),c=OSjs.require("helpers/default-application-window"),u=o.createLocalizer(t);var h=1024,d=768,p={pointer:{statusText:""},picker:{statusText:"LMB: Pick foreground-, RMB: Pick background color"},bucket:{statusText:"LMB: Fill with foreground-, RMB: Fill with background color"},pencil:{statusText:"LMB: Use foreground-, RMB: Use background color"},path:{statusText:"LMB: Use foreground-, RMB: Use background color"},rectangle:{statusText:"LMB: Use foreground-, RMB: Use background color. SHIFT: Toggle rectangle/square mode"},circle:{statusText:"LMB: Use foreground-, RMB: Use background color. SHIFT: Toggle circle/ellipse mode"}},g={pointer:{},picker:function(){var t;function e(e,o){var n="#000000",i=e.shiftKey||e.button>0?"background":"foreground";t||(t=o.ctx.getImageData(0,0,o.canvas.width,o.canvas.height).data);var r=4*(o.pos.x+o.pos.y*o.canvas.width);try{n=a.convertToHEX({r:t[r+0],g:t[r+1],b:t[r+2],a:t[r+3]})}catch(t){}o.win.setToolProperty(i,n)}return{mousedown:e,mousemove:e,mouseup:function(e,o,n,i,r){t=null}}}(),bucket:{mousedown:function(t,e){var o=t.shiftKey||t.button>0?"background":"foreground";e.ctx.fillStyle=e.win.tool[o],e.ctx.fillRect(0,0,e.canvas.width,e.canvas.height)}},pencil:{mousedown:function(t,e){var o=t.shiftKey||t.button>0?"background":"foreground";e.ctx.strokeStyle=e.win.tool[o]},mousemove:function(t,e){e.ctx.beginPath(),e.ctx.moveTo(e.pos.x-1,e.pos.y),e.ctx.lineTo(e.pos.x,e.pos.y),e.ctx.closePath(),e.ctx.stroke()}},path:{mousemove:function(t,e){e.tmpContext&&(e.tmpContext.clearRect(0,0,e.tmpCanvas.width,e.tmpCanvas.height),e.tmpContext.beginPath(),e.tmpContext.moveTo(e.start.x,e.start.y),e.tmpContext.lineTo(e.pos.x,e.pos.y),e.tmpContext.closePath(),e.tmpContext.stroke())}},rectangle:{mousedown:function(t,e){e.tmpContext.fillStyle=t.button>0?e.win.tool.background:e.win.tool.foreground,e.tmpContext.strokeStyle=t.button<=0?e.win.tool.background:e.win.tool.foreground},mousemove:function(t,e){var o,n,i,r;t.shiftKey?(o=Math.min(e.pos.x,e.start.x),n=Math.min(e.pos.y,e.start.y),i=Math.abs(e.pos.x-e.start.x),r=Math.abs(e.pos.y-e.start.y)):(o=e.start.x,n=e.start.y,i=Math.abs(e.pos.x-e.start.x)*(e.pos.x<e.start.x?-1:1),r=Math.abs(i)*(e.pos.y<e.start.y?-1:1)),e.tmpContext.clearRect(0,0,e.tmpCanvas.width,e.tmpCanvas.height),i&&r&&(e.win.tool.lineStroke&&e.tmpContext.strokeRect(o,n,i,r),e.tmpContext.fillRect(o,n,i,r))}},circle:{mousedown:function(t,e){e.tmpContext.fillStyle=t.button>0?e.win.tool.background:e.win.tool.foreground,e.tmpContext.strokeStyle=t.button<=0?e.win.tool.background:e.win.tool.foreground},mousemove:function(t,e){if(t.shiftKey){var o=Math.abs(e.start.x-e.pos.x),n=Math.abs(e.start.y-e.pos.y);e.tmpContext.clearRect(0,0,e.tmpCanvas.width,e.tmpCanvas.height),o>0&&n>0&&(e.tmpContext.beginPath(),e.tmpContext.moveTo(e.start.x,e.start.y-2*n),e.tmpContext.bezierCurveTo(e.start.x+2*o,e.start.y-2*n,e.start.x+2*o,e.start.y+2*n,e.start.x,e.start.y+2*n),e.tmpContext.bezierCurveTo(e.start.x-2*o,e.start.y+2*n,e.start.x-2*o,e.start.y-2*n,e.start.x,e.start.y-2*n),e.tmpContext.closePath(),e.win.tool.lineStroke&&e.tmpContext.stroke(),e.tmpContext.fill())}else{var i=Math.abs(e.start.x-e.pos.x),r=Math.abs(e.start.y-e.pos.y),a=Math.sqrt(Math.pow(i,2)+Math.pow(r,2));e.tmpContext.clearRect(0,0,e.tmpCanvas.width,e.tmpCanvas.height),a>0&&(e.tmpContext.beginPath(),e.tmpContext.arc(e.start.x,e.start.y,a,0,2*Math.PI,!0),e.tmpContext.closePath(),e.win.tool.lineStroke&&e.tmpContext.stroke(),e.tmpContext.fill())}}}};class f extends c{constructor(t,e,o){super("ApplicationDrawWindow",{icon:e.icon,title:e.name,allow_drop:!0,min_width:400,min_height:450,width:800,height:450,translator:u},t,o),this.tool={name:"pointer",background:"#ffffff",foreground:"#000000",lineJoin:"round",lineWidth:1,lineStroke:!1}}init(t,o){const n=super.init(...arguments);var a=this;this._render("DrawWindow",e);var s=this._find("Statusbar"),l=this._find("Canvas").querySelector("canvas");l.width=h,l.height=d;var c,f,m=l.getContext("2d"),x={x:0,y:0},y={x:0,y:0},v=["path","rectangle","circle"];function w(){r.$remove(c),f=null,c=null}function k(t,e,o,n){if("down"===t){x={x:o.x,y:o.y},w();var i=r.$position(l);x.x=o.x-i.left,x.y=o.y-i.top,y={x:x.x,y:x.y},m.strokeStyle=a.tool.foreground,m.fillStyle=a.tool.background,m.lineWidth=a.tool.lineWidth,m.lineJoin=a.tool.lineJoin,v.indexOf(a.tool.name)>=0&&function(t){(c=document.createElement("canvas")).width=l.width,c.height=l.height,c.style.position="absolute",c.style.top="0px",c.style.left="0px",c.style.zIndex=9999999999,l.parentNode.appendChild(c);var e=t.shiftKey||t.button>0;(f=c.getContext("2d")).strokeStyle=e?m.fillStyle:m.strokeStyle,f.fillStyle=e?m.strokeStyle:m.fillStyle,f.lineWidth=m.lineWidth,f.lineJoin=m.lineJoin}(e)}else"move"===t?(y.x=x.x+n.x,y.y=x.y+n.y):"up"===t&&(c&&m&&m.drawImage(c,0,0),w(),x=null);g[a.tool.name]&&g[a.tool.name]["mouse"+t]&&g[a.tool.name]["mouse"+t](e,{pos:y,start:x,canvas:l,ctx:m,tmpContext:f,tmpCanvas:c,win:a})}i.createDrag(l,function(t,e){k("down",t,e)},function(t,e,o){k("move",t,o,e)},function(t,e){k("up",t,e),a.hasChanged=!0}),this._find("Foreground").on("click",function(){a.openColorDialog("foreground")}),this._find("Background").on("click",function(){a.openColorDialog("background")}),Object.keys(p).forEach(function(t){a._find("tool-"+t).on("click",function(){var e=p[t].statusText||"";s.set("value",u(e)),a.setToolProperty("name",t)})});for(var C=[],b=1;b<22;b++)C.push({label:b.toString(),value:b});return this._find("LineWidth").add(C).on("change",function(t){a.setToolProperty("lineWidth",parseInt(t.detail,10))}),this._find("LineJoin").on("change",function(t){a.setToolProperty("lineJoin",t.detail)}),this._find("LineStroke").on("change",function(t){a.setToolProperty("lineStroke",t.detail)}),this.setToolProperty("background",null),this.setToolProperty("foreground",null),this.setToolProperty("lineJoin",null),this.setToolProperty("lineWidth",null),this.setToolProperty("lineStroke",null),n}openColorDialog(t){var e=this,o=null;"background"===t?o=u("Set background color"):"foreground"===t&&(o=u("Set foreground color")),n.create("Color",{title:o,color:e.tool[t]},function(o,n,i){"ok"===n&&e.setToolProperty(t,i.hex)},this)}setToolProperty(t,e){console.warn("setToolProperty",t,e),void 0!==this.tool[t]&&null!==e&&(this.tool[t]=e),this._find("Foreground").set("value",this.tool.foreground),this._find("Background").set("value",this.tool.background),this._find("LineJoin").set("value",this.tool.lineJoin),this._find("LineWidth").set("value",this.tool.lineWidth),this._find("LineStroke").set("value",this.tool.lineStroke)}showFile(t,e){var o=this;super.showFile(...arguments);var n=this._find("Canvas").querySelector("canvas"),i=n.getContext("2d");if(e){this._toggleLoading(!0);var r=new Image;r.onerror=function(){o._toggleLoading(!1),alert("Failed to open image")},r.onload=function(){o._toggleLoading(!1),function(t){if(window.Uint8Array&&t instanceof Uint8Array){for(var e=i.createImageData(n.width,i.height),o=0;o<t.length;o++)e.data[o]=t[o];i.clearRect(0,0,n.width,n.height),i.drawImage(e,0,0)}else(t instanceof Image||t instanceof HTMLImageElement)&&(n.width=t.width,n.height=t.height,i.clearRect(0,0,t.width,t.height),i.drawImage(t,0,0))}(this)},r.src=e}else n.width=h,n.height=d,i.clearRect(0,0,n.width,n.height)}getFileData(){var t=this._find("Canvas").querySelector("canvas");return t?new s(t.toDataURL("image/png")):null}}OSjs.Applications.ApplicationDraw=class extends l{constructor(t,e){super("ApplicationDraw",t,e,{readData:!1,extension:"png",mime:"image/png",filename:"New image.png",filetypes:[{label:"PNG Image",mime:"image/png",extension:"png"}]})}init(t,e){super.init(...arguments);const o=this._getArgument("file");this._addWindow(new f(this,e,o))}}});
//# sourceMappingURL=sourcemaps/main.js.map
