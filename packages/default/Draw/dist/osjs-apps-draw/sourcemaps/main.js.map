{"version":3,"sources":["main.js"],"names":["define","Translations","schemeHtml","Locales","OSjs","require","Dialog","GUI","DOM","Colors","FileDataURL","DefaultApplication","DefaultApplicationWindow","doTranslate","createLocalizer","DEFAULT_WIDTH","DEFAULT_HEIGHT","tools","pointer","statusText","picker","bucket","pencil","path","rectangle","circle","toolEvents","imageData","pick","ev","args","value","t","shiftKey","button","ctx","getImageData","canvas","width","height","data","index","pos","x","y","convertToHEX","r","g","b","a","e","win","setToolProperty","mousedown","mousemove","mouseup","fillStyle","tool","fillRect","strokeStyle","beginPath","moveTo","lineTo","closePath","stroke","tmpContext","clearRect","tmpCanvas","start","background","foreground","w","h","Math","min","abs","lineStroke","strokeRect","bezierCurveTo","fill","sqrt","pow","arc","PI","ApplicationDrawWindow","[object Object]","app","metadata","file","super","icon","title","name","allow_drop","min_width","min_height","translator","this","lineJoin","lineWidth","wm","root","init","arguments","self","_render","statusbar","_find","querySelector","getContext","startPos","cpos","tmpTools","removeTempCanvas","$remove","toolAction","action","diff","elpos","$position","left","top","indexOf","document","createElement","style","position","zIndex","parentNode","appendChild","createTempCanvas","drawImage","createDrag","hasChanged","on","openColorDialog","Object","keys","forEach","stats","set","lineWidths","i","push","label","toString","add","parseInt","detail","param","colorParam","create","color","result","hex","console","warn","showFile","_toggleLoading","tmp","Image","onerror","alert","onload","img","window","Uint8Array","image","createImageData","length","HTMLImageElement","open","src","toDataURL","Applications","ApplicationDraw","readData","extension","mime","filename","filetypes","settings","_getArgument","_addWindow"],"mappings":"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","file":"../main.js","sourcesContent":["define([\n    './locales',\n    \"./scheme.html\"\n], function (Translations,schemeHtml) {\n    'use strict';\n    const Locales = OSjs.require('core/locales');\n    const Dialog = OSjs.require('core/dialog');\n    const GUI = OSjs.require('utils/gui');\n    const DOM = OSjs.require('utils/dom');\n    const Colors = OSjs.require('utils/colors');\n    const FileDataURL = OSjs.require('vfs/filedataurl');\n    const DefaultApplication = OSjs.require('helpers/default-application');\n    const DefaultApplicationWindow = OSjs.require('helpers/default-application-window');\n    const doTranslate = Locales.createLocalizer(Translations);\n    var DEFAULT_WIDTH = 1024;\n    var DEFAULT_HEIGHT = 768;\n    var tools = {\n        pointer: { statusText: '' },\n        picker: { statusText: 'LMB: Pick foreground-, RMB: Pick background color' },\n        bucket: { statusText: 'LMB: Fill with foreground-, RMB: Fill with background color' },\n        pencil: { statusText: 'LMB: Use foreground-, RMB: Use background color' },\n        path: { statusText: 'LMB: Use foreground-, RMB: Use background color' },\n        rectangle: { statusText: 'LMB: Use foreground-, RMB: Use background color. SHIFT: Toggle rectangle/square mode' },\n        circle: { statusText: 'LMB: Use foreground-, RMB: Use background color. SHIFT: Toggle circle/ellipse mode' }\n    };\n    var toolEvents = {\n        pointer: {},\n        picker: function () {\n            var imageData;\n            function pick(ev, args) {\n                var value = '#000000';\n                var t = ev.shiftKey || ev.button > 0 ? 'background' : 'foreground';\n                if (!imageData) {\n                    imageData = args.ctx.getImageData(0, 0, args.canvas.width, args.canvas.height).data;\n                }\n                var index = (args.pos.x + args.pos.y * args.canvas.width) * 4;\n                try {\n                    value = Colors.convertToHEX({\n                        r: imageData[index + 0],\n                        g: imageData[index + 1],\n                        b: imageData[index + 2],\n                        a: imageData[index + 3]\n                    });\n                } catch (e) {\n                }\n                args.win.setToolProperty(t, value);\n            }\n            return {\n                mousedown: pick,\n                mousemove: pick,\n                mouseup: function (ev, pos, canvas, ctx, win) {\n                    imageData = null;\n                }\n            };\n        }(),\n        bucket: {\n            mousedown: function (ev, args) {\n                var t = ev.shiftKey || ev.button > 0 ? 'background' : 'foreground';\n                args.ctx.fillStyle = args.win.tool[t];\n                args.ctx.fillRect(0, 0, args.canvas.width, args.canvas.height);\n            }\n        },\n        pencil: {\n            mousedown: function (ev, args) {\n                var t = ev.shiftKey || ev.button > 0 ? 'background' : 'foreground';\n                args.ctx.strokeStyle = args.win.tool[t];\n            },\n            mousemove: function (ev, args) {\n                args.ctx.beginPath();\n                args.ctx.moveTo(args.pos.x - 1, args.pos.y);\n                args.ctx.lineTo(args.pos.x, args.pos.y);\n                args.ctx.closePath();\n                args.ctx.stroke();\n            }\n        },\n        path: {\n            mousemove: function (ev, args) {\n                if (args.tmpContext) {\n                    args.tmpContext.clearRect(0, 0, args.tmpCanvas.width, args.tmpCanvas.height);\n                    args.tmpContext.beginPath();\n                    args.tmpContext.moveTo(args.start.x, args.start.y);\n                    args.tmpContext.lineTo(args.pos.x, args.pos.y);\n                    args.tmpContext.closePath();\n                    args.tmpContext.stroke();\n                }\n            }\n        },\n        rectangle: {\n            mousedown: function (ev, args) {\n                args.tmpContext.fillStyle = ev.button > 0 ? args.win.tool.background : args.win.tool.foreground;\n                args.tmpContext.strokeStyle = ev.button <= 0 ? args.win.tool.background : args.win.tool.foreground;\n            },\n            mousemove: function (ev, args) {\n                var x, y, w, h;\n                if (ev.shiftKey) {\n                    x = Math.min(args.pos.x, args.start.x);\n                    y = Math.min(args.pos.y, args.start.y);\n                    w = Math.abs(args.pos.x - args.start.x);\n                    h = Math.abs(args.pos.y - args.start.y);\n                } else {\n                    x = args.start.x;\n                    y = args.start.y;\n                    w = Math.abs(args.pos.x - args.start.x) * (args.pos.x < args.start.x ? -1 : 1);\n                    h = Math.abs(w) * (args.pos.y < args.start.y ? -1 : 1);\n                }\n                args.tmpContext.clearRect(0, 0, args.tmpCanvas.width, args.tmpCanvas.height);\n                if (w && h) {\n                    if (args.win.tool.lineStroke) {\n                        args.tmpContext.strokeRect(x, y, w, h);\n                    }\n                    args.tmpContext.fillRect(x, y, w, h);\n                }\n            }\n        },\n        circle: {\n            mousedown: function (ev, args) {\n                args.tmpContext.fillStyle = ev.button > 0 ? args.win.tool.background : args.win.tool.foreground;\n                args.tmpContext.strokeStyle = ev.button <= 0 ? args.win.tool.background : args.win.tool.foreground;\n            },\n            mousemove: function (ev, args) {\n                if (ev.shiftKey) {\n                    var width = Math.abs(args.start.x - args.pos.x);\n                    var height = Math.abs(args.start.y - args.pos.y);\n                    args.tmpContext.clearRect(0, 0, args.tmpCanvas.width, args.tmpCanvas.height);\n                    if (width > 0 && height > 0) {\n                        args.tmpContext.beginPath();\n                        args.tmpContext.moveTo(args.start.x, args.start.y - height * 2);\n                        args.tmpContext.bezierCurveTo(args.start.x + width * 2, args.start.y - height * 2, args.start.x + width * 2, args.start.y + height * 2, args.start.x, args.start.y + height * 2);\n                        args.tmpContext.bezierCurveTo(args.start.x - width * 2, args.start.y + height * 2, args.start.x - width * 2, args.start.y - height * 2, args.start.x, args.start.y - height * 2);\n                        args.tmpContext.closePath();\n                        if (args.win.tool.lineStroke) {\n                            args.tmpContext.stroke();\n                        }\n                        args.tmpContext.fill();\n                    }\n                } else {\n                    var x = Math.abs(args.start.x - args.pos.x);\n                    var y = Math.abs(args.start.y - args.pos.y);\n                    var r = Math.sqrt(Math.pow(x, 2) + Math.pow(y, 2));\n                    args.tmpContext.clearRect(0, 0, args.tmpCanvas.width, args.tmpCanvas.height);\n                    if (r > 0) {\n                        args.tmpContext.beginPath();\n                        args.tmpContext.arc(args.start.x, args.start.y, r, 0, Math.PI * 2, true);\n                        args.tmpContext.closePath();\n                        if (args.win.tool.lineStroke) {\n                            args.tmpContext.stroke();\n                        }\n                        args.tmpContext.fill();\n                    }\n                }\n            }\n        }\n    };\n    class ApplicationDrawWindow extends DefaultApplicationWindow {\n        constructor(app, metadata, file) {\n            super('ApplicationDrawWindow', {\n                icon: metadata.icon,\n                title: metadata.name,\n                allow_drop: true,\n                min_width: 400,\n                min_height: 450,\n                width: 800,\n                height: 450,\n                translator: doTranslate\n            }, app, file);\n            this.tool = {\n                name: 'pointer',\n                background: '#ffffff',\n                foreground: '#000000',\n                lineJoin: 'round',\n                lineWidth: 1,\n                lineStroke: false\n            };\n        }\n        init(wm, app) {\n            const root = super.init(...arguments);\n            var self = this;\n            this._render('DrawWindow', schemeHtml);\n            var statusbar = this._find('Statusbar');\n            var canvas = this._find('Canvas').querySelector('canvas');\n            canvas.width = DEFAULT_WIDTH;\n            canvas.height = DEFAULT_HEIGHT;\n            var ctx = canvas.getContext('2d');\n            var startPos = {\n                x: 0,\n                y: 0\n            };\n            var cpos = {\n                x: 0,\n                y: 0\n            };\n            var tmpTools = [\n                'path',\n                'rectangle',\n                'circle'\n            ];\n            var tmpCanvas, tmpContext;\n            function createTempCanvas(ev) {\n                tmpCanvas = document.createElement('canvas');\n                tmpCanvas.width = canvas.width;\n                tmpCanvas.height = canvas.height;\n                tmpCanvas.style.position = 'absolute';\n                tmpCanvas.style.top = '0px';\n                tmpCanvas.style.left = '0px';\n                tmpCanvas.style.zIndex = 9999999999;\n                canvas.parentNode.appendChild(tmpCanvas);\n                var t = ev.shiftKey || ev.button > 0;\n                tmpContext = tmpCanvas.getContext('2d');\n                tmpContext.strokeStyle = t ? ctx.fillStyle : ctx.strokeStyle;\n                tmpContext.fillStyle = t ? ctx.strokeStyle : ctx.fillStyle;\n                tmpContext.lineWidth = ctx.lineWidth;\n                tmpContext.lineJoin = ctx.lineJoin;\n            }\n            function removeTempCanvas() {\n                DOM.$remove(tmpCanvas);\n                tmpContext = null;\n                tmpCanvas = null;\n            }\n            function toolAction(action, ev, pos, diff) {\n                if (action === 'down') {\n                    startPos = {\n                        x: pos.x,\n                        y: pos.y\n                    };\n                    removeTempCanvas();\n                    var elpos = DOM.$position(canvas);\n                    startPos.x = pos.x - elpos.left;\n                    startPos.y = pos.y - elpos.top;\n                    cpos = {\n                        x: startPos.x,\n                        y: startPos.y\n                    };\n                    ctx.strokeStyle = self.tool.foreground;\n                    ctx.fillStyle = self.tool.background;\n                    ctx.lineWidth = self.tool.lineWidth;\n                    ctx.lineJoin = self.tool.lineJoin;\n                    if (tmpTools.indexOf(self.tool.name) >= 0) {\n                        createTempCanvas(ev);\n                    }\n                } else if (action === 'move') {\n                    cpos.x = startPos.x + diff.x;\n                    cpos.y = startPos.y + diff.y;\n                } else if (action === 'up') {\n                    if (tmpCanvas && ctx) {\n                        ctx.drawImage(tmpCanvas, 0, 0);\n                    }\n                    removeTempCanvas();\n                    startPos = null;\n                }\n                if (toolEvents[self.tool.name] && toolEvents[self.tool.name]['mouse' + action]) {\n                    toolEvents[self.tool.name]['mouse' + action](ev, {\n                        pos: cpos,\n                        start: startPos,\n                        canvas: canvas,\n                        ctx: ctx,\n                        tmpContext: tmpContext,\n                        tmpCanvas: tmpCanvas,\n                        win: self\n                    });\n                }\n            }\n            GUI.createDrag(canvas, function (ev, pos) {\n                toolAction('down', ev, pos);\n            }, function (ev, diff, pos) {\n                toolAction('move', ev, pos, diff);\n            }, function (ev, pos) {\n                toolAction('up', ev, pos);\n                self.hasChanged = true;\n            });\n            this._find('Foreground').on('click', function () {\n                self.openColorDialog('foreground');\n            });\n            this._find('Background').on('click', function () {\n                self.openColorDialog('background');\n            });\n            var ts = Object.keys(tools);\n            ts.forEach(function (t) {\n                self._find('tool-' + t).on('click', function () {\n                    var stats = tools[t].statusText || '';\n                    statusbar.set('value', doTranslate(stats));\n                    self.setToolProperty('name', t);\n                });\n            });\n            var lineWidths = [];\n            for (var i = 1; i < 22; i++) {\n                lineWidths.push({\n                    label: i.toString(),\n                    value: i\n                });\n            }\n            this._find('LineWidth').add(lineWidths).on('change', function (ev) {\n                self.setToolProperty('lineWidth', parseInt(ev.detail, 10));\n            });\n            this._find('LineJoin').on('change', function (ev) {\n                self.setToolProperty('lineJoin', ev.detail);\n            });\n            this._find('LineStroke').on('change', function (ev) {\n                self.setToolProperty('lineStroke', ev.detail);\n            });\n            this.setToolProperty('background', null);\n            this.setToolProperty('foreground', null);\n            this.setToolProperty('lineJoin', null);\n            this.setToolProperty('lineWidth', null);\n            this.setToolProperty('lineStroke', null);\n            return root;\n        }\n        openColorDialog(param) {\n            var self = this;\n            var colorParam = null;\n            if (param === 'background') {\n                colorParam = doTranslate('Set background color');\n            } else if (param === 'foreground') {\n                colorParam = doTranslate('Set foreground color');\n            }\n            Dialog.create('Color', {\n                title: colorParam,\n                color: self.tool[param]\n            }, function (ev, button, result) {\n                if (button !== 'ok') {\n                    return;\n                }\n                self.setToolProperty(param, result.hex);\n            }, this);\n        }\n        setToolProperty(param, value) {\n            console.warn('setToolProperty', param, value);\n            if (typeof this.tool[param] !== 'undefined') {\n                if (value !== null) {\n                    this.tool[param] = value;\n                }\n            }\n            this._find('Foreground').set('value', this.tool.foreground);\n            this._find('Background').set('value', this.tool.background);\n            this._find('LineJoin').set('value', this.tool.lineJoin);\n            this._find('LineWidth').set('value', this.tool.lineWidth);\n            this._find('LineStroke').set('value', this.tool.lineStroke);\n        }\n        showFile(file, result) {\n            var self = this;\n            super.showFile(...arguments);\n            var canvas = this._find('Canvas').querySelector('canvas');\n            var ctx = canvas.getContext('2d');\n            function open(img) {\n                if (window.Uint8Array && img instanceof Uint8Array) {\n                    var image = ctx.createImageData(canvas.width, ctx.height);\n                    for (var i = 0; i < img.length; i++) {\n                        image.data[i] = img[i];\n                    }\n                    ctx.clearRect(0, 0, canvas.width, canvas.height);\n                    ctx.drawImage(image, 0, 0);\n                } else if (img instanceof Image || img instanceof HTMLImageElement) {\n                    canvas.width = img.width;\n                    canvas.height = img.height;\n                    ctx.clearRect(0, 0, img.width, img.height);\n                    ctx.drawImage(img, 0, 0);\n                }\n            }\n            if (result) {\n                this._toggleLoading(true);\n                var tmp = new Image();\n                tmp.onerror = function () {\n                    self._toggleLoading(false);\n                    alert('Failed to open image');\n                };\n                tmp.onload = function () {\n                    self._toggleLoading(false);\n                    open(this);\n                };\n                tmp.src = result;\n            } else {\n                canvas.width = DEFAULT_WIDTH;\n                canvas.height = DEFAULT_HEIGHT;\n                ctx.clearRect(0, 0, canvas.width, canvas.height);\n            }\n        }\n        getFileData() {\n            var canvas = this._find('Canvas').querySelector('canvas');\n            if (canvas) {\n                return new FileDataURL(canvas.toDataURL('image/png'));\n            }\n            return null;\n        }\n    }\n    class ApplicationDraw extends DefaultApplication {\n        constructor(args, metadata) {\n            super('ApplicationDraw', args, metadata, {\n                readData: false,\n                extension: 'png',\n                mime: 'image/png',\n                filename: 'New image.png',\n                filetypes: [{\n                        label: 'PNG Image',\n                        mime: 'image/png',\n                        extension: 'png'\n                    }]\n            });\n        }\n        init(settings, metadata) {\n            super.init(...arguments);\n            const file = this._getArgument('file');\n            this._addWindow(new ApplicationDrawWindow(this, metadata, file));\n        }\n    }\n    OSjs.Applications.ApplicationDraw = ApplicationDraw;\n});"]}