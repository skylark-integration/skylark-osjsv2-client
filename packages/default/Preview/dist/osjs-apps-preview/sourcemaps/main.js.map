{"version":3,"sources":["main.js"],"names":["define","schemeHtml","DOM","OSjs","require","Events","Dialog","Locales","Connection","FileMetadata","DefaultApplication","DefaultApplicationWindow","ApplicationPreviewWindow","[object Object]","app","metadata","file","super","allow_drop","icon","title","name","width","height","this","zoomLevel","isImage","origWidth","origHeight","$view","destroy","arguments","wm","self","root","init","_render","_find","son","onZoomIn","onZoomOut","onZoomFit","onZoomOriginal","on","ev","detail","id","create","value","btn","match","_setWarning","_","request","method","url","err","res","contentType","headers","showFile","parent","modal","c","$element","$bind","pos","z","result","$empty","mime","_create","src","onload","offsetWidth","offsetHeight","_resizeTo","controls","autoplay","toolbar","val","zoom","indexOf","attr","w","Math","min","max","abs","_setTitle","currentFile","filename","String","setAttribute","firstChild","style","_onZoom","Applications","ApplicationPreview","args","readData","settings","_getArgument","_addWindow"],"mappings":"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","file":"../main.js","sourcesContent":["define([\r\n    \"./scheme.html\"\r\n], function (schemeHtml) {\r\n\r\n/*eslint valid-jsdoc: \"off\"*/\r\nconst DOM = OSjs.require('utils/dom');\r\nconst Events = OSjs.require('utils/events');\r\nconst Dialog = OSjs.require('core/dialog');\r\nconst Locales = OSjs.require('core/locales');\r\nconst Connection = OSjs.require('core/connection');\r\nconst FileMetadata = OSjs.require('vfs/file');\r\nconst DefaultApplication = OSjs.require('helpers/default-application');\r\nconst DefaultApplicationWindow = OSjs.require('helpers/default-application-window');\r\n\r\nclass ApplicationPreviewWindow extends DefaultApplicationWindow {\r\n\r\n  constructor(app, metadata, file) {\r\n    super('ApplicationPreviewWindow', {\r\n      allow_drop: true,\r\n      icon: metadata.icon,\r\n      title: metadata.name,\r\n      width: 400,\r\n      height: 200\r\n    }, app, file);\r\n\r\n    this.zoomLevel = 0;\r\n    this.isImage = true;\r\n    this.origWidth = 0;\r\n    this.origHeight = 0;\r\n    this.$view = null;\r\n  }\r\n\r\n  destroy() {\r\n    this.$view = null;\r\n\r\n    return super.destroy(...arguments);\r\n  }\r\n\r\n  init(wm, app) {\r\n    var self = this;\r\n    const root = super.init(...arguments);\r\n\r\n    // Load and set up scheme (GUI) here\r\n    this._render('PreviewWindow', schemeHtml);\r\n\r\n    this._find('ZoomIn').son('click', this, this.onZoomIn);\r\n    this._find('ZoomOut').son('click', this, this.onZoomOut);\r\n    this._find('ZoomFit').son('click', this, this.onZoomFit);\r\n    this._find('ZoomOriginal').son('click', this, this.onZoomOriginal);\r\n\r\n    this._find('SubmenuFile').on('select', function(ev) {\r\n      if ( ev.detail.id === 'MenuOpenLocation' ) {\r\n        Dialog.create('Input', {\r\n          value: 'http://'\r\n        }, function(ev, btn, value) {\r\n          if ( btn === 'ok' ) {\r\n            if ( !value.match(/^http/) ) {\r\n              self._setWarning(Locales._('ERR_OPEN_LOCATION_FMT', Locales._('ERR_INVALID_LOCATION')));\r\n              return;\r\n            }\r\n\r\n            Connection.request('curl', {\r\n              method: 'HEAD',\r\n              url: value\r\n            }, function(err, res) {\r\n              var contentType = res.headers['content-type'];\r\n              if ( !contentType ) {\r\n                err = Locales._('ERR_VFS_NO_MIME_DETECT');\r\n              }\r\n\r\n              if ( err ) {\r\n                self._setWarning(Locales._('ERR_OPEN_LOCATION_FMT', err));\r\n              } else {\r\n                self.showFile(new FileMetadata(value, contentType), value);\r\n              }\r\n            });\r\n          }\r\n        }, {parent: self, modal: true});\r\n      }\r\n    });\r\n\r\n    var c = this._find('Content').$element;\r\n    Events.$bind(c, 'mousewheel', function(ev, pos) {\r\n      if ( pos.z === 1 ) {\r\n        self.onZoomOut();\r\n      } else if ( pos.z === -1 ) {\r\n        self.onZoomIn();\r\n      }\r\n    });\r\n\r\n    return root;\r\n  }\r\n\r\n  showFile(file, result) {\r\n    var self = this;\r\n    var root = this._find('Content').$element;\r\n    DOM.$empty(root);\r\n\r\n    if ( result ) {\r\n      this.zoomLevel = 0;\r\n\r\n      if ( file.mime.match(/^image/) ) {\r\n        this.isImage = true;\r\n        this.$view = this._create('gui-image', {src: result}, root, {\r\n          onload: function() {\r\n            self.origWidth = this.offsetWidth;\r\n            self.origHeight = this.offsetHeight;\r\n            self._resizeTo(this.offsetWidth, this.offsetHeight, true, false, this);\r\n          }\r\n        });\r\n      } else if ( file.mime.match(/^video/) ) {\r\n        this.isImage = false;\r\n        this.$view = this._create('gui-video', {src: result, controls: true, autoplay: true}, root, {\r\n          onload: function() {\r\n            self._resizeTo(this.offsetWidth, this.offsetHeight, true, false, this);\r\n          }\r\n        });\r\n      }\r\n    }\r\n\r\n    var toolbar = this._find('Toolbar');\r\n    if ( toolbar ) {\r\n      toolbar[this.isImage ? 'show' : 'hide']();\r\n    }\r\n\r\n    super.showFile(...arguments);\r\n  }\r\n\r\n  _onZoom(val) {\r\n    if ( !this.isImage || !this.$view ) {\r\n      return;\r\n    }\r\n\r\n    var zoom = ['in', 'out'].indexOf(val) !== -1;\r\n    var attr = 'zoomed';\r\n    var w = null;\r\n\r\n    if ( val === 'in' ) {\r\n      this.zoomLevel = Math.min(10, this.zoomLevel + 1);\r\n    } else if ( val === 'out' ) {\r\n      this.zoomLevel = Math.max(-10, this.zoomLevel - 1);\r\n    } else {\r\n      this.zoomLevel = 0;\r\n      attr = val === 'fit' ? val : '';\r\n    }\r\n\r\n    if ( zoom ) {\r\n      var z = this.zoomLevel;\r\n      if ( z === 0 ) {\r\n        z = 1;\r\n        w = this.origWidth;\r\n      } else if ( z > 0 ) {\r\n        z += 1;\r\n        w = this.origWidth * z;\r\n      } else if ( z < 0 ) {\r\n        z -= 1;\r\n        w = Math.abs(this.origWidth / z);\r\n      }\r\n\r\n      this._setTitle(this.currentFile.filename + ' (' + String(z * 100) + '%)', true);\r\n    } else {\r\n      this._setTitle(this.currentFile.filename, true);\r\n    }\r\n\r\n    this.$view.$element.setAttribute('data-zoom', attr);\r\n    this.$view.$element.firstChild.style.width = (w === null ? 'auto' : String(w) + 'px');\r\n  }\r\n\r\n  onZoomIn() {\r\n    this._onZoom('in');\r\n  }\r\n\r\n  onZoomOut() {\r\n    this._onZoom('out');\r\n  }\r\n\r\n  onZoomFit() {\r\n    this._onZoom('fit');\r\n  }\r\n\r\n  onZoomOriginal() {\r\n    this._onZoom();\r\n  }\r\n\r\n}\r\n\r\nclass ApplicationPreview extends DefaultApplication {\r\n\r\n  constructor(args, metadata) {\r\n    super('ApplicationPreview', args, metadata, {\r\n      readData: false\r\n    });\r\n  }\r\n\r\n  init(settings, metadata) {\r\n    super.init(...arguments);\r\n\r\n    const file = this._getArgument('file');\r\n    this._addWindow(new ApplicationPreviewWindow(this, metadata, file));\r\n  }\r\n}\r\n\r\nOSjs.Applications.ApplicationPreview = ApplicationPreview;\r\n\r\n});"]}