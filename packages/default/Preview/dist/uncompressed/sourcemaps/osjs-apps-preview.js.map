{"version":3,"sources":["osjs-apps-preview.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"../osjs-apps-preview.js","sourcesContent":["define('osjs-apps-preview/scheme.html',[], function() { return \"<application-window data-id=\\\"PreviewWindow\\\">\\r\\n\\r\\n  <gui-vbox>\\r\\n    <!-- MENU BAR -->\\r\\n    <gui-vbox-container data-grow=\\\"0\\\" data-shrink=\\\"1\\\" data-basis=\\\"auto\\\">\\r\\n      <gui-menu-bar>\\r\\n\\r\\n        <gui-menu-bar-entry data-label=\\\"LBL_FILE\\\">\\r\\n          <gui-menu data-id=\\\"SubmenuFile\\\">\\r\\n            <gui-menu-entry data-id=\\\"MenuOpen\\\" data-label=\\\"LBL_OPEN\\\"></gui-menu-entry>\\r\\n            <gui-menu-entry data-id=\\\"MenuOpenLocation\\\" data-label=\\\"LBL_OPEN_LOCATION\\\"></gui-menu-entry>\\r\\n            <gui-menu-entry data-id=\\\"MenuClose\\\" data-label=\\\"LBL_CLOSE\\\"></gui-menu-entry>\\r\\n          </gui-menu>\\r\\n        </gui-menu-bar-entry>\\r\\n\\r\\n      </gui-menu-bar>\\r\\n    </gui-vbox-container>\\r\\n\\r\\n    <!-- TOOLBAR -->\\r\\n    <gui-vbox-container data-grow=\\\"0\\\" data-shrink=\\\"1\\\" data-basis=\\\"auto\\\" data-id=\\\"Toolbar\\\">\\r\\n      <gui-toolbar>\\r\\n        <gui-button data-id=\\\"ZoomOriginal\\\" data-icon=\\\"stock://16x16/actions/zoom-original.png\\\"></gui-button>\\r\\n        <gui-button data-id=\\\"ZoomFit\\\" data-icon=\\\"stock://16x16/actions/zoom-fit-best.png\\\"></gui-button>\\r\\n        <gui-button data-id=\\\"ZoomOut\\\" data-icon=\\\"stock://16x16/actions/zoom-out.png\\\"></gui-button>\\r\\n        <gui-button data-id=\\\"ZoomIn\\\" data-icon=\\\"stock://16x16/actions/zoom-in.png\\\"></gui-button>\\r\\n      </gui-toolbar>\\r\\n    </gui-vbox-container>\\r\\n\\r\\n    <!-- CONTENT -->\\r\\n    <gui-vbox-container data-grow=\\\"1\\\" data-shrink=\\\"0\\\" data-basis=\\\"auto\\\" data-fill=\\\"true\\\">\\r\\n      <gui-container data-id=\\\"Content\\\">\\r\\n      </gui-container>\\r\\n    </gui-vbox-container>\\r\\n\\r\\n  </gui-vbox>\\r\\n\\r\\n\\r\\n</application-window>\\r\\n\"; });\ndefine('osjs-apps-preview/main',[\r\n    \"./scheme.html\"\r\n], function (schemeHtml) {\r\n\r\n/*eslint valid-jsdoc: \"off\"*/\r\nconst DOM = OSjs.require('utils/dom');\r\nconst Events = OSjs.require('utils/events');\r\nconst Dialog = OSjs.require('core/dialog');\r\nconst Locales = OSjs.require('core/locales');\r\nconst Connection = OSjs.require('core/connection');\r\nconst FileMetadata = OSjs.require('vfs/file');\r\nconst DefaultApplication = OSjs.require('helpers/default-application');\r\nconst DefaultApplicationWindow = OSjs.require('helpers/default-application-window');\r\n\r\nclass ApplicationPreviewWindow extends DefaultApplicationWindow {\r\n\r\n  constructor(app, metadata, file) {\r\n    super('ApplicationPreviewWindow', {\r\n      allow_drop: true,\r\n      icon: metadata.icon,\r\n      title: metadata.name,\r\n      width: 400,\r\n      height: 200\r\n    }, app, file);\r\n\r\n    this.zoomLevel = 0;\r\n    this.isImage = true;\r\n    this.origWidth = 0;\r\n    this.origHeight = 0;\r\n    this.$view = null;\r\n  }\r\n\r\n  destroy() {\r\n    this.$view = null;\r\n\r\n    return super.destroy(...arguments);\r\n  }\r\n\r\n  init(wm, app) {\r\n    var self = this;\r\n    const root = super.init(...arguments);\r\n\r\n    // Load and set up scheme (GUI) here\r\n    this._render('PreviewWindow', schemeHtml);\r\n\r\n    this._find('ZoomIn').son('click', this, this.onZoomIn);\r\n    this._find('ZoomOut').son('click', this, this.onZoomOut);\r\n    this._find('ZoomFit').son('click', this, this.onZoomFit);\r\n    this._find('ZoomOriginal').son('click', this, this.onZoomOriginal);\r\n\r\n    this._find('SubmenuFile').on('select', function(ev) {\r\n      if ( ev.detail.id === 'MenuOpenLocation' ) {\r\n        Dialog.create('Input', {\r\n          value: 'http://'\r\n        }, function(ev, btn, value) {\r\n          if ( btn === 'ok' ) {\r\n            if ( !value.match(/^http/) ) {\r\n              self._setWarning(Locales._('ERR_OPEN_LOCATION_FMT', Locales._('ERR_INVALID_LOCATION')));\r\n              return;\r\n            }\r\n\r\n            Connection.request('curl', {\r\n              method: 'HEAD',\r\n              url: value\r\n            }, function(err, res) {\r\n              var contentType = res.headers['content-type'];\r\n              if ( !contentType ) {\r\n                err = Locales._('ERR_VFS_NO_MIME_DETECT');\r\n              }\r\n\r\n              if ( err ) {\r\n                self._setWarning(Locales._('ERR_OPEN_LOCATION_FMT', err));\r\n              } else {\r\n                self.showFile(new FileMetadata(value, contentType), value);\r\n              }\r\n            });\r\n          }\r\n        }, {parent: self, modal: true});\r\n      }\r\n    });\r\n\r\n    var c = this._find('Content').$element;\r\n    Events.$bind(c, 'mousewheel', function(ev, pos) {\r\n      if ( pos.z === 1 ) {\r\n        self.onZoomOut();\r\n      } else if ( pos.z === -1 ) {\r\n        self.onZoomIn();\r\n      }\r\n    });\r\n\r\n    return root;\r\n  }\r\n\r\n  showFile(file, result) {\r\n    var self = this;\r\n    var root = this._find('Content').$element;\r\n    DOM.$empty(root);\r\n\r\n    if ( result ) {\r\n      this.zoomLevel = 0;\r\n\r\n      if ( file.mime.match(/^image/) ) {\r\n        this.isImage = true;\r\n        this.$view = this._create('gui-image', {src: result}, root, {\r\n          onload: function() {\r\n            self.origWidth = this.offsetWidth;\r\n            self.origHeight = this.offsetHeight;\r\n            self._resizeTo(this.offsetWidth, this.offsetHeight, true, false, this);\r\n          }\r\n        });\r\n      } else if ( file.mime.match(/^video/) ) {\r\n        this.isImage = false;\r\n        this.$view = this._create('gui-video', {src: result, controls: true, autoplay: true}, root, {\r\n          onload: function() {\r\n            self._resizeTo(this.offsetWidth, this.offsetHeight, true, false, this);\r\n          }\r\n        });\r\n      }\r\n    }\r\n\r\n    var toolbar = this._find('Toolbar');\r\n    if ( toolbar ) {\r\n      toolbar[this.isImage ? 'show' : 'hide']();\r\n    }\r\n\r\n    super.showFile(...arguments);\r\n  }\r\n\r\n  _onZoom(val) {\r\n    if ( !this.isImage || !this.$view ) {\r\n      return;\r\n    }\r\n\r\n    var zoom = ['in', 'out'].indexOf(val) !== -1;\r\n    var attr = 'zoomed';\r\n    var w = null;\r\n\r\n    if ( val === 'in' ) {\r\n      this.zoomLevel = Math.min(10, this.zoomLevel + 1);\r\n    } else if ( val === 'out' ) {\r\n      this.zoomLevel = Math.max(-10, this.zoomLevel - 1);\r\n    } else {\r\n      this.zoomLevel = 0;\r\n      attr = val === 'fit' ? val : '';\r\n    }\r\n\r\n    if ( zoom ) {\r\n      var z = this.zoomLevel;\r\n      if ( z === 0 ) {\r\n        z = 1;\r\n        w = this.origWidth;\r\n      } else if ( z > 0 ) {\r\n        z += 1;\r\n        w = this.origWidth * z;\r\n      } else if ( z < 0 ) {\r\n        z -= 1;\r\n        w = Math.abs(this.origWidth / z);\r\n      }\r\n\r\n      this._setTitle(this.currentFile.filename + ' (' + String(z * 100) + '%)', true);\r\n    } else {\r\n      this._setTitle(this.currentFile.filename, true);\r\n    }\r\n\r\n    this.$view.$element.setAttribute('data-zoom', attr);\r\n    this.$view.$element.firstChild.style.width = (w === null ? 'auto' : String(w) + 'px');\r\n  }\r\n\r\n  onZoomIn() {\r\n    this._onZoom('in');\r\n  }\r\n\r\n  onZoomOut() {\r\n    this._onZoom('out');\r\n  }\r\n\r\n  onZoomFit() {\r\n    this._onZoom('fit');\r\n  }\r\n\r\n  onZoomOriginal() {\r\n    this._onZoom();\r\n  }\r\n\r\n}\r\n\r\nclass ApplicationPreview extends DefaultApplication {\r\n\r\n  constructor(args, metadata) {\r\n    super('ApplicationPreview', args, metadata, {\r\n      readData: false\r\n    });\r\n  }\r\n\r\n  init(settings, metadata) {\r\n    super.init(...arguments);\r\n\r\n    const file = this._getArgument('file');\r\n    this._addWindow(new ApplicationPreviewWindow(this, metadata, file));\r\n  }\r\n}\r\n\r\nOSjs.Applications.ApplicationPreview = ApplicationPreview;\r\n\r\n});\ndefine('osjs-apps-preview', ['osjs-apps-preview/main'], function (main) { return main; });\n\n"]}