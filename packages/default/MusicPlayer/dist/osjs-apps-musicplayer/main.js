/**
 * osjs-apps-musicplayer - 
 * @author 
 * @version v1.0.0
 * @link 
 * @license 
 */
define(["./locales"],function(e){"use strict";const t=OSjs.require("utils/fs"),i=OSjs.require("utils/misc"),s=OSjs.require("core/locales"),a=OSjs.require("core/dialog"),n=OSjs.require("vfs/file"),r=OSjs.require("helpers/default-application"),l=OSjs.require("helpers/default-application-window"),o=s.createLocalizer(e);function d(e){var t=Math.floor(e/3600),i=Math.floor((e-3600*t)/60),s=Math.floor(e-3600*t-60*i);return i<10&&(i="0"+i),s<10&&(s="0"+s),i+":"+s}class u extends l{constructor(e,t,i){super("ApplicationMusicPlayerWindow",{icon:t.icon,title:t.name,auto_size:!0,allow_drop:!0,allow_resize:!1,allow_maximize:!1,width:370,height:260,translator:o},e,i),this.updated=0,this.seeking=!1}init(e,t){const i=super.init(...arguments);var n=this;this._render("MusicPlayerWindow",require("osjs-scheme-loader!./scheme.html"));var r=this._find("LabelTime"),l=this._find("Seek"),d=this._find("Player"),u=d.$element.firstChild;this._find("ButtonStart").set("disabled",!0),this._find("ButtonRew").set("disabled",!0);var c=this._find("ButtonPlay").set("disabled",!0).on("click",function(){u.play()}),f=this._find("ButtonPause").set("disabled",!0).on("click",function(){u.pause()});return this._find("ButtonFwd").set("disabled",!0),this._find("ButtonEnd").set("disabled",!0),l.on("change",function(e){if(n.seeking=!1,u&&!u.paused)try{u.pause(),e&&(u.currentTime=e.detail||0),u.play()}catch(e){}}),d.on("play",function(e){l.set("disabled",!1),f.set("disabled",!1),c.set("disabled",!0)}),d.on("ended",function(e){l.set("disabled",!0),f.set("disabled",!0)}),d.on("pause",function(e){l.set("disabled",!0),f.set("disabled",!1),c.set("disabled",!1)}),d.on("loadeddata",function(e){}),d.on("timeupdate",function(e){n.updateTime(r,l)}),d.on("error",function(e){if(d.$element.src){var t=null;try{switch(e.target.error.code){case e.target.error.MEDIA_ERR_ABORTED:t=o("Playback aborted");break;case e.target.error.MEDIA_ERR_NETWORK:t=o("Network or communication error");break;case e.target.error.MEDIA_ERR_DECODE:t=o("Decoding failed. Corruption or unsupported media");break;case e.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:t=o("Media source not supported");break;default:t=s._("ERR_APP_UNKNOWN_ERROR")}}catch(e){t=s._("ERR_GENERIC_APP_FATAL_FMT",e)}t&&a.create("Alert",{title:n._title,message:t},null,n)}}),i}showFile(e,i){if(e&&i){var s=this,a=this._find("Player"),n=this._find("Seek"),r=a.$element.firstChild;n.on("mousedown",function(){s.seeking=!0}),n.on("mouseup",function(){s.seeking=!1});var l=e?e.filename:"",o=e?t.dirname(e.path):"",d=this._find("LabelArtist").set("value",""),u=this._find("LabelTitle").set("value",l),c=this._find("LabelAlbum").set("value",o);this._find("LabelTime").set("value",""),n.set("min",0),n.set("max",0),n.set("value",0),this.updated=0,this.seeking=!1,r.src=i||"",r.play(),s._app._api("info",{filename:e.path}).then(e=>{e&&(e.Artist&&d.set("value",e.Artist),e.Album&&c.set("value",e.Album),e.Title&&u.set("value",e.Track))})}}updateTime(e,t){if(!this._destroyed){var s=this._find("Player").$element.firstChild,a=s.duration,n=s.currentTime,r=!1;!isNaN(n)&&isFinite(n)||(n=0),!isNaN(a)&&isFinite(a)||(a=n,r=!0);var l=i.format("{0} / {1}",d(n),r?"<unknown>":d(a));this.updated<2?(t.set("min",0),t.set("max",a)):this.updated++,e.set("value",l),this.seeking||t.set("value",n)}}}OSjs.Applications.ApplicationMusicPlayer=class extends r{constructor(e,t){super("ApplicationMusicPlayer",e,t,{readData:!1})}init(e,t){super.init(...arguments);const i=this._getArgument("file");this._addWindow(new u(this,t,i))}_onMessage(e,t,i){if(super._onMessage(...arguments),"attention"===e&&t&&t.file){var s=this._getMainWindow();this.openFile(new n(t.file),s)}}}});
//# sourceMappingURL=sourcemaps/main.js.map
