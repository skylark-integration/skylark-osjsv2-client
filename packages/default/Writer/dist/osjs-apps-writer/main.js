/**
 * osjs-apps-writer - 
 * @author 
 * @version v1.0.0
 * @link 
 * @license 
 */
define(["./locales","./scheme.html"],function(e,n){"use strict";const t=OSjs.require("vfs/fs"),o=OSjs.require("core/config"),i=OSjs.require("core/dialog"),c=OSjs.require("gui/element"),r=OSjs.require("utils/misc"),a=OSjs.require("core/locales"),s=OSjs.require("helpers/default-application"),u=OSjs.require("helpers/default-application-window"),l=a.createLocalizer(e);class f extends u{constructor(e,n,t){const i=o.getConfig();super("ApplicationWriterWindow",{allow_drop:!0,icon:n.icon,title:n.name,width:550,height:400,translator:l},e,t),this.checkChangeLength=-1,this.checkChangeInterval=null,this.color={background:"#ffffff",foreground:"#000000"},this.font={name:i.Fonts.default,size:3}}destroy(){this.checkChangeInterval=clearInterval(this.checkChangeInterval),super.destroy(...arguments)}init(e,o){const a=super.init(...arguments);var s=this;this._render("WriterWindow",n);var u=this._find("Text"),f={"text-bold":{command:"bold"},"text-italic":{command:"italic"},"text-underline":{command:"underline"},"text-strikethrough":{command:"strikeThrough"},"justify-left":{command:"justifyLeft"},"justify-center":{command:"justifyCenter"},"justify-right":{command:"justifyRight"},indent:{command:"indent"},unindent:{command:"outdent"}},d={MenuUndo:function(){u.command("undo",!1)},MenuRedo:function(){u.command("redo",!1)},MenuCopy:function(){u.command("copy",!1)},MenuCut:function(){u.command("cut",!1)},MenuDelete:function(){u.command("delete",!1)},MenuPaste:function(){u.command("paste",!1)},MenuUnlink:function(){u.command("unlink",!1)},MenuInsertOL:function(){u.command("insertOrderedList",!1)},MenuInsertUL:function(){u.command("insertUnorderedList",!1)},MenuInsertImage:function(){i.create("File",{filter:["^image"]},function(e,n,o){"ok"===n&&o&&t.url(o).then(e=>{u.command("insertImage",!1,e)})},s)},MenuInsertLink:function(){i.create("Input",{message:l("Insert URL"),placeholder:"https://os-js.org"},function(e,n,t){"ok"===n&&t&&u.command("createLink",!1,t)},s)}};function m(e){d[e.detail.id]&&d[e.detail.id]()}function h(e,n){s._toggleDisabled(!0),i.create("Color",{color:e},function(e,t,o){s._toggleDisabled(!1),"ok"===t&&o&&n(o.hex)},s)}this._find("SubmenuEdit").on("select",m),this._find("SubmenuInsert").on("select",m);var g=this._find("Background").on("click",function(){h(s.color.background,function(e){u.command("hiliteColor",!1,e),s.color.background=e,g.set("value",e)})}),p=this._find("Foreground").on("click",function(){h(s.color.foreground,function(e){u.command("foreColor",!1,e),s.color.foreground=e,p.set("value",e)})}),k=this._find("Font").on("click",function(){var e;e=function(e){u.command("fontName",!1,e.fontName),u.command("fontSize",!1,e.fontSize),s.font.name=e.fontName,s.font.size=e.fontSize},s._toggleDisabled(!0),i.create("Font",{fontSize:s.font.size,fontName:s.font.name,minSize:1,maxSize:8,unit:"null"},function(n,t,o){s._toggleDisabled(!1),"ok"===t&&o&&e(o)},s)});function v(){!function(e){g.set("value",e.hiliteColor),p.set("value",e.foreColor),e.fontName&&k.set("label",r.format("{0} ({1})",e.fontName,e.fontSize.toString()))}(function(){function e(e){return u.query(e)}var n={fontName:(e("fontName")||"").split(",")[0].replace(/^'/,"").replace(/'$/,""),fontSize:parseInt(e("fontSize"),10)||s.font.size,foreColor:e("foreColor"),hiliteColor:e("hiliteColor")};return Object.keys(f).forEach(function(t){var o=f[t];n[o.command]={button:t,value:e(o.command)}}),n}())}return a.querySelectorAll("gui-toolbar > gui-button").forEach(function(e){var n=e.getAttribute("data-id"),t=f[n];t&&c.createFromNode(e).on("click",function(){u.command(t.command)}).on("mousedown",function(e){e.preventDefault()})}),g.set("value",this.color.background),p.set("value",this.color.foreground),k.set("label",r.format("{0} ({1})",this.font.name,this.font.size.toString())),u.on("selection",function(){v()}),this.checkChangeInterval=setInterval(function(){if(!s.hasChanged){s.checkChangeLength<0&&(s.checkChangeLength=u.get("value").length);var e=u.get("value").length;e!==s.checkChangeLength&&(s.hasChanged=!0),s.checkChangeLength=e}},500),a}updateFile(e){u.prototype.updateFile.apply(this,arguments);try{this._find("Text").$element.focus()}catch(e){}this.checkChangeLength=-1}showFile(e,n){this._find("Text").set("value",n||""),u.prototype.showFile.apply(this,arguments)}getFileData(){return this._find("Text").get("value")}_focus(e,n){return!!super._focus(...arguments)&&(this._find("Text").focus(),!0)}}OSjs.Applications.ApplicationWriter=class extends s{constructor(e,n){super("ApplicationWriter",e,n,{extension:"odoc",mime:"osjs/document",filename:"New text file.odoc"})}init(e,n){super.init(...arguments);const t=this._getArgument("file");this._addWindow(new f(this,n,t))}}});
//# sourceMappingURL=sourcemaps/main.js.map
