/**
 * osjs-apps-corewm - 
 * @author 
 * @version v1.0.0
 * @link 
 * @license 
 */
define(["../panelitem"],function(t){"use strict";const e=OSjs.require("utils/gui"),n=OSjs.require("gui/menu"),s=OSjs.require("utils/dom"),i=OSjs.require("core/init"),o=OSjs.require("core/theme"),r=OSjs.require("utils/events"),a=OSjs.require("core/locales"),u=OSjs.require("core/process"),c=OSjs.require("core/package-manager"),l=OSjs.require("core/window-manager");return class extends t{constructor(t){t&&t.set("buttons",t.get("buttons",[]).map(t=>(t.title=a._(t.title),t))),super("PanelItemButtons","Buttons",t,{buttons:[]})}init(){const t=super.init(...arguments);let n,i;function o(t){n=s.$remove(n),t||(i=null)}this.renderButtons();let r=0;return e.createDroppable(this._$container,{onOver:(t,e,s)=>{t.target&&function(t){const e="UL"===t.tagName;if(!t||i===t||e)return;const s=t.parentNode;i=t,o(!0),(n=document.createElement("li")).className="Ghost",s.insertBefore(n,t)}(t.target)},onEnter:t=>{t.preventDefault(),r++},onLeave:t=>{r<=0&&o()},onDrop:()=>{r=0,o()},onItemDropped:(t,e,n,i)=>{if(n&&n.data){let e=0;if(s.$hasClass(t.target,"Ghost")&&(e=s.$index(t.target)),void 0!==n.data.position)this.moveButton(n.data.position,e-1);else if("osjs/application"===n.data.mime){const t=n.data.path.split("applications:///")[1];this.createButton(t,e)}}}}),t}clearButtons(){s.$empty(this._$container)}renderButtons(){const t=l.instance,e={applications:e=>{t.showMenu(e)},settings:e=>{t&&t.showSettings()},exit:t=>{i.logout()}};this.clearButtons(),(this._settings.get("buttons")||[]).forEach((t,n)=>{let s=[{title:"Remove button",onClick:()=>{this.removeButton(n)}}],i=()=>{u.create(t.launch)};t.system&&(s=null,i=function(n){n.stopPropagation(),e[t.system](n)}),this.addButton(t.title,t.icon,s,i,n)})}removeButton(t){this._settings.get("buttons").splice(t,1),this.renderButtons(),this._settings.save()}moveButton(t,e){const n=this._settings.get("buttons");if(!(t===e||n.length<=1)){if(e>=n.length){let t=e-n.length;for(;1+t--;)n.push(window.undefined)}n.splice(e,0,n.splice(t,1)[0]),this._settings.save(()=>{this.renderButtons()})}}createButton(t,e){const n=c.getPackage(t),s=this._settings.get("buttons"),i={title:t,icon:n.icon,launch:t};s.length?s.splice(e,0,i):s.push(i),this.renderButtons(),this._settings.save()}addButton(t,i,a,u,c){const l=document.createElement("img");l.alt="",l.src=o.getIcon(i);const p=document.createElement("li");p.title=t,p.setAttribute("role","button"),p.setAttribute("aria-label",t),p.appendChild(l),r.$bind(p,"click",u,!0),r.$bind(p,"contextmenu",function(t){t.preventDefault(),t.stopPropagation(),a&&n.create(a,t)}),e.createDraggable(p,{data:{position:c},onStart:function(t,e){setTimeout(function(){s.$addClass(e,"Ghosting")},1)},onEnd:function(t,e){s.$removeClass(e,"Ghosting")}}),this._$container.appendChild(p)}}});
//# sourceMappingURL=../sourcemaps/panelitems/buttons.js.map
