/**
 * osjs-apps-corewm - 
 * @author 
 * @version v1.0.0
 * @link 
 * @license 
 */
define(["../panelitem"],function(e){"use strict";const t=OSjs.require("utils/dom"),a=OSjs.require("utils/misc"),i=OSjs.require("core/theme"),r=OSjs.require("utils/events"),n=OSjs.require("core/connection");return class extends e{constructor(){super("PanelItemWeather corewm-panel-right corewm-panel-dummy"),this.clockInterval=null,this.position=null,this.interval=null,this.$element=null,this.$image=null,navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{this.position=e,setTimeout(()=>this.updateWeather(),100)})}init(){const e=super.init(...arguments);return this.$element=document.createElement("li"),this.$image=document.createElement("img"),this.$element.appendChild(this.$image),this._$container.appendChild(this.$element),this.updateWeather(),e}destroy(){return r.$unbind(this._$root,"click"),this.interval=clearInterval(this.interval),this.$image=t.$remove(this.$image),this.$element=t.$remove(this.$element),super.destroy(...arguments)}updateWeather(){if(!this.$image)return;this.$image.title="Not allowed or unavailable";var e=!1;const t=e=>{this.$image&&(this.$image.src=e)},s=(e,r,n)=>{if(this.$image){e=e||"<unknown location>",r=r||{},n=n||{};var s=r.description||"<unknown weather>",o=n.temp||"<unknown temp>";n.temp&&(o+="C");var c="sunny.png";switch(s){case"clear sky":c="01n"===r.icon?"weather-clear-night.png":"weather-clear.png";break;case"few clouds":c="02n"===r.icon?"weather-few-clouds-night.png":"weather-few-clouds.png";break;case"scattered clouds":case"broken clouds":c="weather-overcast.png";break;case"shower rain":c="weather-showers.png";break;case"rain":c="weather-showers-scattered.png";break;case"thunderstorm":c="stock_weather-storm.png";break;case"snow":c="stock_weather-snow.png";break;case"mist":c="stock_weather-fog.png";break;default:s.match(/rain$/)&&(c="weather-showers-scattered.png")}var h=i.getIcon("status/"+c);this.$image.title=a.format("{0} - {1} - {2}",e,s,o),t(h)}},o=()=>{if(!e&&this.position){e=!0;var t=this.position.coords.latitude,i=this.position.coords.longitude,r=a.format("http://api.openweathermap.org/data/2.5/weather?lat={0}&lon={1}&units={2}&APPID={3}",t,i,"metric","4ea33327bcfa4ea0293b2d02b6fda385");n.request("curl",{url:r}).then(t=>{if(t){var a=null;try{a=JSON.parse(t.body)}catch(e){}a&&s(a.name,a.weather?a.weather[0]:null,a.main)}e=!1}).catch(()=>{e=!1})}};t(i.getIcon("status/weather-severe-alert.png")),this.interval=setInterval(function(){o()},36e5),r.$bind(this._$root,"click",()=>o()),setTimeout(()=>o(),1e3)}}});
//# sourceMappingURL=../sourcemaps/panelitems/weather.js.map
