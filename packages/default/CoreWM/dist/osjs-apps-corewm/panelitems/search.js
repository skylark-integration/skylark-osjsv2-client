/**
 * osjs-apps-corewm - 
 * @author 
 * @version v1.0.0
 * @link 
 * @license 
 */
define(["../panelitem"],function(e){"use strict";const t=OSjs.require("utils/dom"),i=OSjs.require("helpers/hooks"),s=OSjs.require("core/theme"),n=OSjs.require("utils/events"),r=OSjs.require("core/locales"),o=OSjs.require("utils/keycodes"),a=OSjs.require("core/process"),c=OSjs.require("vfs/file"),u=OSjs.require("core/search-engine"),h=OSjs.require("core/window-manager");return class extends e{constructor(e){super("PanelItemSearch corewm-panel-right","Search",e,{}),this.$ul=null,this.$box=null,this.$input=null,this.$message=null,this.visible=!1,this.hookId=-1,this.currentIndex=-1,this.currentCount=0}init(){const e=super.init(...arguments),t=document.createElement("img");t.src=s.getIcon("actions/system-search.png");const a=document.createElement("input");a.setAttribute("type","text");const c=document.createElement("gui-text");c.appendChild(a);const u=document.createElement("ul");this.$message=document.createElement("div"),this.$message.appendChild(document.createTextNode(r._("SEARCH_LOADING"))),this.$box=document.createElement("corewm-search"),this.$box.className="custom-notification",this.$box.appendChild(c),this.$box.appendChild(this.$message),this.$box.appendChild(u);const h=this,l={};l[o.DOWN]=(()=>this.navigateDown()),l[o.UP]=(()=>this.navigateUp()),l[o.ESC]=(()=>this.hide()),l[o.ENTER]=function(e){this.value.length?(h.search(this.value),this.value=""):h.navigateOpen()},i.addHook("menuBlur",()=>this.hide()),n.$bind(e,"click",function(e){e.stopPropagation(),h.visible?h.hide():h.show()}),n.$bind(a,"mousedown",e=>e.stopPropagation()),n.$bind(a,"keydown",function(e){l[e.keyCode]&&(e.preventDefault(),e.stopPropagation(),l[e.keyCode].call(this,e))}),n.$bind(u,"mousedown",e=>e.stopPropagation()),n.$bind(u,"click",e=>{const t=e.target;"LI"===t.tagName&&h.launch(t)}),n.$bind(this.$box,"mousedown",()=>{a&&a.focus()});const d=document.createElement("li");return d.appendChild(t),this.$ul=u,this.$input=a,this._$container.appendChild(d),document.body.appendChild(this.$box),e}applySettings(){}openSettings(){a.create("ApplicationSettings",{category:"search"})}destroy(){return this.hookId>=0&&i.removeHook(this.hookId),n.$unbind(this._$root,"click"),n.$unbind(this.$input,"mousedown"),n.$unbind(this.$input,"keydown"),n.$unbind(this.$ul,"mousedown"),n.$unbind(this.$ul,"click"),n.$unbind(this.$box,"mousedown"),this.$message=t.$remove(this.$message),this.$input=t.$remove(this.$input),this.$box=t.$remove(this.$box),this.$ul=t.$remove(this.$ul),super.destroy(...arguments)}launch(e){const t=e.getAttribute("data-launch"),i=JSON.parse(e.getAttribute("data-args")),s=e.getAttribute("data-file"),n=e.getAttribute("data-mime"),r=e.getAttribute("data-type");s?"dir"===r?a.create("ApplicationFileManager",{path:s}):a.createFromFile(new c(s,n)):a.create(t,i),this.hide()}show(){if(!this.$box||this.visible)return;const e=h.instance.getWindowSpace(!0),i=this.$box.querySelector("input");t.$empty(this.$box.querySelector("ul")),this.$box.style.marginTop=String(e.top)+"px",this.$box.setAttribute("data-visible",String(!0)),i&&(i.value="",i.focus()),this.visible=!0,this.$message.style.display="none"}hide(){this.$box&&this.visible&&(this.$box.setAttribute("data-visible",String(!1)),this.visible=!1)}search(e){this.$box&&(this.currentIndex=-1,this.currentCount=0,t.$empty(this.$message),this.$message.appendChild(document.createTextNode(r._("SEARCH_LOADING"))),this.$message.style.display="block",u.search(e,{limit:10,recursive:!0}).then(e=>{this.renderResult(e)}).catch(e=>{console.error("PanelItemSearch::search()","errors",e)}))}renderResult(e){if(!this.$box)return;const i=this.$box.querySelector("ul");t.$empty(i),this.currentCount=e.length,this.currentCount?this.$message.style.display="none":(t.$empty(this.$message),this.$message.appendChild(document.createTextNode(r._("SEARCH_NO_RESULTS"))),this.$message.style.display="block"),e.forEach(function(e){const t=document.createElement("img");t.src=e.icon;const s=document.createElement("div");s.className="Title",s.appendChild(document.createTextNode(e.title));const n=document.createElement("div");n.className="Message",n.appendChild(document.createTextNode(e.description));const r=document.createElement("li");r.setAttribute("data-launch",e.launch.application),r.setAttribute("data-args",JSON.stringify(e.launch.args)),e.launch.file&&(r.setAttribute("data-file",e.launch.file.path),r.setAttribute("data-mime",e.launch.file.mime),r.setAttribute("data-type",e.launch.file.type)),r.appendChild(t),r.appendChild(s),r.appendChild(n),i.appendChild(r)})}updateSelection(){const e=this.$box.querySelector("ul"),i=e.children[this.currentIndex];e.querySelectorAll("li").forEach(function(e){t.$removeClass(e,"active")}),t.$addClass(i,"active")}navigateUp(){this.currentCount&&(this.currentIndex>0?this.currentIndex--:this.currentIndex=this.currentCount-1,this.updateSelection())}navigateDown(){this.currentCount&&(this.currentIndex<0||this.currentIndex>=this.currentCount-1?this.currentIndex=0:this.currentIndex++,this.updateSelection())}navigateOpen(){if(-1===this.currentIndex||!this.currentCount)return;const e=this.$box.querySelector("ul").children[this.currentIndex];e&&this.launch(e)}}});
//# sourceMappingURL=../sourcemaps/panelitems/search.js.map
