{"version":3,"sources":["menu.js"],"names":["define","Translations","_","OSjs","require","createLocalizer","Menu","GUI","DOM","Events","Process","Theme","WindowManager","PackageManager","CategorizedApplicationMenu","[object Object]","apps","getPackages","cfgCategories","instance","getDefaultSetting","createEvent","iter","el","createDraggable","type","data","launch","name","clickEvent","create","cats","Object","keys","forEach","c","a","visible","cat","category","push","list","submenu","length","title","icon","getIcon","tooltip","description","onCreated","onClick","menu","this","ev","m","$element","$addClass","ApplicationMenu","root","document","createElement","id","entry","img","src","txt","appendChild","createTextNode","$bind","createEntry","querySelectorAll","$unbind","$remove","pos","parentNode","body","$removeClass","y","window","innerHeight","style","top","bottom","left","x","showMenu","wm","inst","getSetting","clientX","clientY","target","rect","$position","width","height","panel","$parent","node","tagName","toLowerCase","prect","show"],"mappings":"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","file":"../menu.js","sourcesContent":["define(['./locales'], function (Translations) {\n    'use strict';\n    const _ = OSjs.require('core/locales').createLocalizer(Translations);\n    const Menu = OSjs.require('gui/menu');\n    const GUI = OSjs.require('utils/gui');\n    const DOM = OSjs.require('utils/dom');\n    const Events = OSjs.require('utils/events');\n    const Process = OSjs.require('core/process');\n    const Theme = OSjs.require('core/theme');\n    const WindowManager = OSjs.require('core/window-manager');\n    const PackageManager = OSjs.require('core/package-manager');\n    class CategorizedApplicationMenu {\n        constructor() {\n            var apps = PackageManager.getPackages();\n            var wm = WindowManager.instance;\n            var cfgCategories = wm.getDefaultSetting('menu');\n            function createEvent(iter) {\n                return function (el) {\n                    GUI.createDraggable(el, {\n                        type: 'application',\n                        data: { launch: iter.name }\n                    });\n                };\n            }\n            function clickEvent(iter) {\n                return function () {\n                    Process.create(iter.name);\n                };\n            }\n            var cats = {};\n            Object.keys(cfgCategories).forEach(function (c) {\n                cats[c] = [];\n            });\n            Object.keys(apps).forEach(function (a) {\n                var iter = apps[a];\n                if (iter.type === 'application' && iter.visible !== false) {\n                    var cat = iter.category && cats[iter.category] ? iter.category : 'unknown';\n                    cats[cat].push({\n                        name: a,\n                        data: iter\n                    });\n                }\n            });\n            var list = [];\n            Object.keys(cats).forEach(function (c) {\n                var submenu = [];\n                for (var a = 0; a < cats[c].length; a++) {\n                    var iter = cats[c][a];\n                    submenu.push({\n                        title: iter.data.name,\n                        icon: Theme.getIcon(iter.data.icon, '16x16'),\n                        tooltip: iter.data.description,\n                        onCreated: createEvent(iter),\n                        onClick: clickEvent(iter)\n                    });\n                }\n                if (submenu.length) {\n                    list.push({\n                        title: _(cfgCategories[c].title),\n                        icon: Theme.getIcon(cfgCategories[c].icon, '16x16'),\n                        menu: submenu\n                    });\n                }\n            });\n            this.list = list;\n        }\n        show(ev) {\n            var m = Menu.create(this.list, ev);\n            if (m && m.$element) {\n                DOM.$addClass(m.$element, 'CoreWMDefaultApplicationMenu');\n            }\n        }\n    }\n    class ApplicationMenu {\n        constructor() {\n            var root = this.$element = document.createElement('gui-menu');\n            this.$element.id = 'CoreWMApplicationMenu';\n            var apps = PackageManager.getPackages();\n            function createEntry(a, iter) {\n                var entry = document.createElement('gui-menu-entry');\n                var img = document.createElement('img');\n                img.src = Theme.getIcon(iter.icon, '32x32');\n                var txt = document.createElement('div');\n                txt.appendChild(document.createTextNode(iter.name));\n                Events.$bind(entry, 'click', function (ev) {\n                    Process.create(a);\n                });\n                entry.appendChild(img);\n                entry.appendChild(txt);\n                root.appendChild(entry);\n            }\n            Object.keys(apps).forEach(function (a) {\n                var iter = apps[a];\n                if (iter.type === 'application' && iter.visible !== false) {\n                    createEntry(a, iter);\n                }\n            });\n        }\n        destroy() {\n            if (this.$element) {\n                this.$element.querySelectorAll('gui-menu-entry').forEach(function (el) {\n                    Events.$unbind(el, 'click');\n                });\n                DOM.$remove(this.$element);\n            }\n            this.$element = null;\n        }\n        show(pos) {\n            if (!this.$element) {\n                return;\n            }\n            if (!this.$element.parentNode) {\n                document.body.appendChild(this.$element);\n            }\n            DOM.$removeClass(this.$element, 'AtBottom');\n            DOM.$removeClass(this.$element, 'AtTop');\n            if (pos.y > window.innerHeight / 2) {\n                DOM.$addClass(this.$element, 'AtBottom');\n                this.$element.style.top = 'auto';\n                this.$element.style.bottom = '30px';\n            } else {\n                DOM.$addClass(this.$element, 'AtTop');\n                this.$element.style.bottom = 'auto';\n                this.$element.style.top = '30px';\n            }\n            this.$element.style.left = pos.x + 'px';\n        }\n        getRoot() {\n            return this.$element;\n        }\n    }\n    function showMenu(ev) {\n        const wm = WindowManager.instance;\n        let inst;\n        if (wm && wm.getSetting('useTouchMenu') === true) {\n            inst = new ApplicationMenu();\n            var pos = {\n                x: ev.clientX,\n                y: ev.clientY\n            };\n            if (ev.target) {\n                var rect = DOM.$position(ev.target, document.body);\n                if (rect.left && rect.top && rect.width && rect.height) {\n                    pos.x = rect.left - rect.width / 2;\n                    if (pos.x <= 16) {\n                        pos.x = 0;\n                    }\n                    var panel = DOM.$parent(ev.target, function (node) {\n                        return node.tagName.toLowerCase() === 'corewm-panel';\n                    });\n                    if (panel) {\n                        var prect = DOM.$position(panel);\n                        pos.y = prect.top + prect.height;\n                    } else {\n                        pos.y = rect.top + rect.height;\n                    }\n                }\n            }\n            Menu.create(null, pos, inst);\n        } else {\n            inst = new CategorizedApplicationMenu();\n            inst.show(ev);\n        }\n    }\n    return { showMenu: showMenu };\n});"]}