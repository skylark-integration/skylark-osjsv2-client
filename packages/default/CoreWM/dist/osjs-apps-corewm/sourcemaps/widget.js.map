{"version":3,"sources":["widget.js"],"names":["define","Translations","_","OSjs","require","createLocalizer","Menu","DOM","Utils","Events","WindowManager","TIMEOUT_SHOW_ENVELOPE","TIMEOUT_HIDE_ENVELOPE","DEFAULT_OPTIONS","aspect","width","height","minWidth","minHeight","maxHeight","maxWidth","left","right","top","bottom","locked","canvas","resizable","viewBox","frequency","custom","settings","enabled","name","title","bindWidgetEvents","instance","timeout","position","_getNormalizedPosition","dimension","_getDimension","start","x","y","_mouseDown","ev","pos","action","preventDefault","_locked","clearTimeout","$bind","window","dx","dy","obj","_options","_aspect","_getDimensionAspected","_onMouseMove","$unbind","_onMouseUp","_windowWidth","innerWidth","_windowHeight","innerHeight","_onMouseDown","_$element","_$resize","stopPropagation","_showEnvelope","setTimeout","_hideEnvelope","_onContextMenu","validNumber","num","isNaN","[object Object]","options","mergeObject","cloneObject","this","_position","get","_dimension","_name","_settings","_isManipulating","_requestId","_saveTimeout","_settingsWindow","_$canvas","_$context","console","debug","root","document","createElement","setAttribute","getContext","appendChild","_updatePosition","_updateDimension","_setLock","$addClass","fpsInterval","now","then","elapsed","onInited","onResize","animate","requestAnimationFrame","Date","onRender","fps","Math","min","cancelAnimationFrame","destroy","$remove","_setPosition","onMove","_setDimension","_resizeTimeout","$removeClass","_saveOptions","c","onContextMenu","menu","onClick","Array","concat","push","_openSettings","create","tree","opts","set","_focus","wm","win","Window","_scheme","_on","scheme","onOpenSettings","_render","id","_find","on","save","render","addWindow","stick","_isPastHalf","o","w","max","h","l","String","style","k","v","def","value","dir","hleft","aleft","htop"],"mappings":"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","file":"../widget.js","sourcesContent":["define(['./locales'], function (Translations) {\n    'use strict';\n    const _ = OSjs.require('core/locales').createLocalizer(Translations);\n    const Menu = OSjs.require('gui/menu');\n    const DOM = OSjs.require('utils/dom');\n    const Utils = OSjs.require('utils/misc');\n    const Events = OSjs.require('utils/events');\n    const WindowManager = OSjs.require('core/window-manager');\n    const MIN_WIDTH = 64;\n    const MIN_HEIGHT = 64;\n    const TIMEOUT_SAVE = 500;\n    const TIMEOUT_SHOW_ENVELOPE = 3000;\n    const TIMEOUT_HIDE_ENVELOPE = 1000;\n    const DEFAULT_OPTIONS = {\n        aspect: false,\n        width: 100,\n        height: 100,\n        minWidth: MIN_WIDTH,\n        minHeight: MIN_HEIGHT,\n        maxHeight: 500,\n        maxWidth: 500,\n        left: 0,\n        right: null,\n        top: 0,\n        bottom: null,\n        locked: false,\n        canvas: false,\n        resizable: false,\n        viewBox: false,\n        frequency: 2,\n        custom: {},\n        settings: {\n            enabled: false,\n            name: 'CoreWMWidgetSettingsWindow',\n            title: _('LBL_SETTINGS'),\n            width: 300,\n            height: 300\n        }\n    };\n    function bindWidgetEvents(instance) {\n        var timeout = null;\n        var position = instance._getNormalizedPosition();\n        var dimension = instance._getDimension();\n        var start = {\n            x: 0,\n            y: 0\n        };\n        function _getDimensionAspected(dx, dy) {\n            if (instance._options.aspect === true) {\n                var width = dimension.width + dx;\n                var height = width / instance._aspect;\n                return {\n                    width: width,\n                    height: height\n                };\n            }\n            return {\n                width: dimension.width + dx,\n                height: dimension.height + dy\n            };\n        }\n        function _mouseDown(ev, pos, action) {\n            ev.preventDefault();\n            if (instance._locked) {\n                return;\n            }\n            timeout = clearTimeout(timeout);\n            start = pos;\n            position = instance._getNormalizedPosition();\n            dimension = instance._getDimension();\n            Events.$bind(window, 'mousemove:modifywidget', function (ev, pos) {\n                var dx = pos.x - start.x;\n                var dy = pos.y - start.y;\n                var obj = action === 'move' ? {\n                    left: position.left + dx,\n                    top: position.top + dy\n                } : _getDimensionAspected(dx, dy);\n                instance._onMouseMove(ev, obj, action);\n            });\n            Events.$bind(window, 'mouseup:modifywidget', function (ev, pos) {\n                Events.$unbind(window, 'mousemove:modifywidget');\n                Events.$unbind(window, 'mouseup:modifywidget');\n                instance._onMouseUp(ev, pos, action);\n            });\n            instance._windowWidth = window.innerWidth;\n            instance._windowHeight = window.innerHeight;\n            instance._onMouseDown(ev, pos, action);\n        }\n        Events.$bind(instance._$element, 'mousedown:movewidget', function (ev, pos) {\n            _mouseDown(ev, pos, 'move');\n        });\n        Events.$bind(instance._$resize, 'mousedown:resizewidget', function (ev, pos) {\n            ev.stopPropagation();\n            _mouseDown(ev, pos, 'resize');\n        });\n        Events.$bind(instance._$element, 'click:showenvelope', function (ev) {\n            timeout = clearTimeout(timeout);\n            instance._showEnvelope();\n        });\n        Events.$bind(instance._$element, 'mouseover:showenvelope', function () {\n            timeout = clearTimeout(timeout);\n            timeout = setTimeout(function () {\n                instance._showEnvelope();\n            }, TIMEOUT_SHOW_ENVELOPE);\n        });\n        Events.$bind(instance._$element, 'mouseout:hideenvelope', function (ev) {\n            timeout = clearTimeout(timeout);\n            timeout = setTimeout(function () {\n                instance._hideEnvelope();\n            }, TIMEOUT_HIDE_ENVELOPE);\n        });\n        Events.$bind(instance._$element, 'contextmenu:widgetcontext', function (ev) {\n            instance._onContextMenu(ev);\n        });\n    }\n    function validNumber(num) {\n        if (typeof num !== 'undefined' && num !== null) {\n            return !isNaN(num);\n        }\n        return false;\n    }\n    return class Widget {\n        constructor(name, options, settings) {\n            options = Utils.mergeObject(Utils.cloneObject(DEFAULT_OPTIONS), options || {});\n            this._aspect = options.aspect === true ? options.width / options.height : typeof options.aspect === 'number' ? options.aspect : 1;\n            if (options.aspect !== false) {\n                options.minHeight = options.width / this._aspect;\n                options.maxHeight = options.maxWidth / this._aspect;\n            }\n            if (options.viewBox) {\n                options.resizable = true;\n                if (options.viewBox === true) {\n                    options.viewBox = '0 0 ' + options.width + ' ' + options.height;\n                }\n            }\n            this._position = {\n                left: settings.get('left', options.left),\n                top: settings.get('top', options.top),\n                right: settings.get('right', options.right),\n                bottom: settings.get('bottom', options.bottom)\n            };\n            this._dimension = {\n                height: settings.get('height', options.height),\n                width: settings.get('width', options.width)\n            };\n            this._name = name;\n            this._settings = settings;\n            this._options = options;\n            this._isManipulating = false;\n            this._windowWidth = window.innerWidth;\n            this._windowHeight = window.innerHeight;\n            this._requestId = null;\n            this._saveTimeout = null;\n            this._settingsWindow = null;\n            this._locked = settings.get('locked', false);\n            this._$element = null;\n            this._$resize = null;\n            this._$canvas = null;\n            this._$context = null;\n            Utils.mergeObject(this._options.settings, settings.get('settings', {}));\n            console.debug('Widget::construct()', this._name, this._settings.get());\n        }\n        init(root) {\n            this._windowWidth = window.innerWidth;\n            this._windowHeight = window.innerHeight;\n            this._$element = document.createElement('corewm-widget');\n            this._$resize = document.createElement('corewm-widget-resize');\n            if (this._options.canvas) {\n                this._$canvas = document.createElement('canvas');\n                if (this._options.viewBox) {\n                    this._$canvas.setAttribute('viewBox', this._options.viewBox);\n                }\n                this._$context = this._$canvas.getContext('2d');\n                this._$element.appendChild(this._$canvas);\n            }\n            bindWidgetEvents(this);\n            this._updatePosition();\n            this._updateDimension();\n            this._setLock(this._locked);\n            DOM.$addClass(this._$element, 'Widget' + this._name);\n            this._$element.appendChild(this._$resize);\n            root.appendChild(this._$element);\n            return this._$element;\n        }\n        _inited() {\n            this.onInited();\n            this.onResize(this._dimension);\n            var fpsInterval, now, then, elapsed;\n            const animate = () => {\n                window.requestAnimationFrame(animate);\n                now = Date.now();\n                elapsed = now - then;\n                if (elapsed > fpsInterval) {\n                    then = now - elapsed % fpsInterval;\n                    this.onRender();\n                }\n            };\n            if (this._$canvas) {\n                var fps = Math.min(this._options.frequency, 1);\n                this._requestId = window.requestAnimationFrame(function () {\n                    fpsInterval = 1000 / fps;\n                    then = Date.now();\n                    animate();\n                });\n            }\n        }\n        destroy() {\n            Events.$unbind(window, 'mousemove:modifywidget');\n            Events.$unbind(window, 'mouseup:modifywidget');\n            Events.$unbind(this._$resize, 'mousedown:resizewidget');\n            Events.$unbind(this._$element, 'mousedown:movewidget');\n            Events.$unbind(this._$element, 'click:showenvelope');\n            Events.$unbind(this._$element, 'mouseover:showenvelope');\n            Events.$unbind(this._$element, 'mouseout:hideenvelope');\n            Events.$unbind(this._$element, 'contextmenu:widgetcontext');\n            this._saveTimeout = clearTimeout(this._saveTimeout);\n            if (this._requestId) {\n                window.cancelAnimationFrame(this._requestId);\n            }\n            this._requestId = null;\n            if (this._settingsWindow) {\n                this._settingsWindow.destroy();\n            }\n            this._settingsWindow = null;\n            this._$canvas = DOM.$remove(this._$canvas);\n            this._$resize = DOM.$remove(this._$resize);\n            this._$element = DOM.$remove(this._$element);\n            this._$context = null;\n        }\n        blur() {\n        }\n        _onMouseDown(ev, pos, action) {\n            this._saveTimeout = clearTimeout(this._saveTimeout);\n            DOM.$addClass(this._$element, 'corewm-widget-active');\n            if (action === 'resize') {\n                var obj = this._getNormalizedPosition();\n                this._setPosition(obj);\n            }\n        }\n        _onMouseMove(ev, obj, action) {\n            this._isManipulating = true;\n            if (action === 'move') {\n                this._setPosition(obj, true);\n                this.onMove(this._position);\n            } else {\n                this._setDimension(obj);\n                this.onResize(this._dimension);\n            }\n        }\n        _onMouseUp(ev, pos, action) {\n            this._isManipulating = false;\n            this._resizeTimeout = clearTimeout(this._resizeTimeout);\n            DOM.$removeClass(this._$element, 'corewm-widget-active');\n            this._hideEnvelope();\n            if (action === 'resize') {\n                this._setPosition(null, true);\n            }\n            this._saveTimeout = clearTimeout(this._saveTimeout);\n            this._saveTimeout = setTimeout(() => {\n                this._saveOptions();\n            }, TIMEOUT_SAVE);\n        }\n        _onContextMenu(ev) {\n            var c = this.onContextMenu(ev);\n            var menu = [{\n                    title: this._locked ? _('LBL_UNLOCK') : _('LBL_LOCK'),\n                    onClick: () => {\n                        this._setLock();\n                        this._saveOptions();\n                    }\n                }];\n            if (c !== true) {\n                if (c instanceof Array) {\n                    menu = c.concat(menu);\n                }\n                if (this._options.settings.enabled) {\n                    menu.push({\n                        title: _('Open {0} Settings', _(this._name)),\n                        onClick: ev => {\n                            this._openSettings(ev);\n                        }\n                    });\n                }\n            }\n            Menu.create(menu, ev);\n        }\n        _saveOptions(custom) {\n            if (typeof custom !== 'undefined') {\n                this._options.settings.tree = custom;\n            }\n            var opts = {\n                width: this._dimension.width,\n                height: this._dimension.height,\n                right: this._position.right,\n                left: validNumber(this._position.right) ? null : this._position.left,\n                bottom: this._position.bottom,\n                top: validNumber(this._position.bottom) ? null : this._position.top,\n                locked: this._locked,\n                settings: { tree: this._options.settings.tree }\n            };\n            this._settings.set(null, opts, true);\n        }\n        _openSettings(ev) {\n            if (this._settingsWindow) {\n                this._settingsWindow._focus();\n                return;\n            }\n            var wm = WindowManager.instance;\n            var win = new Window(this._options.settings.name, {\n                title: this._options.settings.title,\n                width: this._options.settings.width,\n                height: this._options.settings.height\n            }, null, wm._scheme);\n            win._on('init', (root, scheme) => {\n                var opts = this.onOpenSettings(root, scheme, ev);\n                win._render(opts.id);\n                win._find('ButtonOK').on('click', () => {\n                    var settings = opts.save(root, scheme, ev);\n                    this._saveOptions(settings);\n                });\n                opts.render(root, scheme, ev);\n            });\n            win._on('close', () => {\n                this._settingsWindow = null;\n            });\n            this._settingsWindow = wm.addWindow(win, true);\n        }\n        _showEnvelope() {\n            if (!this._$element) {\n                return;\n            }\n            DOM.$addClass(this._$element, 'corewm-widget-envelope');\n        }\n        _hideEnvelope() {\n            if (!this._$element || this._isManipulating) {\n                return;\n            }\n            DOM.$removeClass(this._$element, 'corewm-widget-envelope');\n        }\n        _setPosition(obj, stick) {\n            obj = obj || Utils.cloneObject(this._position);\n            this._position.top = obj.top;\n            this._position.left = obj.left;\n            this._position.bottom = null;\n            this._position.right = null;\n            if (stick) {\n                if (this._isPastHalf('vertical', obj)) {\n                    this._position.top = null;\n                    this._position.bottom = this._windowHeight - this._dimension.height - obj.top;\n                }\n                if (this._isPastHalf('horizontal', obj)) {\n                    this._position.left = null;\n                    this._position.right = this._windowWidth - this._dimension.width - obj.left;\n                }\n            }\n            this._updatePosition();\n        }\n        _setDimension(obj) {\n            var o = this._options;\n            var w = Math.min(Math.max(obj.width, o.minWidth), o.maxWidth);\n            var h = Math.min(Math.max(obj.height, o.minHeight), o.maxHeight);\n            if (this._options.aspect === true) {\n                h = w / this._aspect;\n            }\n            this._dimension.width = w;\n            this._dimension.height = h;\n            this._updateDimension();\n        }\n        _setLock(l) {\n            if (typeof l !== 'boolean') {\n                l = !this._locked;\n            }\n            this._locked = l;\n            if (this._$element) {\n                this._$element.setAttribute('data-locked', String(this._locked));\n            }\n        }\n        _updatePosition() {\n            if (this._$element) {\n                if (validNumber(this._position.right)) {\n                    this._$element.style.left = 'auto';\n                    this._$element.style.right = String(this._position.right) + 'px';\n                } else {\n                    this._$element.style.left = String(this._position.left) + 'px';\n                    this._$element.style.right = 'auto';\n                }\n                if (validNumber(this._position.bottom)) {\n                    this._$element.style.top = 'auto';\n                    this._$element.style.bottom = String(this._position.bottom) + 'px';\n                } else {\n                    this._$element.style.top = String(this._position.top) + 'px';\n                    this._$element.style.bottom = 'auto';\n                }\n            }\n        }\n        _updateDimension() {\n            if (this._$element) {\n                this._$element.style.width = String(this._dimension.width) + 'px';\n                this._$element.style.height = String(this._dimension.height) + 'px';\n            }\n            if (this._$canvas) {\n                this._$canvas.width = this._dimension.width || MIN_WIDTH;\n                this._$canvas.height = this._dimension.height || MIN_HEIGHT;\n            }\n        }\n        _getNormalizedPosition() {\n            var left = this._position.left;\n            if (validNumber(this._position.right)) {\n                left = this._windowWidth - this._position.right - this._dimension.width;\n            }\n            var top = this._position.top;\n            if (validNumber(this._position.bottom)) {\n                top = this._windowHeight - this._position.bottom - this._dimension.height;\n            }\n            return {\n                left: left,\n                top: top\n            };\n        }\n        _getDimension() {\n            return {\n                width: this._dimension.width,\n                height: this._dimension.height\n            };\n        }\n        _getPosition() {\n            return {\n                left: this._position.left,\n                top: this._position.top,\n                right: this._position.right,\n                bottom: this._position.bottom\n            };\n        }\n        _setSetting(k, v, save) {\n            this._options.settings.tree[k] = v;\n            if (save) {\n                this._saveOptions();\n            }\n        }\n        _getSetting(k, def) {\n            if (typeof this._options.settings === 'undefined' || typeof this._options.settings.tree === 'undefined') {\n                return def;\n            }\n            var value = this._options.settings.tree[k];\n            return typeof value === 'undefined' ? def : value;\n        }\n        _isPastHalf(dir, obj) {\n            obj = obj || this._position;\n            var hleft = this._windowWidth / 2;\n            var aleft = obj.left + this._dimension.width / 2;\n            if (dir === 'horizontal') {\n                return aleft >= hleft;\n            }\n            var htop = this._windowHeight / 2;\n            var atop = obj.top + this._dimension.height / 2;\n            return atop >= htop;\n        }\n        onMove() {\n        }\n        onResize() {\n        }\n        onRender() {\n        }\n        onInited() {\n        }\n        onContextMenu(ev) {\n        }\n        onOpenSettings(root, scheme, ev) {\n            return {\n                id: null,\n                save: function () {\n                    return {};\n                },\n                render: function () {\n                }\n            };\n        }\n    };\n});"]}