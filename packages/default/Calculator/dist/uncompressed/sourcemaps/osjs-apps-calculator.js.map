{"version":3,"sources":["osjs-apps-calculator.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"../osjs-apps-calculator.js","sourcesContent":["define('osjs-apps-calculator/scheme.html',[], function() { return \"<application-window data-id=\\\"CalculatorWindow\\\">\\r\\n\\r\\n  <gui-vbox>\\r\\n    <gui-vbox-container data-grow=\\\"0\\\" data-shrink=\\\"1\\\" data-basis=\\\"auto\\\">\\r\\n      <gui-text data-id=\\\"Output\\\">0</gui-text>\\r\\n    </gui-vbox-container>\\r\\n\\r\\n    <gui-vbox-container data-grow=\\\"1\\\" data-shrink=\\\"0\\\" data-basis=\\\"auto\\\" data-fill=\\\"true\\\">\\r\\n      <gui-grid>\\r\\n        <gui-grid-row>\\r\\n          <gui-grid-entry>\\r\\n            <gui-button data-id=\\\"ButtonX\\\">X</gui-button>\\r\\n          </gui-grid-entry>\\r\\n          <gui-grid-entry>\\r\\n            <gui-button data-id=\\\"ButtonX\\\">X</gui-button>\\r\\n          </gui-grid-entry>\\r\\n          <gui-grid-entry>\\r\\n            <gui-button data-id=\\\"ButtonX\\\">X</gui-button>\\r\\n          </gui-grid-entry>\\r\\n          <gui-grid-entry>\\r\\n            <gui-button data-id=\\\"ButtonX\\\">X</gui-button>\\r\\n          </gui-grid-entry>\\r\\n        </gui-grid-row>\\r\\n\\r\\n        <gui-grid-row>\\r\\n          <gui-grid-entry>\\r\\n            <gui-button data-id=\\\"ButtonX\\\">X</gui-button>\\r\\n          </gui-grid-entry>\\r\\n          <gui-grid-entry>\\r\\n            <gui-button data-id=\\\"ButtonX\\\">X</gui-button>\\r\\n          </gui-grid-entry>\\r\\n          <gui-grid-entry>\\r\\n            <gui-button data-id=\\\"ButtonX\\\">X</gui-button>\\r\\n          </gui-grid-entry>\\r\\n          <gui-grid-entry>\\r\\n            <gui-button data-id=\\\"ButtonX\\\">X</gui-button>\\r\\n          </gui-grid-entry>\\r\\n        </gui-grid-row>\\r\\n\\r\\n        <gui-grid-row>\\r\\n          <gui-grid-entry>\\r\\n            <gui-button data-id=\\\"ButtonX\\\">X</gui-button>\\r\\n          </gui-grid-entry>\\r\\n          <gui-grid-entry>\\r\\n            <gui-button data-id=\\\"ButtonX\\\">X</gui-button>\\r\\n          </gui-grid-entry>\\r\\n          <gui-grid-entry>\\r\\n            <gui-button data-id=\\\"ButtonX\\\">X</gui-button>\\r\\n          </gui-grid-entry>\\r\\n          <gui-grid-entry>\\r\\n            <gui-button data-id=\\\"ButtonX\\\">X</gui-button>\\r\\n          </gui-grid-entry>\\r\\n        </gui-grid-row>\\r\\n\\r\\n        <gui-grid-row>\\r\\n          <gui-grid-entry>\\r\\n            <gui-button data-id=\\\"ButtonX\\\">X</gui-button>\\r\\n          </gui-grid-entry>\\r\\n          <gui-grid-entry>\\r\\n            <gui-button data-id=\\\"ButtonX\\\">X</gui-button>\\r\\n          </gui-grid-entry>\\r\\n          <gui-grid-entry>\\r\\n            <gui-button data-id=\\\"ButtonX\\\">X</gui-button>\\r\\n          </gui-grid-entry>\\r\\n          <gui-grid-entry>\\r\\n            <gui-button data-id=\\\"ButtonX\\\">X</gui-button>\\r\\n          </gui-grid-entry>\\r\\n        </gui-grid-row>\\r\\n\\r\\n        <gui-grid-row>\\r\\n          <gui-grid-entry>\\r\\n            <gui-button data-id=\\\"ButtonX\\\">X</gui-button>\\r\\n          </gui-grid-entry>\\r\\n          <gui-grid-entry>\\r\\n            <gui-button data-id=\\\"ButtonX\\\">X</gui-button>\\r\\n          </gui-grid-entry>\\r\\n          <gui-grid-entry style=\\\"flex:2 0 auto;\\\">\\r\\n            <gui-button data-id=\\\"ButtonX\\\">X</gui-button>\\r\\n          </gui-grid-entry>\\r\\n        </gui-grid-row>\\r\\n      </gui-grid>\\r\\n\\r\\n    </gui-vbox-container>\\r\\n\\r\\n  </gui-vbox>\\r\\n\\r\\n</application-window>\\r\\n\"; });\ndefine('osjs-apps-calculator/main',[\r\n    \"./scheme.html\"\r\n],function(schemeHtml){\r\n\r\nconst Window = OSjs.require('core/window');\r\nconst Application = OSjs.require('core/application');\r\nconst GUIElement = OSjs.require('gui/element');\r\nconst DOM = OSjs.require('utils/dom');\r\n\r\nvar ops = {\r\n  dec: '.',\r\n  perc: '%',\r\n  minus: '-',\r\n  plus: '+',\r\n  multiply: '*',\r\n  divide: '/'\r\n};\r\n\r\nvar keys = {\r\n  107: 'plus',\r\n  109: 'minus',\r\n  106: 'multiply',\r\n  111: 'divide',\r\n  110: 'dec',\r\n  188: 'dec',\r\n  13: 'equal',\r\n  47: 'divide',\r\n  46: 'CE',\r\n  45: 'minus',\r\n  44: 'dec',\r\n  43: 'plus',\r\n  42: 'multiply',\r\n  27: 'CE',\r\n  8: 'nbs'\r\n};\r\n\r\nvar labels = {\r\n  'CE': 'CE',  'AC': 'AC', 'perc': '%',  'plus': '+',\r\n  '7': '7',   '8': '8',  '9': '9',  'minus': '-',\r\n  '4': '4',   '5': '5',  '6': '6',  'multiply': 'x',\r\n  '1': '1',   '2': '2',  '3': '3',  'divide': '÷',\r\n  '0': '0',   'swap': '±',  'dec': ',',  'equal': '='\r\n};\r\n\r\nvar buttons = [\r\n  ['CE', 'AC',   'perc', 'plus'],\r\n  ['7',  '8',    '9',    'minus'],\r\n  ['4',  '5',    '6',    'multiply'],\r\n  ['1',  '2',    '3',    'divide'],\r\n  ['0',  'dec',  'equal']\r\n];\r\n\r\n/////////////////////////////////////////////////////////////////////////////\r\n// WINDOWS\r\n/////////////////////////////////////////////////////////////////////////////\r\n\r\nclass ApplicationCalculatorWindow extends Window {\r\n  constructor(app, metadata) {\r\n    super('ApplicationCalculatorWindow', {\r\n      icon: metadata.icon,\r\n      title: metadata.name,\r\n      allow_resize: false,\r\n      allow_maximize: false,\r\n      width: 220,\r\n      height: 340\r\n    }, app);\r\n\r\n    this.total = 0;\r\n    this.entries = [];\r\n    this.temp = '';\r\n  }\r\n\r\n  init(wm, app) {\r\n    const root = super.init(...arguments);\r\n\r\n    var self = this;\r\n\r\n    // Load and gel.set up scheme (GUI) here\r\n    this._render('CalculatorWindow', schemeHtml);\r\n\r\n    this._find('Output').on('keypress', function(ev) {\r\n      ev.stopPropagation();\r\n      ev.preventDefault();\r\n\r\n      var keyCode = ev.which || ev.keyCode;\r\n      if ( (keyCode > 95) && (keyCode < 106) ) {\r\n        self.operation(keyCode - 96);\r\n      } else if ( (keyCode > 47) && (keyCode < 58) ) {\r\n        self.operation(keyCode - 48);\r\n      } else {\r\n        if ( typeof keys[keyCode] !== 'undefined' ) {\r\n          self.operation(keys[keyCode]);\r\n        }\r\n      }\r\n    }).set('readonly', true).focus();\r\n\r\n    root.querySelectorAll('gui-button').forEach(function(el, idx) {\r\n      var r = parseInt(idx / 4, 10);\r\n      var c = idx % 4;\r\n      var op = buttons[r][c];\r\n\r\n      el = GUIElement.createInstance(el);\r\n      el.set('value', labels[op] || '');\r\n      if ( op === null ) {\r\n        DOM.$addClass(el.$element, 'noop');\r\n        el.set('disabled', true);\r\n      } else {\r\n        el.on('click', function() {\r\n          self.operation(op);\r\n        });\r\n      }\r\n    });\r\n\r\n    return root;\r\n  }\r\n\r\n  operation(val) {\r\n    var self = this;\r\n\r\n    if (this.temp === '' && ['plus', 'minus', 'multiply', 'divide'].indexOf(val) !== -1) {\r\n      this.temp = this._find('Output').get('value');\r\n    }\r\n\r\n    function getAnswer() {\r\n      var nt = Number(self.entries[0]);\r\n\r\n      for ( var i = 1; i < self.entries.length; i++ ) {\r\n        var nextNum = Number(self.entries[i + 1]);\r\n        var symbol = self.entries[i];\r\n        if (symbol === '+') {\r\n          nt += nextNum;\r\n        } else if ( symbol === '-' ) {\r\n          nt -= nextNum;\r\n        } else if ( symbol === '*' ) {\r\n          nt *= nextNum;\r\n        } else if ( symbol === '/' ) {\r\n          nt /= nextNum;\r\n        }\r\n        i++;\r\n      }\r\n\r\n      if ( nt < 0 ) {\r\n        nt = '-' + Math.abs(nt);\r\n      }\r\n\r\n      return nt;\r\n    }\r\n\r\n    var output = (function() {\r\n      // Kudos http://codepen.io/GeoffStorbeck/pen/zxgaqw\r\n\r\n      if ( !isNaN(val) || val === 'dec' ) { // Number\r\n        self.temp += val === 'dec' ? ops[val] : val;\r\n\r\n        return self.temp.substring(0, 10);\r\n      } else if ( val === 'AC' ) { // Clear\r\n        self.entries = [];\r\n        self.temp = '';\r\n        self.total = 0;\r\n\r\n        return '';\r\n      } else if ( val === 'CE' ) { // Clear Last Entry\r\n        self.temp = '';\r\n\r\n        return '';\r\n      } else if ( val === 'equal' ) { // Equal\r\n        self.entries.push(self.temp);\r\n\r\n        var nt = getAnswer();\r\n        self.entries = [];\r\n        self.temp = '';\r\n\r\n        return nt;\r\n      } else {\r\n        if ( typeof ops[val] !== 'undefined' ) {\r\n          val = ops[val];\r\n        }\r\n\r\n        self.entries.push(self.temp);\r\n        self.entries.push(val);\r\n        self.temp = '';\r\n      }\r\n\r\n      return null;\r\n    })();\r\n\r\n    if ( output !== null ) {\r\n      if ( !String(output).length ) {\r\n        output = String(0);\r\n      }\r\n\r\n      if ( output === 'NaN' || output === 'Infinity' || isNaN(output) || !isFinite(output) ) {\r\n        DOM.$addClass(this._$element, 'NaN');\r\n\r\n        setTimeout(function() {\r\n          DOM.$removeClass(self._$element, 'NaN');\r\n        }, 3000);\r\n      }\r\n\r\n      this._find('Output').set('value', String(output));\r\n    }\r\n\r\n    this._find('Output').focus();\r\n  }\r\n}\r\n\r\nclass ApplicationCalculator extends Application {\r\n  constructor(args, metadata) {\r\n    super('ApplicationCalculator', args, metadata);\r\n  }\r\n\r\n  init(settings, metadata) {\r\n    super.init(...arguments);\r\n\r\n    this._addWindow(new ApplicationCalculatorWindow(this, metadata));\r\n  }\r\n}\r\n\r\nOSjs.Applications.ApplicationCalculator = ApplicationCalculator;\r\n\r\n});\r\n\ndefine('osjs-apps-calculator', ['osjs-apps-calculator/main'], function (main) { return main; });\n\n"]}