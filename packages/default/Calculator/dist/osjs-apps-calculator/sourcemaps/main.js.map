{"version":3,"sources":["main.js"],"names":["define","schemeHtml","Window","OSjs","require","Application","GUIElement","DOM","ops","dec","perc","minus","plus","multiply","divide","keys","107","109","106","111","110","188","13","47","46","45","44","43","42","27","8","labels","CE","AC","7","9","4","5","6","1","2","3","0","swap","equal","buttons","ApplicationCalculatorWindow","[object Object]","app","metadata","super","icon","title","name","allow_resize","allow_maximize","width","height","this","total","entries","temp","wm","root","init","arguments","self","_render","_find","on","ev","stopPropagation","preventDefault","keyCode","which","operation","set","focus","querySelectorAll","forEach","el","idx","r","parseInt","c","op","createInstance","$addClass","$element","val","indexOf","get","output","isNaN","substring","push","nt","Number","i","length","nextNum","symbol","Math","abs","getAnswer","String","isFinite","_$element","setTimeout","$removeClass","Applications","ApplicationCalculator","args","settings","_addWindow"],"mappings":"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","file":"../main.js","sourcesContent":["define([\r\n    \"./scheme.html\"\r\n],function(schemeHtml){\r\n\r\nconst Window = OSjs.require('core/window');\r\nconst Application = OSjs.require('core/application');\r\nconst GUIElement = OSjs.require('gui/element');\r\nconst DOM = OSjs.require('utils/dom');\r\n\r\nvar ops = {\r\n  dec: '.',\r\n  perc: '%',\r\n  minus: '-',\r\n  plus: '+',\r\n  multiply: '*',\r\n  divide: '/'\r\n};\r\n\r\nvar keys = {\r\n  107: 'plus',\r\n  109: 'minus',\r\n  106: 'multiply',\r\n  111: 'divide',\r\n  110: 'dec',\r\n  188: 'dec',\r\n  13: 'equal',\r\n  47: 'divide',\r\n  46: 'CE',\r\n  45: 'minus',\r\n  44: 'dec',\r\n  43: 'plus',\r\n  42: 'multiply',\r\n  27: 'CE',\r\n  8: 'nbs'\r\n};\r\n\r\nvar labels = {\r\n  'CE': 'CE',  'AC': 'AC', 'perc': '%',  'plus': '+',\r\n  '7': '7',   '8': '8',  '9': '9',  'minus': '-',\r\n  '4': '4',   '5': '5',  '6': '6',  'multiply': 'x',\r\n  '1': '1',   '2': '2',  '3': '3',  'divide': '÷',\r\n  '0': '0',   'swap': '±',  'dec': ',',  'equal': '='\r\n};\r\n\r\nvar buttons = [\r\n  ['CE', 'AC',   'perc', 'plus'],\r\n  ['7',  '8',    '9',    'minus'],\r\n  ['4',  '5',    '6',    'multiply'],\r\n  ['1',  '2',    '3',    'divide'],\r\n  ['0',  'dec',  'equal']\r\n];\r\n\r\n/////////////////////////////////////////////////////////////////////////////\r\n// WINDOWS\r\n/////////////////////////////////////////////////////////////////////////////\r\n\r\nclass ApplicationCalculatorWindow extends Window {\r\n  constructor(app, metadata) {\r\n    super('ApplicationCalculatorWindow', {\r\n      icon: metadata.icon,\r\n      title: metadata.name,\r\n      allow_resize: false,\r\n      allow_maximize: false,\r\n      width: 220,\r\n      height: 340\r\n    }, app);\r\n\r\n    this.total = 0;\r\n    this.entries = [];\r\n    this.temp = '';\r\n  }\r\n\r\n  init(wm, app) {\r\n    const root = super.init(...arguments);\r\n\r\n    var self = this;\r\n\r\n    // Load and gel.set up scheme (GUI) here\r\n    this._render('CalculatorWindow', schemeHtml);\r\n\r\n    this._find('Output').on('keypress', function(ev) {\r\n      ev.stopPropagation();\r\n      ev.preventDefault();\r\n\r\n      var keyCode = ev.which || ev.keyCode;\r\n      if ( (keyCode > 95) && (keyCode < 106) ) {\r\n        self.operation(keyCode - 96);\r\n      } else if ( (keyCode > 47) && (keyCode < 58) ) {\r\n        self.operation(keyCode - 48);\r\n      } else {\r\n        if ( typeof keys[keyCode] !== 'undefined' ) {\r\n          self.operation(keys[keyCode]);\r\n        }\r\n      }\r\n    }).set('readonly', true).focus();\r\n\r\n    root.querySelectorAll('gui-button').forEach(function(el, idx) {\r\n      var r = parseInt(idx / 4, 10);\r\n      var c = idx % 4;\r\n      var op = buttons[r][c];\r\n\r\n      el = GUIElement.createInstance(el);\r\n      el.set('value', labels[op] || '');\r\n      if ( op === null ) {\r\n        DOM.$addClass(el.$element, 'noop');\r\n        el.set('disabled', true);\r\n      } else {\r\n        el.on('click', function() {\r\n          self.operation(op);\r\n        });\r\n      }\r\n    });\r\n\r\n    return root;\r\n  }\r\n\r\n  operation(val) {\r\n    var self = this;\r\n\r\n    if (this.temp === '' && ['plus', 'minus', 'multiply', 'divide'].indexOf(val) !== -1) {\r\n      this.temp = this._find('Output').get('value');\r\n    }\r\n\r\n    function getAnswer() {\r\n      var nt = Number(self.entries[0]);\r\n\r\n      for ( var i = 1; i < self.entries.length; i++ ) {\r\n        var nextNum = Number(self.entries[i + 1]);\r\n        var symbol = self.entries[i];\r\n        if (symbol === '+') {\r\n          nt += nextNum;\r\n        } else if ( symbol === '-' ) {\r\n          nt -= nextNum;\r\n        } else if ( symbol === '*' ) {\r\n          nt *= nextNum;\r\n        } else if ( symbol === '/' ) {\r\n          nt /= nextNum;\r\n        }\r\n        i++;\r\n      }\r\n\r\n      if ( nt < 0 ) {\r\n        nt = '-' + Math.abs(nt);\r\n      }\r\n\r\n      return nt;\r\n    }\r\n\r\n    var output = (function() {\r\n      // Kudos http://codepen.io/GeoffStorbeck/pen/zxgaqw\r\n\r\n      if ( !isNaN(val) || val === 'dec' ) { // Number\r\n        self.temp += val === 'dec' ? ops[val] : val;\r\n\r\n        return self.temp.substring(0, 10);\r\n      } else if ( val === 'AC' ) { // Clear\r\n        self.entries = [];\r\n        self.temp = '';\r\n        self.total = 0;\r\n\r\n        return '';\r\n      } else if ( val === 'CE' ) { // Clear Last Entry\r\n        self.temp = '';\r\n\r\n        return '';\r\n      } else if ( val === 'equal' ) { // Equal\r\n        self.entries.push(self.temp);\r\n\r\n        var nt = getAnswer();\r\n        self.entries = [];\r\n        self.temp = '';\r\n\r\n        return nt;\r\n      } else {\r\n        if ( typeof ops[val] !== 'undefined' ) {\r\n          val = ops[val];\r\n        }\r\n\r\n        self.entries.push(self.temp);\r\n        self.entries.push(val);\r\n        self.temp = '';\r\n      }\r\n\r\n      return null;\r\n    })();\r\n\r\n    if ( output !== null ) {\r\n      if ( !String(output).length ) {\r\n        output = String(0);\r\n      }\r\n\r\n      if ( output === 'NaN' || output === 'Infinity' || isNaN(output) || !isFinite(output) ) {\r\n        DOM.$addClass(this._$element, 'NaN');\r\n\r\n        setTimeout(function() {\r\n          DOM.$removeClass(self._$element, 'NaN');\r\n        }, 3000);\r\n      }\r\n\r\n      this._find('Output').set('value', String(output));\r\n    }\r\n\r\n    this._find('Output').focus();\r\n  }\r\n}\r\n\r\nclass ApplicationCalculator extends Application {\r\n  constructor(args, metadata) {\r\n    super('ApplicationCalculator', args, metadata);\r\n  }\r\n\r\n  init(settings, metadata) {\r\n    super.init(...arguments);\r\n\r\n    this._addWindow(new ApplicationCalculatorWindow(this, metadata));\r\n  }\r\n}\r\n\r\nOSjs.Applications.ApplicationCalculator = ApplicationCalculator;\r\n\r\n});\r\n"]}